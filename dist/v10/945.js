"use strict";(self.webpackChunkdocs_nestjs_com=self.webpackChunkdocs_nestjs_com||[]).push([[945],{6945:(Y,M,F)=>{F.r(M),F.d(M,{TechniquesModule:()=>$});var P=F(177),j=F(685),R=F(445),a=F(8050),e=F(4438),E=F(5119),i=F(4819),c=F(2469);let L=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-caching"]],features:[e.Vt3],decls:520,vars:8,consts:[["contentReference",""],["app1fdf767f6ec9ee64addac93a57ae7e38a0f39694",""],["app75db61742f5aea88633e6be35dbef33ea540f42f",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/caching.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","gestion-du-cache"],["appAnchor","","id","installation"],[1,"language-bash"],[1,"warning"],["appAnchor","","id","cache-en-m\xe9moire"],[1,"language-typescript"],["appAnchor","","id","interagir-avec-le-stockage-de-donn\xe9es-dans-le-cache"],[1,"info"],["rel","nofollow","target","_blank","href","https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#javascript_types"],["appAnchor","","id","mise-en-cache-automatique-des-r\xe9ponses"],["routerLink","/graphql/quick-start"],["href","/interceptors#mappage-des-r\xe9ponses"],["appAnchor","","id","personnalisation-de-la-mise-en-cache"],["rel","nofollow","target","_blank","href","https://en.wikipedia.org/wiki/Time_to_live"],["appAnchor","","id","utilisation-globale-du-module"],["href","/modules#modules-globaux"],["appAnchor","","id","surcharges-du-cache-global"],["href","/techniques/caching#diff%C3%A9rents-stockages"],["href","/techniques/caching#personnalisation-de-la-mise-en-cache"],["appAnchor","","id","websockets-et-microservices"],[1,"with-heading"],[1,"filename"],["appAnchor","","id","ajuster-le-suivi"],["appAnchor","","id","diff\xe9rents-stockages"],["rel","nofollow","target","_blank","href","https://www.npmjs.com/package/cache-manager-redis-yet"],["rel","nofollow","target","_blank","href","https://github.com/jaredwray/cacheable/blob/main/packages/cache-manager/READMEv5.md#store-engines"],["appAnchor","","id","configuration-asynchrone"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/20-cache"]],template:function(o,t){if(1&o&&(e.j41(0,"div",3,0)(2,"div",4)(3,"a",5),e.nrm(4,"i",6),e.k0s()(),e.j41(5,"h3",7),e.EFF(6,"Gestion du cache"),e.k0s(),e.j41(7,"p"),e.EFF(8,"La mise en cache est une "),e.j41(9,"strong"),e.EFF(10,"technique"),e.k0s(),e.EFF(11," simple et efficace qui permet d'am\xe9liorer les performances de votre application. Elle agit comme un stockage temporaire de donn\xe9es qui permet un acc\xe8s performant aux donn\xe9es."),e.k0s(),e.j41(12,"h4",8)(13,"span"),e.EFF(14,"Installation"),e.k0s()(),e.j41(15,"p"),e.EFF(16,"Installez d'abord les packages n\xe9cessaires :"),e.k0s(),e.j41(17,"pre")(18,"code",9),e.EFF(19,"\n$ npm install @nestjs/cache-manager cache-manager\n"),e.k0s()(),e.j41(20,"blockquote",10)(21,"strong"),e.EFF(22,"Attention"),e.k0s(),e.EFF(23," La version 4 de "),e.j41(24,"code"),e.EFF(25,"cache-manager"),e.k0s(),e.EFF(26," utilise les secondes pour le "),e.j41(27,"code"),e.EFF(28,"TTL (Time-To-Live)"),e.k0s(),e.EFF(29,". La version actuelle de "),e.j41(30,"code"),e.EFF(31,"cache-manager"),e.k0s(),e.EFF(32," (v5) utilise des millisecondes \xe0 la place. NestJS ne convertit pas la valeur, et transmet simplement le ttl que vous fournissez \xe0 la biblioth\xe8que. En d'autres termes :\n"),e.j41(33,"ul")(34,"li"),e.EFF(35,"Si vous utilisez "),e.j41(36,"code"),e.EFF(37,"cache-manager"),e.k0s(),e.EFF(38," v4, fournissez le ttl en secondes"),e.k0s(),e.j41(39,"li"),e.EFF(40,"Si vous utilisez "),e.j41(41,"code"),e.EFF(42,"cache-manager"),e.k0s(),e.EFF(43," v5, fournissez le ttl en millisecondes."),e.k0s(),e.j41(44,"li"),e.EFF(45,"La documentation se r\xe9f\xe8re \xe0 des secondes, puisque NestJS a \xe9t\xe9 publi\xe9 avec la version 4 du gestionnaire de cache."),e.k0s()()(),e.j41(46,"h4",11)(47,"span"),e.EFF(48,"Cache en m\xe9moire"),e.k0s()(),e.j41(49,"p"),e.EFF(50,"Nest fournit une API unifi\xe9e pour diff\xe9rents fournisseurs de stockage de cache. Celui qui est int\xe9gr\xe9 est un stockage de donn\xe9es en m\xe9moire. Cependant, vous pouvez facilement passer \xe0 une solution plus compl\xe8te, comme Redis."),e.k0s(),e.j41(51,"p"),e.EFF(52,"Pour activer la mise en cache, importez le module "),e.j41(53,"code"),e.EFF(54,"CacheModule"),e.k0s(),e.EFF(55," et appelez sa m\xe9thode "),e.j41(56,"code"),e.EFF(57,"register()"),e.k0s(),e.EFF(58,"."),e.k0s(),e.j41(59,"app-copy-button")(60,"pre")(61,"code",12),e.EFF(62,"\nimport { Module } from '@nestjs/common';\nimport { CacheModule } from '@nestjs/cache-manager';\nimport { AppController } from './app.controller';\n\n@Module({\n  imports: [CacheModule.register()],\n  controllers: [AppController],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(63,"h4",13)(64,"span"),e.EFF(65,"Interagir avec le stockage de donn\xe9es dans le cache"),e.k0s()(),e.j41(66,"p"),e.EFF(67,"Pour interagir avec l'instance du gestionnaire de cache, injectez-la dans votre classe en utilisant le jeton "),e.j41(68,"code"),e.EFF(69,"CACHE_MANAGER"),e.k0s(),e.EFF(70,", comme suit :"),e.k0s(),e.j41(71,"app-copy-button")(72,"pre")(73,"code",12),e.EFF(74,"\nconstructor(@Inject(CACHE_MANAGER) private cacheManager: Cache) {}\n"),e.k0s()()(),e.j41(75,"blockquote",14)(76,"strong"),e.EFF(77,"Astuce"),e.k0s(),e.EFF(78," La classe "),e.j41(79,"code"),e.EFF(80,"Cache"),e.k0s(),e.EFF(81," est import\xe9e du package "),e.j41(82,"code"),e.EFF(83,"cache-manager"),e.k0s(),e.EFF(84,", tandis que le token "),e.j41(85,"code"),e.EFF(86,"CACHE_MANAGER"),e.k0s(),e.EFF(87," provient du package "),e.j41(88,"code"),e.EFF(89,"@nestjs/cache-manager"),e.k0s(),e.EFF(90,".\n"),e.k0s(),e.j41(91,"p"),e.EFF(92,"La m\xe9thode "),e.j41(93,"code"),e.EFF(94,"get"),e.k0s(),e.EFF(95," de l'instance "),e.j41(96,"code"),e.EFF(97,"Cache"),e.k0s(),e.EFF(98," (du package "),e.j41(99,"code"),e.EFF(100,"cache-manager"),e.k0s(),e.EFF(101,") est utilis\xe9e pour r\xe9cup\xe9rer des \xe9l\xe9ments du cache. Si l'\xe9l\xe9ment n'existe pas dans le cache, "),e.j41(102,"code"),e.EFF(103,"null"),e.k0s(),e.EFF(104," sera retourn\xe9."),e.k0s(),e.j41(105,"app-copy-button")(106,"pre")(107,"code",12),e.EFF(108,"\nconst value = await this.cacheManager.get('key');\n"),e.k0s()()(),e.j41(109,"p"),e.EFF(110,"Pour ajouter un \xe9l\xe9ment au cache, utilisez la m\xe9thode "),e.j41(111,"code"),e.EFF(112,"set"),e.k0s(),e.EFF(113," :"),e.k0s(),e.j41(114,"app-copy-button")(115,"pre")(116,"code",12),e.EFF(117,"\nawait this.cacheManager.set('key', 'value');\n"),e.k0s()()(),e.j41(118,"blockquote",10)(119,"strong"),e.EFF(120,"Note"),e.k0s(),e.EFF(121," La m\xe9moire cache en m\xe9moire ne peut stocker que des valeurs de types pris en charge par "),e.j41(122,"a",15),e.EFF(123,"l'algorithme de clonage structur\xe9"),e.k0s(),e.EFF(124,".\n"),e.k0s(),e.j41(125,"p"),e.EFF(126,"Le d\xe9lai d'expiration par d\xe9faut du cache est de 5 secondes."),e.k0s(),e.j41(127,"p"),e.EFF(128,"Vous pouvez sp\xe9cifier manuellement un TTL (d\xe9lai d'expiration en secondes) pour cette cl\xe9 sp\xe9cifique, comme suit :"),e.k0s(),e.j41(129,"app-copy-button")(130,"pre")(131,"code",12),e.EFF(132,"\nawait this.cacheManager.set('key', 'value', 1000);\n"),e.k0s()()(),e.j41(133,"p"),e.EFF(134,"Pour d\xe9sactiver l'expiration du cache, mettez la propri\xe9t\xe9 de configuration "),e.j41(135,"code"),e.EFF(136,"ttl"),e.k0s(),e.EFF(137," \xe0 "),e.j41(138,"code"),e.EFF(139,"0"),e.k0s(),e.EFF(140," :"),e.k0s(),e.j41(141,"app-copy-button")(142,"pre")(143,"code",12),e.EFF(144,"\nawait this.cacheManager.set('key', 'value', 0);\n"),e.k0s()()(),e.j41(145,"p"),e.EFF(146,"Pour supprimer un \xe9l\xe9ment du cache, utilisez la m\xe9thode "),e.j41(147,"code"),e.EFF(148,"del"),e.k0s(),e.EFF(149," :"),e.k0s(),e.j41(150,"app-copy-button")(151,"pre")(152,"code",12),e.EFF(153,"\nawait this.cacheManager.del('key');\n"),e.k0s()()(),e.j41(154,"p"),e.EFF(155,"Pour effacer tout le cache, utilisez la m\xe9thode "),e.j41(156,"code"),e.EFF(157,"reset"),e.k0s(),e.EFF(158," :"),e.k0s(),e.j41(159,"app-copy-button")(160,"pre")(161,"code",12),e.EFF(162,"\nawait this.cacheManager.reset();\n"),e.k0s()()(),e.j41(163,"h4",16)(164,"span"),e.EFF(165,"Mise en cache automatique des r\xe9ponses"),e.k0s()(),e.j41(166,"blockquote",10)(167,"strong"),e.EFF(168,"Attention"),e.k0s(),e.EFF(169," Dans les applications "),e.j41(170,"a",17),e.EFF(171,"GraphQL"),e.k0s(),e.EFF(172,", les intercepteurs sont ex\xe9cut\xe9s s\xe9par\xe9ment pour chaque r\xe9solveur de champs. Ainsi, "),e.j41(173,"code"),e.EFF(174,"CacheModule"),e.k0s(),e.EFF(175," (qui utilise les intercepteurs pour mettre en cache les r\xe9ponses) ne fonctionnera pas correctement.\n"),e.k0s(),e.j41(176,"p"),e.EFF(177,"Pour activer la mise en cache automatique des r\xe9ponses, il suffit de lier le "),e.j41(178,"code"),e.EFF(179,"CacheInterceptor"),e.k0s(),e.EFF(180," \xe0 l'endroit o\xf9 vous voulez mettre les donn\xe9es en cache."),e.k0s(),e.j41(181,"app-copy-button")(182,"pre")(183,"code",12),e.EFF(184,"\n@Controller()\n@UseInterceptors(CacheInterceptor)\nexport class AppController {\n  @Get()\n  findAll(): string[] {\n    return [];\n  }\n}\n"),e.k0s()()(),e.j41(185,"blockquote",10)(186,"strong"),e.EFF(187,"Attention"),e.k0s(),e.EFF(188," Seuls les endpoints "),e.j41(189,"code"),e.EFF(190,"GET"),e.k0s(),e.EFF(191," sont mis en cache. De m\xeame, les routes de serveur HTTP qui injectent l'objet de r\xe9ponse natif ("),e.j41(192,"code"),e.EFF(193,"@Res()"),e.k0s(),e.EFF(194,") ne peuvent pas utiliser l'intercepteur de cache. Voir\n"),e.j41(195,"a",18),e.EFF(196,"mappage des r\xe9ponses"),e.k0s(),e.EFF(197," pour plus de d\xe9tails.\n"),e.k0s(),e.j41(198,"p"),e.EFF(199,"Pour r\xe9duire la quantit\xe9 de code de base n\xe9cessaire, vous pouvez lier "),e.j41(200,"code"),e.EFF(201,"CacheInterceptor"),e.k0s(),e.EFF(202," \xe0 tous les points de terminaison de mani\xe8re globale :"),e.k0s(),e.j41(203,"app-copy-button")(204,"pre")(205,"code",12),e.EFF(206,"\nimport { Module } from '@nestjs/common';\nimport { CacheModule, CacheInterceptor } from '@nestjs/cache-manager';\nimport { AppController } from './app.controller';\nimport { APP_INTERCEPTOR } from '@nestjs/core';\n\n@Module({\n  imports: [CacheModule.register()],\n  controllers: [AppController],\n  providers: [\n    {\n      provide: APP_INTERCEPTOR,\n      useClass: CacheInterceptor,\n    },\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(207,"h4",19)(208,"span"),e.EFF(209,"Personnalisation de la mise en cache"),e.k0s()(),e.j41(210,"p"),e.EFF(211,"Toutes les donn\xe9es mises en cache ont leur propre d\xe9lai d'expiration ("),e.j41(212,"a",20),e.EFF(213,"TTL"),e.k0s(),e.EFF(214,"). Pour personnaliser les valeurs par d\xe9faut, passez l'objet options \xe0 la m\xe9thode "),e.j41(215,"code"),e.EFF(216,"register()"),e.k0s(),e.EFF(217,"."),e.k0s(),e.j41(218,"app-copy-button")(219,"pre")(220,"code",12),e.EFF(221,"\nCacheModule.register({\n  ttl: 5, // secondes\n  max: 10, // nombre maximum d'\xe9l\xe9ments dans le cache\n});\n"),e.k0s()()(),e.j41(222,"h4",21)(223,"span"),e.EFF(224,"Utilisation globale du module"),e.k0s()(),e.j41(225,"p"),e.EFF(226,"Lorsque vous voulez utiliser "),e.j41(227,"code"),e.EFF(228,"CacheModule"),e.k0s(),e.EFF(229," dans d'autres modules, vous devez l'importer (comme c'est le cas pour tout module Nest). Vous pouvez aussi le d\xe9clarer comme "),e.j41(230,"a",22),e.EFF(231,"module global"),e.k0s(),e.EFF(232," en fixant la propri\xe9t\xe9 "),e.j41(233,"code"),e.EFF(234,"isGlobal"),e.k0s(),e.EFF(235," de l'objet options \xe0 "),e.j41(236,"code"),e.EFF(237,"true"),e.k0s(),e.EFF(238,", comme indiqu\xe9 ci-dessous. Dans ce cas, vous n'aurez pas besoin d'importer "),e.j41(239,"code"),e.EFF(240,"CacheModule"),e.k0s(),e.EFF(241," dans d'autres modules une fois qu'il aura \xe9t\xe9 charg\xe9 dans le module racine (par exemple, "),e.j41(242,"code"),e.EFF(243,"AppModule"),e.k0s(),e.EFF(244,")."),e.k0s(),e.j41(245,"app-copy-button")(246,"pre")(247,"code",12),e.EFF(248,"\nCacheModule.register({\n  isGlobal: true,\n});\n"),e.k0s()()(),e.j41(249,"h4",23)(250,"span"),e.EFF(251,"Surcharges du cache global"),e.k0s()(),e.j41(252,"p"),e.EFF(253,"Lorsque le cache global est activ\xe9, les entr\xe9es du cache sont stock\xe9es sous une "),e.j41(254,"code"),e.EFF(255,"CacheKey"),e.k0s(),e.EFF(256," qui est g\xe9n\xe9r\xe9e automatiquement en fonction du chemin de la route. Vous pouvez surcharger certains param\xe8tres de cache ("),e.j41(257,"code"),e.EFF(258,"@CacheKey()"),e.k0s(),e.EFF(259," et "),e.j41(260,"code"),e.EFF(261,"@CacheTTL()"),e.k0s(),e.EFF(262,") pour chaque m\xe9thode, ce qui permet de personnaliser les strat\xe9gies de mise en cache pour les m\xe9thodes individuelles des contr\xf4leurs. Cela peut s'av\xe9rer tr\xe8s utile lors de l'utilisation de "),e.j41(263,"a",24),e.EFF(264,"diff\xe9rents stockages de cache"),e.k0s(),e.EFF(265,"."),e.k0s(),e.j41(266,"p"),e.EFF(267,"Vous pouvez appliquer le d\xe9corateur "),e.j41(268,"code"),e.EFF(269,"@CacheTTL()"),e.k0s(),e.EFF(270," \xe0 chaque contr\xf4leur pour d\xe9finir un TTL de cache pour l'ensemble du contr\xf4leur. Dans les situations o\xf9 des param\xe8tres de TTL de cache au niveau du contr\xf4leur et au niveau de la m\xe9thode sont d\xe9finis, les param\xe8tres de TTL de cache sp\xe9cifi\xe9s au niveau de la m\xe9thode auront la priorit\xe9 sur ceux d\xe9finis au niveau du contr\xf4leur."),e.k0s(),e.j41(271,"app-copy-button")(272,"pre")(273,"code",12),e.EFF(274,"\n@Controller()\n@CacheTTL(50)\nexport class AppController {\n  @CacheKey('custom_key')\n  @CacheTTL(20)\n  findAll(): string[] {\n    return [];\n  }\n}\n"),e.k0s()()(),e.j41(275,"blockquote",14)(276,"strong"),e.EFF(277,"Astuce"),e.k0s(),e.EFF(278," Les d\xe9corateurs "),e.j41(279,"code"),e.EFF(280,"@CacheKey()"),e.k0s(),e.EFF(281," et "),e.j41(282,"code"),e.EFF(283,"@CacheTTL()"),e.k0s(),e.EFF(284," sont import\xe9s du package "),e.j41(285,"code"),e.EFF(286,"@nestjs/cache-manager"),e.k0s(),e.EFF(287,".\n"),e.k0s(),e.j41(288,"p"),e.EFF(289,"The "),e.j41(290,"code"),e.EFF(291,"@CacheKey()"),e.k0s(),e.EFF(292," decorator may be used with or without a corresponding "),e.j41(293,"code"),e.EFF(294,"@CacheTTL()"),e.k0s(),e.EFF(295," decorator and vice versa. One may choose to override only the "),e.j41(296,"code"),e.EFF(297,"@CacheKey()"),e.k0s(),e.EFF(298," or only the "),e.j41(299,"code"),e.EFF(300,"@CacheTTL()"),e.k0s(),e.EFF(301,". Settings that are not overridden with a decorator will use the default values as registered globally (see "),e.j41(302,"a",25),e.EFF(303,"Customize caching"),e.k0s(),e.EFF(304,")."),e.k0s(),e.j41(305,"h4",26)(306,"span"),e.EFF(307,"WebSockets et Microservices"),e.k0s()(),e.j41(308,"p"),e.EFF(309,"Vous pouvez \xe9galement appliquer le "),e.j41(310,"code"),e.EFF(311,"CacheInterceptor"),e.k0s(),e.EFF(312," aux abonn\xe9s WebSocket ainsi qu'aux patterns Microservice (quelle que soit la m\xe9thode de transport utilis\xe9e)."),e.k0s(),e.j41(313,"app-copy-button",27)(314,"span",28),e.nrm(315,"app-tabs",null,1),e.k0s(),e.j41(317,"pre")(318,"code",12),e.EFF(319,"\n@CacheKey('events')\n@UseInterceptors(CacheInterceptor)\n@SubscribeMessage('events')\nhandleEvent(client: Client, data: string[]): Observable<string[]> {\n  return [];\n}\n"),e.k0s()(),e.j41(320,"pre")(321,"code",12),e.EFF(322,"\n@CacheKey('events')\n@UseInterceptors(CacheInterceptor)\n@SubscribeMessage('events')\nhandleEvent(client, data) {\n  return [];\n}\n"),e.k0s()()(),e.j41(323,"p"),e.EFF(324,"Cependant, le d\xe9corateur suppl\xe9mentaire "),e.j41(325,"code"),e.EFF(326,"@CacheKey()"),e.k0s(),e.EFF(327," est n\xe9cessaire pour sp\xe9cifier une cl\xe9 utilis\xe9e pour stocker et r\xe9cup\xe9rer ult\xe9rieurement les donn\xe9es mises en cache. Notez \xe9galement qu'il ne faut pas "),e.j41(328,"strong"),e.EFF(329,"tout mettre en cache"),e.k0s(),e.EFF(330,". Les actions qui effectuent des op\xe9rations m\xe9tier plut\xf4t que de simplement interroger les donn\xe9es ne doivent jamais \xeatre mises en cache."),e.k0s(),e.j41(331,"p"),e.EFF(332,"De plus, vous pouvez sp\xe9cifier un d\xe9lai d'expiration du cache (TTL) en utilisant le d\xe9corateur "),e.j41(333,"code"),e.EFF(334,"@CacheTTL()"),e.k0s(),e.EFF(335,", qui remplacera la valeur globale par d\xe9faut du TTL."),e.k0s(),e.j41(336,"app-copy-button",27)(337,"span",28),e.nrm(338,"app-tabs",null,2),e.k0s(),e.j41(340,"pre")(341,"code",12),e.EFF(342,"\n@CacheTTL(10)\n@UseInterceptors(CacheInterceptor)\n@SubscribeMessage('events')\nhandleEvent(client: Client, data: string[]): Observable<string[]> {\n  return [];\n}\n"),e.k0s()(),e.j41(343,"pre")(344,"code",12),e.EFF(345,"\n@CacheTTL(10)\n@UseInterceptors(CacheInterceptor)\n@SubscribeMessage('events')\nhandleEvent(client, data) {\n  return [];\n}\n"),e.k0s()()(),e.j41(346,"blockquote",14)(347,"strong"),e.EFF(348,"Astuce"),e.k0s(),e.EFF(349," Le d\xe9corateur "),e.j41(350,"code"),e.EFF(351,"@CacheTTL()"),e.k0s(),e.EFF(352," peut \xeatre utilis\xe9 avec ou sans le d\xe9corateur "),e.j41(353,"code"),e.EFF(354,"@CacheKey()"),e.k0s(),e.EFF(355," correspondant.\n"),e.k0s(),e.j41(356,"h4",29)(357,"span"),e.EFF(358,"Ajuster le suivi"),e.k0s()(),e.j41(359,"p"),e.EFF(360,"Par d\xe9faut, Nest utilise l'URL de la requ\xeate (dans une application HTTP) ou la cl\xe9 de cache (dans les applications websockets et microservices, d\xe9finie via le d\xe9corateur "),e.j41(361,"code"),e.EFF(362,"@CacheKey()"),e.k0s(),e.EFF(363,") pour associer les enregistrements de cache \xe0 vos endpoints. N\xe9anmoins, vous pouvez parfois vouloir mettre en place un suivi bas\xe9 sur diff\xe9rents facteurs, par exemple, en utilisant des en-t\xeates HTTP (par exemple, "),e.j41(364,"code"),e.EFF(365,"Authorization"),e.k0s(),e.EFF(366," pour identifier correctement les points de terminaison "),e.j41(367,"code"),e.EFF(368,"profile"),e.k0s(),e.EFF(369,")."),e.k0s(),e.j41(370,"p"),e.EFF(371,"Pour ce faire, cr\xe9ez une sous-classe de "),e.j41(372,"code"),e.EFF(373,"CacheInterceptor"),e.k0s(),e.EFF(374," et surchargez la m\xe9thode "),e.j41(375,"code"),e.EFF(376,"trackBy()"),e.k0s(),e.EFF(377,"."),e.k0s(),e.j41(378,"app-copy-button")(379,"pre")(380,"code",12),e.EFF(381,"\n@Injectable()\nclass HttpCacheInterceptor extends CacheInterceptor {\n  trackBy(context: ExecutionContext): string | undefined {\n    return 'key';\n  }\n}\n"),e.k0s()()(),e.j41(382,"h4",30)(383,"span"),e.EFF(384,"Diff\xe9rents stockages"),e.k0s()(),e.j41(385,"p"),e.EFF(386,"Le paquetage "),e.j41(387,"code"),e.EFF(388,"cache-manager"),e.k0s(),e.EFF(389," offre une vari\xe9t\xe9 d'options de stockage utiles, y compris le "),e.j41(390,"a",31),e.EFF(391,"Redis store"),e.k0s(),e.EFF(392,", qui est le package officiel pour l'int\xe9gration de Redis avec cache-manager. Vous pouvez trouver une liste compl\xe8te des stores support\xe9s "),e.j41(393,"a",32),e.EFF(394,"ici"),e.k0s(),e.EFF(395,". Pour configurer le store Redis, utilisez la m\xe9thode "),e.j41(396,"code"),e.EFF(397,"registerAsync()"),e.k0s(),e.EFF(398," pour l'initialiser, comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(399,"app-copy-button")(400,"pre")(401,"code",12),e.EFF(402,"\nimport { redisStore } from 'cache-manager-redis-yet';\nimport { Module } from '@nestjs/common';\nimport { CacheModule, CacheStore } from '@nestjs/cache-manager';\nimport { AppController } from './app.controller';\n\n@Module({\n  imports: [\n    CacheModule.registerAsync({\n      useFactory: async () => {\n        const store = await redisStore({\n          socket: {\n            host: 'localhost',\n            port: 6379,\n          },\n        });\n\n        return {\n          store: store as unknown as CacheStore,\n          ttl: 3 * 60000, // 3 minutes (milliseconds)\n        };\n      },\n    }),\n  ],\n  controllers: [AppController],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(403,"blockquote",10)(404,"strong"),e.EFF(405,"Attention"),e.k0s(),e.EFF(406," Le paquet "),e.j41(407,"code"),e.EFF(408,"cache-manager-redis-yet"),e.k0s(),e.EFF(409," requiert que le param\xe8tre "),e.j41(410,"code"),e.EFF(411,"ttl"),e.k0s(),e.EFF(412," (time-to-live) soit sp\xe9cifi\xe9 directement plut\xf4t que dans les options du module.\n"),e.k0s(),e.j41(413,"h4",33)(414,"span"),e.EFF(415,"Configuration asynchrone"),e.k0s()(),e.j41(416,"p"),e.EFF(417,"Vous pouvez vouloir passer des options de module de mani\xe8re asynchrone au lieu de les passer statiquement au moment de la compilation. Dans ce cas, utilisez la m\xe9thode "),e.j41(418,"code"),e.EFF(419,"registerAsync()"),e.k0s(),e.EFF(420,", qui fournit plusieurs fa\xe7ons de g\xe9rer la configuration asynchrone."),e.k0s(),e.j41(421,"p"),e.EFF(422,"Une approche consiste \xe0 utiliser une fonction factory :"),e.k0s(),e.j41(423,"app-copy-button")(424,"pre")(425,"code",12),e.EFF(426,"\nCacheModule.registerAsync({\n  useFactory: () => ({\n    ttl: 5,\n  }),\n});\n"),e.k0s()()(),e.j41(427,"p"),e.EFF(428,"Notre fabrique se comporte comme toutes les autres fabriques de modules asynchrones (elle peut \xeatre "),e.j41(429,"code"),e.EFF(430,"async"),e.k0s(),e.EFF(431," et est capable d'injecter des d\xe9pendances via "),e.j41(432,"code"),e.EFF(433,"inject"),e.k0s(),e.EFF(434,")."),e.k0s(),e.j41(435,"app-copy-button")(436,"pre")(437,"code",12),e.EFF(438,"\nCacheModule.registerAsync({\n  imports: [ConfigModule],\n  useFactory: async (configService: ConfigService) => ({\n    ttl: configService.get('CACHE_TTL'),\n  }),\n  inject: [ConfigService],\n});\n"),e.k0s()()(),e.j41(439,"p"),e.EFF(440,"Vous pouvez \xe9galement utiliser la m\xe9thode "),e.j41(441,"code"),e.EFF(442,"useClass"),e.k0s(),e.EFF(443," :"),e.k0s(),e.j41(444,"app-copy-button")(445,"pre")(446,"code",12),e.EFF(447,"\nCacheModule.registerAsync({\n  useClass: CacheConfigService,\n});\n"),e.k0s()()(),e.j41(448,"p"),e.EFF(449,"La construction ci-dessus instanciera "),e.j41(450,"code"),e.EFF(451,"CacheConfigService"),e.k0s(),e.EFF(452," dans "),e.j41(453,"code"),e.EFF(454,"CacheModule"),e.k0s(),e.EFF(455," et l'utilisera pour obtenir l'objet options. Le "),e.j41(456,"code"),e.EFF(457,"CacheConfigService"),e.k0s(),e.EFF(458," doit impl\xe9menter l'interface "),e.j41(459,"code"),e.EFF(460,"CacheOptionsFactory"),e.k0s(),e.EFF(461," afin de fournir les options de configuration :"),e.k0s(),e.j41(462,"app-copy-button")(463,"pre")(464,"code",12),e.EFF(465,"\n@Injectable()\nclass CacheConfigService implements CacheOptionsFactory {\n  createCacheOptions(): CacheModuleOptions {\n    return {\n      ttl: 5,\n    };\n  }\n}\n"),e.k0s()()(),e.j41(466,"p"),e.EFF(467,"Si vous souhaitez utiliser un fournisseur de configuration existant import\xe9 d'un module diff\xe9rent, utilisez la syntaxe "),e.j41(468,"code"),e.EFF(469,"useExisting"),e.k0s(),e.EFF(470," :"),e.k0s(),e.j41(471,"app-copy-button")(472,"pre")(473,"code",12),e.EFF(474,"\nCacheModule.registerAsync({\n  imports: [ConfigModule],\n  useExisting: ConfigService,\n});\n"),e.k0s()()(),e.j41(475,"p"),e.EFF(476,"Cela fonctionne de la m\xeame mani\xe8re que "),e.j41(477,"code"),e.EFF(478,"useClass"),e.k0s(),e.EFF(479," avec une diff\xe9rence essentielle - "),e.j41(480,"code"),e.EFF(481,"CacheModule"),e.k0s(),e.EFF(482," va chercher dans les modules import\xe9s pour r\xe9utiliser tout "),e.j41(483,"code"),e.EFF(484,"ConfigService"),e.k0s(),e.EFF(485," d\xe9j\xe0 cr\xe9\xe9, au lieu d'instancier le sien."),e.k0s(),e.j41(486,"blockquote",14)(487,"strong"),e.EFF(488,"Astuce"),e.k0s(),e.j41(489,"code"),e.EFF(490,"CacheModule#register"),e.k0s(),e.EFF(491," et "),e.j41(492,"code"),e.EFF(493,"CacheModule#registerAsync"),e.k0s(),e.EFF(494," et "),e.j41(495,"code"),e.EFF(496,"CacheOptionsFactory"),e.k0s(),e.EFF(497," ont un g\xe9n\xe9rique optionnel (argument de type) pour restreindre les options de configuration sp\xe9cifiques au magasin, ce qui les rend s\xfbrs du point de vue du type.\n"),e.k0s(),e.j41(498,"p"),e.EFF(499,"Vous pouvez \xe9galement passer ce que l'on appelle des "),e.j41(500,"code"),e.EFF(501,"extraProviders"),e.k0s(),e.EFF(502," \xe0 la m\xe9thode "),e.j41(503,"code"),e.EFF(504,"registerAsync()"),e.k0s(),e.EFF(505,". Ces fournisseurs seront fusionn\xe9s avec les fournisseurs du module."),e.k0s(),e.j41(506,"app-copy-button")(507,"pre")(508,"code",12),e.EFF(509,"\nCacheModule.registerAsync({\n  imports: [ConfigModule],\n  useClass: ConfigService,\n  extraProviders: [MyAdditionalProvider],\n});\n"),e.k0s()()(),e.j41(510,"p"),e.EFF(511,"C'est utile lorsque vous souhaitez fournir des d\xe9pendances suppl\xe9mentaires \xe0 la fonction de factory ou au constructeur de la classe."),e.k0s(),e.j41(512,"h4",34)(513,"span"),e.EFF(514,"Exemple"),e.k0s()(),e.j41(515,"p"),e.EFF(516,"Un exemple concret est disponible "),e.j41(517,"a",35),e.EFF(518,"ici"),e.k0s(),e.EFF(519,"."),e.k0s()()),2&o){const u=e.sdS(316),r=e.sdS(339);e.R7$(317),e.AVh("hide",u.isJsActive),e.R7$(3),e.AVh("hide",!u.isJsActive),e.R7$(20),e.AVh("hide",r.isJsActive),e.R7$(3),e.AVh("hide",!r.isJsActive)}},dependencies:[E.O,i.a,c.z,j.Wk],encapsulation:2,changeDetection:0})}return s})(),I=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-compression"]],features:[e.Vt3],decls:87,vars:0,consts:[["contentReference",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/compression.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","compression"],["appAnchor","","id","utilisation-avec-express-par-d\xe9faut"],["rel","nofollow","target","_blank","href","https://github.com/expressjs/compression"],[1,"language-bash"],[1,"language-typescript"],["appAnchor","","id","utilisation-avec-fastify"],["rel","nofollow","target","_blank","href","https://github.com/fastify/fastify-compress"]],template:function(o,t){1&o&&(e.j41(0,"div",1,0)(2,"div",2)(3,"a",3),e.nrm(4,"i",4),e.k0s()(),e.j41(5,"h3",5),e.EFF(6,"Compression"),e.k0s(),e.j41(7,"p"),e.EFF(8,"La compression permet de r\xe9duire consid\xe9rablement la taille du corps de la r\xe9ponse, ce qui augmente la vitesse d'une application web."),e.k0s(),e.j41(9,"p"),e.EFF(10,"Pour les sites web "),e.j41(11,"strong"),e.EFF(12,"\xe0 fort trafic"),e.k0s(),e.EFF(13," en production, il est fortement recommand\xe9 de d\xe9charger la compression du serveur d'application - typiquement en utilisant un proxy inverse \xe0 la place (par exemple, Nginx). Dans ce cas, vous ne devriez pas utiliser de middleware de compression."),e.k0s(),e.j41(14,"h4",6)(15,"span"),e.EFF(16,"Utilisation avec Express (par d\xe9faut)"),e.k0s()(),e.j41(17,"p"),e.EFF(18,"Utilisez le package middleware "),e.j41(19,"a",7),e.EFF(20,"compression"),e.k0s(),e.EFF(21," pour activer la compression gzip."),e.k0s(),e.j41(22,"p"),e.EFF(23,"Installez d'abord le package requis :"),e.k0s(),e.j41(24,"pre")(25,"code",8),e.EFF(26,"\n$ npm i --save compression\n"),e.k0s()(),e.j41(27,"p"),e.EFF(28,"Une fois l'installation termin\xe9e, appliquez le middleware de compression en tant que middleware global."),e.k0s(),e.j41(29,"app-copy-button")(30,"pre")(31,"code",9),e.EFF(32,"\nimport * as compression from 'compression';\n// quelque part dans votre fichier d'initialisation\napp.use(compression());\n"),e.k0s()()(),e.j41(33,"h4",10)(34,"span"),e.EFF(35,"Utilisation avec Fastify"),e.k0s()(),e.j41(36,"p"),e.EFF(37,"Si vous utilisez l'adaptateur "),e.j41(38,"code"),e.EFF(39,"FastifyAdapter"),e.k0s(),e.EFF(40,", vous devrez utiliser "),e.j41(41,"a",11),e.EFF(42,"fastify-compress"),e.k0s(),e.EFF(43," :"),e.k0s(),e.j41(44,"pre")(45,"code",8),e.EFF(46,"\n$ npm i --save @fastify/compress\n"),e.k0s()(),e.j41(47,"p"),e.EFF(48,"Une fois l'installation termin\xe9e, appliquez le middleware "),e.j41(49,"code"),e.EFF(50,"@fastify/compress"),e.k0s(),e.EFF(51," en tant que middleware global."),e.k0s(),e.j41(52,"app-copy-button")(53,"pre")(54,"code",9),e.EFF(55,"\nimport compression from '@fastify/compress';\n// quelque part dans votre fichier d'initialisation\nawait app.register(compression);\n"),e.k0s()()(),e.j41(56,"p"),e.EFF(57,"Par d\xe9faut, "),e.j41(58,"code"),e.EFF(59,"@fastify/compress"),e.k0s(),e.EFF(60," utilisera la compression Brotli (sur Node >= 11.7.0) lorsque les navigateurs indiquent qu'ils supportent cet encodage. Bien que Brotli puisse \xeatre assez efficace en termes de taux de compression, il peut aussi \xeatre assez lent. Par d\xe9faut, Brotli d\xe9finit une qualit\xe9 de compression maximale de 11, bien qu'elle puisse \xeatre ajust\xe9e pour r\xe9duire le temps de compression au d\xe9triment de la qualit\xe9 de compression en ajustant le param\xe8tre "),e.j41(61,"code"),e.EFF(62,"BROTLI_PARAM_QUALITY"),e.k0s(),e.EFF(63," entre 0 (minimum) et 11 (maximum). Cela n\xe9cessitera un r\xe9glage fin pour optimiser les performances en termes d'espace et de temps. Voici un exemple avec une qualit\xe9 de 4 :"),e.k0s(),e.j41(64,"app-copy-button")(65,"pre")(66,"code",9),e.EFF(67,"\nimport { constants } from 'zlib';\n// quelque part dans votre fichier d'initialisation\nawait app.register(compression, { brotliOptions: { params: { [constants.BROTLI_PARAM_QUALITY]: 4 } } });\n"),e.k0s()()(),e.j41(68,"p"),e.EFF(69,"Pour simplifier, vous pouvez demander \xe0 "),e.j41(70,"code"),e.EFF(71,"fastify-compress"),e.k0s(),e.EFF(72," d'utiliser uniquement la compression deflate et gzip pour compresser les r\xe9ponses; cela peut entra\xeener des r\xe9ponses potentiellement plus volumineuses, mais elles seront livr\xe9es beaucoup plus rapidement."),e.k0s(),e.j41(73,"p"),e.EFF(74,"Pour sp\xe9cifier les encodages, il faut fournir un second argument \xe0 "),e.j41(75,"code"),e.EFF(76,"app.register"),e.k0s(),e.EFF(77," :"),e.k0s(),e.j41(78,"app-copy-button")(79,"pre")(80,"code",9),e.EFF(81,"\nawait app.register(compression, { encodings: ['gzip', 'deflate'] });\n"),e.k0s()()(),e.j41(82,"p"),e.EFF(83,"Ce qui pr\xe9c\xe8de indique \xe0 "),e.j41(84,"code"),e.EFF(85,"fastify-compress"),e.k0s(),e.EFF(86," de n'utiliser que les encodages gzip et deflate, en pr\xe9f\xe9rant gzip si le client supporte les deux."),e.k0s()())},dependencies:[i.a,c.z],encapsulation:2,changeDetection:0})}return s})();var z=F(7077),k=F(5663);let w=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-configuration"]],features:[e.Vt3],decls:1054,vars:60,consts:[["contentReference",""],["app4247b40d15d0b27b9761df89465ff970409433ad",""],["appfc54f6d7f60cd8a931f106f08938839d6c1e88e0",""],["appcb106576ea6f21c73745aad2f6858ac701a944e9",""],["appe0c1e5d39028474838828ece1429cbb9c320e113",""],["app1550a61ee0ed359bb3fe2e5277fa963d09ec8569",""],["appddf635beb3bed44f691c13bb93f7f994b3b625ab",""],["appf72ce31e817140a0d5a7ac850dea81d583ea17f2",""],["app65619a056728a445e1ca7d4e97ff8a2569695a47",""],["appdadbec1cabc0b48fc540789b9a65a88872b56e79",""],["app770fbb959268f59c3c0f34fed54079d8f69c4cd5",""],["app75d4ca81fa541566d50bdba3bb7049997d974593",""],["app05994e21f355b7e739d8d09e1167745341e352ac",""],["appc254a1a7a587125086d414b564ad33187ec7e662",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/configuration.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","configuration"],["rel","nofollow","target","_blank","href","https://12factor.net/config"],["appAnchor","","id","installation"],[1,"language-bash"],[1,"info"],["rel","nofollow","target","_blank","href","https://github.com/motdotla/dotenv"],[1,"warning"],["appAnchor","","id","pour-commencer"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],[1,"language-json"],["appAnchor","","id","chemin-dacc\xe8s-personnalis\xe9-au-fichier-env"],["appAnchor","","id","d\xe9sactiver-le-chargement-des-variables-denvironnement"],["appAnchor","","id","utilisation-globale-du-module"],["href","/modules#modules-globaux"],["appAnchor","","id","fichiers-de-configuration-personnalis\xe9s"],["href","techniques/configuration#pour-commencer"],[1,"language-yaml"],["href","/cli/monorepo#assets"],["appAnchor","","id","utilisation-de-configservice"],["href","techniques/configuration#fichiers-de-configuration-personnalis\xe9s"],["appAnchor","","id","espaces-de-noms-de-configuration"],["appAnchor","","id","les-configurations-\xe0-namespace-dans-les-modules"],["appAnchor","","id","variables-denvironnement-du-cache"],["appAnchor","","id","enregistrement-partiel"],["appAnchor","","id","validation-du-sch\xe9ma"],["rel","nofollow","target","_blank","href","https://github.com/sideway/joi"],["rel","nofollow","target","_blank","href","https://joi.dev/api/?v=17.3.0#example"],["rel","nofollow","target","_blank","href","https://joi.dev/api/?v=17.3.0#anyvalidatevalue-options"],["appAnchor","","id","fonction-de-validation-personnalis\xe9e"],["appAnchor","","id","fonctions-getter-personnalis\xe9es"],["appAnchor","","id","hook-des-variables-denvironnement-charg\xe9es"],["appAnchor","","id","configuration-conditionnelle-du-module"],["appAnchor","","id","variables-extensibles"],["rel","nofollow","target","_blank","href","https://github.com/motdotla/dotenv-expand"],["appAnchor","","id","utilisation-dans-maints"]],template:function(o,t){if(1&o&&(e.j41(0,"div",14,0)(2,"div",15)(3,"a",16),e.nrm(4,"i",17),e.k0s()(),e.j41(5,"h3",18),e.EFF(6,"Configuration"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Les applications fonctionnent souvent dans diff\xe9rents "),e.j41(9,"strong"),e.EFF(10,"environnements"),e.k0s(),e.EFF(11,". Selon l'environnement, diff\xe9rents param\xe8tres de configuration doivent \xeatre utilis\xe9s. Par exemple, l'environnement local s'appuie g\xe9n\xe9ralement sur des identifiants de base de donn\xe9es sp\xe9cifiques, valables uniquement pour l'instance locale de la base de donn\xe9es. L'environnement de production utilise un ensemble distinct d'identifiants de base de donn\xe9es. \xc9tant donn\xe9 que les variables de configuration changent, la meilleure pratique consiste \xe0 "),e.j41(12,"a",19),e.EFF(13,"stocker les variables de configuration"),e.k0s(),e.EFF(14," dans l'environnement."),e.k0s(),e.j41(15,"p"),e.EFF(16,"Les variables d'environnement d\xe9finies \xe0 l'ext\xe9rieur sont visibles \xe0 l'int\xe9rieur de Node.js \xe0 travers la variable globale "),e.j41(17,"code"),e.EFF(18,"process.env"),e.k0s(),e.EFF(19,". Nous pourrions essayer de r\xe9soudre le probl\xe8me des environnements multiples en d\xe9finissant les variables d'environnement s\xe9par\xe9ment dans chaque environnement. Cela peut rapidement devenir compliqu\xe9, en particulier dans les environnements de d\xe9veloppement et de test o\xf9 ces valeurs doivent \xeatre facilement simul\xe9es et/ou modifi\xe9es."),e.k0s(),e.j41(20,"p"),e.EFF(21,"Dans les applications Node.js, il est courant d'utiliser des fichiers "),e.j41(22,"code"),e.EFF(23,".env"),e.k0s(),e.EFF(24,", contenant des paires cl\xe9-valeur o\xf9 chaque cl\xe9 repr\xe9sente une valeur particuli\xe8re, pour repr\xe9senter chaque environnement. L'ex\xe9cution d'une application dans diff\xe9rents environnements n'est alors qu'une question de permutation du bon fichier "),e.j41(25,"code"),e.EFF(26,".env"),e.k0s(),e.EFF(27,"."),e.k0s(),e.j41(28,"p"),e.EFF(29,"Une bonne approche pour utiliser cette technique dans Nest est de cr\xe9er un "),e.j41(30,"code"),e.EFF(31,"ConfigModule"),e.k0s(),e.EFF(32," qui expose un "),e.j41(33,"code"),e.EFF(34,"ConfigService"),e.k0s(),e.EFF(35," qui charge le fichier "),e.j41(36,"code"),e.EFF(37,".env"),e.k0s(),e.EFF(38," appropri\xe9. Bien que vous puissiez choisir d'\xe9crire un tel module vous-m\xeame, Nest fournit le package "),e.j41(39,"code"),e.EFF(40,"@nestjs/config"),e.k0s(),e.EFF(41," pr\xeat \xe0 l'emploi. Nous couvrirons ce package dans le chapitre actuel."),e.k0s(),e.j41(42,"h4",20)(43,"span"),e.EFF(44,"Installation"),e.k0s()(),e.j41(45,"p"),e.EFF(46,"Pour commencer \xe0 l'utiliser, nous devons d'abord installer les d\xe9pendances n\xe9cessaires."),e.k0s(),e.j41(47,"pre")(48,"code",21),e.EFF(49,"\n$ npm i --save @nestjs/config\n"),e.k0s()(),e.j41(50,"blockquote",22)(51,"strong"),e.EFF(52,"Astuce"),e.k0s(),e.EFF(53," Le package "),e.j41(54,"code"),e.EFF(55,"@nestjs/config"),e.k0s(),e.EFF(56," utilise en interne "),e.j41(57,"a",23),e.EFF(58,"dotenv"),e.k0s(),e.EFF(59,".\n"),e.k0s(),e.j41(60,"blockquote",24)(61,"strong"),e.EFF(62,"Remarque"),e.k0s(),e.j41(63,"code"),e.EFF(64,"@nestjs/config"),e.k0s(),e.EFF(65," n\xe9cessite TypeScript 4.1 ou plus r\xe9cent.\n"),e.k0s(),e.j41(66,"h4",25)(67,"span"),e.EFF(68,"Pour commencer"),e.k0s()(),e.j41(69,"p"),e.EFF(70,"Une fois le processus d'installation termin\xe9, nous pouvons importer le "),e.j41(71,"code"),e.EFF(72,"ConfigModule"),e.k0s(),e.EFF(73,". Typiquement, nous l'importerons dans le module racine "),e.j41(74,"code"),e.EFF(75,"AppModule"),e.k0s(),e.EFF(76," et contr\xf4lerons son comportement en utilisant la m\xe9thode statique "),e.j41(77,"code"),e.EFF(78,".forRoot()"),e.k0s(),e.EFF(79,". Au cours de cette \xe9tape, les paires cl\xe9/valeur des variables d'environnement sont analys\xe9es et r\xe9solues. Plus tard, nous verrons plusieurs options pour acc\xe9der \xe0 la classe "),e.j41(80,"code"),e.EFF(81,"ConfigService"),e.k0s(),e.EFF(82," du "),e.j41(83,"code"),e.EFF(84,"ConfigModule"),e.k0s(),e.EFF(85," dans nos autres modules de fonctionnalit\xe9s."),e.k0s(),e.j41(86,"app-copy-button",26)(87,"span",27),e.EFF(88),e.nI1(89,"extension"),e.nrm(90,"app-tabs",null,1),e.k0s(),e.j41(92,"pre")(93,"code",28),e.EFF(94,"\nimport { Module } from '@nestjs/common';\nimport { ConfigModule } from '@nestjs/config';\n\n@Module({\n  imports: [ConfigModule.forRoot()],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(95,"p"),e.EFF(96,"Le code ci-dessus va charger et analyser un fichier "),e.j41(97,"code"),e.EFF(98,".env"),e.k0s(),e.EFF(99," depuis l'emplacement par d\xe9faut (le r\xe9pertoire racine du projet), fusionner les paires cl\xe9/valeur du fichier "),e.j41(100,"code"),e.EFF(101,".env"),e.k0s(),e.EFF(102," avec les variables d'environnement assign\xe9es \xe0 "),e.j41(103,"code"),e.EFF(104,"process.env"),e.k0s(),e.EFF(105,", et stocker le r\xe9sultat dans une structure priv\xe9e \xe0 laquelle vous pouvez acc\xe9der \xe0 travers le "),e.j41(106,"code"),e.EFF(107,"ConfigService"),e.k0s(),e.EFF(108,". La m\xe9thode "),e.j41(109,"code"),e.EFF(110,"forRoot()"),e.k0s(),e.EFF(111," enregistre le fournisseur "),e.j41(112,"code"),e.EFF(113,"ConfigService"),e.k0s(),e.EFF(114,", qui fournit une m\xe9thode "),e.j41(115,"code"),e.EFF(116,"get()"),e.k0s(),e.EFF(117," pour lire ces variables de configuration analys\xe9es/fusionn\xe9es. Comme "),e.j41(118,"code"),e.EFF(119,"@nestjs/config"),e.k0s(),e.EFF(120," repose sur "),e.j41(121,"a",23),e.EFF(122,"dotenv"),e.k0s(),e.EFF(123,", il utilise les r\xe8gles de ce package pour r\xe9soudre les conflits de noms de variables d'environnement. Lorsqu'une cl\xe9 existe \xe0 la fois dans l'environnement d'ex\xe9cution en tant que variable d'environnement (par exemple, via des exports shell OS comme "),e.j41(124,"code"),e.EFF(125,"export DATABASE_USER=test"),e.k0s(),e.EFF(126,") et dans un fichier "),e.j41(127,"code"),e.EFF(128,".env"),e.k0s(),e.EFF(129,", la variable d'environnement d'ex\xe9cution a la priorit\xe9."),e.k0s(),e.j41(130,"p"),e.EFF(131,"Un exemple de fichier "),e.j41(132,"code"),e.EFF(133,".env"),e.k0s(),e.EFF(134," ressemble \xe0 ceci :"),e.k0s(),e.j41(135,"pre")(136,"code",29),e.EFF(137,"\nDATABASE_USER=test\nDATABASE_PASSWORD=test\n"),e.k0s()(),e.j41(138,"h4",30)(139,"span"),e.EFF(140,"Chemin d'acc\xe8s personnalis\xe9 au fichier env"),e.k0s()(),e.j41(141,"p"),e.EFF(142,"Par d\xe9faut, le package recherche un fichier "),e.j41(143,"code"),e.EFF(144,".env"),e.k0s(),e.EFF(145," dans le r\xe9pertoire racine de l'application. Pour sp\xe9cifier un autre chemin pour le fichier "),e.j41(146,"code"),e.EFF(147,".env"),e.k0s(),e.EFF(148,", d\xe9finissez la propri\xe9t\xe9 "),e.j41(149,"code"),e.EFF(150,"envFilePath"),e.k0s(),e.EFF(151," d'un objet d'options (optionnel) que vous passez \xe0 "),e.j41(152,"code"),e.EFF(153,"forRoot()"),e.k0s(),e.EFF(154,", comme suit :"),e.k0s(),e.j41(155,"app-copy-button")(156,"pre")(157,"code",28),e.EFF(158,"\nConfigModule.forRoot({\n  envFilePath: '.development.env',\n});\n"),e.k0s()()(),e.j41(159,"p"),e.EFF(160,"Vous pouvez \xe9galement sp\xe9cifier plusieurs chemins pour les fichiers "),e.j41(161,"code"),e.EFF(162,".env"),e.k0s(),e.EFF(163," comme ceci :"),e.k0s(),e.j41(164,"app-copy-button")(165,"pre")(166,"code",28),e.EFF(167,"\nConfigModule.forRoot({\n  envFilePath: ['.env.development.local', '.env.development'],\n});\n"),e.k0s()()(),e.j41(168,"p"),e.EFF(169,"Si une variable se trouve dans plusieurs fichiers, le premier est prioritaire."),e.k0s(),e.j41(170,"h4",31)(171,"span"),e.EFF(172,"D\xe9sactiver le chargement des variables d'environnement"),e.k0s()(),e.j41(173,"p"),e.EFF(174,"Si vous ne voulez pas charger le fichier "),e.j41(175,"code"),e.EFF(176,".env"),e.k0s(),e.EFF(177,", mais plut\xf4t acc\xe9der aux variables d'environnement depuis l'environnement d'ex\xe9cution (comme avec les exportations du shell OS comme "),e.j41(178,"code"),e.EFF(179,"export DATABASE_USER=test"),e.k0s(),e.EFF(180,"), mettez la propri\xe9t\xe9 "),e.j41(181,"code"),e.EFF(182,"ignoreEnvFile"),e.k0s(),e.EFF(183," de l'objet options \xe0 "),e.j41(184,"code"),e.EFF(185,"true"),e.k0s(),e.EFF(186,", comme suit :"),e.k0s(),e.j41(187,"app-copy-button")(188,"pre")(189,"code",28),e.EFF(190,"\nConfigModule.forRoot({\n  ignoreEnvFile: true,\n});\n"),e.k0s()()(),e.j41(191,"h4",32)(192,"span"),e.EFF(193,"Utilisation globale du module"),e.k0s()(),e.j41(194,"p"),e.EFF(195,"Lorsque vous voudrez utiliser "),e.j41(196,"code"),e.EFF(197,"ConfigModule"),e.k0s(),e.EFF(198," dans d'autres modules, vous devrez l'importer (comme c'est le cas pour tout module Nest). Alternativement, vous pouvez le d\xe9clarer comme "),e.j41(199,"a",33),e.EFF(200,"module global"),e.k0s(),e.EFF(201," en mettant la propri\xe9t\xe9 "),e.j41(202,"code"),e.EFF(203,"isGlobal"),e.k0s(),e.EFF(204," de l'objet options \xe0 "),e.j41(205,"code"),e.EFF(206,"true"),e.k0s(),e.EFF(207,", comme montr\xe9 ci-dessous. Dans ce cas, vous n'aurez pas besoin d'importer "),e.j41(208,"code"),e.EFF(209,"ConfigModule"),e.k0s(),e.EFF(210," dans d'autres modules une fois qu'il aura \xe9t\xe9 charg\xe9 dans le module racine (par exemple, "),e.j41(211,"code"),e.EFF(212,"AppModule"),e.k0s(),e.EFF(213,")."),e.k0s(),e.j41(214,"app-copy-button")(215,"pre")(216,"code",28),e.EFF(217,"\nConfigModule.forRoot({\n  isGlobal: true,\n});\n"),e.k0s()()(),e.j41(218,"h4",34)(219,"span"),e.EFF(220,"Fichiers de configuration personnalis\xe9s"),e.k0s()(),e.j41(221,"p"),e.EFF(222,"Pour les projets plus complexes, vous pouvez utiliser des fichiers de configuration personnalis\xe9s pour renvoyer des objets de configuration imbriqu\xe9s. Cela vous permet de regrouper les param\xe8tres de configuration connexes par fonction (par exemple, les param\xe8tres li\xe9s \xe0 la base de donn\xe9es) et de stocker les param\xe8tres connexes dans des fichiers individuels pour faciliter leur gestion ind\xe9pendante."),e.k0s(),e.j41(223,"p"),e.EFF(224,"Un fichier de configuration personnalis\xe9 exporte une fonction factory qui renvoie un objet de configuration. L'objet de configuration peut \xeatre n'importe quel objet JavaScript simple imbriqu\xe9 arbitrairement. L'objet "),e.j41(225,"code"),e.EFF(226,"process.env"),e.k0s(),e.EFF(227," contiendra les paires cl\xe9/valeur des variables d'environnement enti\xe8rement r\xe9solues (avec le fichier "),e.j41(228,"code"),e.EFF(229,".env"),e.k0s(),e.EFF(230," et les variables d\xe9finies en externe r\xe9solues et fusionn\xe9es comme d\xe9crit "),e.j41(231,"a",35),e.EFF(232,"ci-dessus"),e.k0s(),e.EFF(233,"). Puisque vous contr\xf4lez l'objet de configuration retourn\xe9, vous pouvez ajouter toute logique n\xe9cessaire pour convertir les valeurs en un type appropri\xe9, d\xe9finir des valeurs par d\xe9faut, etc. Par exemple :"),e.k0s(),e.j41(234,"app-copy-button",26)(235,"span",27),e.EFF(236),e.nI1(237,"extension"),e.nrm(238,"app-tabs",null,2),e.k0s(),e.j41(240,"pre")(241,"code",28),e.EFF(242,"\nexport default () => ({\n  port: parseInt(process.env.PORT, 10) || 3000,\n  database: {\n    host: process.env.DATABASE_HOST,\n    port: parseInt(process.env.DATABASE_PORT, 10) || 5432\n  }\n});\n"),e.k0s()()(),e.j41(243,"p"),e.EFF(244,"Nous chargeons ce fichier en utilisant la propri\xe9t\xe9 "),e.j41(245,"code"),e.EFF(246,"load"),e.k0s(),e.EFF(247," de l'objet options que nous passons \xe0 la m\xe9thode "),e.j41(248,"code"),e.EFF(249,"ConfigModule.forRoot()"),e.k0s(),e.EFF(250," :"),e.k0s(),e.j41(251,"app-copy-button")(252,"pre")(253,"code",28),e.EFF(254,"\nimport configuration from './config/configuration';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      load: [configuration],\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(255,"blockquote",22)(256,"strong"),e.EFF(257,"Remarque"),e.k0s(),e.EFF(258," La valeur assign\xe9e \xe0 la propri\xe9t\xe9 "),e.j41(259,"code"),e.EFF(260,"load"),e.k0s(),e.EFF(261," est un tableau, ce qui vous permet de charger plusieurs fichiers de configuration (par exemple "),e.j41(262,"code"),e.EFF(263,"load : [databaseConfig, authConfig]"),e.k0s(),e.EFF(264,").\n"),e.k0s(),e.j41(265,"p"),e.EFF(266,"Avec les fichiers de configuration personnalis\xe9s, nous pouvons \xe9galement g\xe9rer des fichiers personnalis\xe9s tels que les fichiers YAML. Voici un exemple de configuration au format YAML :"),e.k0s(),e.j41(267,"pre")(268,"code",36),e.EFF(269,"\nhttp:\n  host: 'localhost'\n  port: 8080\n\ndb:\n  postgres:\n    url: 'localhost'\n    port: 5432\n    database: 'yaml-db'\n\n  sqlite:\n    database: 'sqlite.db'\n"),e.k0s()(),e.j41(270,"p"),e.EFF(271,"Pour lire et analyser les fichiers YAML, nous pouvons utiliser le package "),e.j41(272,"code"),e.EFF(273,"js-yaml"),e.k0s(),e.EFF(274,"."),e.k0s(),e.j41(275,"pre")(276,"code",21),e.EFF(277,"\n$ npm i js-yaml\n$ npm i -D @types/js-yaml\n"),e.k0s()(),e.j41(278,"p"),e.EFF(279,"Une fois le package install\xe9, nous utilisons la fonction "),e.j41(280,"code"),e.EFF(281,"yaml#load"),e.k0s(),e.EFF(282," pour charger le fichier YAML que nous venons de cr\xe9er."),e.k0s(),e.j41(283,"app-copy-button",26)(284,"span",27),e.EFF(285),e.nI1(286,"extension"),e.nrm(287,"app-tabs",null,3),e.k0s(),e.j41(289,"pre")(290,"code",28),e.EFF(291,"\nimport { readFileSync } from 'fs';\nimport * as yaml from 'js-yaml';\nimport { join } from 'path';\n\nconst YAML_CONFIG_FILENAME = 'config.yaml';\n\nexport default () => {\n  return yaml.load(\n    readFileSync(join(__dirname, YAML_CONFIG_FILENAME), 'utf8'),\n  ) as Record<string, any>;\n};\n"),e.k0s()()(),e.j41(292,"blockquote",24)(293,"strong"),e.EFF(294,"Note"),e.k0s(),e.EFF(295,' Nest CLI ne d\xe9place pas automatiquement vos "assets" (fichiers non-TS) dans le dossier '),e.j41(296,"code"),e.EFF(297,"dist"),e.k0s(),e.EFF(298," pendant le processus de construction. Pour vous assurer que vos fichiers YAML sont copi\xe9s, vous devez le sp\xe9cifier dans l'objet "),e.j41(299,"code"),e.EFF(300,"compilerOptions#assets"),e.k0s(),e.EFF(301," du fichier "),e.j41(302,"code"),e.EFF(303,"nest-cli.json"),e.k0s(),e.EFF(304,". Par exemple, si le dossier "),e.j41(305,"code"),e.EFF(306,"config"),e.k0s(),e.EFF(307," est au m\xeame niveau que le dossier "),e.j41(308,"code"),e.EFF(309,"src"),e.k0s(),e.EFF(310,", ajoutez "),e.j41(311,"code"),e.EFF(312,"compilerOptions#assets"),e.k0s(),e.EFF(313," avec la valeur "),e.j41(314,"code"),e.EFF(315),e.k0s(),e.EFF(316,". En savoir plus "),e.j41(317,"a",37),e.EFF(318,"ici"),e.k0s(),e.EFF(319,".\n"),e.k0s(),e.j41(320,"p"),e.EFF(321,"Juste une petite note - les fichiers de configuration ne sont pas automatiquement valid\xe9s, m\xeame si vous utilisez l'option "),e.j41(322,"code"),e.EFF(323,"validationSchema"),e.k0s(),e.EFF(324," dans le "),e.j41(325,"code"),e.EFF(326,"ConfigModule"),e.k0s(),e.EFF(327," de NestJS. Si vous avez besoin d'une validation ou si vous voulez appliquer des transformations, vous devrez le faire \xe0 l'int\xe9rieur de la fonction factory o\xf9 vous avez un contr\xf4le complet sur l'objet de configuration. Cela vous permet d'impl\xe9menter une logique de validation personnalis\xe9e si n\xe9cessaire."),e.k0s(),e.j41(328,"p"),e.EFF(329,"Par exemple, si vous voulez vous assurer que le port se situe dans une certaine plage, vous pouvez ajouter une \xe9tape de validation \xe0 la fonction factory :"),e.k0s(),e.j41(330,"app-copy-button",26)(331,"span",27),e.EFF(332),e.nI1(333,"extension"),e.nrm(334,"app-tabs",null,4),e.k0s(),e.j41(336,"pre")(337,"code",28),e.EFF(338,"\nexport default () => {\n  const config = yaml.load(\n    readFileSync(join(__dirname, YAML_CONFIG_FILENAME), 'utf8'),\n  ) as Record<string, any>;\n  if (config.http.port < 1024 || config.http.port > 49151) {\n    throw new Error('HTTP port must be between 1024 and 49151');\n  }\n  return config;\n};\n"),e.k0s()()(),e.j41(339,"p"),e.EFF(340,"D\xe9sormais, si le port se trouve en dehors de la plage sp\xe9cifi\xe9e, l'application g\xe9n\xe8re une erreur au d\xe9marrage."),e.k0s(),e.j41(341,"p"),e.nrm(342,"app-banner-devtools"),e.k0s(),e.j41(343,"h4",38)(344,"span"),e.EFF(345,"Utilisation de "),e.j41(346,"code"),e.EFF(347,"ConfigService"),e.k0s()()(),e.j41(348,"p"),e.EFF(349,"Pour acc\xe9der aux valeurs de configuration de notre "),e.j41(350,"code"),e.EFF(351,"ConfigService"),e.k0s(),e.EFF(352,", nous devons d'abord injecter "),e.j41(353,"code"),e.EFF(354,"ConfigService"),e.k0s(),e.EFF(355,". Comme pour tout fournisseur, nous devons importer le module qui le contient - le "),e.j41(356,"code"),e.EFF(357,"ConfigModule"),e.k0s(),e.EFF(358," - dans le module qui l'utilisera (\xe0 moins que vous n'ayez mis la propri\xe9t\xe9 "),e.j41(359,"code"),e.EFF(360,"isGlobal"),e.k0s(),e.EFF(361," dans l'objet options pass\xe9 \xe0 la m\xe9thode "),e.j41(362,"code"),e.EFF(363,"ConfigModule.forRoot()"),e.k0s(),e.EFF(364," \xe0 "),e.j41(365,"code"),e.EFF(366,"true"),e.k0s(),e.EFF(367,"). Importez-le dans un module de fonctionnalit\xe9 comme indiqu\xe9 ci-dessous."),e.k0s(),e.j41(368,"app-copy-button",26)(369,"span",27),e.EFF(370),e.nI1(371,"extension"),e.nrm(372,"app-tabs",null,5),e.k0s(),e.j41(374,"pre")(375,"code",28),e.EFF(376,"\n@Module({\n  imports: [ConfigModule],\n  // ...\n})\n"),e.k0s()()(),e.j41(377,"p"),e.EFF(378,"Nous pouvons ensuite l'injecter \xe0 l'aide de l'injection de constructeur standard :"),e.k0s(),e.j41(379,"app-copy-button")(380,"pre")(381,"code",28),e.EFF(382,"\nconstructor(private configService: ConfigService) {}\n"),e.k0s()()(),e.j41(383,"blockquote",22)(384,"strong"),e.EFF(385,"Astuce"),e.k0s(),e.EFF(386," Le "),e.j41(387,"code"),e.EFF(388,"ConfigService"),e.k0s(),e.EFF(389," est import\xe9 du package "),e.j41(390,"code"),e.EFF(391,"@nestjs/config"),e.k0s(),e.EFF(392,".\n"),e.k0s(),e.j41(393,"p"),e.EFF(394,"Et l'utiliser dans notre classe :"),e.k0s(),e.j41(395,"app-copy-button")(396,"pre")(397,"code",28),e.EFF(398,"\n// obtenir une variable d'environnement\nconst dbUser = this.configService.get<string>('DATABASE_USER');\n\n// obtenir une valeur de configuration personnalis\xe9e\nconst dbHost = this.configService.get<string>('database.host');\n"),e.k0s()()(),e.j41(399,"p"),e.EFF(400,"Comme indiqu\xe9 ci-dessus, utilisez la m\xe9thode "),e.j41(401,"code"),e.EFF(402,"configService.get()"),e.k0s(),e.EFF(403," pour obtenir une simple variable d'environnement en passant le nom de la variable. Vous pouvez faire une indication de type TypeScript en passant le type, comme indiqu\xe9 ci-dessus (par exemple, "),e.j41(404,"code"),e.EFF(405,"get<string>(...)"),e.k0s(),e.EFF(406,"). La m\xe9thode "),e.j41(407,"code"),e.EFF(408,"get()"),e.k0s(),e.EFF(409," peut \xe9galement traverser un objet de configuration personnalis\xe9 imbriqu\xe9 (cr\xe9\xe9 via un "),e.j41(410,"a",39),e.EFF(411,"fichier de configuration personnalis\xe9"),e.k0s(),e.EFF(412,"), comme le montre le deuxi\xe8me exemple ci-dessus."),e.k0s(),e.j41(413,"p"),e.EFF(414,"Vous pouvez \xe9galement obtenir l'ensemble de l'objet de configuration personnalis\xe9e imbriqu\xe9 en utilisant une interface comme indication de type :"),e.k0s(),e.j41(415,"app-copy-button")(416,"pre")(417,"code",28),e.EFF(418,"\ninterface DatabaseConfig {\n  host: string;\n  port: number;\n}\n\nconst dbConfig = this.configService.get<DatabaseConfig>('database');\n\n// vous pouvez maintenant utiliser `dbConfig.port` et `dbConfig.host`.\nconst port = dbConfig.port;\n"),e.k0s()()(),e.j41(419,"p"),e.EFF(420,"La m\xe9thode "),e.j41(421,"code"),e.EFF(422,"get()"),e.k0s(),e.EFF(423," prend \xe9galement un deuxi\xe8me argument facultatif d\xe9finissant une valeur par d\xe9faut, qui sera renvoy\xe9e si la cl\xe9 n'existe pas, comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(424,"app-copy-button")(425,"pre")(426,"code",28),e.EFF(427,"\n// utiliser \"localhost\" lorsque \"database.host\" n'est pas d\xe9fini\nconst dbHost = this.configService.get<string>('database.host', 'localhost');\n"),e.k0s()()(),e.j41(428,"p")(429,"code"),e.EFF(430,"ConfigService"),e.k0s(),e.EFF(431," a deux g\xe9n\xe9riques optionnels (arguments de type). Le premier permet d'\xe9viter d'acc\xe9der \xe0 une propri\xe9t\xe9 de configuration qui n'existe pas. Utilisez-le comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(432,"app-copy-button")(433,"pre")(434,"code",28),e.EFF(435,"\ninterface EnvironmentVariables {\n  PORT: number;\n  TIMEOUT: string;\n}\n\n// quelque part dans le code\nconstructor(private configService: ConfigService<EnvironmentVariables>) {\n  const port = this.configService.get('PORT', { infer: true });\n\n  // Erreur TypeScript : ceci n'est pas valide car la propri\xe9t\xe9 URL n'est pas d\xe9finie dans EnvironmentVariables\n  const url = this.configService.get('URL', { infer: true });\n}\n"),e.k0s()()(),e.j41(436,"p"),e.EFF(437,"Avec la propri\xe9t\xe9 "),e.j41(438,"code"),e.EFF(439,"infer"),e.k0s(),e.EFF(440," fix\xe9e \xe0 "),e.j41(441,"code"),e.EFF(442,"true"),e.k0s(),e.EFF(443,", la m\xe9thode "),e.j41(444,"code"),e.EFF(445,"ConfigService#get"),e.k0s(),e.EFF(446," va automatiquement inf\xe9rer le type de propri\xe9t\xe9 bas\xe9 sur l'interface, donc par exemple, "),e.j41(447,"code"),e.EFF(448,'typeof port === "number"'),e.k0s(),e.EFF(449," (si vous n'utilisez pas le flag "),e.j41(450,"code"),e.EFF(451,"strictNullChecks"),e.k0s(),e.EFF(452," de TypeScript) puisque "),e.j41(453,"code"),e.EFF(454,"PORT"),e.k0s(),e.EFF(455," a un type "),e.j41(456,"code"),e.EFF(457,"number"),e.k0s(),e.EFF(458," dans l'interface "),e.j41(459,"code"),e.EFF(460,"EnvironmentVariables"),e.k0s(),e.EFF(461,"."),e.k0s(),e.j41(462,"p"),e.EFF(463,"De plus, avec la fonctionnalit\xe9 "),e.j41(464,"code"),e.EFF(465,"infer"),e.k0s(),e.EFF(466,", vous pouvez d\xe9duire le type d'une propri\xe9t\xe9 d'un objet de configuration personnalis\xe9 imbriqu\xe9, m\xeame en utilisant la notation par points, comme suit :"),e.k0s(),e.j41(467,"app-copy-button")(468,"pre")(469,"code",28),e.EFF(470,"\nconstructor(private configService: ConfigService<{ database: { host: string } }>) {\n  const dbHost = this.configService.get('database.host', { infer: true })!;\n  // typeof dbHost === \"string\"                                          |\n  //                                                                     +--\x3e op\xe9rateur d'assertion non-nul\n}\n"),e.k0s()()(),e.j41(471,"p"),e.EFF(472,"Le second g\xe9n\xe9rique s'appuie sur le premier, agissant comme une assertion de type pour se d\xe9barrasser de tous les types "),e.j41(473,"code"),e.EFF(474,"ind\xe9finis"),e.k0s(),e.EFF(475," que les m\xe9thodes de "),e.j41(476,"code"),e.EFF(477,"ConfigService"),e.k0s(),e.EFF(478," peuvent retourner lorsque "),e.j41(479,"code"),e.EFF(480,"strictNullChecks"),e.k0s(),e.EFF(481," est activ\xe9. Par exemple :"),e.k0s(),e.j41(482,"app-copy-button")(483,"pre")(484,"code",28),e.EFF(485,"\n// ...\nconstructor(private configService: ConfigService<{ PORT: number }, true>) {\n  //                                                               ^^^^\n  const port = this.configService.get('PORT', { infer: true });\n  //    ^^^ Le type de port sera \"number\", ce qui rend inutile les assertions de type TS.\n}\n"),e.k0s()()(),e.j41(486,"h4",40)(487,"span"),e.EFF(488,"Espaces de noms de configuration"),e.k0s()(),e.j41(489,"p"),e.EFF(490,"Le module "),e.j41(491,"code"),e.EFF(492,"ConfigModule"),e.k0s(),e.EFF(493," vous permet de d\xe9finir et de charger plusieurs fichiers de configuration personnalis\xe9s, comme indiqu\xe9 dans "),e.j41(494,"a",39),e.EFF(495,"Fichiers de configuration personnalis\xe9s"),e.k0s(),e.EFF(496,' ci-dessus. Vous pouvez g\xe9rer des hi\xe9rarchies d\'objets de configuration complexes avec des objets de configuration imbriqu\xe9s, comme indiqu\xe9 dans cette section. Vous pouvez \xe9galement renvoyer un objet de configuration "\xe0 espace de noms" avec la fonction '),e.j41(497,"code"),e.EFF(498,"registerAs()"),e.k0s(),e.EFF(499," comme suit :"),e.k0s(),e.j41(500,"app-copy-button",26)(501,"span",27),e.EFF(502),e.nI1(503,"extension"),e.nrm(504,"app-tabs",null,6),e.k0s(),e.j41(506,"pre")(507,"code",28),e.EFF(508,"\nexport default registerAs('database', () => ({\n  host: process.env.DATABASE_HOST,\n  port: process.env.DATABASE_PORT || 5432\n}));\n"),e.k0s()()(),e.j41(509,"p"),e.EFF(510,"Comme pour les fichiers de configuration personnalis\xe9s, dans votre fonction d'usine "),e.j41(511,"code"),e.EFF(512,"registerAs()"),e.k0s(),e.EFF(513,", l'objet "),e.j41(514,"code"),e.EFF(515,"process.env"),e.k0s(),e.EFF(516," contiendra les paires cl\xe9/valeur des variables d'environnement enti\xe8rement r\xe9solues (avec le fichier "),e.j41(517,"code"),e.EFF(518,".env"),e.k0s(),e.EFF(519," et les variables d\xe9finies en externe r\xe9solues et fusionn\xe9es comme d\xe9crit "),e.j41(520,"a",35),e.EFF(521,"ci-dessus"),e.k0s(),e.EFF(522,")."),e.k0s(),e.j41(523,"blockquote",22)(524,"strong"),e.EFF(525,"Astuce"),e.k0s(),e.EFF(526," La fonction "),e.j41(527,"code"),e.EFF(528,"registerAs"),e.k0s(),e.EFF(529," est export\xe9e du package "),e.j41(530,"code"),e.EFF(531,"@nestjs/config"),e.k0s(),e.EFF(532,".\n"),e.k0s(),e.j41(533,"p"),e.EFF(534,"Chargez une configuration en espace de noms avec la propri\xe9t\xe9 "),e.j41(535,"code"),e.EFF(536,"load"),e.k0s(),e.EFF(537," de l'objet options de la m\xe9thode "),e.j41(538,"code"),e.EFF(539,"forRoot()"),e.k0s(),e.EFF(540,", de la m\xeame mani\xe8re que vous chargez un fichier de configuration personnalis\xe9 :"),e.k0s(),e.j41(541,"app-copy-button")(542,"pre")(543,"code",28),e.EFF(544,"\nimport databaseConfig from './config/database.config';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      load: [databaseConfig],\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(545,"p"),e.EFF(546,"Maintenant, pour obtenir la valeur "),e.j41(547,"code"),e.EFF(548,"host"),e.k0s(),e.EFF(549," de l'espace de noms "),e.j41(550,"code"),e.EFF(551,"database"),e.k0s(),e.EFF(552,", utilisez la notation par points. Utilisez "),e.j41(553,"code"),e.EFF(554,"'database'"),e.k0s(),e.EFF(555," comme pr\xe9fixe au nom de la propri\xe9t\xe9, correspondant au nom de l'espace de noms (pass\xe9 comme premier argument \xe0 la fonction "),e.j41(556,"code"),e.EFF(557,"registerAs()"),e.k0s(),e.EFF(558,") :"),e.k0s(),e.j41(559,"app-copy-button")(560,"pre")(561,"code",28),e.EFF(562,"\nconst dbHost = this.configService.get<string>('database.host');\n"),e.k0s()()(),e.j41(563,"p"),e.EFF(564,"Une alternative raisonnable est d'injecter directement l'espace de noms "),e.j41(565,"code"),e.EFF(566,"database"),e.k0s(),e.EFF(567,". Cela nous permet de b\xe9n\xe9ficier d'un typage fort :"),e.k0s(),e.j41(568,"app-copy-button")(569,"pre")(570,"code",28),e.EFF(571,"\nconstructor(\n  @Inject(databaseConfig.KEY)\n  private dbConfig: ConfigType<typeof databaseConfig>,\n) {}\n"),e.k0s()()(),e.j41(572,"blockquote",22)(573,"strong"),e.EFF(574,"Astuce"),e.k0s(),e.EFF(575," Le "),e.j41(576,"code"),e.EFF(577,"ConfigType"),e.k0s(),e.EFF(578," est export\xe9 depuis le package "),e.j41(579,"code"),e.EFF(580,"@nestjs/config"),e.k0s(),e.EFF(581,".\n"),e.k0s(),e.j41(582,"h4",41)(583,"span"),e.EFF(584,"Les configurations \xe0 namespace dans les modules"),e.k0s()(),e.j41(585,"p"),e.EFF(586,"Pour utiliser une configuration \xe0 namespace comme objet de configuration pour un autre module de votre application, vous pouvez utiliser la m\xe9thode "),e.j41(587,"code"),e.EFF(588,".asProvider()"),e.k0s(),e.EFF(589," de l'objet de configuration. Cette m\xe9thode convertit votre configuration \xe0 namespace en un fournisseur, qui peut ensuite \xeatre pass\xe9 \xe0 la m\xe9thode "),e.j41(590,"code"),e.EFF(591,"forRootAsync()"),e.k0s(),e.EFF(592," (ou toute autre m\xe9thode \xe9quivalente) du module que vous souhaitez utiliser."),e.k0s(),e.j41(593,"p"),e.EFF(594,"Voici un exemple :"),e.k0s(),e.j41(595,"app-copy-button")(596,"pre")(597,"code",28),e.EFF(598,"\nimport databaseConfig from './config/database.config';\n\n@Module({\n  imports: [\n    TypeOrmModule.forRootAsync(databaseConfig.asProvider()),\n  ],\n})\n"),e.k0s()()(),e.j41(599,"p"),e.EFF(600,"Pour comprendre le fonctionnement de la m\xe9thode "),e.j41(601,"code"),e.EFF(602,".asProvider()"),e.k0s(),e.EFF(603,", examinons la valeur de retour :"),e.k0s(),e.j41(604,"app-copy-button")(605,"pre")(606,"code",28),e.EFF(607,"\n// Valeur de retour de la m\xe9thode .asProvider()\n{\n  imports: [ConfigModule.forFeature(databaseConfig)],\n  useFactory: (configuration: ConfigType<typeof databaseConfig>) => configuration,\n  inject: [databaseConfig.KEY]\n}\n"),e.k0s()()(),e.j41(608,"p"),e.EFF(609,"Cette structure vous permet d'int\xe9grer de mani\xe8re transparente des configurations \xe0 namespace dans vos modules, ce qui garantit que votre application reste organis\xe9e et modulaire, sans avoir \xe0 \xe9crire du code r\xe9p\xe9titif et de type \xab boilerplate \xbb."),e.k0s(),e.j41(610,"h4",42)(611,"span"),e.EFF(612,"Variables d'environnement du cache"),e.k0s()(),e.j41(613,"p"),e.EFF(614,"Comme l'acc\xe8s \xe0 "),e.j41(615,"code"),e.EFF(616,"process.env"),e.k0s(),e.EFF(617," peut \xeatre lent, vous pouvez d\xe9finir la propri\xe9t\xe9 "),e.j41(618,"code"),e.EFF(619,"cache"),e.k0s(),e.EFF(620," de l'objet options pass\xe9 \xe0 "),e.j41(621,"code"),e.EFF(622,"ConfigModule.forRoot()"),e.k0s(),e.EFF(623," pour augmenter les performances de la m\xe9thode "),e.j41(624,"code"),e.EFF(625,"ConfigService#get"),e.k0s(),e.EFF(626," lorsqu'il s'agit de variables stock\xe9es dans "),e.j41(627,"code"),e.EFF(628,"process.env"),e.k0s(),e.EFF(629,"."),e.k0s(),e.j41(630,"app-copy-button")(631,"pre")(632,"code",28),e.EFF(633,"\nConfigModule.forRoot({\n  cache: true,\n});\n"),e.k0s()()(),e.j41(634,"h4",43)(635,"span"),e.EFF(636,"Enregistrement partiel"),e.k0s()(),e.j41(637,"p"),e.EFF(638,"Jusqu'\xe0 pr\xe9sent, nous avons trait\xe9 les fichiers de configuration dans notre module racine (par exemple, "),e.j41(639,"code"),e.EFF(640,"AppModule"),e.k0s(),e.EFF(641,"), avec la m\xe9thode "),e.j41(642,"code"),e.EFF(643,"forRoot()"),e.k0s(),e.EFF(644,". Peut-\xeatre avez-vous une structure de projet plus complexe, avec des fichiers de configuration sp\xe9cifiques situ\xe9s dans plusieurs r\xe9pertoires diff\xe9rents. Plut\xf4t que de charger tous ces fichiers dans le module racine, le package "),e.j41(645,"code"),e.EFF(646,"@nestjs/config"),e.k0s(),e.EFF(647," fournit une fonctionnalit\xe9 appel\xe9e "),e.j41(648,"strong"),e.EFF(649,"enregistrement partiel"),e.k0s(),e.EFF(650,", qui r\xe9f\xe9rence seulement les fichiers de configuration associ\xe9s \xe0 chaque module de fonctionnalit\xe9. Utilisez la m\xe9thode statique "),e.j41(651,"code"),e.EFF(652,"forFeature()"),e.k0s(),e.EFF(653," \xe0 l'int\xe9rieur d'un module de fonctionnalit\xe9 pour effectuer cet enregistrement partiel, comme suit :"),e.k0s(),e.j41(654,"app-copy-button")(655,"pre")(656,"code",28),e.EFF(657,"\nimport databaseConfig from './config/database.config';\n\n@Module({\n  imports: [ConfigModule.forFeature(databaseConfig)],\n})\nexport class DatabaseModule {}\n"),e.k0s()()(),e.j41(658,"blockquote",22)(659,"strong"),e.EFF(660,"Attention"),e.k0s(),e.EFF(661," Dans certaines circonstances, vous pouvez avoir besoin d'acc\xe9der aux propri\xe9t\xe9s charg\xe9es via l'enregistrement partiel en utilisant le hook "),e.j41(662,"code"),e.EFF(663,"onModuleInit()"),e.k0s(),e.EFF(664,", plut\xf4t que dans un constructeur. En effet, la m\xe9thode "),e.j41(665,"code"),e.EFF(666,"forFeature()"),e.k0s(),e.EFF(667," est ex\xe9cut\xe9e pendant l'initialisation du module, et l'ordre d'initialisation du module est ind\xe9termin\xe9. Si vous acc\xe9dez \xe0 des valeurs charg\xe9es de cette mani\xe8re par un autre module, dans un constructeur, le module dont d\xe9pend la configuration peut ne pas avoir \xe9t\xe9 initialis\xe9. La m\xe9thode "),e.j41(668,"code"),e.EFF(669,"onModuleInit()"),e.k0s(),e.EFF(670," ne s'ex\xe9cute qu'apr\xe8s l'initialisation de tous les modules dont elle d\xe9pend, cette technique est donc s\xfbre.\n"),e.k0s(),e.j41(671,"h4",44)(672,"span"),e.EFF(673,"Validation du sch\xe9ma"),e.k0s()(),e.j41(674,"p"),e.EFF(675,"Il est d'usage de lever une exception au d\xe9marrage de l'application si les variables d'environnement requises n'ont pas \xe9t\xe9 fournies ou si elles ne respectent pas certaines r\xe8gles de validation. Le package "),e.j41(676,"code"),e.EFF(677,"@nestjs/config"),e.k0s(),e.EFF(678," offre deux fa\xe7ons diff\xe9rentes de le faire :"),e.k0s(),e.j41(679,"ul")(680,"li"),e.EFF(681,"Le validateur int\xe9gr\xe9 "),e.j41(682,"a",45),e.EFF(683,"Joi"),e.k0s(),e.EFF(684,". Avec Joi, vous d\xe9finissez un sch\xe9ma d'objet et validez les objets JavaScript en fonction de ce sch\xe9ma."),e.k0s(),e.j41(685,"li"),e.EFF(686,"Une fonction personnalis\xe9e "),e.j41(687,"code"),e.EFF(688,"validate()"),e.k0s(),e.EFF(689," qui prend des variables d'environnement en entr\xe9e."),e.k0s()(),e.j41(690,"p"),e.EFF(691,"Pour utiliser Joi, nous devons installer le package Joi :"),e.k0s(),e.j41(692,"pre")(693,"code",21),e.EFF(694,"\n$ npm install --save joi\n"),e.k0s()(),e.j41(695,"p"),e.EFF(696,"Nous pouvons maintenant d\xe9finir un sch\xe9ma de validation Joi et le passer via la propri\xe9t\xe9 "),e.j41(697,"code"),e.EFF(698,"validationSchema"),e.k0s(),e.EFF(699," de l'objet options de la m\xe9thode "),e.j41(700,"code"),e.EFF(701,"forRoot()"),e.k0s(),e.EFF(702,", comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(703,"app-copy-button",26)(704,"span",27),e.EFF(705),e.nI1(706,"extension"),e.nrm(707,"app-tabs",null,7),e.k0s(),e.j41(709,"pre")(710,"code",28),e.EFF(711,"\nimport * as Joi from 'joi';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      validationSchema: Joi.object({\n        NODE_ENV: Joi.string()\n          .valid('development', 'production', 'test', 'provision')\n          .default('development'),\n        PORT: Joi.number().port().default(3000),\n      }),\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(712,"p"),e.EFF(713,"Par d\xe9faut, toutes les cl\xe9s de sch\xe9ma sont consid\xe9r\xe9es comme optionnelles. Ici, nous fixons des valeurs par d\xe9faut pour "),e.j41(714,"code"),e.EFF(715,"NODE_ENV"),e.k0s(),e.EFF(716," et "),e.j41(717,"code"),e.EFF(718,"PORT"),e.k0s(),e.EFF(719," qui seront utilis\xe9es si nous ne fournissons pas ces variables dans l'environnement (fichier "),e.j41(720,"code"),e.EFF(721,".env"),e.k0s(),e.EFF(722," ou environnement du processus). Alternativement, nous pouvons utiliser la m\xe9thode de validation "),e.j41(723,"code"),e.EFF(724,"required()"),e.k0s(),e.EFF(725," pour exiger qu'une valeur soit d\xe9finie dans l'environnement (fichier "),e.j41(726,"code"),e.EFF(727,".env"),e.k0s(),e.EFF(728," ou environnement du processus). Dans ce cas, l'\xe9tape de validation l\xe8vera une exception si nous ne fournissons pas la variable dans l'environnement. Voir "),e.j41(729,"a",46),e.EFF(730,"M\xe9thodes de validation Joi"),e.k0s(),e.EFF(731," pour plus d'informations sur la fa\xe7on de construire des sch\xe9mas de validation."),e.k0s(),e.j41(732,"p"),e.EFF(733,"Par d\xe9faut, les variables d'environnement inconnues (variables d'environnement dont les cl\xe9s ne sont pas pr\xe9sentes dans le sch\xe9ma) sont autoris\xe9es et ne d\xe9clenchent pas d'exception de validation. Par d\xe9faut, toutes les erreurs de validation sont signal\xe9es. Vous pouvez modifier ces comportements en passant un objet d'options via la cl\xe9 "),e.j41(734,"code"),e.EFF(735,"validationOptions"),e.k0s(),e.EFF(736," de l'objet d'options "),e.j41(737,"code"),e.EFF(738,"forRoot()"),e.k0s(),e.EFF(739,". Cet objet d'options peut contenir n'importe laquelle des propri\xe9t\xe9s d'options de validation standard fournies par les "),e.j41(740,"a",47),e.EFF(741,"Options de validation Joi"),e.k0s(),e.EFF(742,". Par exemple, pour inverser les deux param\xe8tres ci-dessus, passez des options comme ceci :"),e.k0s(),e.j41(743,"app-copy-button",26)(744,"span",27),e.EFF(745),e.nI1(746,"extension"),e.nrm(747,"app-tabs",null,8),e.k0s(),e.j41(749,"pre")(750,"code",28),e.EFF(751,"\nimport * as Joi from 'joi';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      validationSchema: Joi.object({\n        NODE_ENV: Joi.string()\n          .valid('development', 'production', 'test', 'provision')\n          .default('development'),\n        PORT: Joi.number().port().default(3000),\n      }),\n      validationOptions: {\n        allowUnknown: false,\n        abortEarly: true,\n      },\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(752,"p"),e.EFF(753,"Le package "),e.j41(754,"code"),e.EFF(755,"@nestjs/config"),e.k0s(),e.EFF(756," utilise les param\xe8tres par d\xe9faut de :"),e.k0s(),e.j41(757,"ul")(758,"li")(759,"code"),e.EFF(760,"allowUnknown"),e.k0s(),e.EFF(761," : permet d'autoriser ou non les cl\xe9s inconnues dans les variables d'environnement. La valeur par d\xe9faut est "),e.j41(762,"code"),e.EFF(763,"true"),e.k0s()(),e.j41(764,"li")(765,"code"),e.EFF(766,"abortEarly"),e.k0s(),e.EFF(767," : si true, arr\xeate la validation \xe0 la premi\xe8re erreur ; si false, retourne toutes les erreurs. La valeur par d\xe9faut est "),e.j41(768,"code"),e.EFF(769,"false"),e.k0s(),e.EFF(770,"."),e.k0s()(),e.j41(771,"p"),e.EFF(772,"Notez qu'une fois que vous avez d\xe9cid\xe9 de passer un objet "),e.j41(773,"code"),e.EFF(774,"validationOptions"),e.k0s(),e.EFF(775,", tous les param\xe8tres que vous ne passez pas explicitement prendront par d\xe9faut les valeurs standard de "),e.j41(776,"code"),e.EFF(777,"Joi"),e.k0s(),e.EFF(778," (et non les valeurs par d\xe9faut de "),e.j41(779,"code"),e.EFF(780,"@nestjs/config"),e.k0s(),e.EFF(781,"). Par exemple, si vous laissez "),e.j41(782,"code"),e.EFF(783,"allowUnknowns"),e.k0s(),e.EFF(784," non sp\xe9cifi\xe9 dans votre objet "),e.j41(785,"code"),e.EFF(786,"validationOptions"),e.k0s(),e.EFF(787," personnalis\xe9, il aura la valeur par d\xe9faut "),e.j41(788,"code"),e.EFF(789,"Joi"),e.k0s(),e.EFF(790," de "),e.j41(791,"code"),e.EFF(792,"false"),e.k0s(),e.EFF(793,". Il est donc probablement plus s\xfbr de sp\xe9cifier "),e.j41(794,"strong"),e.EFF(795,"ces deux"),e.k0s(),e.EFF(796," param\xe8tres dans votre objet personnalis\xe9."),e.k0s(),e.j41(797,"h4",48)(798,"span"),e.EFF(799,"Fonction de validation personnalis\xe9e"),e.k0s()(),e.j41(800,"p"),e.EFF(801,"Alternativement, vous pouvez sp\xe9cifier une fonction "),e.j41(802,"strong"),e.EFF(803,"synchrone"),e.k0s(),e.j41(804,"code"),e.EFF(805,"validate"),e.k0s(),e.EFF(806," qui prend un objet contenant les variables d'environnement (du fichier env et du processus) et retourne un objet contenant les variables d'environnement valid\xe9es afin que vous puissiez les convertir/muter si n\xe9cessaire. Si la fonction g\xe9n\xe8re une erreur, cela emp\xeachera l'application de d\xe9marrer."),e.k0s(),e.j41(807,"p"),e.EFF(808,"Dans cet exemple, nous allons proc\xe9der avec les packages "),e.j41(809,"code"),e.EFF(810,"class-transformer"),e.k0s(),e.EFF(811," et "),e.j41(812,"code"),e.EFF(813,"class-validator"),e.k0s(),e.EFF(814,". Tout d'abord, nous devons d\xe9finir :"),e.k0s(),e.j41(815,"ul")(816,"li"),e.EFF(817,"une classe avec des contraintes de validation,"),e.k0s(),e.j41(818,"li"),e.EFF(819,"une fonction de validation qui utilise les fonctions "),e.j41(820,"code"),e.EFF(821,"plainToInstance"),e.k0s(),e.EFF(822," et "),e.j41(823,"code"),e.EFF(824,"validateSync"),e.k0s(),e.EFF(825,"."),e.k0s()(),e.j41(826,"app-copy-button",26)(827,"span",27),e.EFF(828),e.nI1(829,"extension"),e.nrm(830,"app-tabs",null,9),e.k0s(),e.j41(832,"pre")(833,"code",28),e.EFF(834,'\nimport { plainToInstance } from \'class-transformer\';\nimport { IsEnum, IsNumber, Max, Min, validateSync } from \'class-validator\';\n\nenum Environment {\n  Development = "development",\n  Production = "production",\n  Test = "test",\n  Provision = "provision",\n}\n\nclass EnvironmentVariables {\n  @IsEnum(Environment)\n  NODE_ENV: Environment;\n\n  @IsNumber()\n  @Min(0)\n  @Max(65535)\n  PORT: number;\n}\n\nexport function validate(config: Record<string, unknown>) {\n  const validatedConfig = plainToInstance(\n    EnvironmentVariables,\n    config,\n    { enableImplicitConversion: true },\n  );\n  const errors = validateSync(validatedConfig, { skipMissingProperties: false });\n\n  if (errors.length > 0) {\n    throw new Error(errors.toString());\n  }\n  return validatedConfig;\n}\n'),e.k0s()()(),e.j41(835,"p"),e.EFF(836,"Avec ceci en place, utilisez la fonction "),e.j41(837,"code"),e.EFF(838,"validate"),e.k0s(),e.EFF(839," comme option de configuration du "),e.j41(840,"code"),e.EFF(841,"ConfigModule"),e.k0s(),e.EFF(842,", comme suit :"),e.k0s(),e.j41(843,"app-copy-button",26)(844,"span",27),e.EFF(845),e.nI1(846,"extension"),e.nrm(847,"app-tabs",null,10),e.k0s(),e.j41(849,"pre")(850,"code",28),e.EFF(851,"\nimport { validate } from './env.validation';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      validate,\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(852,"h4",49)(853,"span"),e.EFF(854,"Fonctions getter personnalis\xe9es"),e.k0s()(),e.j41(855,"p")(856,"code"),e.EFF(857,"ConfigService"),e.k0s(),e.EFF(858," d\xe9finit une m\xe9thode g\xe9n\xe9rique "),e.j41(859,"code"),e.EFF(860,"get()"),e.k0s(),e.EFF(861," pour r\xe9cup\xe9rer une valeur de configuration par cl\xe9. Nous pouvons \xe9galement ajouter des fonctions "),e.j41(862,"code"),e.EFF(863,"getter"),e.k0s(),e.EFF(864," pour permettre un style de codage un peu plus naturel :"),e.k0s(),e.j41(865,"app-copy-button",26)(866,"span",27),e.nrm(867,"app-tabs",null,11),e.k0s(),e.j41(869,"pre")(870,"code",28),e.EFF(871,"\n@Injectable()\nexport class ApiConfigService {\n  constructor(private configService: ConfigService) {}\n\n  get isAuthEnabled(): boolean {\n    return this.configService.get('AUTH_ENABLED') === 'true';\n  }\n}\n"),e.k0s()(),e.j41(872,"pre")(873,"code",28),e.EFF(874,"\n@Dependencies(ConfigService)\n@Injectable()\nexport class ApiConfigService {\n  constructor(configService) {\n    this.configService = configService;\n  }\n\n  get isAuthEnabled() {\n    return this.configService.get('AUTH_ENABLED') === 'true';\n  }\n}\n"),e.k0s()()(),e.j41(875,"p"),e.EFF(876,"Nous pouvons maintenant utiliser la fonction getter comme suit :"),e.k0s(),e.j41(877,"app-copy-button",26)(878,"span",27),e.EFF(879),e.nI1(880,"extension"),e.nrm(881,"app-tabs",null,12),e.k0s(),e.j41(883,"pre")(884,"code",28),e.EFF(885,"\n@Injectable()\nexport class AppService {\n  constructor(apiConfigService: ApiConfigService) {\n    if (apiConfigService.isAuthEnabled) {\n      // L'authentification est activ\xe9e\n    }\n  }\n}\n"),e.k0s()(),e.j41(886,"pre")(887,"code",28),e.EFF(888,"\n@Dependencies(ApiConfigService)\n@Injectable()\nexport class AppService {\n  constructor(apiConfigService) {\n    if (apiConfigService.isAuthEnabled) {\n      // L'authentification est activ\xe9e\n    }\n  }\n}\n"),e.k0s()()(),e.j41(889,"h4",50)(890,"span"),e.EFF(891,"Hook des variables d'environnement charg\xe9es"),e.k0s()(),e.j41(892,"p"),e.EFF(893,"Si la configuration d'un module d\xe9pend des variables d'environnement, et que ces variables sont charg\xe9es depuis le fichier "),e.j41(894,"code"),e.EFF(895,".env"),e.k0s(),e.EFF(896,", vous pouvez utiliser le hook "),e.j41(897,"code"),e.EFF(898,"ConfigModule.envVariablesLoaded"),e.k0s(),e.EFF(899," pour vous assurer que le fichier a \xe9t\xe9 charg\xe9 avant d'interagir avec l'objet "),e.j41(900,"code"),e.EFF(901,"process.env"),e.k0s(),e.EFF(902,", voir l'exemple suivant :"),e.k0s(),e.j41(903,"app-copy-button")(904,"pre")(905,"code",28),e.EFF(906,"\nexport async function getStorageModule() {\n  await ConfigModule.envVariablesLoaded;\n  return process.env.STORAGE === 'S3' ? S3StorageModule : DefaultStorageModule;\n}\n"),e.k0s()()(),e.j41(907,"p"),e.EFF(908,"Cette construction garantit qu'apr\xe8s la r\xe9solution de la promesse "),e.j41(909,"code"),e.EFF(910,"ConfigModule.envVariablesLoaded"),e.k0s(),e.EFF(911,", toutes les variables de configuration sont charg\xe9es."),e.k0s(),e.j41(912,"h4",51)(913,"span"),e.EFF(914,"Configuration conditionnelle du module"),e.k0s()(),e.j41(915,"p"),e.EFF(916,"Il peut arriver que vous souhaitiez charger un module de mani\xe8re conditionnelle et sp\xe9cifier la condition dans une variable d'environnement. Heureusement, "),e.j41(917,"code"),e.EFF(918,"@nestjs/config"),e.k0s(),e.EFF(919," fournit un "),e.j41(920,"code"),e.EFF(921,"ConditionalModule"),e.k0s(),e.EFF(922," qui vous permet de faire exactement cela."),e.k0s(),e.j41(923,"app-copy-button")(924,"pre")(925,"code",28),e.EFF(926,"\n@Module({\n  imports: [\n    ConfigModule.forRoot(),\n    ConditionalModule.registerWhen(FooModule, 'USE_FOO'),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(927,"p"),e.EFF(928,"Le module ci-dessus ne chargera le "),e.j41(929,"code"),e.EFF(930,"FooModule"),e.k0s(),e.EFF(931," que si, dans le fichier "),e.j41(932,"code"),e.EFF(933,".env"),e.k0s(),e.EFF(934,", il n'y a pas de valeur "),e.j41(935,"code"),e.EFF(936,"false"),e.k0s(),e.EFF(937," pour la variable d'environnement "),e.j41(938,"code"),e.EFF(939,"USE_FOO"),e.k0s(),e.EFF(940,". Vous pouvez \xe9galement sp\xe9cifier une condition personnalis\xe9e en fournissant vous-m\xeame une fonction qui re\xe7oit la r\xe9f\xe9rence "),e.j41(941,"code"),e.EFF(942,"process.env"),e.k0s(),e.EFF(943," et qui doit renvoyer un bool\xe9en pour que le "),e.j41(944,"code"),e.EFF(945,"ConditionalModule"),e.k0s(),e.EFF(946," le g\xe8re :"),e.k0s(),e.j41(947,"app-copy-button")(948,"pre")(949,"code",28),e.EFF(950,"\n@Module({\n  imports: [\n    ConfigModule.forRoot(),\n    ConditionalModule.registerWhen(\n      FooBarModule,\n      (env: NodeJS.ProcessEnv) => !!env['foo'] && !!env['bar'],\n    ),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(951,"p"),e.EFF(952,"Il est important de s'assurer que lorsque vous utilisez le "),e.j41(953,"code"),e.EFF(954,"ConditionalModule"),e.k0s(),e.EFF(955,", vous avez \xe9galement le "),e.j41(956,"code"),e.EFF(957,"ConfigModule"),e.k0s(),e.EFF(958," charg\xe9 dans l'application, afin que le hook "),e.j41(959,"code"),e.EFF(960,"ConfigModule.envVariablesLoaded"),e.k0s(),e.EFF(961," puisse \xeatre correctement r\xe9f\xe9renc\xe9 et utilis\xe9. Si le hook n'est pas activ\xe9 dans les 5 secondes, ou dans le d\xe9lai en millisecondes, d\xe9fini par l'utilisateur dans le troisi\xe8me param\xe8tre des m\xe9thodes "),e.j41(962,"code"),e.EFF(963,"registerWhen"),e.k0s(),e.EFF(964,", alors le "),e.j41(965,"code"),e.EFF(966,"ConditionalModule"),e.k0s(),e.EFF(967," lancera une erreur et Nest annulera le d\xe9marrage de l'application."),e.k0s(),e.j41(968,"h4",52)(969,"span"),e.EFF(970,"Variables extensibles"),e.k0s()(),e.j41(971,"p"),e.EFF(972,"Le package "),e.j41(973,"code"),e.EFF(974,"@nestjs/config"),e.k0s(),e.EFF(975," supporte l'expansion des variables d'environnement. Avec cette technique, vous pouvez cr\xe9er des variables d'environnement imbriqu\xe9es, o\xf9 une variable est r\xe9f\xe9renc\xe9e dans la d\xe9finition d'une autre. Par exemple :"),e.k0s(),e.j41(976,"pre")(977,"code",29),e.EFF(978,"\nAPP_URL=mywebsite.com\nSUPPORT_EMAIL=support@${APP_URL}\n"),e.k0s()(),e.j41(979,"p"),e.EFF(980,"Avec cette construction, la variable "),e.j41(981,"code"),e.EFF(982,"SUPPORT_EMAIL"),e.k0s(),e.EFF(983," se r\xe9sout en "),e.j41(984,"code"),e.EFF(985,"'support@mywebsite.com'"),e.k0s(),e.EFF(986,". Notez l'utilisation de la syntaxe "),e.j41(987,"code"),e.EFF(988),e.k0s(),e.EFF(989," pour d\xe9clencher la r\xe9solution de la valeur de la variable "),e.j41(990,"code"),e.EFF(991,"APP_URL"),e.k0s(),e.EFF(992," \xe0 l'int\xe9rieur de la d\xe9finition de "),e.j41(993,"code"),e.EFF(994,"SUPPORT_EMAIL"),e.k0s(),e.EFF(995,"."),e.k0s(),e.j41(996,"blockquote",22)(997,"strong"),e.EFF(998,"Astuce"),e.k0s(),e.EFF(999," Pour cette fonctionnalit\xe9, le package "),e.j41(1e3,"code"),e.EFF(1001,"@nestjs/config"),e.k0s(),e.EFF(1002," utilise en interne "),e.j41(1003,"a",53),e.EFF(1004,"dotenv-expand"),e.k0s(),e.EFF(1005,".\n"),e.k0s(),e.j41(1006,"p"),e.EFF(1007,"Activez l'expansion des variables d'environnement en utilisant la propri\xe9t\xe9 "),e.j41(1008,"code"),e.EFF(1009,"expandVariables"),e.k0s(),e.EFF(1010," dans l'objet options pass\xe9 \xe0 la m\xe9thode "),e.j41(1011,"code"),e.EFF(1012,"forRoot()"),e.k0s(),e.EFF(1013," du "),e.j41(1014,"code"),e.EFF(1015,"ConfigModule"),e.k0s(),e.EFF(1016,", comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(1017,"app-copy-button",26)(1018,"span",27),e.EFF(1019),e.nI1(1020,"extension"),e.nrm(1021,"app-tabs",null,13),e.k0s(),e.j41(1023,"pre")(1024,"code",28),e.EFF(1025,"\n@Module({\n  imports: [\n    ConfigModule.forRoot({\n      // ...\n      expandVariables: true,\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(1026,"h4",54)(1027,"span"),e.EFF(1028,"Utilisation dans "),e.j41(1029,"code"),e.EFF(1030,"main.ts"),e.k0s()()(),e.j41(1031,"p"),e.EFF(1032,"Bien que notre configuration soit stock\xe9e dans un service, elle peut toujours \xeatre utilis\xe9e dans le fichier "),e.j41(1033,"code"),e.EFF(1034,"main.ts"),e.k0s(),e.EFF(1035,". Ainsi, vous pouvez l'utiliser pour stocker des variables telles que le port de l'application ou l'h\xf4te CORS."),e.k0s(),e.j41(1036,"p"),e.EFF(1037,"Pour y acc\xe9der, vous devez utiliser la m\xe9thode "),e.j41(1038,"code"),e.EFF(1039,"app.get()"),e.k0s(),e.EFF(1040,", suivie de la r\xe9f\xe9rence du service :"),e.k0s(),e.j41(1041,"app-copy-button")(1042,"pre")(1043,"code",28),e.EFF(1044,"\nconst configService = app.get(ConfigService);\n"),e.k0s()()(),e.j41(1045,"p"),e.EFF(1046,"Vous pouvez alors l'utiliser comme d'habitude, en appelant la m\xe9thode "),e.j41(1047,"code"),e.EFF(1048,"get"),e.k0s(),e.EFF(1049," avec la cl\xe9 de configuration :"),e.k0s(),e.j41(1050,"app-copy-button")(1051,"pre")(1052,"code",28),e.EFF(1053,"\nconst port = configService.get('PORT');\n"),e.k0s()()()()),2&o){const u=e.sdS(91),r=e.sdS(239),p=e.sdS(288),l=e.sdS(335),d=e.sdS(373),m=e.sdS(505),f=e.sdS(708),v=e.sdS(748),b=e.sdS(831),h=e.sdS(848),y=e.sdS(868),g=e.sdS(882),q=e.sdS(1022);e.R7$(88),e.SpI(" ",e.i5U(89,24,"app.module",u.isJsActive),"\n"),e.R7$(148),e.SpI(" ",e.i5U(237,27,"config/configuration",r.isJsActive),"\n"),e.R7$(49),e.SpI(" ",e.i5U(286,30,"config/configuration",p.isJsActive),"\n"),e.R7$(30),e.Lme('"assets" : [',"{",'"include" : "../config/*.yaml", "outDir" : "./dist/config"',"}","]"),e.R7$(17),e.SpI(" ",e.i5U(333,33,"config/configuration",l.isJsActive),"\n"),e.R7$(38),e.SpI(" ",e.i5U(371,36,"feature.module",d.isJsActive),"\n"),e.R7$(132),e.SpI(" ",e.i5U(503,39,"config/database.config",m.isJsActive),"\n"),e.R7$(203),e.SpI(" ",e.i5U(706,42,"app.module",f.isJsActive),"\n"),e.R7$(40),e.SpI(" ",e.i5U(746,45,"app.module",v.isJsActive),"\n"),e.R7$(83),e.SpI(" ",e.i5U(829,48,"env.validation",b.isJsActive),"\n"),e.R7$(17),e.SpI(" ",e.i5U(846,51,"app.module",h.isJsActive),"\n"),e.R7$(24),e.AVh("hide",y.isJsActive),e.R7$(3),e.AVh("hide",!y.isJsActive),e.R7$(7),e.SpI(" ",e.i5U(880,54,"app.service",g.isJsActive),"\n"),e.R7$(4),e.AVh("hide",g.isJsActive),e.R7$(3),e.AVh("hide",!g.isJsActive),e.R7$(102),e.Lme("$","{","...","}",""),e.R7$(31),e.SpI(" ",e.i5U(1020,57,"app.module",q.isJsActive),"\n")}},dependencies:[E.O,i.a,z._,c.z,k.M],encapsulation:2,changeDetection:0})}return s})(),T=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-cookies-docs"]],features:[e.Vt3],decls:245,vars:0,consts:[["contentReference",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/cookies.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","cookies"],["appAnchor","","id","utiliser-avec-express-par-d\xe9faut"],["rel","nofollow","target","_blank","href","https://github.com/expressjs/cookie-parser"],[1,"language-shell"],[1,"language-typescript"],["rel","nofollow","target","_blank","href","https://www.npmjs.org/package/cookie"],[1,"info"],[1,"warning"],["appAnchor","","id","utilisation-avec-fastify"],["rel","nofollow","target","_blank","href","https://github.com/fastify/fastify-cookie#sending"],["appAnchor","","id","cr\xe9ation-dun-d\xe9corateur-personnalis\xe9-multiplateforme"],["routerLink","/custom-decorators"]],template:function(o,t){1&o&&(e.j41(0,"div",1,0)(2,"div",2)(3,"a",3),e.nrm(4,"i",4),e.k0s()(),e.j41(5,"h3",5),e.EFF(6,"Cookies"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Un "),e.j41(9,"strong"),e.EFF(10,"cookie HTTP"),e.k0s(),e.EFF(11," est un petit \xe9l\xe9ment de donn\xe9es stock\xe9 par le navigateur de l'utilisateur. Les cookies ont \xe9t\xe9 con\xe7us comme un m\xe9canisme fiable permettant aux sites web de se souvenir d'informations relatives \xe0 un \xe9tat. Lorsque l'utilisateur visite \xe0 nouveau le site web, le cookie est automatiquement envoy\xe9 avec la requ\xeate."),e.k0s(),e.j41(12,"h4",6)(13,"span"),e.EFF(14,"Utiliser avec Express (par d\xe9faut)"),e.k0s()(),e.j41(15,"p"),e.EFF(16,"Commencez par installer le "),e.j41(17,"a",7),e.EFF(18,"package requis"),e.k0s(),e.EFF(19," (et ses types pour les utilisateurs de TypeScript) :"),e.k0s(),e.j41(20,"pre")(21,"code",8),e.EFF(22,"\n$ npm i cookie-parser\n$ npm i -D @types/cookie-parser\n"),e.k0s()(),e.j41(23,"p"),e.EFF(24,"Une fois l'installation termin\xe9e, appliquez le middleware "),e.j41(25,"code"),e.EFF(26,"cookie-parser"),e.k0s(),e.EFF(27," comme middleware global (par exemple, dans votre fichier "),e.j41(28,"code"),e.EFF(29,"main.ts"),e.k0s(),e.EFF(30,")."),e.k0s(),e.j41(31,"app-copy-button")(32,"pre")(33,"code",9),e.EFF(34,"\nimport * as cookieParser from 'cookie-parser';\n// quelque part dans votre fichier d'initialisation\napp.use(cookieParser());\n"),e.k0s()()(),e.j41(35,"p"),e.EFF(36,"Vous pouvez passer plusieurs options au middleware "),e.j41(37,"code"),e.EFF(38,"cookieParser"),e.k0s(),e.EFF(39," :"),e.k0s(),e.j41(40,"ul")(41,"li")(42,"code"),e.EFF(43,"secret"),e.k0s(),e.EFF(44," : une cha\xeene de caract\xe8res ou un tableau utilis\xe9 pour signer les cookies. Ceci est optionnel et si ce n'est pas sp\xe9cifi\xe9, les cookies sign\xe9s ne seront pas analys\xe9s. Si une cha\xeene de caract\xe8res est fournie, elle est utilis\xe9e comme secret. Si un tableau est fourni, une tentative sera faite pour v\xe9rifier le cookie avec chaque secret dans l'ordre."),e.k0s(),e.j41(45,"li")(46,"code"),e.EFF(47,"options"),e.k0s(),e.EFF(48," : un objet qui est pass\xe9 \xe0 "),e.j41(49,"code"),e.EFF(50,"cookie.parse"),e.k0s(),e.EFF(51," comme deuxi\xe8me option. Voir "),e.j41(52,"a",10),e.EFF(53,"cookie"),e.k0s(),e.EFF(54," pour plus d'informations."),e.k0s()(),e.j41(55,"p"),e.EFF(56,"Le middleware va analyser l'en-t\xeate "),e.j41(57,"code"),e.EFF(58,"Cookie"),e.k0s(),e.EFF(59," de la requ\xeate et exposer les donn\xe9es du cookie en tant que propri\xe9t\xe9 "),e.j41(60,"code"),e.EFF(61,"req.cookies"),e.k0s(),e.EFF(62," et, si un secret a \xe9t\xe9 fourni, en tant que propri\xe9t\xe9 "),e.j41(63,"code"),e.EFF(64,"req.signedCookies"),e.k0s(),e.EFF(65,". Ces propri\xe9t\xe9s sont des paires nom-valeur du nom du cookie et de la valeur du cookie."),e.k0s(),e.j41(66,"p"),e.EFF(67,"Lorsqu'un secret est fourni, ce module d\xe9signera et validera toutes les valeurs des cookies sign\xe9s et d\xe9placera ces paires nom-valeur de "),e.j41(68,"code"),e.EFF(69,"req.cookies"),e.k0s(),e.EFF(70," dans "),e.j41(71,"code"),e.EFF(72,"req.signedCookies"),e.k0s(),e.EFF(73,". Un cookie sign\xe9 est un cookie dont la valeur est pr\xe9fix\xe9e par "),e.j41(74,"code"),e.EFF(75,"s:"),e.k0s(),e.EFF(76,". Les cookies sign\xe9s qui \xe9chouent \xe0 la validation de la signature auront la valeur "),e.j41(77,"code"),e.EFF(78,"false"),e.k0s(),e.EFF(79," \xe0 la place de la valeur alt\xe9r\xe9e."),e.k0s(),e.j41(80,"p"),e.EFF(81,"Ainsi, vous pouvez maintenant lire les cookies \xe0 partir des gestionnaires de routes, comme suit :"),e.k0s(),e.j41(82,"app-copy-button")(83,"pre")(84,"code",9),e.EFF(85,"\n@Get()\nfindAll(@Req() request: Request) {\n  console.log(request.cookies); // ou \"request.cookies['cookieKey']\"\n  // ou console.log(request.signedCookies);\n}\n"),e.k0s()()(),e.j41(86,"blockquote",11)(87,"strong"),e.EFF(88,"Astuce"),e.k0s(),e.EFF(89," Le d\xe9corateur "),e.j41(90,"code"),e.EFF(91,"@Req()"),e.k0s(),e.EFF(92," est import\xe9 du package "),e.j41(93,"code"),e.EFF(94,"@nestjs/common"),e.k0s(),e.EFF(95,", tandis que "),e.j41(96,"code"),e.EFF(97,"Request"),e.k0s(),e.EFF(98," est import\xe9 du package "),e.j41(99,"code"),e.EFF(100,"express"),e.k0s(),e.EFF(101,".\n"),e.k0s(),e.j41(102,"p"),e.EFF(103,"Pour attacher un cookie \xe0 une r\xe9ponse sortante, utilisez la m\xe9thode "),e.j41(104,"code"),e.EFF(105,"Response#cookie()"),e.k0s(),e.EFF(106," :"),e.k0s(),e.j41(107,"app-copy-button")(108,"pre")(109,"code",9),e.EFF(110,"\n@Get()\nfindAll(@Res({ passthrough: true }) response: Response) {\n  response.cookie('key', 'value')\n}\n"),e.k0s()()(),e.j41(111,"blockquote",12)(112,"strong"),e.EFF(113,"Attention"),e.k0s(),e.EFF(114," Si vous voulez laisser la logique de gestion des r\xe9ponses au framework, n'oubliez pas de mettre l'option "),e.j41(115,"code"),e.EFF(116,"passthrough"),e.k0s(),e.EFF(117," \xe0 "),e.j41(118,"code"),e.EFF(119,"true"),e.k0s(),e.EFF(120,", comme indiqu\xe9 ci-dessus. Pour en savoir plus, cliquez ici (/controllers#approche-sp\xe9cifique-aux-biblioth\xe8ques).\n"),e.k0s(),e.j41(121,"blockquote",11)(122,"strong"),e.EFF(123,"Astuce"),e.k0s(),e.EFF(124," Le d\xe9corateur "),e.j41(125,"code"),e.EFF(126,"@Res()"),e.k0s(),e.EFF(127," est import\xe9 du package "),e.j41(128,"code"),e.EFF(129,"@nestjs/common"),e.k0s(),e.EFF(130,", tandis que "),e.j41(131,"code"),e.EFF(132,"Response"),e.k0s(),e.EFF(133," est import\xe9 du package "),e.j41(134,"code"),e.EFF(135,"express"),e.k0s(),e.EFF(136,".\n"),e.k0s(),e.j41(137,"h4",13)(138,"span"),e.EFF(139,"Utilisation avec Fastify"),e.k0s()(),e.j41(140,"p"),e.EFF(141,"Installez d'abord le package requis :"),e.k0s(),e.j41(142,"pre")(143,"code",8),e.EFF(144,"\n$ npm i @fastify/cookie\n"),e.k0s()(),e.j41(145,"p"),e.EFF(146,"Une fois l'installation termin\xe9e, enregistrez le plugin "),e.j41(147,"code"),e.EFF(148,"@fastify/cookie"),e.k0s(),e.EFF(149," :"),e.k0s(),e.j41(150,"app-copy-button")(151,"pre")(152,"code",9),e.EFF(153,"\nimport fastifyCookie from '@fastify/cookie';\n\n// quelque part dans votre fichier d'initialisation\nconst app = await NestFactory.create<NestFastifyApplication>(AppModule, new FastifyAdapter());\nawait app.register(fastifyCookie, {\n  secret: 'my-secret', // pour la signature des cookies\n});\n"),e.k0s()()(),e.j41(154,"p"),e.EFF(155,"Ceci \xe9tant fait, vous pouvez maintenant lire les cookies \xe0 partir des gestionnaires d'itin\xe9raires, comme suit :"),e.k0s(),e.j41(156,"app-copy-button")(157,"pre")(158,"code",9),e.EFF(159,"\n@Get()\nfindAll(@Req() request: FastifyRequest) {\n  console.log(request.cookies); // ou \"request.cookies['cookieKey']\"\n}\n"),e.k0s()()(),e.j41(160,"blockquote",11)(161,"strong"),e.EFF(162,"Astuce"),e.k0s(),e.EFF(163," Le d\xe9corateur "),e.j41(164,"code"),e.EFF(165,"@Req()"),e.k0s(),e.EFF(166," est import\xe9 du paquet "),e.j41(167,"code"),e.EFF(168,"@nestjs/common"),e.k0s(),e.EFF(169,", tandis que "),e.j41(170,"code"),e.EFF(171,"FastifyRequest"),e.k0s(),e.EFF(172," est import\xe9 du paquet "),e.j41(173,"code"),e.EFF(174,"fastify"),e.k0s(),e.EFF(175,".\n"),e.k0s(),e.j41(176,"p"),e.EFF(177,"Pour attacher un cookie \xe0 une r\xe9ponse sortante, utilisez la m\xe9thode "),e.j41(178,"code"),e.EFF(179,"FastifyReply#setCookie()"),e.k0s(),e.EFF(180," :"),e.k0s(),e.j41(181,"app-copy-button")(182,"pre")(183,"code",9),e.EFF(184,"\n@Get()\nfindAll(@Res({ passthrough: true }) response: FastifyReply) {\n  response.setCookie('key', 'value')\n}\n"),e.k0s()()(),e.j41(185,"p"),e.EFF(186,"Pour en savoir plus sur la m\xe9thode "),e.j41(187,"code"),e.EFF(188,"FastifyReply#setCookie()"),e.k0s(),e.EFF(189,", consultez cette "),e.j41(190,"a",14),e.EFF(191,"page"),e.k0s(),e.EFF(192,"."),e.k0s(),e.j41(193,"blockquote",12)(194,"strong"),e.EFF(195,"Attention"),e.k0s(),e.EFF(196," Si vous voulez laisser la logique de gestion des r\xe9ponses au framework, n'oubliez pas de mettre l'option "),e.j41(197,"code"),e.EFF(198,"passthrough"),e.k0s(),e.EFF(199," \xe0 "),e.j41(200,"code"),e.EFF(201,"true"),e.k0s(),e.EFF(202,", comme indiqu\xe9 ci-dessus. Pour en savoir plus, cliquez ici (/controllers#approche-sp\xe9cifique-aux-biblioth\xe8ques).\n"),e.k0s(),e.j41(203,"blockquote",11)(204,"strong"),e.EFF(205,"Astuce"),e.k0s(),e.EFF(206," Le d\xe9corateur "),e.j41(207,"code"),e.EFF(208,"@Res()"),e.k0s(),e.EFF(209," est import\xe9 du paquet "),e.j41(210,"code"),e.EFF(211,"@nestjs/common"),e.k0s(),e.EFF(212,", tandis que "),e.j41(213,"code"),e.EFF(214,"FastifyReply"),e.k0s(),e.EFF(215," est import\xe9 du paquet "),e.j41(216,"code"),e.EFF(217,"fastify"),e.k0s(),e.EFF(218,".\n"),e.k0s(),e.j41(219,"h4",15)(220,"span"),e.EFF(221,"Cr\xe9ation d'un d\xe9corateur personnalis\xe9 (multiplateforme)"),e.k0s()(),e.j41(222,"p"),e.EFF(223,"Pour disposer d'un moyen pratique et d\xe9claratif d'acc\xe9der aux cookies entrants, nous pouvons cr\xe9er un "),e.j41(224,"a",16),e.EFF(225,"d\xe9corateur personnalis\xe9"),e.k0s(),e.EFF(226,"."),e.k0s(),e.j41(227,"app-copy-button")(228,"pre")(229,"code",9),e.EFF(230,"\nimport { createParamDecorator, ExecutionContext } from '@nestjs/common';\n\nexport const Cookies = createParamDecorator((data: string, ctx: ExecutionContext) => {\n  const request = ctx.switchToHttp().getRequest();\n  return data ? request.cookies?.[data] : request.cookies;\n});\n"),e.k0s()()(),e.j41(231,"p"),e.EFF(232,"Le d\xe9corateur "),e.j41(233,"code"),e.EFF(234,"@Cookies()"),e.k0s(),e.EFF(235," extrait tous les cookies ou un cookie nomm\xe9 de l'objet "),e.j41(236,"code"),e.EFF(237,"req.cookies"),e.k0s(),e.EFF(238," et remplit le param\xe8tre d\xe9cor\xe9 avec cette valeur."),e.k0s(),e.j41(239,"p"),e.EFF(240,"Ceci \xe9tant fait, nous pouvons maintenant utiliser le d\xe9corateur dans la signature d'un gestionnaire de route, comme suit :"),e.k0s(),e.j41(241,"app-copy-button")(242,"pre")(243,"code",9),e.EFF(244,"\n@Get()\nfindAll(@Cookies('name') name: string) {}\n"),e.k0s()()()())},dependencies:[i.a,c.z,j.Wk],encapsulation:2,changeDetection:0})}return s})(),U=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-events"]],features:[e.Vt3],decls:252,vars:4,consts:[["contentReference",""],["appfeecfebbbd21c18bef33298a308ffb2253dc0c78",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/events.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","\xe9v\xe9nements"],["rel","nofollow","target","_blank","href","https://www.npmjs.com/package/@nestjs/event-emitter"],["rel","nofollow","target","_blank","href","https://github.com/EventEmitter2/EventEmitter2"],["appAnchor","","id","pour-commencer"],[1,"language-shell"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],["appAnchor","","id","envoi-d\xe9v\xe9nements"],[1,"info"],["appAnchor","","id","\xe9couter-les-\xe9v\xe9nements"],[1,"warning"],["rel","nofollow","target","_blank","href","https://github.com/EventEmitter2/EventEmitter2#emitteronevent-listener-options-objectboolean"],["rel","nofollow","target","_blank","href","https://github.com/EventEmitter2/EventEmitter2#multi-level-wildcards"],["appAnchor","","id","pr\xe9venir-la-perte-d\xe9v\xe9nements"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/30-event-emitter"]],template:function(o,t){if(1&o&&(e.j41(0,"div",2,0)(2,"div",3)(3,"a",4),e.nrm(4,"i",5),e.k0s()(),e.j41(5,"h3",6),e.EFF(6,"\xc9v\xe9nements"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Le package "),e.j41(9,"a",7),e.EFF(10,"Event Emitter"),e.k0s(),e.EFF(11," ("),e.j41(12,"code"),e.EFF(13,"@nestjs/event-emitter"),e.k0s(),e.EFF(14,") fournit une impl\xe9mentation simple d'observateur, vous permettant de vous abonner et d'\xe9couter les diff\xe9rents \xe9v\xe9nements qui se produisent dans votre application. Les \xe9v\xe9nements sont un excellent moyen de d\xe9coupler les diff\xe9rents aspects de votre application, puisqu'un seul \xe9v\xe9nement peut avoir plusieurs auditeurs qui ne d\xe9pendent pas les uns des autres."),e.k0s(),e.j41(15,"p")(16,"code"),e.EFF(17,"EventEmitterModule"),e.k0s(),e.EFF(18," utilise en interne le package "),e.j41(19,"a",8),e.EFF(20,"eventemitter2"),e.k0s(),e.EFF(21,"."),e.k0s(),e.j41(22,"h4",9)(23,"span"),e.EFF(24,"Pour commencer"),e.k0s()(),e.j41(25,"p"),e.EFF(26,"Installez d'abord le package requis :"),e.k0s(),e.j41(27,"pre")(28,"code",10),e.EFF(29,"\n$ npm i --save @nestjs/event-emitter\n"),e.k0s()(),e.j41(30,"p"),e.EFF(31,"Une fois l'installation termin\xe9e, importez le module "),e.j41(32,"code"),e.EFF(33,"EventEmitterModule"),e.k0s(),e.EFF(34," dans le module racine "),e.j41(35,"code"),e.EFF(36,"AppModule"),e.k0s(),e.EFF(37," et ex\xe9cutez la m\xe9thode statique "),e.j41(38,"code"),e.EFF(39,"forRoot()"),e.k0s(),e.EFF(40," comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(41,"app-copy-button",11)(42,"span",12),e.EFF(43),e.nI1(44,"extension"),e.nrm(45,"app-tabs",null,1),e.k0s(),e.j41(47,"pre")(48,"code",13),e.EFF(49,"\nimport { Module } from '@nestjs/common';\nimport { EventEmitterModule } from '@nestjs/event-emitter';\n\n@Module({\n  imports: [\n    EventEmitterModule.forRoot()\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(50,"p"),e.EFF(51,"L'appel "),e.j41(52,"code"),e.EFF(53,".forRoot()"),e.k0s(),e.EFF(54," initialise l'\xe9metteur d'\xe9v\xe9nements et enregistre tous les r\xe9cepteurs d'\xe9v\xe9nements d\xe9claratifs qui existent dans votre application. L'enregistrement a lieu lorsque le hook du cycle de vie "),e.j41(55,"code"),e.EFF(56,"onApplicationBootstrap"),e.k0s(),e.EFF(57," se produit, en s'assurant que tous les modules ont \xe9t\xe9 charg\xe9s et ont d\xe9clar\xe9 tous les travaux planifi\xe9s."),e.k0s(),e.j41(58,"p"),e.EFF(59,"Pour configurer l'instance "),e.j41(60,"code"),e.EFF(61,"EventEmitter"),e.k0s(),e.EFF(62," sous-jacente, passez l'objet de configuration \xe0 la m\xe9thode "),e.j41(63,"code"),e.EFF(64,".forRoot()"),e.k0s(),e.EFF(65,", comme suit :"),e.k0s(),e.j41(66,"app-copy-button")(67,"pre")(68,"code",13),e.EFF(69,"\nEventEmitterModule.forRoot({\n  // mettre ce param\xe8tre \xe0 `true` pour utiliser les caract\xe8res joker\n  wildcard: false,\n  // le d\xe9limiteur utilis\xe9 pour segmenter les espaces de noms\n  delimiter: '.',\n  // mettez ceci \xe0 `true` si vous voulez \xe9mettre l'\xe9v\xe9nement newListener\n  newListener: false,\n  // mettez ceci \xe0 `true` si vous voulez \xe9mettre l'\xe9v\xe9nement removeListener\n  removeListener: false,\n  // le nombre maximum d'auditeurs pouvant \xeatre affect\xe9s \xe0 un \xe9v\xe9nement\n  maxListeners: 10,\n  // afficher le nom de l'\xe9v\xe9nement dans le message de fuite de m\xe9moire lorsque le nombre d'auditeurs attribu\xe9s est sup\xe9rieur au nombre maximal.\n  verboseMemoryLeak: false,\n  // d\xe9sactiver le lancement de uncaughtException si un \xe9v\xe9nement d'erreur est \xe9mis et qu'il n'a pas d'auditeurs\n  ignoreErrors: false,\n});\n"),e.k0s()()(),e.j41(70,"h4",14)(71,"span"),e.EFF(72,"Envoi d'\xe9v\xe9nements"),e.k0s()(),e.j41(73,"p"),e.EFF(74,"Pour envoyer (c'est-\xe0-dire d\xe9clencher) un \xe9v\xe9nement, il faut d'abord injecter "),e.j41(75,"code"),e.EFF(76,"EventEmitter2"),e.k0s(),e.EFF(77," en utilisant l'injection de constructeur standard :"),e.k0s(),e.j41(78,"app-copy-button")(79,"pre")(80,"code",13),e.EFF(81,"\nconstructor(private eventEmitter: EventEmitter2) {}\n"),e.k0s()()(),e.j41(82,"blockquote",15)(83,"strong"),e.EFF(84,"Astuce"),e.k0s(),e.EFF(85," Importez le "),e.j41(86,"code"),e.EFF(87,"EventEmitter2"),e.k0s(),e.EFF(88," depuis le package "),e.j41(89,"code"),e.EFF(90,"@nestjs/event-emitter"),e.k0s(),e.EFF(91,".\n"),e.k0s(),e.j41(92,"p"),e.EFF(93,"Utilisez-le ensuite dans une classe comme suit :"),e.k0s(),e.j41(94,"app-copy-button")(95,"pre")(96,"code",13),e.EFF(97,"\nthis.eventEmitter.emit(\n  'order.created',\n  new OrderCreatedEvent({\n    orderId: 1,\n    payload: {},\n  }),\n);\n"),e.k0s()()(),e.j41(98,"h4",16)(99,"span"),e.EFF(100,"\xc9couter les \xe9v\xe9nements"),e.k0s()(),e.j41(101,"p"),e.EFF(102,"Pour d\xe9clarer un r\xe9cepteur d'\xe9v\xe9nements, d\xe9corez une m\xe9thode avec le d\xe9corateur "),e.j41(103,"code"),e.EFF(104,"@OnEvent()"),e.k0s(),e.EFF(105," pr\xe9c\xe9dant la d\xe9finition de la m\xe9thode contenant le code \xe0 ex\xe9cuter, comme suit :"),e.k0s(),e.j41(106,"app-copy-button")(107,"pre")(108,"code",13),e.EFF(109,"\n@OnEvent('order.created')\nhandleOrderCreatedEvent(payload: OrderCreatedEvent) {\n  // handle and process \"OrderCreatedEvent\" event\n}\n"),e.k0s()()(),e.j41(110,"blockquote",17)(111,"strong"),e.EFF(112,"Attention"),e.k0s(),e.EFF(113," Les abonn\xe9s aux \xe9v\xe9nements ne peuvent pas faire l'objet d'une requ\xeate.\n"),e.k0s(),e.j41(114,"p"),e.EFF(115,"Le premier argument peut \xeatre une "),e.j41(116,"code"),e.EFF(117,"string"),e.k0s(),e.EFF(118," ou un "),e.j41(119,"code"),e.EFF(120,"symbol"),e.k0s(),e.EFF(121," pour un \xe9metteur d'\xe9v\xe9nement simple et un "),e.j41(122,"code"),e.EFF(123,"string | symbol | Array<string | symbol>"),e.k0s(),e.EFF(124," dans le cas d'un \xe9metteur joker."),e.k0s(),e.j41(125,"p"),e.EFF(126,"Le second argument (optionnel) est un objet d'options d'\xe9coute comme suit:"),e.k0s(),e.j41(127,"app-copy-button")(128,"pre")(129,"code",13),e.EFF(130,'\nexport type OnEventOptions = OnOptions & {\n  /**\n   * If "true", prepends (instead of append) the given listener to the array of listeners.\n   *\n   * @see https://github.com/EventEmitter2/EventEmitter2#emitterprependlistenerevent-listener-options\n   *\n   * @default false\n   */\n  prependListener?: boolean;\n\n  /**\n   * If "true", the onEvent callback will not throw an error while handling the event. Otherwise, if "false" it will throw an error.\n   * \n   * @default true\n   */\n  suppressErrors?: boolean;\n};\n'),e.k0s()()(),e.j41(131,"blockquote",15)(132,"strong"),e.EFF(133,"Astuce"),e.k0s(),e.EFF(134," En savoir plus sur l'objet d'options OnOptions depuis "),e.j41(135,"a",18)(136,"code"),e.EFF(137,"eventemitter2"),e.k0s()(),e.EFF(138,".\n"),e.k0s(),e.j41(139,"p"),e.EFF(140,"Pour utiliser les espaces de noms et les jokers, passez l'option "),e.j41(141,"code"),e.EFF(142,"wildcard"),e.k0s(),e.EFF(143," dans la m\xe9thode "),e.j41(144,"code"),e.EFF(145,"EventEmitterModule#forRoot()"),e.k0s(),e.EFF(146,". Lorsque les espaces de noms et les caract\xe8res g\xe9n\xe9riques sont activ\xe9s, les \xe9v\xe9nements peuvent \xeatre soit des cha\xeenes de caract\xe8res ("),e.j41(147,"code"),e.EFF(148,"foo.bar"),e.k0s(),e.EFF(149,") s\xe9par\xe9es par un d\xe9limiteur, soit des tableaux ("),e.j41(150,"code"),e.EFF(151,"['foo', 'bar']"),e.k0s(),e.EFF(152,"). Le d\xe9limiteur est \xe9galement configurable en tant que propri\xe9t\xe9 de configuration ("),e.j41(153,"code"),e.EFF(154,"delimiter"),e.k0s(),e.EFF(155,"). Avec la fonctionnalit\xe9 namespaces activ\xe9e, vous pouvez vous abonner \xe0 des \xe9v\xe9nements en utilisant un joker :"),e.k0s(),e.j41(156,"app-copy-button")(157,"pre")(158,"code",13),e.EFF(159,"\n@OnEvent('order.*')\nhandleOrderEvents(payload: OrderCreatedEvent | OrderRemovedEvent | OrderUpdatedEvent) {\n  // g\xe8re et traite un \xe9v\xe9nement\n}\n"),e.k0s()()(),e.j41(160,"p"),e.EFF(161,"Notez qu'un tel joker ne s'applique qu'\xe0 un seul bloc. L'argument "),e.j41(162,"code"),e.EFF(163,"order.*"),e.k0s(),e.EFF(164," correspondra, par exemple, aux \xe9v\xe9nements "),e.j41(165,"code"),e.EFF(166,"order.created"),e.k0s(),e.EFF(167," et "),e.j41(168,"code"),e.EFF(169,"order.shipped"),e.k0s(),e.EFF(170," mais pas \xe0 "),e.j41(171,"code"),e.EFF(172,"order.delayed.out_of_stock"),e.k0s(),e.EFF(173,". Afin d'\xe9couter de tels \xe9v\xe9nements, utilisez le motif "),e.j41(174,"code"),e.EFF(175,"multilevel wildcard"),e.k0s(),e.EFF(176," (i.e., "),e.j41(177,"code"),e.EFF(178,"**"),e.k0s(),e.EFF(179,"), d\xe9crit dans la "),e.j41(180,"a",19),e.EFF(181,"documentation"),e.k0s(),e.EFF(182," de "),e.j41(183,"code"),e.EFF(184,"EventEmitter2"),e.k0s(),e.EFF(185," ."),e.k0s(),e.j41(186,"p"),e.EFF(187,"Gr\xe2ce \xe0 ce mod\xe8le, vous pouvez, par exemple, cr\xe9er un \xe9couteur d'\xe9v\xe9nements qui capture tous les \xe9v\xe9nements."),e.k0s(),e.j41(188,"app-copy-button")(189,"pre")(190,"code",13),e.EFF(191,"\n@OnEvent('**')\nhandleEverything(payload: any) {\n  // g\xe8re et traite un \xe9v\xe9nement\n}\n"),e.k0s()()(),e.j41(192,"blockquote",15)(193,"strong"),e.EFF(194,"Astuce"),e.k0s(),e.EFF(195," La classe "),e.j41(196,"code"),e.EFF(197,"EventEmitter2"),e.k0s(),e.EFF(198," fournit plusieurs m\xe9thodes utiles pour interagir avec les \xe9v\xe9nements, comme "),e.j41(199,"code"),e.EFF(200,"waitFor"),e.k0s(),e.EFF(201," et "),e.j41(202,"code"),e.EFF(203,"onAny"),e.k0s(),e.EFF(204,". Vous pouvez en savoir plus sur ces m\xe9thodes "),e.j41(205,"a",8),e.EFF(206,"ici"),e.k0s(),e.EFF(207,".\n"),e.k0s(),e.j41(208,"h4",20)(209,"span"),e.EFF(210,"Pr\xe9venir la perte d'\xe9v\xe9nements"),e.k0s()(),e.j41(211,"p"),e.EFF(212,"Les \xe9v\xe9nements d\xe9clench\xe9s avant ou pendant le hook de cycle de vie "),e.j41(213,"code"),e.EFF(214,"onApplicationBootstrap"),e.k0s(),e.EFF(215," - tels que ceux provenant des constructeurs de modules ou de la m\xe9thode "),e.j41(216,"code"),e.EFF(217,"onModuleInit"),e.k0s(),e.EFF(218," - peuvent \xeatre manqu\xe9s parce que le "),e.j41(219,"code"),e.EFF(220,"EventSubscribersLoader"),e.k0s(),e.EFF(221," n'a peut-\xeatre pas fini de configurer les listeners."),e.k0s(),e.j41(222,"p"),e.EFF(223,"Pour \xe9viter ce probl\xe8me, vous pouvez utiliser la m\xe9thode "),e.j41(224,"code"),e.EFF(225,"waitUntilReady"),e.k0s(),e.EFF(226," du "),e.j41(227,"code"),e.EFF(228,"EventEmitterReadinessWatcher"),e.k0s(),e.EFF(229,", qui retourne une promesse qui se r\xe9sout une fois que tous les listeners ont \xe9t\xe9 enregistr\xe9s. Cette m\xe9thode peut \xeatre appel\xe9e dans le hook de cycle de vie "),e.j41(230,"code"),e.EFF(231,"onApplicationBootstrap"),e.k0s(),e.EFF(232," d'un module pour s'assurer que tous les \xe9v\xe9nements sont correctement captur\xe9s."),e.k0s(),e.j41(233,"app-copy-button")(234,"pre")(235,"code",13),e.EFF(236,"\nawait this.eventEmitterReadinessWatcher.waitUntilReady();\nawait this.eventEmitter.emit(\n  'order.created',\n  new OrderCreatedEvent({ orderId: 1, payload: {} }),\n);\n"),e.k0s()()(),e.j41(237,"blockquote",15)(238,"strong"),e.EFF(239,"Note"),e.k0s(),e.EFF(240," Ceci n'est n\xe9cessaire que pour les \xe9v\xe9nements \xe9mis avant que le hook du cycle de vie "),e.j41(241,"code"),e.EFF(242,"onApplicationBootstrap"),e.k0s(),e.EFF(243," ne soit termin\xe9.\n"),e.k0s(),e.j41(244,"h4",21)(245,"span"),e.EFF(246,"Exemple"),e.k0s()(),e.j41(247,"p"),e.EFF(248,"Un exemple concret est disponible "),e.j41(249,"a",22),e.EFF(250,"ici"),e.k0s(),e.EFF(251,"."),e.k0s()()),2&o){const u=e.sdS(46);e.R7$(43),e.SpI(" ",e.i5U(44,1,"app.module",u.isJsActive),"\n")}},dependencies:[E.O,i.a,c.z,k.M],encapsulation:2,changeDetection:0})}return s})(),O=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-file-upload"]],features:[e.Vt3],decls:553,vars:18,consts:[["contentReference",""],["app1b5c10010791abfc1a8c5dbee8e771d610d7e001",""],["appd371f540e51e2776b3903916bcb85a4d8a5e69fc",""],["app659deaba5043e521a09d9b8dbd324d71988265e4",""],["app46f803bb76afb1409aeea981cfe3f5a6dc3bb3c1",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/file-upload.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","t\xe9l\xe9chargement-de-fichiers"],["rel","nofollow","target","_blank","href","https://github.com/expressjs/multer"],[1,"warning"],[1,"language-shell"],["appAnchor","","id","exemple-basique"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],[1,"info"],["rel","nofollow","target","_blank","href","https://github.com/expressjs/multer#multeropts"],["appAnchor","","id","validation-de-fichiers"],["rel","nofollow","target","_blank","href","https://docs.nestjs.com/pipes"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/blob/master/packages/common/pipes/file/file-type.validator.ts"],["rel","nofollow","target","_blank","href","https://www.ibm.com/support/pages/what-magic-number"],["appAnchor","","id","liste-de-fichiers"],["appAnchor","","id","fichiers-multiples"],["appAnchor","","id","nimporte-quel-fichier"],["appAnchor","","id","pas-de-fichier"],["appAnchor","","id","options-par-d\xe9faut"],["appAnchor","","id","configuration-asynchrone"],["href","/fundamentals/custom-providers#fournisseurs-de-factory--usefactory"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/29-file-upload"]],template:function(o,t){if(1&o&&(e.j41(0,"div",5,0)(2,"div",6)(3,"a",7),e.nrm(4,"i",8),e.k0s()(),e.j41(5,"h3",9),e.EFF(6,"T\xe9l\xe9chargement de fichiers"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Pour g\xe9rer le t\xe9l\xe9chargement de fichiers, Nest fournit un module int\xe9gr\xe9 bas\xe9 sur le package middleware "),e.j41(9,"a",10),e.EFF(10,"multer"),e.k0s(),e.EFF(11," pour Express. Multer g\xe8re les donn\xe9es affich\xe9es au format "),e.j41(12,"code"),e.EFF(13,"multipart/form-data"),e.k0s(),e.EFF(14,", qui est principalement utilis\xe9 pour le t\xe9l\xe9chargement de fichiers via une requ\xeate HTTP "),e.j41(15,"code"),e.EFF(16,"POST"),e.k0s(),e.EFF(17,". Ce module est enti\xe8rement configurable et vous pouvez adapter son comportement aux besoins de votre application."),e.k0s(),e.j41(18,"blockquote",11)(19,"strong"),e.EFF(20,"Attention"),e.k0s(),e.EFF(21," Multer ne peut pas traiter les donn\xe9es qui ne sont pas dans le format multipart support\xe9 ("),e.j41(22,"code"),e.EFF(23,"multipart/form-data"),e.k0s(),e.EFF(24,"). Notez \xe9galement que ce paquet n'est pas compatible avec le "),e.j41(25,"code"),e.EFF(26,"FastifyAdapter"),e.k0s(),e.EFF(27,".\n"),e.k0s(),e.j41(28,"p"),e.EFF(29,"Pour une meilleure s\xe9curit\xe9 des types, installons le paquet de types Multer :"),e.k0s(),e.j41(30,"pre")(31,"code",12),e.EFF(32,"\n$ npm i -D @types/multer\n"),e.k0s()(),e.j41(33,"p"),e.EFF(34,"Avec ce paquet install\xe9, nous pouvons maintenant utiliser le type "),e.j41(35,"code"),e.EFF(36,"Express.Multer.File"),e.k0s(),e.EFF(37," (vous pouvez importer ce type comme suit : "),e.j41(38,"code"),e.EFF(39),e.k0s(),e.EFF(40,")."),e.k0s(),e.j41(41,"h4",13)(42,"span"),e.EFF(43,"Exemple basique"),e.k0s()(),e.j41(44,"p"),e.EFF(45,"Pour t\xe9l\xe9charger un seul fichier, il suffit de lier l'intercepteur "),e.j41(46,"code"),e.EFF(47,"FileInterceptor()"),e.k0s(),e.EFF(48," au gestionnaire de route et d'extraire "),e.j41(49,"code"),e.EFF(50,"file"),e.k0s(),e.EFF(51," de la "),e.j41(52,"code"),e.EFF(53,"request"),e.k0s(),e.EFF(54," en utilisant le d\xe9corateur "),e.j41(55,"code"),e.EFF(56,"@UploadedFile()"),e.k0s(),e.EFF(57,"."),e.k0s(),e.j41(58,"app-copy-button",14)(59,"span",15),e.nrm(60,"app-tabs",null,1),e.k0s(),e.j41(62,"pre")(63,"code",16),e.EFF(64,"\n@Post('upload')\n@UseInterceptors(FileInterceptor('file'))\nuploadFile(@UploadedFile() file: Express.Multer.File) {\n  console.log(file);\n}\n"),e.k0s()(),e.j41(65,"pre")(66,"code",16),e.EFF(67,"\n@Post('upload')\n@UseInterceptors(FileInterceptor('file'))\n@Bind(UploadedFile())\nuploadFile(file) {\n  console.log(file);\n}\n"),e.k0s()()(),e.j41(68,"blockquote",17)(69,"strong"),e.EFF(70,"Astuce"),e.k0s(),e.EFF(71," Le d\xe9corateur "),e.j41(72,"code"),e.EFF(73,"FileInterceptor()"),e.k0s(),e.EFF(74," est export\xe9 depuis le paquet "),e.j41(75,"code"),e.EFF(76,"@nestjs/platform-express"),e.k0s(),e.EFF(77,". Le d\xe9corateur "),e.j41(78,"code"),e.EFF(79,"@UploadedFile()"),e.k0s(),e.EFF(80," est export\xe9 depuis le paquet "),e.j41(81,"code"),e.EFF(82,"@nestjs/common"),e.k0s(),e.EFF(83,".\n"),e.k0s(),e.j41(84,"p"),e.EFF(85,"Le d\xe9corateur "),e.j41(86,"code"),e.EFF(87,"FileInterceptor()"),e.k0s(),e.EFF(88," prend deux arguments :"),e.k0s(),e.j41(89,"ul")(90,"li")(91,"code"),e.EFF(92,"fieldName"),e.k0s(),e.EFF(93,": cha\xeene de caract\xe8res qui fournit le nom du champ du formulaire HTML qui contient un fichier"),e.k0s(),e.j41(94,"li")(95,"code"),e.EFF(96,"options"),e.k0s(),e.EFF(97,": objet optionnel de type "),e.j41(98,"code"),e.EFF(99,"MulterOptions"),e.k0s(),e.EFF(100,". C'est le m\xeame objet que celui utilis\xe9 par le constructeur de multer (plus de d\xe9tails "),e.j41(101,"a",18),e.EFF(102,"ici"),e.k0s(),e.EFF(103,")."),e.k0s()(),e.j41(104,"blockquote",11)(105,"strong"),e.EFF(106,"Attention"),e.k0s(),e.j41(107,"code"),e.EFF(108,"FileInterceptor()"),e.k0s(),e.EFF(109," peut ne pas \xeatre compatible avec des fournisseurs de clouds tiers tels que Google Firebase ou autres.\n"),e.k0s(),e.j41(110,"h4",19)(111,"span"),e.EFF(112,"Validation de fichiers"),e.k0s()(),e.j41(113,"p"),e.EFF(114,"Souvent, il peut \xeatre utile de valider les m\xe9tadonn\xe9es d'un fichier entrant, comme la taille ou le mime-type du fichier. Pour cela, vous pouvez cr\xe9er votre propre "),e.j41(115,"a",20),e.EFF(116,"Pipe"),e.k0s(),e.EFF(117," et le lier au param\xe8tre annot\xe9 avec le d\xe9corateur "),e.j41(118,"code"),e.EFF(119,"UploadedFile"),e.k0s(),e.EFF(120,". L'exemple ci-dessous montre comment un pipe basique de validation de taille de fichier pourrait \xeatre impl\xe9ment\xe9 :"),e.k0s(),e.j41(121,"app-copy-button")(122,"pre")(123,"code",16),e.EFF(124,"\nimport { PipeTransform, Injectable, ArgumentMetadata } from '@nestjs/common';\n\n@Injectable()\nexport class FileSizeValidationPipe implements PipeTransform {\n  transform(value: any, metadata: ArgumentMetadata) {\n    // \"value\" est un objet contenant les attributs et les m\xe9tadonn\xe9es du fichier\n    const oneKb = 1000;\n    return value.size < oneKb;\n  }\n}\n"),e.k0s()()(),e.j41(125,"p"),e.EFF(126,"Ceci peut \xeatre utilis\xe9 en conjonction avec le "),e.j41(127,"code"),e.EFF(128,"FileInterceptor"),e.k0s(),e.EFF(129," comme suit :"),e.k0s(),e.j41(130,"app-copy-button")(131,"pre")(132,"code",16),e.EFF(133,"\n@Post('file')\n@UseInterceptors(FileInterceptor('file'))\nuploadFileAndValidate(@UploadedFile(\n  new FileSizeValidationPipe(),\n  // other pipes can be added here\n) file: Express.Multer.File, ) {\n  return file;\n}\n"),e.k0s()()(),e.j41(134,"p"),e.EFF(135,"Nest fournit un pipe int\xe9gr\xe9 pour g\xe9rer les cas d'utilisation courants et faciliter/standardiser l'ajout de nouveaux cas. Ce tube est appel\xe9 "),e.j41(136,"code"),e.EFF(137,"ParseFilePipe"),e.k0s(),e.EFF(138,", et vous pouvez l'utiliser comme suit :"),e.k0s(),e.j41(139,"app-copy-button")(140,"pre")(141,"code",16),e.EFF(142,"\n@Post('file')\nuploadFileAndPassValidation(\n  @Body() body: SampleDto,\n  @UploadedFile(\n    new ParseFilePipe({\n      validators: [\n        // ... Ensemble d'instances de validateurs de fichiers ici\n      ]\n    })\n  )\n  file: Express.Multer.File,\n) {\n  return {\n    body,\n    file: file.buffer.toString(),\n  };\n}\n"),e.k0s()()(),e.j41(143,"p"),e.EFF(144,"Comme vous pouvez le voir, il est n\xe9cessaire de sp\xe9cifier un tableau de validateurs de fichiers qui seront ex\xe9cut\xe9s par le "),e.j41(145,"code"),e.EFF(146,"ParseFilePipe"),e.k0s(),e.EFF(147,". Nous allons discuter de l'interface d'un validateur, mais il vaut la peine de mentionner que ce pipe a aussi deux options "),e.j41(148,"strong"),e.EFF(149,"optionnelles"),e.k0s(),e.EFF(150," suppl\xe9mentaires :"),e.k0s(),e.j41(151,"table")(152,"tr")(153,"td")(154,"code"),e.EFF(155,"errorHttpStatusCode"),e.k0s()(),e.j41(156,"td"),e.EFF(157,"Le code d'\xe9tat HTTP \xe0 afficher en cas d'\xe9chec de "),e.j41(158,"b"),e.EFF(159,"n'importe lequel"),e.k0s(),e.EFF(160," des validateurs. La valeur par d\xe9faut est "),e.j41(161,"code"),e.EFF(162,"400"),e.k0s(),e.EFF(163," (BAD REQUEST)"),e.k0s()(),e.j41(164,"tr")(165,"td")(166,"code"),e.EFF(167,"exceptionFactory"),e.k0s()(),e.j41(168,"td"),e.EFF(169,"Une fabrique qui re\xe7oit le message d'erreur et renvoie une erreur."),e.k0s()()(),e.j41(170,"p"),e.EFF(171,"Revenons maintenant \xe0 l'interface "),e.j41(172,"code"),e.EFF(173,"FileValidator"),e.k0s(),e.EFF(174,". Pour int\xe9grer des validateurs \xe0 cette pipe, vous devez soit utiliser les impl\xe9mentations int\xe9gr\xe9es, soit fournir votre propre "),e.j41(175,"code"),e.EFF(176,"FileValidator"),e.k0s(),e.EFF(177,". Voir l'exemple ci-dessous :"),e.k0s(),e.j41(178,"app-copy-button")(179,"pre")(180,"code",16),e.EFF(181,"\nexport abstract class FileValidator<TValidationOptions = Record<string, any>> {\n  constructor(protected readonly validationOptions: TValidationOptions) {}\n\n  /**\n   * Indique si ce fichier doit \xeatre consid\xe9r\xe9 comme valide, selon les options pass\xe9es dans le constructeur.\n   * @param file le fichier contenu dans l'objet requ\xeate\n   */\n  abstract isValid(file?: any): boolean | Promise<boolean>;\n\n  /**\n   * Cr\xe9e un message d'erreur en cas d'\xe9chec de la validation.\n   * @param file le fichier contenu dans l'objet requ\xeate\n   */\n  abstract buildErrorMessage(file: any): string;\n}\n"),e.k0s()()(),e.j41(182,"blockquote",17)(183,"strong"),e.EFF(184,"Astuce"),e.k0s(),e.EFF(185," L'interface "),e.j41(186,"code"),e.EFF(187,"FileValidator"),e.k0s(),e.EFF(188," supporte la validation asynchrone via sa fonction "),e.j41(189,"code"),e.EFF(190,"isValid"),e.k0s(),e.EFF(191,". Pour tirer parti de la s\xe9curit\xe9 des types, vous pouvez aussi taper le param\xe8tre "),e.j41(192,"code"),e.EFF(193,"file"),e.k0s(),e.EFF(194," comme "),e.j41(195,"code"),e.EFF(196,"Express.Multer.File"),e.k0s(),e.EFF(197," dans le cas o\xf9 vous utilisez express (par d\xe9faut) comme pilote.\n"),e.k0s(),e.j41(198,"p")(199,"code"),e.EFF(200,"FileValidator"),e.k0s(),e.EFF(201," est une classe normale qui a acc\xe8s \xe0 l'objet fichier et le valide en fonction des options fournies par le client. Nest poss\xe8de deux impl\xe9mentations int\xe9gr\xe9es de "),e.j41(202,"code"),e.EFF(203,"FileValidator"),e.k0s(),e.EFF(204," que vous pouvez utiliser dans votre projet :"),e.k0s(),e.j41(205,"ul")(206,"li")(207,"code"),e.EFF(208,"MaxFileSizeValidator"),e.k0s(),e.EFF(209," - V\xe9rifie si la taille d'un fichier donn\xe9 est inf\xe9rieure \xe0 la valeur fournie (mesur\xe9e en "),e.j41(210,"code"),e.EFF(211,"bytes"),e.k0s(),e.EFF(212,")"),e.k0s(),e.j41(213,"li")(214,"code"),e.EFF(215,"FileTypeValidator"),e.k0s(),e.EFF(216," - V\xe9rifie si le type de mime d'un fichier donn\xe9 correspond \xe0 la valeur donn\xe9e."),e.k0s()(),e.j41(217,"blockquote",11)(218,"strong"),e.EFF(219,"Attention"),e.k0s(),e.EFF(220," Pour v\xe9rifier le type de fichier, la classe "),e.j41(221,"a",21),e.EFF(222,"FileTypeValidator"),e.k0s(),e.EFF(223," utilise le type d\xe9tect\xe9 par multer. Par d\xe9faut, multer d\xe9duit le type de fichier \xe0 partir de l'extension du fichier sur l'appareil de l'utilisateur. Cependant, il ne v\xe9rifie pas le contenu r\xe9el du fichier. Comme les fichiers peuvent \xeatre renomm\xe9s avec des extensions arbitraires, envisagez d'utiliser une impl\xe9mentation personnalis\xe9e (comme la v\xe9rification du "),e.j41(224,"a",22),e.EFF(225,"nombre magique"),e.k0s(),e.EFF(226," du fichier) si votre application n\xe9cessite une solution plus s\xfbre.\n"),e.k0s(),e.j41(227,"p"),e.EFF(228,"Pour comprendre comment ils peuvent \xeatre utilis\xe9s en conjonction avec le "),e.j41(229,"code"),e.EFF(230,"FileParsePipe"),e.k0s(),e.EFF(231," mentionn\xe9 plus haut, nous allons utiliser un extrait modifi\xe9 du dernier exemple pr\xe9sent\xe9 :"),e.k0s(),e.j41(232,"app-copy-button")(233,"pre")(234,"code",16),e.EFF(235,"\n@UploadedFile(\n  new ParseFilePipe({\n    validators: [\n      new MaxFileSizeValidator({ maxSize: 1000 }),\n      new FileTypeValidator({ fileType: 'image/jpeg' }),\n    ],\n  }),\n)\nfile: Express.Multer.File,\n"),e.k0s()()(),e.j41(236,"blockquote",17)(237,"strong"),e.EFF(238,"Astuce"),e.k0s(),e.EFF(239," Si le nombre de validateurs augmente consid\xe9rablement ou si leurs options encombrent le fichier, vous pouvez d\xe9finir ce tableau dans un fichier s\xe9par\xe9 et l'importer ici sous la forme d'une constante nomm\xe9e comme "),e.j41(240,"code"),e.EFF(241,"fileValidators"),e.k0s(),e.EFF(242,".\n"),e.k0s(),e.j41(243,"p"),e.EFF(244,"Enfin, vous pouvez utiliser la classe sp\xe9ciale "),e.j41(245,"code"),e.EFF(246,"ParseFilePipeBuilder"),e.k0s(),e.EFF(247," qui vous permet de composer et de construire vos validateurs. En l'utilisant comme indiqu\xe9 ci-dessous, vous pouvez \xe9viter l'instanciation manuelle de chaque validateur et simplement passer leurs options directement :"),e.k0s(),e.j41(248,"app-copy-button")(249,"pre")(250,"code",16),e.EFF(251,"\n@UploadedFile(\n  new ParseFilePipeBuilder()\n    .addFileTypeValidator({\n      fileType: 'jpeg',\n    })\n    .addMaxSizeValidator({\n      maxSize: 1000\n    })\n    .build({\n      errorHttpStatusCode: HttpStatus.UNPROCESSABLE_ENTITY\n    }),\n)\nfile: Express.Multer.File,\n"),e.k0s()()(),e.j41(252,"blockquote",17)(253,"strong"),e.EFF(254,"Astuce"),e.k0s(),e.EFF(255," La pr\xe9sence d'un fichier est requise par d\xe9faut, mais vous pouvez la rendre optionnelle en ajoutant le param\xe8tre "),e.j41(256,"code"),e.EFF(257,"fileIsRequired : false"),e.k0s(),e.EFF(258," dans les options de la fonction "),e.j41(259,"code"),e.EFF(260,"build"),e.k0s(),e.EFF(261," (au m\xeame niveau que "),e.j41(262,"code"),e.EFF(263,"errorHttpStatusCode"),e.k0s(),e.EFF(264,").\n"),e.k0s(),e.j41(265,"h4",23)(266,"span"),e.EFF(267,"Liste de fichiers"),e.k0s()(),e.j41(268,"p"),e.EFF(269,"Pour t\xe9l\xe9charger un ensemble de fichiers (identifi\xe9s par un seul nom de champ), utilisez le d\xe9corateur "),e.j41(270,"code"),e.EFF(271,"FilesInterceptor()"),e.k0s(),e.EFF(272," (notez le pluriel "),e.j41(273,"strong"),e.EFF(274,"Files"),e.k0s(),e.EFF(275," dans le nom du d\xe9corateur). Ce d\xe9corateur prend trois arguments :"),e.k0s(),e.j41(276,"ul")(277,"li")(278,"code"),e.EFF(279,"fieldName"),e.k0s(),e.EFF(280,": comme d\xe9crit ci-dessus"),e.k0s(),e.j41(281,"li")(282,"code"),e.EFF(283,"maxCount"),e.k0s(),e.EFF(284,": nombre facultatif d\xe9finissant le nombre maximum de fichiers \xe0 accepter"),e.k0s(),e.j41(285,"li")(286,"code"),e.EFF(287,"options"),e.k0s(),e.EFF(288,": objet facultatif "),e.j41(289,"code"),e.EFF(290,"MulterOptions"),e.k0s(),e.EFF(291,", comme d\xe9crit ci-dessus"),e.k0s()(),e.j41(292,"p"),e.EFF(293,"Lorsque vous utilisez "),e.j41(294,"code"),e.EFF(295,"FilesInterceptor()"),e.k0s(),e.EFF(296,", extrayez les fichiers de la "),e.j41(297,"code"),e.EFF(298,"request"),e.k0s(),e.EFF(299," avec le d\xe9corateur "),e.j41(300,"code"),e.EFF(301,"@UploadedFiles()"),e.k0s(),e.EFF(302,"."),e.k0s(),e.j41(303,"app-copy-button",14)(304,"span",15),e.nrm(305,"app-tabs",null,2),e.k0s(),e.j41(307,"pre")(308,"code",16),e.EFF(309,"\n@Post('upload')\n@UseInterceptors(FilesInterceptor('files'))\nuploadFile(@UploadedFiles() files: Array<Express.Multer.File>) {\n  console.log(files);\n}\n"),e.k0s()(),e.j41(310,"pre")(311,"code",16),e.EFF(312,"\n@Post('upload')\n@UseInterceptors(FilesInterceptor('files'))\n@Bind(UploadedFiles())\nuploadFile(files) {\n  console.log(files);\n}\n"),e.k0s()()(),e.j41(313,"blockquote",17)(314,"strong"),e.EFF(315,"Astuce"),e.k0s(),e.EFF(316," Le d\xe9corateur "),e.j41(317,"code"),e.EFF(318,"FilesInterceptor()"),e.k0s(),e.EFF(319," est export\xe9 depuis le paquet "),e.j41(320,"code"),e.EFF(321,"@nestjs/platform-express"),e.k0s(),e.EFF(322,". Le d\xe9corateur "),e.j41(323,"code"),e.EFF(324,"@UploadedFiles()"),e.k0s(),e.EFF(325," est export\xe9 depuis le paquet "),e.j41(326,"code"),e.EFF(327,"@nestjs/common"),e.k0s(),e.EFF(328,".\n"),e.k0s(),e.j41(329,"h4",24)(330,"span"),e.EFF(331,"Fichiers multiples"),e.k0s()(),e.j41(332,"p"),e.EFF(333,"Pour t\xe9l\xe9charger plusieurs fichiers (tous avec des noms de champs diff\xe9rents), utilisez le d\xe9corateur "),e.j41(334,"code"),e.EFF(335,"FileFieldsInterceptor()"),e.k0s(),e.EFF(336,". Ce d\xe9corateur prend deux arguments :"),e.k0s(),e.j41(337,"ul")(338,"li")(339,"code"),e.EFF(340,"uploadedFields"),e.k0s(),e.EFF(341,": un tableau d'objets, o\xf9 chaque objet sp\xe9cifie une propri\xe9t\xe9 obligatoire "),e.j41(342,"code"),e.EFF(343,"name"),e.k0s(),e.EFF(344," avec une valeur de cha\xeene sp\xe9cifiant un nom de champ, comme d\xe9crit ci-dessus, et une propri\xe9t\xe9 optionnelle "),e.j41(345,"code"),e.EFF(346,"maxCount"),e.k0s(),e.EFF(347,", comme d\xe9crit ci-dessus"),e.k0s(),e.j41(348,"li")(349,"code"),e.EFF(350,"options"),e.k0s(),e.EFF(351,": objet facultatif "),e.j41(352,"code"),e.EFF(353,"MulterOptions"),e.k0s(),e.EFF(354,", comme d\xe9crit ci-dessus"),e.k0s()(),e.j41(355,"p"),e.EFF(356,"Lorsque vous utilisez "),e.j41(357,"code"),e.EFF(358,"FileFieldsInterceptor()"),e.k0s(),e.EFF(359,", extrayez les fichiers de la "),e.j41(360,"code"),e.EFF(361,"request"),e.k0s(),e.EFF(362," avec le d\xe9corateur "),e.j41(363,"code"),e.EFF(364,"@UploadedFiles()"),e.k0s(),e.EFF(365,"."),e.k0s(),e.j41(366,"app-copy-button",14)(367,"span",15),e.nrm(368,"app-tabs",null,3),e.k0s(),e.j41(370,"pre")(371,"code",16),e.EFF(372,"\n@Post('upload')\n@UseInterceptors(FileFieldsInterceptor([\n  { name: 'avatar', maxCount: 1 },\n  { name: 'background', maxCount: 1 },\n]))\nuploadFile(@UploadedFiles() files: { avatar?: Express.Multer.File[], background?: Express.Multer.File[] }) {\n  console.log(files);\n}\n"),e.k0s()(),e.j41(373,"pre")(374,"code",16),e.EFF(375,"\n@Post('upload')\n@Bind(UploadedFiles())\n@UseInterceptors(FileFieldsInterceptor([\n  { name: 'avatar', maxCount: 1 },\n  { name: 'background', maxCount: 1 },\n]))\nuploadFile(files) {\n  console.log(files);\n}\n"),e.k0s()()(),e.j41(376,"h4",25)(377,"span"),e.EFF(378,"N'importe quel fichier"),e.k0s()(),e.j41(379,"p"),e.EFF(380,"Pour t\xe9l\xe9charger tous les champs avec des cl\xe9s de noms de champs arbitraires, utilisez le d\xe9corateur "),e.j41(381,"code"),e.EFF(382,"AnyFilesInterceptor()"),e.k0s(),e.EFF(383,". Ce d\xe9corateur peut accepter un objet optionnel "),e.j41(384,"code"),e.EFF(385,"options"),e.k0s(),e.EFF(386," comme d\xe9crit ci-dessus."),e.k0s(),e.j41(387,"p"),e.EFF(388,"Lorsque vous utilisez "),e.j41(389,"code"),e.EFF(390,"AnyFilesInterceptor()"),e.k0s(),e.EFF(391,", extrayez les fichiers de la "),e.j41(392,"code"),e.EFF(393,"request"),e.k0s(),e.EFF(394," avec le d\xe9corateur "),e.j41(395,"code"),e.EFF(396,"@UploadedFiles()"),e.k0s(),e.EFF(397,"."),e.k0s(),e.j41(398,"app-copy-button",14)(399,"span",15),e.nrm(400,"app-tabs",null,4),e.k0s(),e.j41(402,"pre")(403,"code",16),e.EFF(404,"\n@Post('upload')\n@UseInterceptors(AnyFilesInterceptor())\nuploadFile(@UploadedFiles() files: Array<Express.Multer.File>) {\n  console.log(files);\n}\n"),e.k0s()(),e.j41(405,"pre")(406,"code",16),e.EFF(407,"\n@Post('upload')\n@Bind(UploadedFiles())\n@UseInterceptors(AnyFilesInterceptor())\nuploadFile(files) {\n  console.log(files);\n}\n"),e.k0s()()(),e.j41(408,"h4",26)(409,"span"),e.EFF(410,"Pas de fichier"),e.k0s()(),e.j41(411,"p"),e.EFF(412,"Pour accepter "),e.j41(413,"code"),e.EFF(414,"multipart/form-data"),e.k0s(),e.EFF(415," mais ne pas autoriser le t\xe9l\xe9chargement de fichiers, utilisez le "),e.j41(416,"code"),e.EFF(417,"NoFilesInterceptor"),e.k0s(),e.EFF(418,". Cela d\xe9finit les donn\xe9es multipart comme des attributs sur le corps de la requ\xeate. Tout fichier envoy\xe9 avec la requ\xeate lancera une "),e.j41(419,"code"),e.EFF(420,"BadRequestException"),e.k0s(),e.EFF(421,"."),e.k0s(),e.j41(422,"app-copy-button")(423,"pre")(424,"code",16),e.EFF(425,"\n@Post('upload')\n@UseInterceptors(NoFilesInterceptor())\nhandleMultiPartData(@Body() body) {\n  console.log(body)\n}\n"),e.k0s()()(),e.j41(426,"h4",27)(427,"span"),e.EFF(428,"Options par d\xe9faut"),e.k0s()(),e.j41(429,"p"),e.EFF(430,"Vous pouvez sp\xe9cifier des options multer dans les intercepteurs de fichiers comme d\xe9crit ci-dessus. Pour d\xe9finir les options par d\xe9faut, vous pouvez appeler la m\xe9thode statique "),e.j41(431,"code"),e.EFF(432,"register()"),e.k0s(),e.EFF(433," lorsque vous importez le "),e.j41(434,"code"),e.EFF(435,"MulterModule"),e.k0s(),e.EFF(436,", en passant les options support\xe9es. Vous pouvez utiliser toutes les options list\xe9es "),e.j41(437,"a",18),e.EFF(438,"ici"),e.k0s(),e.EFF(439,"."),e.k0s(),e.j41(440,"app-copy-button")(441,"pre")(442,"code",16),e.EFF(443,"\nMulterModule.register({\n  dest: './upload',\n});\n"),e.k0s()()(),e.j41(444,"blockquote",17)(445,"strong"),e.EFF(446,"Astuce"),e.k0s(),e.EFF(447," La classe "),e.j41(448,"code"),e.EFF(449,"MulterModule"),e.k0s(),e.EFF(450," est export\xe9e du paquetage "),e.j41(451,"code"),e.EFF(452,"@nestjs/platform-express"),e.k0s(),e.EFF(453,".\n"),e.k0s(),e.j41(454,"h4",28)(455,"span"),e.EFF(456,"Configuration asynchrone"),e.k0s()(),e.j41(457,"p"),e.EFF(458,"Lorsque vous avez besoin de d\xe9finir les options de "),e.j41(459,"code"),e.EFF(460,"MulterModule"),e.k0s(),e.EFF(461," de mani\xe8re asynchrone plut\xf4t que statique, utilisez la m\xe9thode "),e.j41(462,"code"),e.EFF(463,"registerAsync()"),e.k0s(),e.EFF(464,". Comme pour la plupart des modules dynamiques, Nest fournit plusieurs techniques pour g\xe9rer la configuration asynchrone."),e.k0s(),e.j41(465,"p"),e.EFF(466,"Une technique consiste \xe0 utiliser une fonction d'usine :"),e.k0s(),e.j41(467,"app-copy-button")(468,"pre")(469,"code",16),e.EFF(470,"\nMulterModule.registerAsync({\n  useFactory: () => ({\n    dest: './upload',\n  }),\n});\n"),e.k0s()()(),e.j41(471,"p"),e.EFF(472,"Comme les autres "),e.j41(473,"a",29),e.EFF(474,"fournisseurs d'usine"),e.k0s(),e.EFF(475,", notre fonction d'usine peut \xeatre "),e.j41(476,"code"),e.EFF(477,"async"),e.k0s(),e.EFF(478," et peut injecter des d\xe9pendances via "),e.j41(479,"code"),e.EFF(480,"inject"),e.k0s(),e.EFF(481,"."),e.k0s(),e.j41(482,"app-copy-button")(483,"pre")(484,"code",16),e.EFF(485,"\nMulterModule.registerAsync({\n  imports: [ConfigModule],\n  useFactory: async (configService: ConfigService) => ({\n    dest: configService.get<string>('MULTER_DEST'),\n  }),\n  inject: [ConfigService],\n});\n"),e.k0s()()(),e.j41(486,"p"),e.EFF(487,"Alternativement, vous pouvez configurer le "),e.j41(488,"code"),e.EFF(489,"MulterModule"),e.k0s(),e.EFF(490," en utilisant une classe au lieu d'une fabrique, comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(491,"app-copy-button")(492,"pre")(493,"code",16),e.EFF(494,"\nMulterModule.registerAsync({\n  useClass: MulterConfigService,\n});\n"),e.k0s()()(),e.j41(495,"p"),e.EFF(496,"La construction ci-dessus instancie "),e.j41(497,"code"),e.EFF(498,"MulterConfigService"),e.k0s(),e.EFF(499," \xe0 l'int\xe9rieur de "),e.j41(500,"code"),e.EFF(501,"MulterModule"),e.k0s(),e.EFF(502,", en l'utilisant pour cr\xe9er l'objet d'options requis. Notez que dans cet exemple, le "),e.j41(503,"code"),e.EFF(504,"MulterConfigService"),e.k0s(),e.EFF(505," doit impl\xe9menter l'interface "),e.j41(506,"code"),e.EFF(507,"MulterOptionsFactory"),e.k0s(),e.EFF(508,", comme montr\xe9 ci-dessous. Le "),e.j41(509,"code"),e.EFF(510,"MulterModule"),e.k0s(),e.EFF(511," appellera la m\xe9thode "),e.j41(512,"code"),e.EFF(513,"createMulterOptions()"),e.k0s(),e.EFF(514," sur l'objet instanci\xe9 de la classe fournie."),e.k0s(),e.j41(515,"app-copy-button")(516,"pre")(517,"code",16),e.EFF(518,"\n@Injectable()\nclass MulterConfigService implements MulterOptionsFactory {\n  createMulterOptions(): MulterModuleOptions {\n    return {\n      dest: './upload',\n    };\n  }\n}\n"),e.k0s()()(),e.j41(519,"p"),e.EFF(520,"Si vous voulez r\xe9utiliser un fournisseur d'options existant au lieu de cr\xe9er une copie priv\xe9e dans le "),e.j41(521,"code"),e.EFF(522,"MulterModule"),e.k0s(),e.EFF(523,", utilisez la syntaxe "),e.j41(524,"code"),e.EFF(525,"useExisting"),e.k0s(),e.EFF(526,"."),e.k0s(),e.j41(527,"app-copy-button")(528,"pre")(529,"code",16),e.EFF(530,"\nMulterModule.registerAsync({\n  imports: [ConfigModule],\n  useExisting: ConfigService,\n});\n"),e.k0s()()(),e.j41(531,"p"),e.EFF(532,"Vous pouvez \xe9galement passer ce que l'on appelle des "),e.j41(533,"code"),e.EFF(534,"extraProviders"),e.k0s(),e.EFF(535," \xe0 la m\xe9thode "),e.j41(536,"code"),e.EFF(537,"registerAsync()"),e.k0s(),e.EFF(538,". Ces fournisseurs seront fusionn\xe9s avec les fournisseurs du module."),e.k0s(),e.j41(539,"app-copy-button")(540,"pre")(541,"code",16),e.EFF(542,"\nMulterModule.registerAsync({\n  imports: [ConfigModule],\n  useClass: ConfigService,\n  extraProviders: [MyAdditionalProvider],\n});\n"),e.k0s()()(),e.j41(543,"p"),e.EFF(544,"C'est utile lorsque vous souhaitez fournir des d\xe9pendances suppl\xe9mentaires \xe0 la fonction d'usine ou au constructeur de la classe."),e.k0s(),e.j41(545,"h4",30)(546,"span"),e.EFF(547,"Exemple"),e.k0s()(),e.j41(548,"p"),e.EFF(549,"Un exemple concret est disponible "),e.j41(550,"a",31),e.EFF(551,"ici"),e.k0s(),e.EFF(552,"."),e.k0s()()),2&o){const u=e.sdS(61),r=e.sdS(306),p=e.sdS(369),l=e.sdS(401);e.R7$(39),e.Lme("import ","{"," Express ","}"," from 'express'"),e.R7$(23),e.AVh("hide",u.isJsActive),e.R7$(3),e.AVh("hide",!u.isJsActive),e.R7$(242),e.AVh("hide",r.isJsActive),e.R7$(3),e.AVh("hide",!r.isJsActive),e.R7$(60),e.AVh("hide",p.isJsActive),e.R7$(3),e.AVh("hide",!p.isJsActive),e.R7$(29),e.AVh("hide",l.isJsActive),e.R7$(3),e.AVh("hide",!l.isJsActive)}},dependencies:[E.O,i.a,c.z],encapsulation:2,changeDetection:0})}return s})(),V=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-http-module"]],features:[e.Vt3],decls:266,vars:4,consts:[["contentReference",""],["app2284167ff06ea0da671f33e59b322ccde8c7f195",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/http-module.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","module-http"],["rel","nofollow","target","_blank","href","https://github.com/axios/axios"],[1,"info"],["rel","nofollow","target","_blank","href","https://github.com/sindresorhus/got"],["rel","nofollow","target","_blank","href","https://github.com/nodejs/undici"],["appAnchor","","id","installation"],[1,"language-bash"],["appAnchor","","id","pour-commencer"],[1,"language-typescript"],[1,"with-heading"],[1,"filename"],["appAnchor","","id","configuration"],["rel","nofollow","target","_blank","href","https://github.com/axios/axios#request-config"],["appAnchor","","id","configuration-asynchrone"],["href","/fundamentals/custom-providers#fournisseurs-de-factory--usefactory"],["appAnchor","","id","utilisation-directe-daxios"],["appAnchor","","id","exemple-complet"],["rel","nofollow","target","_blank","href","https://rxjs.dev/api/index/function/firstValueFrom"],["rel","nofollow","target","_blank","href","https://rxjs.dev/api/index/function/lastValueFrom"]],template:function(o,t){if(1&o&&(e.j41(0,"div",2,0)(2,"div",3)(3,"a",4),e.nrm(4,"i",5),e.k0s()(),e.j41(5,"h3",6),e.EFF(6,"Module HTTP"),e.k0s(),e.j41(7,"p")(8,"a",7),e.EFF(9,"Axios"),e.k0s(),e.EFF(10," est un package de client HTTP riche en fonctionnalit\xe9s et largement utilis\xe9. Nest encapsule Axios et l'expose via le "),e.j41(11,"code"),e.EFF(12,"HttpModule"),e.k0s(),e.EFF(13," int\xe9gr\xe9. Le "),e.j41(14,"code"),e.EFF(15,"HttpModule"),e.k0s(),e.EFF(16," exporte la classe "),e.j41(17,"code"),e.EFF(18,"HttpService"),e.k0s(),e.EFF(19,", qui expose les m\xe9thodes bas\xe9es sur Axios pour effectuer des requ\xeates HTTP. La biblioth\xe8que transforme \xe9galement les r\xe9ponses HTTP r\xe9sultantes en "),e.j41(20,"code"),e.EFF(21,"Observables"),e.k0s(),e.EFF(22,"."),e.k0s(),e.j41(23,"blockquote",8)(24,"strong"),e.EFF(25,"Astuce"),e.k0s(),e.EFF(26," Vous pouvez \xe9galement utiliser directement n'importe quelle biblioth\xe8que client HTTP Node.js, y compris "),e.j41(27,"a",9),e.EFF(28,"got"),e.k0s(),e.EFF(29," ou "),e.j41(30,"a",10),e.EFF(31,"undici"),e.k0s(),e.EFF(32,".\n"),e.k0s(),e.j41(33,"h4",11)(34,"span"),e.EFF(35,"Installation"),e.k0s()(),e.j41(36,"p"),e.EFF(37,"Pour commencer \xe0 l'utiliser, nous devons d'abord installer les d\xe9pendances n\xe9cessaires."),e.k0s(),e.j41(38,"pre")(39,"code",12),e.EFF(40,"\n$ npm i --save @nestjs/axios axios\n"),e.k0s()(),e.j41(41,"h4",13)(42,"span"),e.EFF(43,"Pour commencer"),e.k0s()(),e.j41(44,"p"),e.EFF(45,"Une fois le processus d'installation termin\xe9, pour utiliser le "),e.j41(46,"code"),e.EFF(47,"HttpService"),e.k0s(),e.EFF(48,", il faut d'abord importer le "),e.j41(49,"code"),e.EFF(50,"HttpModule"),e.k0s(),e.EFF(51,"."),e.k0s(),e.j41(52,"app-copy-button")(53,"pre")(54,"code",14),e.EFF(55,"\n@Module({\n  imports: [HttpModule],\n  providers: [CatsService],\n})\nexport class CatsModule {}\n"),e.k0s()()(),e.j41(56,"p"),e.EFF(57,"Ensuite, injecter "),e.j41(58,"code"),e.EFF(59,"HttpService"),e.k0s(),e.EFF(60," en utilisant l'injection normale de constructeur."),e.k0s(),e.j41(61,"blockquote",8)(62,"strong"),e.EFF(63,"Astuce"),e.k0s(),e.EFF(64," Les modules "),e.j41(65,"code"),e.EFF(66,"HttpModule"),e.k0s(),e.EFF(67," et "),e.j41(68,"code"),e.EFF(69,"HttpService"),e.k0s(),e.EFF(70," sont import\xe9s du package "),e.j41(71,"code"),e.EFF(72,"@nestjs/axios"),e.k0s(),e.EFF(73,".\n"),e.k0s(),e.j41(74,"app-copy-button",15)(75,"span",16),e.nrm(76,"app-tabs",null,1),e.k0s(),e.j41(78,"pre")(79,"code",14),e.EFF(80,"\n@Injectable()\nexport class CatsService {\n  constructor(private readonly httpService: HttpService) {}\n\n  findAll(): Observable<AxiosResponse<Cat[]>> {\n    return this.httpService.get('http://localhost:3000/cats');\n  }\n}\n"),e.k0s()(),e.j41(81,"pre")(82,"code",14),e.EFF(83,"\n@Injectable()\n@Dependencies(HttpService)\nexport class CatsService {\n  constructor(httpService) {\n    this.httpService = httpService;\n  }\n\n  findAll() {\n    return this.httpService.get('http://localhost:3000/cats');\n  }\n}\n"),e.k0s()()(),e.j41(84,"blockquote",8)(85,"strong"),e.EFF(86,"Astuce"),e.k0s(),e.j41(87,"code"),e.EFF(88,"AxiosResponse"),e.k0s(),e.EFF(89," est une interface export\xe9e depuis le package "),e.j41(90,"code"),e.EFF(91,"axios"),e.k0s(),e.EFF(92," ("),e.j41(93,"code"),e.EFF(94,"$ npm i axios"),e.k0s(),e.EFF(95,").\n"),e.k0s(),e.j41(96,"p"),e.EFF(97,"Toutes les m\xe9thodes "),e.j41(98,"code"),e.EFF(99,"HttpService"),e.k0s(),e.EFF(100," retournent un objet "),e.j41(101,"code"),e.EFF(102,"AxiosResponse"),e.k0s(),e.EFF(103," envelopp\xe9 dans un objet "),e.j41(104,"code"),e.EFF(105,"Observable"),e.k0s(),e.EFF(106,"."),e.k0s(),e.j41(107,"h4",17)(108,"span"),e.EFF(109,"Configuration"),e.k0s()(),e.j41(110,"p")(111,"a",7),e.EFF(112,"Axios"),e.k0s(),e.EFF(113," peut \xeatre configur\xe9 avec une vari\xe9t\xe9 d'options pour personnaliser le comportement du "),e.j41(114,"code"),e.EFF(115,"HttpService"),e.k0s(),e.EFF(116,". Lisez-en plus \xe0 leur sujet "),e.j41(117,"a",18),e.EFF(118,"ici"),e.k0s(),e.EFF(119,". Pour configurer l'instance Axios sous-jacente, passez un objet facultatif d'options \xe0 la m\xe9thode "),e.j41(120,"code"),e.EFF(121,"register()"),e.k0s(),e.EFF(122," de "),e.j41(123,"code"),e.EFF(124,"HttpModule"),e.k0s(),e.EFF(125," lors de son importation. Cet objet options sera pass\xe9 directement au constructeur d'Axios sous-jacent."),e.k0s(),e.j41(126,"app-copy-button")(127,"pre")(128,"code",14),e.EFF(129,"\n@Module({\n  imports: [\n    HttpModule.register({\n      timeout: 5000,\n      maxRedirects: 5,\n    }),\n  ],\n  providers: [CatsService],\n})\nexport class CatsModule {}\n"),e.k0s()()(),e.j41(130,"h4",19)(131,"span"),e.EFF(132,"Configuration asynchrone"),e.k0s()(),e.j41(133,"p"),e.EFF(134,"Lorsque vous avez besoin de passer des options de module de mani\xe8re asynchrone plut\xf4t que statique, utilisez la m\xe9thode "),e.j41(135,"code"),e.EFF(136,"registerAsync()"),e.k0s(),e.EFF(137,". Comme pour la plupart des modules dynamiques, Nest fournit plusieurs techniques pour g\xe9rer la configuration asynchrone."),e.k0s(),e.j41(138,"p"),e.EFF(139,"Une technique consiste \xe0 utiliser une fonction factory :"),e.k0s(),e.j41(140,"app-copy-button")(141,"pre")(142,"code",14),e.EFF(143,"\nHttpModule.registerAsync({\n  useFactory: () => ({\n    timeout: 5000,\n    maxRedirects: 5,\n  }),\n});\n"),e.k0s()()(),e.j41(144,"p"),e.EFF(145,"Comme les autres fournisseurs d'usine, notre fonction d'usine peut \xeatre "),e.j41(146,"a",20),e.EFF(147,"async"),e.k0s(),e.EFF(148," et peut injecter des d\xe9pendances via "),e.j41(149,"code"),e.EFF(150,"inject"),e.k0s(),e.EFF(151,"."),e.k0s(),e.j41(152,"app-copy-button")(153,"pre")(154,"code",14),e.EFF(155,"\nHttpModule.registerAsync({\n  imports: [ConfigModule],\n  useFactory: async (configService: ConfigService) => ({\n    timeout: configService.get('HTTP_TIMEOUT'),\n    maxRedirects: configService.get('HTTP_MAX_REDIRECTS'),\n  }),\n  inject: [ConfigService],\n});\n"),e.k0s()()(),e.j41(156,"p"),e.EFF(157,"Alternativement, vous pouvez configurer le "),e.j41(158,"code"),e.EFF(159,"HttpModule"),e.k0s(),e.EFF(160," en utilisant une classe au lieu d'une fabrique, comme montr\xe9 ci-dessous."),e.k0s(),e.j41(161,"app-copy-button")(162,"pre")(163,"code",14),e.EFF(164,"\nHttpModule.registerAsync({\n  useClass: HttpConfigService,\n});\n"),e.k0s()()(),e.j41(165,"p"),e.EFF(166,"La construction ci-dessus instancie "),e.j41(167,"code"),e.EFF(168,"HttpConfigService"),e.k0s(),e.EFF(169," dans "),e.j41(170,"code"),e.EFF(171,"HttpModule"),e.k0s(),e.EFF(172,", en l'utilisant pour cr\xe9er un objet options. Notez que dans cet exemple, le "),e.j41(173,"code"),e.EFF(174,"HttpConfigService"),e.k0s(),e.EFF(175," doit impl\xe9menter l'interface "),e.j41(176,"code"),e.EFF(177,"HttpModuleOptionsFactory"),e.k0s(),e.EFF(178," comme montr\xe9 ci-dessous. Le "),e.j41(179,"code"),e.EFF(180,"HttpModule"),e.k0s(),e.EFF(181," appellera la m\xe9thode "),e.j41(182,"code"),e.EFF(183,"createHttpOptions()"),e.k0s(),e.EFF(184," sur l'objet instanci\xe9 de la classe fournie."),e.k0s(),e.j41(185,"app-copy-button")(186,"pre")(187,"code",14),e.EFF(188,"\n@Injectable()\nclass HttpConfigService implements HttpModuleOptionsFactory {\n  createHttpOptions(): HttpModuleOptions {\n    return {\n      timeout: 5000,\n      maxRedirects: 5,\n    };\n  }\n}\n"),e.k0s()()(),e.j41(189,"p"),e.EFF(190,"Si vous voulez r\xe9utiliser un fournisseur d'options existant au lieu de cr\xe9er une copie priv\xe9e dans le "),e.j41(191,"code"),e.EFF(192,"HttpModule"),e.k0s(),e.EFF(193,", utilisez la syntaxe "),e.j41(194,"code"),e.EFF(195,"useExisting"),e.k0s(),e.EFF(196,"."),e.k0s(),e.j41(197,"app-copy-button")(198,"pre")(199,"code",14),e.EFF(200,"\nHttpModule.registerAsync({\n  imports: [ConfigModule],\n  useExisting: HttpConfigService,\n});\n"),e.k0s()()(),e.j41(201,"p"),e.EFF(202,"Vous pouvez \xe9galement passer ce que l'on appelle des "),e.j41(203,"code"),e.EFF(204,"extraProviders"),e.k0s(),e.EFF(205," \xe0 la m\xe9thode "),e.j41(206,"code"),e.EFF(207,"registerAsync()"),e.k0s(),e.EFF(208,". Ces fournisseurs seront fusionn\xe9s avec les fournisseurs du module."),e.k0s(),e.j41(209,"app-copy-button")(210,"pre")(211,"code",14),e.EFF(212,"\nHttpModule.registerAsync({\n  imports: [ConfigModule],\n  useClass: ConfigService,\n  extraProviders: [MyAdditionalProvider],\n});\n"),e.k0s()()(),e.j41(213,"p"),e.EFF(214,"C'est utile lorsque vous souhaitez fournir des d\xe9pendances suppl\xe9mentaires \xe0 la fonction d'usine ou au constructeur de la classe."),e.k0s(),e.j41(215,"h4",21)(216,"span"),e.EFF(217,"Utilisation directe d'Axios"),e.k0s()(),e.j41(218,"p"),e.EFF(219,"Si vous pensez que les options de "),e.j41(220,"code"),e.EFF(221,"HttpModule.register"),e.k0s(),e.EFF(222," ne sont pas suffisantes pour vous, ou si vous voulez juste acc\xe9der \xe0 l'instance Axios sous-jacente cr\xe9\xe9e par "),e.j41(223,"code"),e.EFF(224,"@nestjs/axios"),e.k0s(),e.EFF(225,", vous pouvez y acc\xe9der via "),e.j41(226,"code"),e.EFF(227,"HttpService#axiosRef"),e.k0s(),e.EFF(228," comme suit :"),e.k0s(),e.j41(229,"app-copy-button")(230,"pre")(231,"code",14),e.EFF(232,"\n@Injectable()\nexport class CatsService {\n  constructor(private readonly httpService: HttpService) {}\n\n  findAll(): Promise<AxiosResponse<Cat[]>> {\n    return this.httpService.axiosRef.get('http://localhost:3000/cats');\n    //                      ^ AxiosInstance interface\n  }\n}\n"),e.k0s()()(),e.j41(233,"h4",22)(234,"span"),e.EFF(235,"Exemple complet"),e.k0s()(),e.j41(236,"p"),e.EFF(237,"Puisque la valeur de retour des m\xe9thodes "),e.j41(238,"code"),e.EFF(239,"HttpService"),e.k0s(),e.EFF(240," est un Observable, nous pouvons utiliser "),e.j41(241,"code"),e.EFF(242,"rxjs"),e.k0s(),e.EFF(243," - "),e.j41(244,"code"),e.EFF(245,"firstValueFrom"),e.k0s(),e.EFF(246," ou "),e.j41(247,"code"),e.EFF(248,"lastValueFrom"),e.k0s(),e.EFF(249," pour r\xe9cup\xe9rer les donn\xe9es de la requ\xeate sous la forme d'une promesse."),e.k0s(),e.j41(250,"app-copy-button")(251,"pre")(252,"code",14),e.EFF(253,"\nimport { catchError, firstValueFrom } from 'rxjs';\n\n@Injectable()\nexport class CatsService {\n  private readonly logger = new Logger(CatsService.name);\n  constructor(private readonly httpService: HttpService) {}\n\n  async findAll(): Promise<Cat[]> {\n    const { data } = await firstValueFrom(\n      this.httpService.get<Cat[]>('http://localhost:3000/cats').pipe(\n        catchError((error: AxiosError) => {\n          this.logger.error(error.response.data);\n          throw 'An error happened!';\n        }),\n      ),\n    );\n    return data;\n  }\n}\n"),e.k0s()()(),e.j41(254,"blockquote",8)(255,"strong"),e.EFF(256,"Astuce"),e.k0s(),e.EFF(257," Consultez la documentation de RxJS sur "),e.j41(258,"a",23)(259,"code"),e.EFF(260,"firstValueFrom"),e.k0s()(),e.EFF(261," et "),e.j41(262,"a",24)(263,"code"),e.EFF(264,"lastValueFrom"),e.k0s()(),e.EFF(265," pour conna\xeetre les diff\xe9rences entre les deux.\n"),e.k0s()()),2&o){const u=e.sdS(77);e.R7$(78),e.AVh("hide",u.isJsActive),e.R7$(3),e.AVh("hide",!u.isJsActive)}},dependencies:[E.O,i.a,c.z],encapsulation:2,changeDetection:0})}return s})();var A=F(5749);let N=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-logger"]],features:[e.Vt3],decls:485,vars:0,consts:[["contentReference",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/logger.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","logger"],["rel","nofollow","target","_blank","href","https://github.com/winstonjs/winston"],["appAnchor","","id","personnalisation-de-base"],[1,"language-typescript"],[1,"info"],["appAnchor","","id","impl\xe9mentation-personnalis\xe9e"],["href","techniques/logger#injection-de-d\xe9pendance"],["appAnchor","","id","\xe9tendre-le-logger-int\xe9gr\xe9"],["href","techniques/logger#utilisation-du-logger-pour-la-journalisation-des-applications"],["href","techniques/logger#impl\xe9mentation-personnalis\xe9e"],["appAnchor","","id","injection-de-d\xe9pendance"],["href","techniques/logger#injection-dun-logger-personnalis\xe9"],["appAnchor","","id","utilisation-du-logger-pour-la-journalisation-des-applications"],[1,"language-bash"],["appAnchor","","id","logs-avec-timestamps"],["appAnchor","","id","injection-dun-logger-personnalis\xe9"],["routerLink","/fundamentals/injection-scopes"],["appAnchor","","id","utilisation-dun-logger-externe"]],template:function(o,t){1&o&&(e.j41(0,"div",1,0)(2,"div",2)(3,"a",3),e.nrm(4,"i",4),e.k0s()(),e.j41(5,"h3",5),e.EFF(6,"Logger"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Nest est livr\xe9 avec un logger textuel int\xe9gr\xe9 qui est utilis\xe9 pendant le d\xe9marrage de l'application et dans d'autres circonstances telles que l'affichage des exceptions captur\xe9es (c'est-\xe0-dire la journalisation du syst\xe8me). Cette fonctionnalit\xe9 est fournie par la classe "),e.j41(9,"code"),e.EFF(10,"Logger"),e.k0s(),e.EFF(11," dans le package "),e.j41(12,"code"),e.EFF(13,"@nestjs/common"),e.k0s(),e.EFF(14,". Vous pouvez enti\xe8rement contr\xf4ler le comportement du syst\xe8me de journalisation, y compris ce qui suit :"),e.k0s(),e.j41(15,"ul")(16,"li"),e.EFF(17,"d\xe9sactiver compl\xe8tement la journalisation"),e.k0s(),e.j41(18,"li"),e.EFF(19,"sp\xe9cifier le niveau de d\xe9tail du journal (par exemple, afficher les erreurs, les avertissements, les informations de d\xe9bogage, etc.)"),e.k0s(),e.j41(20,"li"),e.EFF(21,"remplacer l'horodatage dans le logger par d\xe9faut (par exemple, utiliser la norme ISO8601 comme format de date)"),e.k0s(),e.j41(22,"li"),e.EFF(23,"remplacer compl\xe8tement le logger par d\xe9faut"),e.k0s(),e.j41(24,"li"),e.EFF(25,"personnaliser le logger par d\xe9faut en l'\xe9tendant"),e.k0s(),e.j41(26,"li"),e.EFF(27,"utiliser l'injection de d\xe9pendances pour simplifier la composition et le test de votre application"),e.k0s()(),e.j41(28,"p"),e.EFF(29,"Vous pouvez \xe9galement utiliser le logger int\xe9gr\xe9, ou cr\xe9er votre propre impl\xe9mentation personnalis\xe9e, pour enregistrer vos propres \xe9v\xe9nements et messages au niveau de l'application."),e.k0s(),e.j41(30,"p"),e.EFF(31,"Pour des fonctionnalit\xe9s de journalisation plus avanc\xe9es, vous pouvez utiliser n'importe quel package de journalisation Node.js, tel que "),e.j41(32,"a",6),e.EFF(33,"Winston"),e.k0s(),e.EFF(34,", pour mettre en \u0153uvre un syst\xe8me de journalisation enti\xe8rement personnalis\xe9 et de qualit\xe9 production."),e.k0s(),e.j41(35,"h4",7)(36,"span"),e.EFF(37,"Personnalisation de base"),e.k0s()(),e.j41(38,"p"),e.EFF(39,"Pour d\xe9sactiver la journalisation, mettez la propri\xe9t\xe9 "),e.j41(40,"code"),e.EFF(41,"logger"),e.k0s(),e.EFF(42," \xe0 "),e.j41(43,"code"),e.EFF(44,"false"),e.k0s(),e.EFF(45," dans l'objet (optionnel) options de l'application Nest pass\xe9 comme second argument \xe0 la m\xe9thode "),e.j41(46,"code"),e.EFF(47,"NestFactory.create()"),e.k0s(),e.EFF(48,"."),e.k0s(),e.j41(49,"app-copy-button")(50,"pre")(51,"code",8),e.EFF(52,"\nconst app = await NestFactory.create(AppModule, {\n  logger: false,\n});\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(53,"p"),e.EFF(54,"Pour activer des niveaux de journalisation sp\xe9cifiques, d\xe9finissez la propri\xe9t\xe9 "),e.j41(55,"code"),e.EFF(56,"logger"),e.k0s(),e.EFF(57," avec un tableau de caract\xe8res sp\xe9cifiant les niveaux de journalisation \xe0 afficher, comme suit :"),e.k0s(),e.j41(58,"app-copy-button")(59,"pre")(60,"code",8),e.EFF(61,"\nconst app = await NestFactory.create(AppModule, {\n  logger: ['error', 'warn'],\n});\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(62,"p"),e.EFF(63,"Les valeurs du tableau peuvent \xeatre n'importe quelle combinaison de "),e.j41(64,"code"),e.EFF(65,"'log'"),e.k0s(),e.EFF(66,", "),e.j41(67,"code"),e.EFF(68,"'fatal'"),e.k0s(),e.EFF(69,", "),e.j41(70,"code"),e.EFF(71,"'error'"),e.k0s(),e.EFF(72,", "),e.j41(73,"code"),e.EFF(74,"'warn'"),e.k0s(),e.EFF(75,", "),e.j41(76,"code"),e.EFF(77,"'debug'"),e.k0s(),e.EFF(78,", et "),e.j41(79,"code"),e.EFF(80,"'verbose'"),e.k0s(),e.EFF(81,"."),e.k0s(),e.j41(82,"blockquote",9)(83,"strong"),e.EFF(84,"Astuce"),e.k0s(),e.EFF(85," Pour d\xe9sactiver la couleur dans les messages de l'enregistreur par d\xe9faut, d\xe9finissez la variable d'environnement "),e.j41(86,"code"),e.EFF(87,"NO_COLOR"),e.k0s(),e.EFF(88," avec une cha\xeene de caract\xe8res non vide.\n"),e.k0s(),e.j41(89,"h4",10)(90,"span"),e.EFF(91,"Impl\xe9mentation personnalis\xe9e"),e.k0s()(),e.j41(92,"p"),e.EFF(93,"Vous pouvez fournir une impl\xe9mentation de logger personnalis\xe9e qui sera utilis\xe9e par Nest pour la journalisation du syst\xe8me en d\xe9finissant la valeur de la propri\xe9t\xe9 "),e.j41(94,"code"),e.EFF(95,"logger"),e.k0s(),e.EFF(96," \xe0 un objet qui satisfait l'interface "),e.j41(97,"code"),e.EFF(98,"LoggerService"),e.k0s(),e.EFF(99,". Par exemple, vous pouvez demander \xe0 Nest d'utiliser l'objet JavaScript global int\xe9gr\xe9 "),e.j41(100,"code"),e.EFF(101,"console"),e.k0s(),e.EFF(102," (qui impl\xe9mente l'interface "),e.j41(103,"code"),e.EFF(104,"LoggerService"),e.k0s(),e.EFF(105,"), comme suit :"),e.k0s(),e.j41(106,"app-copy-button")(107,"pre")(108,"code",8),e.EFF(109,"\nconst app = await NestFactory.create(AppModule, {\n  logger: console,\n});\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(110,"p"),e.EFF(111,"L'impl\xe9mentation de votre propre logger personnalis\xe9 est simple. Il suffit d'impl\xe9menter chacune des m\xe9thodes de l'interface "),e.j41(112,"code"),e.EFF(113,"LoggerService"),e.k0s(),e.EFF(114," comme indiqu\xe9 ci-dessous."),e.k0s(),e.j41(115,"app-copy-button")(116,"pre")(117,"code",8),e.EFF(118,'\nimport { LoggerService, Injectable } from \'@nestjs/common\';\n\n@Injectable()\nexport class MyLogger implements LoggerService {\n  /**\n   * \xc9crit un journal de niveau "log".\n   */\n  log(message: any, ...optionalParams: any[]) {}\n\n  /**\n   * \xc9crit un journal de niveau "fatal" (erreur fatale).\n   */\n  fatal(message: any, ...optionalParams: any[]) {}\n\n  /**\n   * \xc9crit un journal de niveau "error" (erreur).\n   */\n  error(message: any, ...optionalParams: any[]) {}\n\n  /**\n   * \xc9crit un journal de niveau "warn" (avertissement).\n   */\n  warn(message: any, ...optionalParams: any[]) {}\n\n  /**\n   * \xc9crit un journal de niveau "debug" (d\xe9bogage).\n   */\n  debug?(message: any, ...optionalParams: any[]) {}\n\n  /**\n   * \xc9crit un journal de niveau "verbose" (verbeux).\n   */\n  verbose?(message: any, ...optionalParams: any[]) {}\n}\n'),e.k0s()()(),e.j41(119,"p"),e.EFF(120,"Vous pouvez alors fournir une instance de "),e.j41(121,"code"),e.EFF(122,"MyLogger"),e.k0s(),e.EFF(123," via la propri\xe9t\xe9 "),e.j41(124,"code"),e.EFF(125,"logger"),e.k0s(),e.EFF(126," de l'objet d'options de l'application Nest."),e.k0s(),e.j41(127,"app-copy-button")(128,"pre")(129,"code",8),e.EFF(130,"\nconst app = await NestFactory.create(AppModule, {\n  logger: new MyLogger(),\n});\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(131,"p"),e.EFF(132,"Cette technique, bien que simple, n'utilise pas l'injection de d\xe9pendance pour la classe "),e.j41(133,"code"),e.EFF(134,"MyLogger"),e.k0s(),e.EFF(135,". Cela peut poser quelques probl\xe8mes, en particulier pour les tests, et limiter la r\xe9utilisation de "),e.j41(136,"code"),e.EFF(137,"MyLogger"),e.k0s(),e.EFF(138,". Pour une meilleure solution, voir la section "),e.j41(139,"a",11),e.EFF(140,"Injection de d\xe9pendances"),e.k0s(),e.EFF(141," ci-dessous."),e.k0s(),e.j41(142,"h4",12)(143,"span"),e.EFF(144,"\xc9tendre le logger int\xe9gr\xe9"),e.k0s()(),e.j41(145,"p"),e.EFF(146,"Plut\xf4t que d'\xe9crire un logger \xe0 partir de z\xe9ro, vous pouvez r\xe9pondre \xe0 vos besoins en \xe9tendant la classe int\xe9gr\xe9e "),e.j41(147,"code"),e.EFF(148,"ConsoleLogger"),e.k0s(),e.EFF(149," et en surchargeant certains comportements de l'impl\xe9mentation par d\xe9faut."),e.k0s(),e.j41(150,"app-copy-button")(151,"pre")(152,"code",8),e.EFF(153,"\nimport { ConsoleLogger } from '@nestjs/common';\n\nexport class MyLogger extends ConsoleLogger {\n  error(message: any, stack?: string, context?: string) {\n    // ajoutez ici votre logique personnalis\xe9e\n    super.error(...arguments);\n  }\n}\n"),e.k0s()()(),e.j41(154,"p"),e.EFF(155,"Vous pouvez utiliser un tel logger \xe9tendu dans vos modules de fonctionnalit\xe9s comme d\xe9crit dans la section "),e.j41(156,"a",13),e.EFF(157,"utilisation du logger pour la journalisation des applications"),e.k0s(),e.EFF(158," ci-dessous."),e.k0s(),e.j41(159,"p"),e.EFF(160,"Vous pouvez demander \xe0 Nest d'utiliser votre logger \xe9tendu pour la journalisation du syst\xe8me en lui passant une instance via la propri\xe9t\xe9 "),e.j41(161,"code"),e.EFF(162,"logger"),e.k0s(),e.EFF(163," de l'objet d'options de l'application (comme indiqu\xe9 dans la section "),e.j41(164,"a",14),e.EFF(165,"Impl\xe9mentation personnalis\xe9e"),e.k0s(),e.EFF(166," ci-dessus), ou en utilisant la technique indiqu\xe9e dans la section "),e.j41(167,"a",11),e.EFF(168,"Injection de d\xe9pendance"),e.k0s(),e.EFF(169," ci-dessous. Si vous le faites, vous devez prendre soin d'appeler "),e.j41(170,"code"),e.EFF(171,"super"),e.k0s(),e.EFF(172,", comme indiqu\xe9 dans l'exemple de code ci-dessus, pour d\xe9l\xe9guer l'appel de la m\xe9thode de log sp\xe9cifique \xe0 la classe m\xe8re (int\xe9gr\xe9e) afin que Nest puisse s'appuyer sur les fonctionnalit\xe9s int\xe9gr\xe9es qu'il attend."),e.k0s(),e.j41(173,"p"),e.nrm(174,"app-banner-courses"),e.k0s(),e.j41(175,"h4",15)(176,"span"),e.EFF(177,"Injection de d\xe9pendance"),e.k0s()(),e.j41(178,"p"),e.EFF(179,"Pour des fonctionnalit\xe9s de journalisation plus avanc\xe9es, vous voudrez tirer parti de l'injection de d\xe9pendances. Par exemple, vous pouvez injecter un "),e.j41(180,"code"),e.EFF(181,"ConfigService"),e.k0s(),e.EFF(182," dans votre logger pour le personnaliser, et \xe0 son tour injecter votre logger personnalis\xe9 dans d'autres contr\xf4leurs et/ou fournisseurs. Pour activer l'injection de d\xe9pendance pour votre logger personnalis\xe9, cr\xe9ez une classe qui impl\xe9mente "),e.j41(183,"code"),e.EFF(184,"LoggerService"),e.k0s(),e.EFF(185," et enregistrez cette classe comme fournisseur dans un module. Par exemple, vous pouvez"),e.k0s(),e.j41(186,"ol")(187,"li"),e.EFF(188,"D\xe9finir une classe "),e.j41(189,"code"),e.EFF(190,"MyLogger"),e.k0s(),e.EFF(191," qui \xe9tend la classe int\xe9gr\xe9e "),e.j41(192,"code"),e.EFF(193,"ConsoleLogger"),e.k0s(),e.EFF(194," ou la remplace compl\xe8tement, comme montr\xe9 dans les sections pr\xe9c\xe9dentes. Assurez-vous d'impl\xe9menter l'interface "),e.j41(195,"code"),e.EFF(196,"LoggerService"),e.k0s(),e.EFF(197,"."),e.k0s(),e.j41(198,"li"),e.EFF(199,"Cr\xe9er un "),e.j41(200,"code"),e.EFF(201,"LoggerModule"),e.k0s(),e.EFF(202," comme montr\xe9 ci-dessous, et fournir "),e.j41(203,"code"),e.EFF(204,"MyLogger"),e.k0s(),e.EFF(205," \xe0 partir de ce module."),e.k0s()(),e.j41(206,"app-copy-button")(207,"pre")(208,"code",8),e.EFF(209,"\nimport { Module } from '@nestjs/common';\nimport { MyLogger } from './my-logger.service';\n\n@Module({\n  providers: [MyLogger],\n  exports: [MyLogger],\n})\nexport class LoggerModule {}\n"),e.k0s()()(),e.j41(210,"p"),e.EFF(211,"Avec cette construction, vous fournissez maintenant votre logger personnalis\xe9 pour qu'il puisse \xeatre utilis\xe9 par n'importe quel autre module. Parce que votre classe "),e.j41(212,"code"),e.EFF(213,"MyLogger"),e.k0s(),e.EFF(214," fait partie d'un module, elle peut utiliser l'injection de d\xe9pendances (par exemple, pour injecter un "),e.j41(215,"code"),e.EFF(216,"ConfigService"),e.k0s(),e.EFF(217,"). Il y a encore une technique n\xe9cessaire pour fournir ce logger personnalis\xe9 afin qu'il soit utilis\xe9 par Nest pour la journalisation du syst\xe8me (par exemple, pour le bootstrapping et la gestion des erreurs)."),e.k0s(),e.j41(218,"p"),e.EFF(219,"Parce que l'instanciation de l'application ("),e.j41(220,"code"),e.EFF(221,"NestFactory.create()"),e.k0s(),e.EFF(222,") se produit en dehors du contexte d'un module, elle ne participe pas \xe0 la phase normale d'injection de d\xe9pendance de l'initialisation. Nous devons donc nous assurer qu'au moins un module d'application importe le "),e.j41(223,"code"),e.EFF(224,"LoggerModule"),e.k0s(),e.EFF(225," pour d\xe9clencher l'instanciation par Nest d'une instance singleton de notre classe "),e.j41(226,"code"),e.EFF(227,"MyLogger"),e.k0s(),e.EFF(228,"."),e.k0s(),e.j41(229,"p"),e.EFF(230,"Nous pouvons alors demander \xe0 Nest d'utiliser la m\xeame instance singleton de "),e.j41(231,"code"),e.EFF(232,"MyLogger"),e.k0s(),e.EFF(233," avec la construction suivante :"),e.k0s(),e.j41(234,"app-copy-button")(235,"pre")(236,"code",8),e.EFF(237,"\nconst app = await NestFactory.create(AppModule, {\n  bufferLogs: true,\n});\napp.useLogger(app.get(MyLogger));\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(238,"blockquote",9)(239,"strong"),e.EFF(240,"Remarque"),e.k0s(),e.EFF(241," Dans l'exemple ci-dessus, nous avons mis "),e.j41(242,"code"),e.EFF(243,"bufferLogs"),e.k0s(),e.EFF(244," \xe0 "),e.j41(245,"code"),e.EFF(246,"true"),e.k0s(),e.EFF(247," pour nous assurer que tous les logs seront mis en m\xe9moire tampon jusqu'\xe0 ce qu'un logger personnalis\xe9 soit attach\xe9 ("),e.j41(248,"code"),e.EFF(249,"MyLogger"),e.k0s(),e.EFF(250," dans ce cas) et que le processus d'initialisation de l'application soit termin\xe9 ou \xe9choue. Si le processus d'initialisation \xe9choue, Nest se rabattra sur le "),e.j41(251,"code"),e.EFF(252,"ConsoleLogger"),e.k0s(),e.EFF(253," original pour imprimer tous les messages d'erreur rapport\xe9s. Vous pouvez \xe9galement d\xe9finir "),e.j41(254,"code"),e.EFF(255,"autoFlushLogs"),e.k0s(),e.EFF(256," \xe0 "),e.j41(257,"code"),e.EFF(258,"false"),e.k0s(),e.EFF(259," (par d\xe9faut "),e.j41(260,"code"),e.EFF(261,"true"),e.k0s(),e.EFF(262,") pour vider manuellement les logs (en utilisant la m\xe9thode "),e.j41(263,"code"),e.EFF(264,"Logger.flush()"),e.k0s(),e.EFF(265,").\n"),e.k0s(),e.j41(266,"p"),e.EFF(267,"Ici, nous utilisons la m\xe9thode "),e.j41(268,"code"),e.EFF(269,"get()"),e.k0s(),e.EFF(270," sur l'instance "),e.j41(271,"code"),e.EFF(272,"NestApplication"),e.k0s(),e.EFF(273," pour r\xe9cup\xe9rer l'instance singleton de l'objet "),e.j41(274,"code"),e.EFF(275,"MyLogger"),e.k0s(),e.EFF(276,". Cette technique est essentiellement un moyen d'\"injecter\" une instance d'un logger pour qu'il soit utilis\xe9 par Nest. L'appel \xe0 "),e.j41(277,"code"),e.EFF(278,"app.get()"),e.k0s(),e.EFF(279," r\xe9cup\xe8re l'instance singleton de "),e.j41(280,"code"),e.EFF(281,"MyLogger"),e.k0s(),e.EFF(282,", et d\xe9pend de l'injection pr\xe9alable de cette instance dans un autre module, comme d\xe9crit ci-dessus."),e.k0s(),e.j41(283,"p"),e.EFF(284,"Vous pouvez \xe9galement injecter ce fournisseur "),e.j41(285,"code"),e.EFF(286,"MyLogger"),e.k0s(),e.EFF(287," dans vos classes de fonctionnalit\xe9s, assurant ainsi un comportement de journalisation coh\xe9rent \xe0 travers la journalisation du syst\xe8me Nest et la journalisation de l'application. Voir "),e.j41(288,"a",13),e.EFF(289,"Utilisation du logger pour la journalisation des applications"),e.k0s(),e.EFF(290," et "),e.j41(291,"a",16),e.EFF(292,"Injection d'un logger personnalis\xe9"),e.k0s(),e.EFF(293," ci-dessous pour plus d'informations."),e.k0s(),e.j41(294,"h4",17)(295,"span"),e.EFF(296,"Utilisation du logger pour la journalisation des applications"),e.k0s()(),e.j41(297,"p"),e.EFF(298,"Nous pouvons combiner plusieurs des techniques ci-dessus pour fournir un comportement et un formatage coh\xe9rents \xe0 la fois pour la journalisation du syst\xe8me Nest et pour la journalisation des \xe9v\xe9nements/messages de nos propres applications."),e.k0s(),e.j41(299,"p"),e.EFF(300,"Une bonne pratique est d'instancier la classe "),e.j41(301,"code"),e.EFF(302,"Logger"),e.k0s(),e.EFF(303," de "),e.j41(304,"code"),e.EFF(305,"@nestjs/common"),e.k0s(),e.EFF(306," dans chacun de nos services. Nous pouvons fournir le nom de notre service comme argument "),e.j41(307,"code"),e.EFF(308,"context"),e.k0s(),e.EFF(309," dans le constructeur de "),e.j41(310,"code"),e.EFF(311,"Logger"),e.k0s(),e.EFF(312,", comme ceci :"),e.k0s(),e.j41(313,"app-copy-button")(314,"pre")(315,"code",8),e.EFF(316,"\nimport { Logger, Injectable } from '@nestjs/common';\n\n@Injectable()\nclass MyService {\n  private readonly logger = new Logger(MyService.name);\n\n  doSomething() {\n    this.logger.log('Doing something...');\n  }\n}\n"),e.k0s()()(),e.j41(317,"p"),e.EFF(318,"Dans l'impl\xe9mentation par d\xe9faut du logger, "),e.j41(319,"code"),e.EFF(320,"context"),e.k0s(),e.EFF(321," est imprim\xe9 entre crochets, comme "),e.j41(322,"code"),e.EFF(323,"NestFactory"),e.k0s(),e.EFF(324," dans l'exemple ci-dessous :"),e.k0s(),e.j41(325,"pre")(326,"code",18),e.EFF(327,"\n[Nest] 19096   - 12/08/2019, 7:12:59 AM   [NestFactory] Starting Nest application...\n"),e.k0s()(),e.j41(328,"p"),e.EFF(329,"Si nous fournissons un logger personnalis\xe9 via "),e.j41(330,"code"),e.EFF(331,"app.useLogger()"),e.k0s(),e.EFF(332,", il sera en fait utilis\xe9 par Nest en interne. Cela signifie que notre code reste agnostique en mati\xe8re d'impl\xe9mentation, alors que nous pouvons facilement remplacer le logger par d\xe9faut par notre logger personnalis\xe9 en appelant "),e.j41(333,"code"),e.EFF(334,"app.useLogger()"),e.k0s(),e.EFF(335,"."),e.k0s(),e.j41(336,"p"),e.EFF(337,"Ainsi, si nous suivons les \xe9tapes de la section pr\xe9c\xe9dente et appelons "),e.j41(338,"code"),e.EFF(339,"app.useLogger(app.get(MyLogger))"),e.k0s(),e.EFF(340,", les appels suivants \xe0 "),e.j41(341,"code"),e.EFF(342,"this.logger.log()"),e.k0s(),e.EFF(343," depuis "),e.j41(344,"code"),e.EFF(345,"MyService"),e.k0s(),e.EFF(346," r\xe9sulteront en des appels \xe0 la m\xe9thode "),e.j41(347,"code"),e.EFF(348,"log"),e.k0s(),e.EFF(349," depuis l'instance "),e.j41(350,"code"),e.EFF(351,"MyLogger"),e.k0s(),e.EFF(352,"."),e.k0s(),e.j41(353,"p"),e.EFF(354,"Cela devrait convenir dans la plupart des cas. Mais si vous avez besoin de plus de personnalisation (comme l'ajout et l'appel de m\xe9thodes personnalis\xe9es), passez \xe0 la section suivante."),e.k0s(),e.j41(355,"h4",19)(356,"span"),e.EFF(357,"Logs avec timestamps"),e.k0s()(),e.j41(358,"p"),e.EFF(359,"Pour activer l'enregistrement de l'horodatage pour chaque message enregistr\xe9, vous pouvez utiliser le param\xe8tre optionnel "),e.j41(360,"code"),e.EFF(361,"timestamp : true"),e.k0s(),e.EFF(362," lors de la cr\xe9ation de l'instance du logger."),e.k0s(),e.j41(363,"app-copy-button")(364,"pre")(365,"code",8),e.EFF(366,"\nimport { Logger, Injectable } from '@nestjs/common';\n\n@Injectable()\nclass MyService {\n  private readonly logger = new Logger(MyService.name, { timestamp: true });\n\n  doSomething() {\n    this.logger.log('Doing something with timestamp here ->');\n  }\n}\n"),e.k0s()()(),e.j41(367,"p"),e.EFF(368,"Cela produira un r\xe9sultat dans le format suivant :"),e.k0s(),e.j41(369,"pre")(370,"code",18),e.EFF(371,"\n[Nest] 19096   - 04/19/2024, 7:12:59 AM   [MyService] Doing something with timestamp here +5ms\n"),e.k0s()(),e.j41(372,"p"),e.EFF(373,"Notez le "),e.j41(374,"code"),e.EFF(375,"+5ms"),e.k0s(),e.EFF(376," \xe0 la fin de la ligne. Pour chaque d\xe9claration, la diff\xe9rence de temps par rapport au message pr\xe9c\xe9dent est calcul\xe9e et affich\xe9e \xe0 la fin de la ligne."),e.k0s(),e.j41(377,"h4",20)(378,"span"),e.EFF(379,"Injection d'un logger personnalis\xe9"),e.k0s()(),e.j41(380,"p"),e.EFF(381,"Pour commencer, \xe9tendez le logger int\xe9gr\xe9 avec le code suivant. Nous fournissons l'option "),e.j41(382,"code"),e.EFF(383,"scope"),e.k0s(),e.EFF(384," comme m\xe9tadonn\xe9e de configuration pour la classe "),e.j41(385,"code"),e.EFF(386,"ConsoleLogger"),e.k0s(),e.EFF(387,", en sp\xe9cifiant un scope "),e.j41(388,"a",21),e.EFF(389,"transient"),e.k0s(),e.EFF(390,", pour s'assurer que nous aurons une instance unique de "),e.j41(391,"code"),e.EFF(392,"MyLogger"),e.k0s(),e.EFF(393," dans chaque module de fonctionnalit\xe9. Dans cet exemple, nous n'\xe9tendons pas les m\xe9thodes individuelles de "),e.j41(394,"code"),e.EFF(395,"ConsoleLogger"),e.k0s(),e.EFF(396," (comme "),e.j41(397,"code"),e.EFF(398,"log()"),e.k0s(),e.EFF(399,", "),e.j41(400,"code"),e.EFF(401,"warn()"),e.k0s(),e.EFF(402,", etc.), bien que vous puissiez choisir de le faire."),e.k0s(),e.j41(403,"app-copy-button")(404,"pre")(405,"code",8),e.EFF(406,"\nimport { Injectable, Scope, ConsoleLogger } from '@nestjs/common';\n\n@Injectable({ scope: Scope.TRANSIENT })\nexport class MyLogger extends ConsoleLogger {\n  customLog() {\n    this.log('Please feed the cat!');\n  }\n}\n"),e.k0s()()(),e.j41(407,"p"),e.EFF(408,"Ensuite, cr\xe9ez un "),e.j41(409,"code"),e.EFF(410,"LoggerModule"),e.k0s(),e.EFF(411," avec une construction comme celle-ci :"),e.k0s(),e.j41(412,"app-copy-button")(413,"pre")(414,"code",8),e.EFF(415,"\nimport { Module } from '@nestjs/common';\nimport { MyLogger } from './my-logger.service';\n\n@Module({\n  providers: [MyLogger],\n  exports: [MyLogger],\n})\nexport class LoggerModule {}\n"),e.k0s()()(),e.j41(416,"p"),e.EFF(417,"Ensuite, importez le "),e.j41(418,"code"),e.EFF(419,"LoggerModule"),e.k0s(),e.EFF(420," dans votre module de fonctionnalit\xe9. Puisque nous avons \xe9tendu le "),e.j41(421,"code"),e.EFF(422,"Logger"),e.k0s(),e.EFF(423," par d\xe9faut, nous avons la possibilit\xe9 d'utiliser la m\xe9thode "),e.j41(424,"code"),e.EFF(425,"setContext"),e.k0s(),e.EFF(426,". Nous pouvons donc commencer \xe0 utiliser le logger personnalis\xe9 en fonction du contexte, comme ceci :"),e.k0s(),e.j41(427,"app-copy-button")(428,"pre")(429,"code",8),e.EFF(430,"\nimport { Injectable } from '@nestjs/common';\nimport { MyLogger } from './my-logger.service';\n\n@Injectable()\nexport class CatsService {\n  private readonly cats: Cat[] = [];\n\n  constructor(private myLogger: MyLogger) {\n    // En raison de la port\xe9e transitoire, CatsService poss\xe8de sa propre instance de MyLogger,\n    // ainsi, la d\xe9finition du contexte ici n'affectera pas d'autres instances dans d'autres services.\n    this.myLogger.setContext('CatsService');\n  }\n\n  findAll(): Cat[] {\n    // Vous pouvez appeler toutes les m\xe9thodes par d\xe9faut\n    this.myLogger.warn('About to return cats!');\n    // Et vos m\xe9thodes personnalis\xe9es\n    this.myLogger.customLog();\n    return this.cats;\n  }\n}\n"),e.k0s()()(),e.j41(431,"p"),e.EFF(432,"Enfin, demandez \xe0 Nest d'utiliser une instance du logger personnalis\xe9 dans votre fichier "),e.j41(433,"code"),e.EFF(434,"main.ts"),e.k0s(),e.EFF(435," comme montr\xe9 ci-dessous. Bien s\xfbr, dans cet exemple, nous n'avons pas vraiment personnalis\xe9 le comportement du logger (en \xe9tendant les m\xe9thodes "),e.j41(436,"code"),e.EFF(437,"Logger"),e.k0s(),e.EFF(438," comme "),e.j41(439,"code"),e.EFF(440,"log()"),e.k0s(),e.EFF(441,", "),e.j41(442,"code"),e.EFF(443,"warn()"),e.k0s(),e.EFF(444,", etc), donc cette \xe9tape n'est pas vraiment n\xe9cessaire. Mais elle "),e.j41(445,"strong"),e.EFF(446,"serait"),e.k0s(),e.EFF(447," n\xe9cessaire si vous ajoutiez une logique personnalis\xe9e \xe0 ces m\xe9thodes et que vous vouliez que Nest utilise la m\xeame impl\xe9mentation."),e.k0s(),e.j41(448,"app-copy-button")(449,"pre")(450,"code",8),e.EFF(451,"\nconst app = await NestFactory.create(AppModule, {\n  bufferLogs: true,\n});\napp.useLogger(new MyLogger());\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(452,"blockquote",9)(453,"strong"),e.EFF(454,"Astuce"),e.k0s(),e.EFF(455," Alternativement, au lieu de mettre "),e.j41(456,"code"),e.EFF(457,"bufferLogs"),e.k0s(),e.EFF(458," \xe0 "),e.j41(459,"code"),e.EFF(460,"true"),e.k0s(),e.EFF(461,", vous pouvez d\xe9sactiver temporairement le logger avec l'instruction "),e.j41(462,"code"),e.EFF(463,"logger : false"),e.k0s(),e.EFF(464,". Soyez conscient que si vous fournissez "),e.j41(465,"code"),e.EFF(466,"logger : false"),e.k0s(),e.EFF(467," \xe0 "),e.j41(468,"code"),e.EFF(469,"NestFactory.create"),e.k0s(),e.EFF(470,", rien ne sera enregistr\xe9 jusqu'\xe0 ce que vous appeliez "),e.j41(471,"code"),e.EFF(472,"useLogger"),e.k0s(),e.EFF(473,", donc vous pourriez manquer d'importantes erreurs d'initialisation. Si cela ne vous d\xe9range pas que certains de vos messages initiaux soient enregistr\xe9s avec le logger par d\xe9faut, vous pouvez simplement omettre l'option "),e.j41(474,"code"),e.EFF(475,"logger : false"),e.k0s(),e.EFF(476,".\n"),e.k0s(),e.j41(477,"h4",22)(478,"span"),e.EFF(479,"Utilisation d'un logger externe"),e.k0s()(),e.j41(480,"p"),e.EFF(481,"Les applications de production ont souvent des exigences sp\xe9cifiques en mati\xe8re de journalisation, y compris le filtrage avanc\xe9, le formatage et la journalisation centralis\xe9e. Le logger int\xe9gr\xe9 de Nest est utilis\xe9 pour surveiller le comportement du syst\xe8me Nest et peut \xe9galement \xeatre utile pour la journalisation de texte format\xe9 de base dans vos modules de fonctionnalit\xe9 pendant le d\xe9veloppement, mais les applications de production tirent souvent parti de modules de journalisation d\xe9di\xe9s tels que "),e.j41(482,"a",6),e.EFF(483,"Winston"),e.k0s(),e.EFF(484,". Comme pour toute application Node.js standard, vous pouvez tirer pleinement parti de ces modules dans Nest."),e.k0s()())},dependencies:[i.a,A.Q,c.z,j.Wk],encapsulation:2,changeDetection:0})}return s})(),D=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-mongo"]],features:[e.Vt3],decls:824,vars:64,consts:[["contentReference",""],["app491a469e0193e4155d087aac46c4f1104e250516",""],["app3f7dce39b8cfc7e375f912384f03f4ec5ca49737",""],["appa7da7ab42c67437b56b7cc1bfc2c62ae8872e137",""],["appdd077b870ce86051340397209653281b3b6a0489",""],["app6b8d65109f20d3815bafa20b3146a6105085012b",""],["appe3423c7a48f7085c35f6b70036a7333eb84f004d",""],["app18404a0a2c1165d8aff2b147743609ad4bb1068a",""],["app9aa182185ee7d435f90c1ed740cead26c574ffd9",""],["app5ea3a1f6cc3914f9e37fd5cfe27b2c249040d109",""],["app6061f77dfb675239fe22ba2b01155102e3b13c69",""],["app1b2f9302903b9184bb8e195f538359e88fc2d35f",""],["appf47f7f6bc65c9d456db49fc75c10594dbd97b4bf",""],["app221cf2fe4164b57c178b8e155a8cd679e178879f",""],["app85065be932f24a3e6af75793b67c2ab3b650f590",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/mongo.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","mongo"],["rel","nofollow","target","_blank","href","https://www.mongodb.com/"],["rel","nofollow","target","_blank","href","https://github.com/typeorm/typeorm"],["routerLink","/techniques/database"],["rel","nofollow","target","_blank","href","https://mongoosejs.com"],["rel","nofollow","target","_blank","href","https://github.com/Automattic/mongoose"],[1,"language-bash"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/connections.html"],["appAnchor","","id","injection-de-mod\xe8le"],["rel","nofollow","target","_blank","href","http://mongoosejs.com/docs/guide.html"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/models.html"],[1,"info"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/guide.html#options"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/schematypes.html"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/schematypes.html#schematype-options"],["appAnchor","","id","connexion"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/api.html#Connection"],["appAnchor","","id","sessions"],["appAnchor","","id","bases-de-donn\xe9es-multiples"],[1,"warning"],["appAnchor","","id","hooks-middleware"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/middleware.html"],["href","/fundamentals/custom-providers#fournisseurs-de-factory--usefactory"],["appAnchor","","id","plugins"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/plugins.html"],["appAnchor","","id","discriminants"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/discriminators.html"],["appAnchor","","id","tests"],["href","/fundamentals/custom-providers#principes-de-base-de-lid"],["appAnchor","","id","configuration-asynchrone"],["appAnchor","","id","\xe9v\xe9nements-de-connexion"],["rel","nofollow","target","_blank","href","https://mongoosejs.com/docs/connections.html#connection-events"],["appAnchor","","id","sous-documents"],["appAnchor","","id","propri\xe9t\xe9s-virtuelles"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/06-mongoose"]],template:function(o,t){if(1&o&&(e.j41(0,"div",15,0)(2,"div",16)(3,"a",17),e.nrm(4,"i",18),e.k0s()(),e.j41(5,"h3",19),e.EFF(6,"Mongo"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Nest prend en charge deux m\xe9thodes d'int\xe9gration avec la base de donn\xe9es "),e.j41(9,"a",20),e.EFF(10,"MongoDB"),e.k0s(),e.EFF(11,". Vous pouvez soit utiliser le module int\xe9gr\xe9 "),e.j41(12,"a",21),e.EFF(13,"TypeORM"),e.k0s(),e.EFF(14," d\xe9crit "),e.j41(15,"a",22),e.EFF(16,"ici"),e.k0s(),e.EFF(17,", qui poss\xe8de un connecteur pour MongoDB, soit utiliser "),e.j41(18,"a",23),e.EFF(19,"Mongoose"),e.k0s(),e.EFF(20,", l'outil de mod\xe9lisation d'objets MongoDB le plus populaire. Dans ce chapitre, nous allons d\xe9crire ce dernier, en utilisant le package d\xe9di\xe9 "),e.j41(21,"code"),e.EFF(22,"@nestjs/mongoose"),e.k0s(),e.EFF(23,"."),e.k0s(),e.j41(24,"p"),e.EFF(25,"Commencez par installer les "),e.j41(26,"a",24),e.EFF(27,"d\xe9pendances requises"),e.k0s(),e.EFF(28," :"),e.k0s(),e.j41(29,"pre")(30,"code",25),e.EFF(31,"\n$ npm i @nestjs/mongoose mongoose\n"),e.k0s()(),e.j41(32,"p"),e.EFF(33,"Une fois le processus d'installation termin\xe9, nous pouvons importer le module "),e.j41(34,"code"),e.EFF(35,"MongooseModule"),e.k0s(),e.EFF(36," dans le module racine "),e.j41(37,"code"),e.EFF(38,"AppModule"),e.k0s(),e.EFF(39,"."),e.k0s(),e.j41(40,"app-copy-button",26)(41,"span",27),e.EFF(42),e.nI1(43,"extension"),e.nrm(44,"app-tabs",null,1),e.k0s(),e.j41(46,"pre")(47,"code",28),e.EFF(48,"\nimport { Module } from '@nestjs/common';\nimport { MongooseModule } from '@nestjs/mongoose';\n\n@Module({\n  imports: [MongooseModule.forRoot('mongodb://localhost/nest')],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(49,"p"),e.EFF(50,"La m\xe9thode "),e.j41(51,"code"),e.EFF(52,"forRoot()"),e.k0s(),e.EFF(53," accepte le m\xeame objet de configuration que "),e.j41(54,"code"),e.EFF(55,"mongoose.connect()"),e.k0s(),e.EFF(56," du package Mongoose, comme d\xe9crit "),e.j41(57,"a",29),e.EFF(58,"ici"),e.k0s(),e.EFF(59,"."),e.k0s(),e.j41(60,"h4",30)(61,"span"),e.EFF(62,"Injection de mod\xe8le"),e.k0s()(),e.j41(63,"p"),e.EFF(64,"Avec Mongoose, tout est d\xe9riv\xe9 d'un "),e.j41(65,"a",31),e.EFF(66,"Schema"),e.k0s(),e.EFF(67,". Chaque sch\xe9ma correspond \xe0 une collection MongoDB et d\xe9finit la forme des documents au sein de cette collection. Les sch\xe9mas sont utilis\xe9s pour d\xe9finir les "),e.j41(68,"a",32),e.EFF(69,"Mod\xe8les"),e.k0s(),e.EFF(70,". Les mod\xe8les sont responsables de la cr\xe9ation et de la lecture des documents \xe0 partir de la base de donn\xe9es MongoDB sous-jacente."),e.k0s(),e.j41(71,"p"),e.EFF(72,"Les sch\xe9mas peuvent \xeatre cr\xe9\xe9s \xe0 l'aide de d\xe9corateurs NestJS ou manuellement avec Mongoose. L'utilisation de d\xe9corateurs pour cr\xe9er des sch\xe9mas permet de r\xe9duire consid\xe9rablement le nombre de lignes de code et d'am\xe9liorer la lisibilit\xe9 globale du code."),e.k0s(),e.j41(73,"p"),e.EFF(74,"D\xe9finissons le "),e.j41(75,"code"),e.EFF(76,"CatSchema"),e.k0s(),e.EFF(77," :"),e.k0s(),e.j41(78,"app-copy-button",26)(79,"span",27),e.EFF(80),e.nI1(81,"extension"),e.nrm(82,"app-tabs",null,2),e.k0s(),e.j41(84,"pre")(85,"code",28),e.EFF(86,"\nimport { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\nimport { HydratedDocument } from 'mongoose';\n\nexport type CatDocument = HydratedDocument<Cat>;\n\n@Schema()\nexport class Cat {\n  @Prop()\n  name: string;\n\n  @Prop()\n  age: number;\n\n  @Prop()\n  breed: string;\n}\n\nexport const CatSchema = SchemaFactory.createForClass(Cat);\n"),e.k0s()()(),e.j41(87,"blockquote",33)(88,"strong"),e.EFF(89,"Astuce"),e.k0s(),e.EFF(90," Notez que vous pouvez aussi g\xe9n\xe9rer une d\xe9finition de sch\xe9ma brute en utilisant la classe "),e.j41(91,"code"),e.EFF(92,"DefinitionsFactory"),e.k0s(),e.EFF(93," (de "),e.j41(94,"code"),e.EFF(95,"nestjs/mongoose"),e.k0s(),e.EFF(96,"). Cela vous permet de modifier manuellement la d\xe9finition de sch\xe9ma g\xe9n\xe9r\xe9e en fonction des m\xe9tadonn\xe9es que vous avez fournies. C'est utile pour certains cas o\xf9 il peut \xeatre difficile de tout repr\xe9senter avec des d\xe9corateurs.\n"),e.k0s(),e.j41(97,"p"),e.EFF(98,"Le d\xe9corateur "),e.j41(99,"code"),e.EFF(100,"@Schema()"),e.k0s(),e.EFF(101," marque une classe comme une d\xe9finition de sch\xe9ma. Il fait correspondre notre classe "),e.j41(102,"code"),e.EFF(103,"Cat"),e.k0s(),e.EFF(104,' \xe0 une collection MongoDB du m\xeame nom, mais avec un "s" suppl\xe9mentaire \xe0 la fin - donc le nom final de la collection MongoDB sera '),e.j41(105,"code"),e.EFF(106,"cats"),e.k0s(),e.EFF(107,". Ce d\xe9corateur accepte un seul argument optionnel qui est un objet d'options de sch\xe9ma. Pensez-y comme l'objet que vous passeriez normalement comme second argument du constructeur de la classe "),e.j41(108,"code"),e.EFF(109,"mongoose.Schema"),e.k0s(),e.EFF(110," (e.g., "),e.j41(111,"code"),e.EFF(112,"new mongoose.Schema(_, options)"),e.k0s(),e.EFF(113,")). Pour en savoir plus sur les options de sch\xe9ma disponibles, voir "),e.j41(114,"a",34),e.EFF(115,"ce chapitre"),e.k0s(),e.EFF(116,"."),e.k0s(),e.j41(117,"p"),e.EFF(118,"Le d\xe9corateur "),e.j41(119,"code"),e.EFF(120,"@Prop()"),e.k0s(),e.EFF(121," d\xe9finit une propri\xe9t\xe9 dans le document. Par exemple, dans la d\xe9finition du sch\xe9ma ci-dessus, nous avons d\xe9fini trois propri\xe9t\xe9s : "),e.j41(122,"code"),e.EFF(123,"name"),e.k0s(),e.EFF(124,", "),e.j41(125,"code"),e.EFF(126,"age"),e.k0s(),e.EFF(127,", et "),e.j41(128,"code"),e.EFF(129,"breed"),e.k0s(),e.EFF(130,". Les "),e.j41(131,"a",35),e.EFF(132,"types de sch\xe9ma"),e.k0s(),e.EFF(133," de ces propri\xe9t\xe9s sont automatiquement d\xe9duits gr\xe2ce aux capacit\xe9s de m\xe9tadonn\xe9es (et de r\xe9flexivit\xe9) de TypeScript. Cependant, dans des sc\xe9narios plus complexes dans lesquels les types ne peuvent pas \xeatre implicitement d\xe9duits (par exemple, les tableaux ou les structures d'objets imbriqu\xe9s), les types doivent \xeatre indiqu\xe9s explicitement, comme suit :"),e.k0s(),e.j41(134,"app-copy-button")(135,"pre")(136,"code",28),e.EFF(137,"\n@Prop([String])\ntags: string[];\n"),e.k0s()()(),e.j41(138,"p"),e.EFF(139,"Alternativement, le d\xe9corateur "),e.j41(140,"code"),e.EFF(141,"@Prop()"),e.k0s(),e.EFF(142," accepte un argument objet options ("),e.j41(143,"a",36),e.EFF(144,"en savoir plus"),e.k0s(),e.EFF(145," sur les options disponibles). Vous pouvez ainsi indiquer si une propri\xe9t\xe9 est obligatoire ou non, sp\xe9cifier une valeur par d\xe9faut ou la marquer comme immuable. Par exemple, le d\xe9corateur"),e.k0s(),e.j41(146,"app-copy-button")(147,"pre")(148,"code",28),e.EFF(149,"\n@Prop({ required: true })\nname: string;\n"),e.k0s()()(),e.j41(150,"p"),e.EFF(151,"Si vous souhaitez sp\xe9cifier une relation avec un autre mod\xe8le, vous pouvez \xe9galement utiliser le d\xe9corateur "),e.j41(152,"code"),e.EFF(153,"@Prop()"),e.k0s(),e.EFF(154,". Par exemple, si "),e.j41(155,"code"),e.EFF(156,"Cat"),e.k0s(),e.EFF(157," a "),e.j41(158,"code"),e.EFF(159,"Owner"),e.k0s(),e.EFF(160," qui est stock\xe9 dans une collection diff\xe9rente appel\xe9e "),e.j41(161,"code"),e.EFF(162,"owners"),e.k0s(),e.EFF(163,", la propri\xe9t\xe9 doit avoir un type et une ref. Par exemple, le d\xe9corateur"),e.k0s(),e.j41(164,"app-copy-button")(165,"pre")(166,"code",28),e.EFF(167,"\nimport * as mongoose from 'mongoose';\nimport { Owner } from '../owners/schemas/owner.schema';\n\n// dans la d\xe9finition de la classe\n@Prop({ type: mongoose.Schema.Types.ObjectId, ref: 'Owner' })\nowner: Owner;\n"),e.k0s()()(),e.j41(168,"p"),e.EFF(169,"S'il y a plusieurs owners, la configuration de votre propri\xe9t\xe9 doit \xeatre la suivante :"),e.k0s(),e.j41(170,"app-copy-button")(171,"pre")(172,"code",28),e.EFF(173,"\n@Prop({ type: [{ type: mongoose.Schema.Types.ObjectId, ref: 'Owner' }] })\nowners: Owner[];\n"),e.k0s()()(),e.j41(174,"p"),e.EFF(175,"Enfin, la d\xe9finition "),e.j41(176,"strong"),e.EFF(177,"brute"),e.k0s(),e.EFF(178," du sch\xe9ma peut \xe9galement \xeatre transmise au d\xe9corateur. Ceci est utile lorsque, par exemple, une propri\xe9t\xe9 repr\xe9sente un objet imbriqu\xe9 qui n'est pas d\xe9fini comme une classe. Pour cela, utilisez la fonction "),e.j41(179,"code"),e.EFF(180,"raw()"),e.k0s(),e.EFF(181," du package "),e.j41(182,"code"),e.EFF(183,"@nestjs/mongoose"),e.k0s(),e.EFF(184,", comme suit :"),e.k0s(),e.j41(185,"app-copy-button")(186,"pre")(187,"code",28),e.EFF(188,"\n@Prop(raw({\n  firstName: { type: String },\n  lastName: { type: String }\n}))\ndetails: Record<string, any>;\n"),e.k0s()()(),e.j41(189,"p"),e.EFF(190,"Si vous pr\xe9f\xe9rez "),e.j41(191,"strong"),e.EFF(192,"ne pas utiliser de d\xe9corateurs"),e.k0s(),e.EFF(193,", vous pouvez d\xe9finir un sch\xe9ma manuellement. Par exemple, vous pouvez d\xe9finir un sch\xe9ma manuellement :"),e.k0s(),e.j41(194,"app-copy-button")(195,"pre")(196,"code",28),e.EFF(197,"\nexport const CatSchema = new mongoose.Schema({\n  name: String,\n  age: Number,\n  breed: String,\n});\n"),e.k0s()()(),e.j41(198,"p"),e.EFF(199,"Le fichier "),e.j41(200,"code"),e.EFF(201,"cat.schema"),e.k0s(),e.EFF(202," r\xe9side dans un dossier du r\xe9pertoire "),e.j41(203,"code"),e.EFF(204,"cats"),e.k0s(),e.EFF(205,", o\xf9 nous d\xe9finissons \xe9galement le "),e.j41(206,"code"),e.EFF(207,"CatsModule"),e.k0s(),e.EFF(208,". Bien que vous puissiez stocker les fichiers de sch\xe9ma o\xf9 vous le souhaitez, nous recommandons de les stocker pr\xe8s des objets "),e.j41(209,"strong"),e.EFF(210,"domaine"),e.k0s(),e.EFF(211," qui leur sont associ\xe9s, dans le r\xe9pertoire du module appropri\xe9."),e.k0s(),e.j41(212,"p"),e.EFF(213,"Examinons le module "),e.j41(214,"code"),e.EFF(215,"CatsModule"),e.k0s(),e.EFF(216," :"),e.k0s(),e.j41(217,"app-copy-button",26)(218,"span",27),e.EFF(219),e.nI1(220,"extension"),e.nrm(221,"app-tabs",null,3),e.k0s(),e.j41(223,"pre")(224,"code",28),e.EFF(225,"\nimport { Module } from '@nestjs/common';\nimport { MongooseModule } from '@nestjs/mongoose';\nimport { CatsController } from './cats.controller';\nimport { CatsService } from './cats.service';\nimport { Cat, CatSchema } from './schemas/cat.schema';\n\n@Module({\n  imports: [MongooseModule.forFeature([{ name: Cat.name, schema: CatSchema }])],\n  controllers: [CatsController],\n  providers: [CatsService],\n})\nexport class CatsModule {}\n"),e.k0s()()(),e.j41(226,"p"),e.EFF(227,"Le module "),e.j41(228,"code"),e.EFF(229,"MongooseModule"),e.k0s(),e.EFF(230," fournit la m\xe9thode "),e.j41(231,"code"),e.EFF(232,"forFeature()"),e.k0s(),e.EFF(233," pour configurer le module, y compris la d\xe9finition des mod\xe8les qui doivent \xeatre enregistr\xe9s dans le champ d'application actuel. Si vous voulez aussi utiliser les mod\xe8les dans un autre module, ajoutez MongooseModule \xe0 la section "),e.j41(234,"code"),e.EFF(235,"exports"),e.k0s(),e.EFF(236," de "),e.j41(237,"code"),e.EFF(238,"CatsModule"),e.k0s(),e.EFF(239," et importez "),e.j41(240,"code"),e.EFF(241,"CatsModule"),e.k0s(),e.EFF(242," dans l'autre module."),e.k0s(),e.j41(243,"p"),e.EFF(244,"Une fois le sch\xe9ma enregistr\xe9, vous pouvez injecter un mod\xe8le "),e.j41(245,"code"),e.EFF(246,"Cat"),e.k0s(),e.EFF(247," dans le "),e.j41(248,"code"),e.EFF(249,"CatsService"),e.k0s(),e.EFF(250," en utilisant le d\xe9corateur "),e.j41(251,"code"),e.EFF(252,"@InjectModel()"),e.k0s(),e.EFF(253," :"),e.k0s(),e.j41(254,"app-copy-button",26)(255,"span",27),e.EFF(256),e.nI1(257,"extension"),e.nrm(258,"app-tabs",null,4),e.k0s(),e.j41(260,"pre")(261,"code",28),e.EFF(262,"\nimport { Model } from 'mongoose';\nimport { Injectable } from '@nestjs/common';\nimport { InjectModel } from '@nestjs/mongoose';\nimport { Cat } from './schemas/cat.schema';\nimport { CreateCatDto } from './dto/create-cat.dto';\n\n@Injectable()\nexport class CatsService {\n  constructor(@InjectModel(Cat.name) private catModel: Model<Cat>) {}\n\n  async create(createCatDto: CreateCatDto): Promise<Cat> {\n    const createdCat = new this.catModel(createCatDto);\n    return createdCat.save();\n  }\n\n  async findAll(): Promise<Cat[]> {\n    return this.catModel.find().exec();\n  }\n}\n"),e.k0s()(),e.j41(263,"pre")(264,"code",28),e.EFF(265,"\nimport { Model } from 'mongoose';\nimport { Injectable, Dependencies } from '@nestjs/common';\nimport { getModelToken } from '@nestjs/mongoose';\nimport { Cat } from './schemas/cat.schema';\n\n@Injectable()\n@Dependencies(getModelToken(Cat.name))\nexport class CatsService {\n  constructor(catModel) {\n    this.catModel = catModel;\n  }\n\n  async create(createCatDto) {\n    const createdCat = new this.catModel(createCatDto);\n    return createdCat.save();\n  }\n\n  async findAll() {\n    return this.catModel.find().exec();\n  }\n}\n"),e.k0s()()(),e.j41(266,"h4",37)(267,"span"),e.EFF(268,"Connexion"),e.k0s()(),e.j41(269,"p"),e.EFF(270,"Il peut arriver que vous ayez besoin d'acc\xe9der \xe0 l'objet natif "),e.j41(271,"a",38),e.EFF(272,"Mongoose Connection"),e.k0s(),e.EFF(273,". Par exemple, vous pouvez vouloir faire des appels API natifs sur l'objet connexion. Vous pouvez injecter la connexion Mongoose en utilisant le d\xe9corateur "),e.j41(274,"code"),e.EFF(275,"@InjectConnection()"),e.k0s(),e.EFF(276," comme suit :"),e.k0s(),e.j41(277,"app-copy-button")(278,"pre")(279,"code",28),e.EFF(280,"\nimport { Injectable } from '@nestjs/common';\nimport { InjectConnection } from '@nestjs/mongoose';\nimport { Connection } from 'mongoose';\n\n@Injectable()\nexport class CatsService {\n  constructor(@InjectConnection() private connection: Connection) {}\n}\n"),e.k0s()()(),e.j41(281,"h4",39)(282,"span"),e.EFF(283,"Sessions"),e.k0s()(),e.j41(284,"p"),e.EFF(285,"Pour d\xe9marrer une session avec Mongoose, il est recommand\xe9 d'injecter la connexion \xe0 la base de donn\xe9es en utilisant "),e.j41(286,"code"),e.EFF(287,"@InjectConnection"),e.k0s(),e.EFF(288," plut\xf4t que d'appeler directement "),e.j41(289,"code"),e.EFF(290,"mongoose.startSession()"),e.k0s(),e.EFF(291,". Cette approche permet une meilleure int\xe9gration avec le syst\xe8me d'injection de d\xe9pendances de NestJS, assurant une bonne gestion des connexions."),e.k0s(),e.j41(292,"p"),e.EFF(293,"Voici un exemple de d\xe9marrage d'une session :"),e.k0s(),e.j41(294,"app-copy-button")(295,"pre")(296,"code",28),e.EFF(297,"\nimport { InjectConnection } from '@nestjs/mongoose';\nimport { Connection } from 'mongoose';\n\n@Injectable()\nexport class CatsService {\n  constructor(@InjectConnection() private readonly connection: Connection) {}\n\n  async startTransaction() {\n    const session = await this.connection.startSession();\n    session.startTransaction();\n    // Your transaction logic here\n  }\n}\n"),e.k0s()()(),e.j41(298,"p"),e.EFF(299,"Dans cet exemple, "),e.j41(300,"code"),e.EFF(301,"@InjectConnection()"),e.k0s(),e.EFF(302," est utilis\xe9 pour injecter la connexion Mongoose dans le service. Une fois la connexion inject\xe9e, vous pouvez utiliser "),e.j41(303,"code"),e.EFF(304,"connection.startSession()"),e.k0s(),e.EFF(305," pour d\xe9marrer une nouvelle session. Cette session peut \xeatre utilis\xe9e pour g\xe9rer les transactions de la base de donn\xe9es, en garantissant des op\xe9rations atomiques sur plusieurs requ\xeates. Apr\xe8s avoir d\xe9marr\xe9 la session, n'oubliez pas de valider ou d'annuler la transaction en fonction de votre logique."),e.k0s(),e.j41(306,"h4",40)(307,"span"),e.EFF(308,"Bases de donn\xe9es multiples"),e.k0s()(),e.j41(309,"p"),e.EFF(310,"Certains projets n\xe9cessitent plusieurs connexions \xe0 des bases de donn\xe9es. Ce module permet \xe9galement d'y parvenir. Pour travailler avec des connexions multiples, il faut d'abord cr\xe9er les connexions. Dans ce cas, le nom de la connexion devient "),e.j41(311,"strong"),e.EFF(312,"obligatoire"),e.k0s(),e.EFF(313,"."),e.k0s(),e.j41(314,"app-copy-button",26)(315,"span",27),e.EFF(316),e.nI1(317,"extension"),e.nrm(318,"app-tabs",null,5),e.k0s(),e.j41(320,"pre")(321,"code",28),e.EFF(322,"\nimport { Module } from '@nestjs/common';\nimport { MongooseModule } from '@nestjs/mongoose';\n\n@Module({\n  imports: [\n    MongooseModule.forRoot('mongodb://localhost/test', {\n      connectionName: 'cats',\n    }),\n    MongooseModule.forRoot('mongodb://localhost/users', {\n      connectionName: 'users',\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(323,"blockquote",41)(324,"strong"),e.EFF(325,"Remarque"),e.k0s(),e.EFF(326," Veuillez noter que vous ne devez pas avoir plusieurs connexions sans nom ou avec le m\xeame nom, sinon elles seront remplac\xe9es.\n"),e.k0s(),e.j41(327,"p"),e.EFF(328,"Avec cette configuration, vous devez indiquer \xe0 la fonction "),e.j41(329,"code"),e.EFF(330,"MongooseModule.forFeature()"),e.k0s(),e.EFF(331," quelle connexion doit \xeatre utilis\xe9e."),e.k0s(),e.j41(332,"app-copy-button")(333,"pre")(334,"code",28),e.EFF(335,"\n@Module({\n  imports: [\n    MongooseModule.forFeature([{ name: Cat.name, schema: CatSchema }], 'cats'),\n  ],\n})\nexport class CatsModule {}\n"),e.k0s()()(),e.j41(336,"p"),e.EFF(337,"Vous pouvez \xe9galement injecter la "),e.j41(338,"code"),e.EFF(339,"Connection"),e.k0s(),e.EFF(340," pour une connexion donn\xe9e :"),e.k0s(),e.j41(341,"app-copy-button")(342,"pre")(343,"code",28),e.EFF(344,"\nimport { Injectable } from '@nestjs/common';\nimport { InjectConnection } from '@nestjs/mongoose';\nimport { Connection } from 'mongoose';\n\n@Injectable()\nexport class CatsService {\n  constructor(@InjectConnection('cats') private connection: Connection) {}\n}\n"),e.k0s()()(),e.j41(345,"p"),e.EFF(346,"Pour injecter une "),e.j41(347,"code"),e.EFF(348,"Connection"),e.k0s(),e.EFF(349," donn\xe9e dans un fournisseur personnalis\xe9 (par exemple, un fournisseur factory), utilisez la fonction "),e.j41(350,"code"),e.EFF(351,"getConnectionToken()"),e.k0s(),e.EFF(352," en passant le nom de la connexion en tant qu'argument."),e.k0s(),e.j41(353,"app-copy-button")(354,"pre")(355,"code",28),e.EFF(356,"\n{\n  provide: CatsService,\n  useFactory: (catsConnection: Connection) => {\n    return new CatsService(catsConnection);\n  },\n  inject: [getConnectionToken('cats')],\n}\n"),e.k0s()()(),e.j41(357,"p"),e.EFF(358,"Si vous souhaitez simplement injecter le mod\xe8le \xe0 partir d'une base de donn\xe9es nomm\xe9e, vous pouvez utiliser le nom de la connexion comme second param\xe8tre du d\xe9corateur "),e.j41(359,"code"),e.EFF(360,"@InjectModel()"),e.k0s(),e.EFF(361,"."),e.k0s(),e.j41(362,"app-copy-button",26)(363,"span",27),e.EFF(364),e.nI1(365,"extension"),e.nrm(366,"app-tabs",null,6),e.k0s(),e.j41(368,"pre")(369,"code",28),e.EFF(370,"\n@Injectable()\nexport class CatsService {\n  constructor(@InjectModel(Cat.name, 'cats') private catModel: Model<Cat>) {}\n}\n"),e.k0s()(),e.j41(371,"pre")(372,"code",28),e.EFF(373,"\n@Injectable()\n@Dependencies(getModelToken(Cat.name, 'cats'))\nexport class CatsService {\n  constructor(catModel) {\n    this.catModel = catModel;\n  }\n}\n"),e.k0s()()(),e.j41(374,"h4",42)(375,"span"),e.EFF(376,"Hooks (middleware)"),e.k0s()(),e.j41(377,"p"),e.EFF(378,"Les middleware (\xe9galement appel\xe9s pre et post hooks) sont des fonctions auxquelles on passe le contr\xf4le pendant l'ex\xe9cution de fonctions asynchrones. Le middleware est sp\xe9cifi\xe9 au niveau du sch\xe9ma et est utile pour \xe9crire des plugins ("),e.j41(379,"a",43),e.EFF(380,"source"),e.k0s(),e.EFF(381,"). Appeler "),e.j41(382,"code"),e.EFF(383,"pre()"),e.k0s(),e.EFF(384," ou "),e.j41(385,"code"),e.EFF(386,"post()"),e.k0s(),e.EFF(387," apr\xe8s avoir compil\xe9 un mod\xe8le ne fonctionne pas dans Mongoose. Pour enregistrer un hook "),e.j41(388,"strong"),e.EFF(389,"avant"),e.k0s(),e.EFF(390," l'enregistrement du mod\xe8le, utilisez la m\xe9thode "),e.j41(391,"code"),e.EFF(392,"forFeatureAsync()"),e.k0s(),e.EFF(393," du "),e.j41(394,"code"),e.EFF(395,"MongooseModule"),e.k0s(),e.EFF(396," avec un fournisseur de fabrique (i.e., "),e.j41(397,"code"),e.EFF(398,"useFactory"),e.k0s(),e.EFF(399,"). Avec cette technique, vous pouvez acc\xe9der \xe0 un objet sch\xe9ma, puis utiliser la m\xe9thode "),e.j41(400,"code"),e.EFF(401,"pre()"),e.k0s(),e.EFF(402," ou "),e.j41(403,"code"),e.EFF(404,"post()"),e.k0s(),e.EFF(405," pour enregistrer un hook sur ce sch\xe9ma. Voir l'exemple ci-dessous :"),e.k0s(),e.j41(406,"app-copy-button")(407,"pre")(408,"code",28),e.EFF(409,"\n@Module({\n  imports: [\n    MongooseModule.forFeatureAsync([\n      {\n        name: Cat.name,\n        useFactory: () => {\n          const schema = CatsSchema;\n          schema.pre('save', function () {\n            console.log('Bonjour depuis pre save');\n          });\n          return schema;\n        },\n      },\n    ]),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(410,"p"),e.EFF(411,"Comme les autres "),e.j41(412,"a",44),e.EFF(413,"fournisseurs d'usine"),e.k0s(),e.EFF(414,", notre fonction d'usine peut \xeatre "),e.j41(415,"code"),e.EFF(416,"async"),e.k0s(),e.EFF(417," et peut injecter des d\xe9pendances via "),e.j41(418,"code"),e.EFF(419,"inject"),e.k0s(),e.EFF(420,"."),e.k0s(),e.j41(421,"app-copy-button")(422,"pre")(423,"code",28),e.EFF(424,"\n@Module({\n  imports: [\n    MongooseModule.forFeatureAsync([\n      {\n        name: Cat.name,\n        imports: [ConfigModule],\n        useFactory: (configService: ConfigService) => {\n          const schema = CatsSchema;\n          schema.pre('save', function() {\n            console.log(\n              `${configService.get('APP_NAME')}: Bonjour dpeuis pre save`,\n            ),\n          });\n          return schema;\n        },\n        inject: [ConfigService],\n      },\n    ]),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(425,"h4",45)(426,"span"),e.EFF(427,"Plugins"),e.k0s()(),e.j41(428,"p"),e.EFF(429,"Pour enregistrer un "),e.j41(430,"a",46),e.EFF(431,"plugin"),e.k0s(),e.EFF(432," pour un sch\xe9ma donn\xe9, utilisez la m\xe9thode "),e.j41(433,"code"),e.EFF(434,"forFeatureAsync()"),e.k0s(),e.EFF(435,"."),e.k0s(),e.j41(436,"app-copy-button")(437,"pre")(438,"code",28),e.EFF(439,"\n@Module({\n  imports: [\n    MongooseModule.forFeatureAsync([\n      {\n        name: Cat.name,\n        useFactory: () => {\n          const schema = CatsSchema;\n          schema.plugin(require('mongoose-autopopulate'));\n          return schema;\n        },\n      },\n    ]),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(440,"p"),e.EFF(441,"Pour enregistrer un plugin pour tous les sch\xe9mas \xe0 la fois, appelez la m\xe9thode "),e.j41(442,"code"),e.EFF(443,".plugin()"),e.k0s(),e.EFF(444," de l'objet "),e.j41(445,"code"),e.EFF(446,"Connection"),e.k0s(),e.EFF(447,". Vous devez acc\xe9der \xe0 la connexion avant que les mod\xe8les ne soient cr\xe9\xe9s ; pour cela, utilisez l'objet "),e.j41(448,"code"),e.EFF(449,"connectionFactory"),e.k0s(),e.EFF(450," :"),e.k0s(),e.j41(451,"app-copy-button",26)(452,"span",27),e.EFF(453),e.nI1(454,"extension"),e.nrm(455,"app-tabs",null,7),e.k0s(),e.j41(457,"pre")(458,"code",28),e.EFF(459,"\nimport { Module } from '@nestjs/common';\nimport { MongooseModule } from '@nestjs/mongoose';\n\n@Module({\n  imports: [\n    MongooseModule.forRoot('mongodb://localhost/test', {\n      connectionFactory: (connection) => {\n        connection.plugin(require('mongoose-autopopulate'));\n        return connection;\n      }\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(460,"h4",47)(461,"span"),e.EFF(462,"Discriminants"),e.k0s()(),e.j41(463,"p"),e.EFF(464,"Les "),e.j41(465,"a",48),e.EFF(466,"discriminants"),e.k0s(),e.EFF(467," sont un m\xe9canisme d'h\xe9ritage de sch\xe9ma. Ils vous permettent d'avoir plusieurs mod\xe8les avec des sch\xe9mas qui se chevauchent au-dessus de la m\xeame collection MongoDB sous-jacente."),e.k0s(),e.j41(468,"p"),e.EFF(469,"Supposons que vous souhaitiez suivre diff\xe9rents types d'\xe9v\xe9nements dans une seule collection. Chaque \xe9v\xe9nement aura un horodatage."),e.k0s(),e.j41(470,"app-copy-button",26)(471,"span",27),e.EFF(472),e.nI1(473,"extension"),e.nrm(474,"app-tabs",null,8),e.k0s(),e.j41(476,"pre")(477,"code",28),e.EFF(478,"\n@Schema({ discriminatorKey: 'kind' })\nexport class Event {\n  @Prop({\n    type: String,\n    required: true,\n    enum: [ClickedLinkEvent.name, SignUpEvent.name],\n  })\n  kind: string;\n\n  @Prop({ type: Date, required: true })\n  time: Date;\n}\n\nexport const EventSchema = SchemaFactory.createForClass(Event);\n"),e.k0s()()(),e.j41(479,"blockquote",33)(480,"strong"),e.EFF(481,"Astuce"),e.k0s(),e.EFF(482,' La fa\xe7on dont Mongoose fait la diff\xe9rence entre les diff\xe9rents mod\xe8les de discriminants est par la "cl\xe9 du discriminant", qui est '),e.j41(483,"code"),e.EFF(484,"__t"),e.k0s(),e.EFF(485," par d\xe9faut. Mongoose ajoute une cha\xeene de caract\xe8res appel\xe9e "),e.j41(486,"code"),e.EFF(487,"__t"),e.k0s(),e.EFF(488," \xe0 vos sch\xe9mas qu'il utilise pour savoir de quel discriminateur ce document est une instance.\nVous pouvez \xe9galement utiliser l'option "),e.j41(489,"code"),e.EFF(490,"discriminatorKey"),e.k0s(),e.EFF(491," pour d\xe9finir le chemin pour le discriminant.\n"),e.k0s(),e.j41(492,"p"),e.EFF(493,"Les instances "),e.j41(494,"code"),e.EFF(495,"SignedUpEvent"),e.k0s(),e.EFF(496," et "),e.j41(497,"code"),e.EFF(498,"ClickedLinkEvent"),e.k0s(),e.EFF(499," seront stock\xe9es dans la m\xeame collection que les \xe9v\xe9nements g\xe9n\xe9riques."),e.k0s(),e.j41(500,"p"),e.EFF(501,"D\xe9finissons maintenant la classe "),e.j41(502,"code"),e.EFF(503,"ClickedLinkEvent"),e.k0s(),e.EFF(504,", comme suit :"),e.k0s(),e.j41(505,"app-copy-button",26)(506,"span",27),e.EFF(507),e.nI1(508,"extension"),e.nrm(509,"app-tabs",null,9),e.k0s(),e.j41(511,"pre")(512,"code",28),e.EFF(513,"\n@Schema()\nexport class ClickedLinkEvent {\n  kind: string;\n  time: Date;\n\n  @Prop({ type: String, required: true })\n  url: string;\n}\n\nexport const ClickedLinkEventSchema = SchemaFactory.createForClass(ClickedLinkEvent);\n"),e.k0s()()(),e.j41(514,"p"),e.EFF(515,"Et la classe "),e.j41(516,"code"),e.EFF(517,"SignUpEvent"),e.k0s(),e.EFF(518," :"),e.k0s(),e.j41(519,"app-copy-button",26)(520,"span",27),e.EFF(521),e.nI1(522,"extension"),e.nrm(523,"app-tabs",null,10),e.k0s(),e.j41(525,"pre")(526,"code",28),e.EFF(527,"\n@Schema()\nexport class SignUpEvent {\n  kind: string;\n  time: Date;\n\n  @Prop({ type: String, required: true })\n  user: string;\n}\n\nexport const SignUpEventSchema = SchemaFactory.createForClass(SignUpEvent);\n"),e.k0s()()(),e.j41(528,"p"),e.EFF(529,"Avec ceci en place, utilisez l'option "),e.j41(530,"code"),e.EFF(531,"discriminators"),e.k0s(),e.EFF(532," pour enregistrer un discriminant pour un sch\xe9ma donn\xe9. Cela fonctionne \xe0 la fois sur "),e.j41(533,"code"),e.EFF(534,"MongooseModule.forFeature"),e.k0s(),e.EFF(535," et "),e.j41(536,"code"),e.EFF(537,"MongooseModule.forFeatureAsync"),e.k0s(),e.EFF(538," :"),e.k0s(),e.j41(539,"app-copy-button",26)(540,"span",27),e.EFF(541),e.nI1(542,"extension"),e.nrm(543,"app-tabs",null,11),e.k0s(),e.j41(545,"pre")(546,"code",28),e.EFF(547,"\nimport { Module } from '@nestjs/common';\nimport { MongooseModule } from '@nestjs/mongoose';\n\n@Module({\n  imports: [\n    MongooseModule.forFeature([\n      {\n        name: Event.name,\n        schema: EventSchema,\n        discriminators: [\n          { name: ClickedLinkEvent.name, schema: ClickedLinkEventSchema },\n          { name: SignUpEvent.name, schema: SignUpEventSchema },\n        ],\n      },\n    ]),\n  ]\n})\nexport class EventsModule {}\n"),e.k0s()()(),e.j41(548,"h4",49)(549,"span"),e.EFF(550,"Tests"),e.k0s()(),e.j41(551,"p"),e.EFF(552,"Lors des tests unitaires d'une application, nous souhaitons g\xe9n\xe9ralement \xe9viter toute connexion \xe0 la base de donn\xe9es, afin de simplifier la mise en place de nos suites de tests et d'en acc\xe9l\xe9rer l'ex\xe9cution. Mais nos classes peuvent d\xe9pendre de mod\xe8les tir\xe9s de l'instance de connexion. Comment r\xe9soudre ces classes ? La solution consiste \xe0 cr\xe9er des mod\xe8les fictifs."),e.k0s(),e.j41(553,"p"),e.EFF(554,"Pour rendre cela plus facile, le package "),e.j41(555,"code"),e.EFF(556,"@nestjs/mongoose"),e.k0s(),e.EFF(557," expose une fonction "),e.j41(558,"code"),e.EFF(559,"getModelToken()"),e.k0s(),e.EFF(560," qui retourne un "),e.j41(561,"a",50),e.EFF(562,"jeton d'injection pr\xe9par\xe9"),e.k0s(),e.EFF(563," bas\xe9 sur un nom de jeton. En utilisant ce jeton, vous pouvez facilement fournir une impl\xe9mentation fictive en utilisant n'importe laquelle des techniques standard de [fournisseurs personnalis\xe9s] (/fundamentals/custom-providers), y compris "),e.j41(564,"code"),e.EFF(565,"useClass"),e.k0s(),e.EFF(566,", "),e.j41(567,"code"),e.EFF(568,"useValue"),e.k0s(),e.EFF(569,", et "),e.j41(570,"code"),e.EFF(571,"useFactory"),e.k0s(),e.EFF(572,". Par exemple :"),e.k0s(),e.j41(573,"app-copy-button")(574,"pre")(575,"code",28),e.EFF(576,"\n@Module({\n  providers: [\n    CatsService,\n    {\n      provide: getModelToken(Cat.name),\n      useValue: catModel,\n    },\n  ],\n})\nexport class CatsModule {}\n"),e.k0s()()(),e.j41(577,"p"),e.EFF(578,"Dans cet exemple, un "),e.j41(579,"code"),e.EFF(580,"catModel"),e.k0s(),e.EFF(581," (instance d'objet) cod\xe9 en dur sera fourni chaque fois qu'un consommateur injectera un "),e.j41(582,"code"),e.EFF(583,"Model<Cat>"),e.k0s(),e.EFF(584," en utilisant un d\xe9corateur "),e.j41(585,"code"),e.EFF(586,"@InjectModel()"),e.k0s(),e.EFF(587,"."),e.k0s(),e.j41(588,"p"),e.nrm(589,"app-banner-courses"),e.k0s(),e.j41(590,"h4",51)(591,"span"),e.EFF(592,"Configuration asynchrone"),e.k0s()(),e.j41(593,"p"),e.EFF(594,"Lorsque vous avez besoin de passer des options de module de mani\xe8re asynchrone plut\xf4t que statique, utilisez la m\xe9thode "),e.j41(595,"code"),e.EFF(596,"forRootAsync()"),e.k0s(),e.EFF(597,". Comme pour la plupart des modules dynamiques, Nest fournit plusieurs techniques pour g\xe9rer la configuration asynchrone."),e.k0s(),e.j41(598,"p"),e.EFF(599,"Une technique consiste \xe0 utiliser une fonction factory :"),e.k0s(),e.j41(600,"app-copy-button")(601,"pre")(602,"code",28),e.EFF(603,"\nMongooseModule.forRootAsync({\n  useFactory: () => ({\n    uri: 'mongodb://localhost/nest',\n  }),\n});\n"),e.k0s()()(),e.j41(604,"p"),e.EFF(605,"Comme les autres "),e.j41(606,"a",44),e.EFF(607,"fournisseurs de factory"),e.k0s(),e.EFF(608,", notre fonction factory peut \xeatre "),e.j41(609,"code"),e.EFF(610,"async"),e.k0s(),e.EFF(611," et peut injecter des d\xe9pendances via "),e.j41(612,"code"),e.EFF(613,"inject"),e.k0s(),e.EFF(614,"."),e.k0s(),e.j41(615,"app-copy-button")(616,"pre")(617,"code",28),e.EFF(618,"\nMongooseModule.forRootAsync({\n  imports: [ConfigModule],\n  useFactory: async (configService: ConfigService) => ({\n    uri: configService.get<string>('MONGODB_URI'),\n  }),\n  inject: [ConfigService],\n});\n"),e.k0s()()(),e.j41(619,"p"),e.EFF(620,"Alternativement, vous pouvez configurer le "),e.j41(621,"code"),e.EFF(622,"MongooseModule"),e.k0s(),e.EFF(623," en utilisant une classe au lieu d'une factory, comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(624,"app-copy-button")(625,"pre")(626,"code",28),e.EFF(627,"\nMongooseModule.forRootAsync({\n  useClass: MongooseConfigService,\n});\n"),e.k0s()()(),e.j41(628,"p"),e.EFF(629,"La construction ci-dessus instancie "),e.j41(630,"code"),e.EFF(631,"MongooseConfigService"),e.k0s(),e.EFF(632," \xe0 l'int\xe9rieur de "),e.j41(633,"code"),e.EFF(634,"MongooseModule"),e.k0s(),e.EFF(635,", en l'utilisant pour cr\xe9er l'objet d'options requis. Notez que dans cet exemple, le "),e.j41(636,"code"),e.EFF(637,"MongooseConfigService"),e.k0s(),e.EFF(638," doit impl\xe9menter l'interface "),e.j41(639,"code"),e.EFF(640,"MongooseOptionsFactory"),e.k0s(),e.EFF(641,", comme montr\xe9 ci-dessous. Le "),e.j41(642,"code"),e.EFF(643,"MongooseModule"),e.k0s(),e.EFF(644," appellera la m\xe9thode "),e.j41(645,"code"),e.EFF(646,"createMongooseOptions()"),e.k0s(),e.EFF(647," sur l'objet instanci\xe9 de la classe fournie."),e.k0s(),e.j41(648,"app-copy-button")(649,"pre")(650,"code",28),e.EFF(651,"\n@Injectable()\nexport class MongooseConfigService implements MongooseOptionsFactory {\n  createMongooseOptions(): MongooseModuleOptions {\n    return {\n      uri: 'mongodb://localhost/nest',\n    };\n  }\n}\n"),e.k0s()()(),e.j41(652,"p"),e.EFF(653,"Si vous voulez r\xe9utiliser un fournisseur d'options existant au lieu de cr\xe9er une copie priv\xe9e \xe0 l'int\xe9rieur du "),e.j41(654,"code"),e.EFF(655,"MongooseModule"),e.k0s(),e.EFF(656,", utilisez la syntaxe "),e.j41(657,"code"),e.EFF(658,"useExisting"),e.k0s(),e.EFF(659,"."),e.k0s(),e.j41(660,"app-copy-button")(661,"pre")(662,"code",28),e.EFF(663,"\nMongooseModule.forRootAsync({\n  imports: [ConfigModule],\n  useExisting: ConfigService,\n});\n"),e.k0s()()(),e.j41(664,"h4",52)(665,"span"),e.EFF(666,"\xc9v\xe9nements de connexion"),e.k0s()(),e.j41(667,"p"),e.EFF(668,"Vous pouvez \xe9couter les "),e.j41(669,"a",53),e.EFF(670,"\xe9v\xe9nements de connexion de Mongoose"),e.k0s(),e.EFF(671," en utilisant l'option de configuration "),e.j41(672,"code"),e.EFF(673,"onConnectionCreate"),e.k0s(),e.EFF(674,". Cela vous permet d'impl\xe9menter une logique personnalis\xe9e chaque fois qu'une connexion est \xe9tablie. Par exemple, vous pouvez enregistrer des r\xe9cepteurs d'\xe9v\xe9nements pour les \xe9v\xe9nements "),e.j41(675,"code"),e.EFF(676,"connected"),e.k0s(),e.EFF(677,", "),e.j41(678,"code"),e.EFF(679,"open"),e.k0s(),e.EFF(680,", "),e.j41(681,"code"),e.EFF(682,"disconnected"),e.k0s(),e.EFF(683,", "),e.j41(684,"code"),e.EFF(685,"reconnected"),e.k0s(),e.EFF(686,", et "),e.j41(687,"code"),e.EFF(688,"disconnecting"),e.k0s(),e.EFF(689,", comme d\xe9montr\xe9 ci-dessous :"),e.k0s(),e.j41(690,"app-copy-button")(691,"pre")(692,"code",28),e.EFF(693,"\nMongooseModule.forRoot('mongodb://localhost/test', {\n  onConnectionCreate: (connection: Connection) => {\n    connection.on('connected', () => console.log('connected'));\n    connection.on('open', () => console.log('open'));\n    connection.on('disconnected', () => console.log('disconnected'));\n    connection.on('reconnected', () => console.log('reconnected'));\n    connection.on('disconnecting', () => console.log('disconnecting'));\n\n    return connection;\n  },\n}),\n"),e.k0s()()(),e.j41(694,"p"),e.EFF(695,"Dans cet extrait de code, nous \xe9tablissons une connexion \xe0 une base de donn\xe9es MongoDB \xe0 l'adresse "),e.j41(696,"code"),e.EFF(697,"mongodb://localhost/test"),e.k0s(),e.EFF(698,". L'option "),e.j41(699,"code"),e.EFF(700,"onConnectionCreate"),e.k0s(),e.EFF(701," vous permet de mettre en place des r\xe9cepteurs d'\xe9v\xe9nements sp\xe9cifiques pour surveiller l'\xe9tat de la connexion :"),e.k0s(),e.j41(702,"ul")(703,"li")(704,"code"),e.EFF(705,"connected"),e.k0s(),e.EFF(706," : D\xe9clench\xe9 lorsque la connexion est \xe9tablie avec succ\xe8s."),e.k0s(),e.j41(707,"li")(708,"code"),e.EFF(709,"open"),e.k0s(),e.EFF(710," : Se d\xe9clenche lorsque la connexion est compl\xe8tement ouverte et pr\xeate \xe0 \xeatre utilis\xe9e."),e.k0s(),e.j41(711,"li")(712,"code"),e.EFF(713,"disconnected"),e.k0s(),e.EFF(714," : Appel\xe9 lorsque la connexion est perdue."),e.k0s(),e.j41(715,"li")(716,"code"),e.EFF(717,"reconnected"),e.k0s(),e.EFF(718," : Invoqu\xe9 lorsque la connexion est r\xe9tablie apr\xe8s avoir \xe9t\xe9 d\xe9connect\xe9e."),e.k0s(),e.j41(719,"li")(720,"code"),e.EFF(721,"disconnecting"),e.k0s(),e.EFF(722," : Se produit lorsque la connexion est en train de se fermer."),e.k0s()(),e.j41(723,"p"),e.EFF(724,"Vous pouvez \xe9galement incorporer la propri\xe9t\xe9 "),e.j41(725,"code"),e.EFF(726,"onConnectionCreate"),e.k0s(),e.EFF(727," dans les configurations asynchrones cr\xe9\xe9es avec "),e.j41(728,"code"),e.EFF(729,"MongooseModule.forRootAsync()"),e.k0s(),e.EFF(730," :"),e.k0s(),e.j41(731,"app-copy-button")(732,"pre")(733,"code",28),e.EFF(734,"\nMongooseModule.forRootAsync({\n  useFactory: () => ({\n    uri: 'mongodb://localhost/test',\n    onConnectionCreate: (connection: Connection) => {\n      // Register event listeners here\n      return connection;\n    },\n  }),\n}),\n"),e.k0s()()(),e.j41(735,"p"),e.EFF(736,"Il s'agit d'un moyen souple de g\xe9rer les \xe9v\xe9nements de connexion, ce qui vous permet de g\xe9rer efficacement les changements d'\xe9tat de la connexion."),e.k0s(),e.j41(737,"h4",54)(738,"span"),e.EFF(739,"Sous-documents"),e.k0s()(),e.j41(740,"p"),e.EFF(741,"Pour imbriquer des sous-documents dans un document parent, vous pouvez d\xe9finir vos sch\xe9mas comme suit :"),e.k0s(),e.j41(742,"app-copy-button",26)(743,"span",27),e.EFF(744),e.nI1(745,"extension"),e.nrm(746,"app-tabs",null,12),e.k0s(),e.j41(748,"pre")(749,"code",28),e.EFF(750,"\n@Schema()\nexport class Name {\n  @Prop()\n  firstName: string;\n\n  @Prop()\n  lastName: string;\n}\n\nexport const NameSchema = SchemaFactory.createForClass(Name);\n"),e.k0s()()(),e.j41(751,"p"),e.EFF(752,"Il faut ensuite r\xe9f\xe9rencer le sous-document dans le sch\xe9ma parent :"),e.k0s(),e.j41(753,"app-copy-button",26)(754,"span",27),e.EFF(755),e.nI1(756,"extension"),e.nrm(757,"app-tabs",null,13),e.k0s(),e.j41(759,"pre")(760,"code",28),e.EFF(761,"\n@Schema()\nexport class Person {\n  @Prop(NameSchema)\n  name: Name;\n}\n\nexport const PersonSchema = SchemaFactory.createForClass(Person);\n\nexport type PersonDocumentOverride = {\n  name: Types.Subdocument<Types.ObjectId & Name>;\n};\n\nexport type PersonDocument = HydratedDocument<Person, PersonDocumentOverride>;\n"),e.k0s()()(),e.j41(762,"p"),e.EFF(763,"Si vous souhaitez inclure plusieurs sous-documents, vous pouvez utiliser un tableau de sous-documents. Il est important de modifier le type de la propri\xe9t\xe9 en cons\xe9quence :"),e.k0s(),e.j41(764,"app-copy-button",26)(765,"span",27),e.EFF(766),e.nI1(767,"extension"),e.nrm(768,"app-tabs",null,14),e.k0s(),e.j41(770,"pre")(771,"code",28),e.EFF(772,"\n@Schema()\nexport class Person {\n  @Prop([NameSchema])\n  name: Name[];\n}\n\nexport const PersonSchema = SchemaFactory.createForClass(Person);\n\nexport type PersonDocumentOverride = {\n  name: Types.DocumentArray<Name>;\n};\n\nexport type PersonDocument = HydratedDocument<Person, PersonDocumentOverride>;\n"),e.k0s()()(),e.j41(773,"h4",55)(774,"span"),e.EFF(775,"Propri\xe9t\xe9s virtuelles"),e.k0s()(),e.j41(776,"p"),e.EFF(777,"Dans Mongoose, une propri\xe9t\xe9 "),e.j41(778,"strong"),e.EFF(779,"virtuelle"),e.k0s(),e.EFF(780," est une propri\xe9t\xe9 qui existe sur un document mais qui n'est pas persist\xe9e dans MongoDB. Elle n'est pas stock\xe9e dans la base de donn\xe9es mais est calcul\xe9e dynamiquement \xe0 chaque fois qu'on y acc\xe8de. Les propri\xe9t\xe9s virtuelles sont g\xe9n\xe9ralement utilis\xe9es pour les valeurs d\xe9riv\xe9es ou calcul\xe9es, comme la combinaison de champs (par exemple, la cr\xe9ation d'une propri\xe9t\xe9 "),e.j41(781,"code"),e.EFF(782,"fullName"),e.k0s(),e.EFF(783," en concat\xe9nant "),e.j41(784,"code"),e.EFF(785,"firstName"),e.k0s(),e.EFF(786," et "),e.j41(787,"code"),e.EFF(788,"lastName"),e.k0s(),e.EFF(789,"), ou pour la cr\xe9ation de propri\xe9t\xe9s qui s'appuient sur des donn\xe9es existantes dans le document."),e.k0s(),e.j41(790,"app-copy-button")(791,"pre")(792,"code",28),e.EFF(793,"\nclass Person {\n  @Prop()\n  firstName: string;\n\n  @Prop()\n  lastName: string;\n\n  @Virtual({\n    get: function (this: Person) {\n      return `${this.firstName} ${this.lastName}`;\n    },\n  })\n  fullName: string;\n}\n"),e.k0s()()(),e.j41(794,"blockquote",33)(795,"strong"),e.EFF(796,"Astuce"),e.k0s(),e.nrm(797,"br"),e.EFF(798,"Le d\xe9corateur "),e.j41(799,"code"),e.EFF(800,"@Virtual()"),e.k0s(),e.EFF(801," est import\xe9 du paquetage "),e.j41(802,"code"),e.EFF(803,"@nestjs/mongoose"),e.k0s(),e.EFF(804,".\n"),e.k0s(),e.j41(805,"p"),e.EFF(806,"Dans cet exemple, la propri\xe9t\xe9 virtuelle "),e.j41(807,"code"),e.EFF(808,"fullName"),e.k0s(),e.EFF(809," est d\xe9riv\xe9e de "),e.j41(810,"code"),e.EFF(811,"firstName"),e.k0s(),e.EFF(812," et "),e.j41(813,"code"),e.EFF(814,"lastName"),e.k0s(),e.EFF(815,". M\xeame si elle se comporte comme une propri\xe9t\xe9 normale lorsqu'on y acc\xe8de, elle n'est jamais sauvegard\xe9e dans le document MongoDB."),e.k0s(),e.j41(816,"h4",56)(817,"span"),e.EFF(818,"Exemple"),e.k0s()(),e.j41(819,"p"),e.EFF(820,"Un exemple concret est disponible "),e.j41(821,"a",57),e.EFF(822,"ici"),e.k0s(),e.EFF(823,"."),e.k0s()()),2&o){const u=e.sdS(45),r=e.sdS(83),p=e.sdS(222),l=e.sdS(259),d=e.sdS(319),m=e.sdS(367),f=e.sdS(456),v=e.sdS(475),b=e.sdS(510),h=e.sdS(524),y=e.sdS(544),g=e.sdS(747),q=e.sdS(758),C=e.sdS(769);e.R7$(42),e.SpI(" ",e.i5U(43,22,"app.module",u.isJsActive),"\n"),e.R7$(38),e.SpI(" ",e.i5U(81,25,"schemas/cat.schema",r.isJsActive),"\n"),e.R7$(139),e.SpI(" ",e.i5U(220,28,"cats.module",p.isJsActive),"\n"),e.R7$(37),e.SpI(" ",e.i5U(257,31,"cats.service",l.isJsActive),"\n"),e.R7$(4),e.AVh("hide",l.isJsActive),e.R7$(3),e.AVh("hide",!l.isJsActive),e.R7$(53),e.SpI(" ",e.i5U(317,34,"app.module",d.isJsActive),"\n"),e.R7$(48),e.SpI(" ",e.i5U(365,37,"cats.service",m.isJsActive),"\n"),e.R7$(4),e.AVh("hide",m.isJsActive),e.R7$(3),e.AVh("hide",!m.isJsActive),e.R7$(82),e.SpI(" ",e.i5U(454,40,"app.module",f.isJsActive),"\n"),e.R7$(19),e.SpI(" ",e.i5U(473,43,"event.schema",v.isJsActive),"\n"),e.R7$(35),e.SpI(" ",e.i5U(508,46,"click-link-event.schema",b.isJsActive),"\n"),e.R7$(14),e.SpI(" ",e.i5U(522,49,"sign-up-event.schema",h.isJsActive),"\n"),e.R7$(20),e.SpI(" ",e.i5U(542,52,"event.module",y.isJsActive),"\n"),e.R7$(203),e.SpI(" ",e.i5U(745,55,"name.schema",g.isJsActive),"\n"),e.R7$(11),e.SpI(" ",e.i5U(756,58,"person.schema",q.isJsActive),"\n"),e.R7$(11),e.SpI(" ",e.i5U(767,61,"name.schema",C.isJsActive),"\n")}},dependencies:[E.O,i.a,A.Q,c.z,j.Wk,k.M],encapsulation:2,changeDetection:0})}return s})(),_=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-mvc"]],features:[e.Vt3],decls:230,vars:29,consts:[["contentReference",""],["app0cdf14b86786bd883880a981e49a201074fbd734",""],["app7ebf58fd1de2379ce21bc65c92813908e0eb5c29",""],["appb8718be4e6d86792d676da0ca4482ea4160deb10",""],["appbb50be03174f7d105978dd188905794db3bbb3cc",""],["app661c71ead03880876b93f22b92c007eac40c1ffc",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/mvc.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","mod\xe8le-vue-contr\xf4leur"],["rel","nofollow","target","_blank","href","https://github.com/expressjs/express"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest-cli"],[1,"language-bash"],["rel","nofollow","target","_blank","href","https://expressjs.com/en/guide/using-template-engines.html"],["rel","nofollow","target","_blank","href","https://github.com/pillarjs/hbs#readme"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],["appAnchor","","id","rendu-des-mod\xe8les"],[1,"language-html"],["appAnchor","","id","rendu-dynamique-des-mod\xe8les"],[1,"info"],["rel","nofollow","target","_blank","href","https://expressjs.com/en/api.html"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/15-mvc"],["appAnchor","","id","fastify"],["routerLink","/techniques/performance"],["rel","nofollow","target","_blank","href","https://github.com/fastify/fastify"],["appAnchor","","id","exemple-1"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/17-mvc-fastify"]],template:function(o,t){if(1&o&&(e.j41(0,"div",6,0)(2,"div",7)(3,"a",8),e.nrm(4,"i",9),e.k0s()(),e.j41(5,"h3",10),e.EFF(6,"Mod\xe8le-Vue-Contr\xf4leur"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Nest utilise par d\xe9faut la biblioth\xe8que "),e.j41(9,"a",11),e.EFF(10,"Express"),e.k0s(),e.EFF(11,". Par cons\xe9quent, toutes les techniques d'utilisation du mod\xe8le MVC (Mod\xe8le-Vue-Contr\xf4leur) dans Express s'appliquent \xe9galement \xe0 Nest."),e.k0s(),e.j41(12,"p"),e.EFF(13,"Commen\xe7ons par mettre en place une application Nest simple \xe0 l'aide de l'outil "),e.j41(14,"a",12),e.EFF(15,"CLI"),e.k0s(),e.EFF(16," :"),e.k0s(),e.j41(17,"pre")(18,"code",13),e.EFF(19,"\n$ npm i -g @nestjs/cli\n$ nest new project\n"),e.k0s()(),e.j41(20,"p"),e.EFF(21,"Pour cr\xe9er une application MVC, nous avons \xe9galement besoin d'un "),e.j41(22,"a",14),e.EFF(23,"moteur de mod\xe8le"),e.k0s(),e.EFF(24," pour g\xe9n\xe9rer nos vues HTML :"),e.k0s(),e.j41(25,"pre")(26,"code",13),e.EFF(27,"\n$ npm install --save hbs\n"),e.k0s()(),e.j41(28,"p"),e.EFF(29,"Nous avons utilis\xe9 le moteur "),e.j41(30,"code"),e.EFF(31,"hbs"),e.k0s(),e.EFF(32," ("),e.j41(33,"a",15),e.EFF(34,"Handlebars"),e.k0s(),e.EFF(35,"), mais vous pouvez utiliser ce qui correspond \xe0 vos besoins. Une fois le processus d'installation termin\xe9, nous devons configurer l'instance express en utilisant le code suivant :"),e.k0s(),e.j41(36,"app-copy-button",16)(37,"span",17),e.EFF(38),e.nI1(39,"extension"),e.nrm(40,"app-tabs",null,1),e.k0s(),e.j41(42,"pre")(43,"code",18),e.EFF(44,"\nimport { NestFactory } from '@nestjs/core';\nimport { NestExpressApplication } from '@nestjs/platform-express';\nimport { join } from 'path';\nimport { AppModule } from './app.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.create<NestExpressApplication>(\n    AppModule,\n  );\n\n  app.useStaticAssets(join(__dirname, '..', 'public'));\n  app.setBaseViewsDir(join(__dirname, '..', 'views'));\n  app.setViewEngine('hbs');\n\n  await app.listen(process.env.PORT ?? 3000);\n}\nbootstrap();\n"),e.k0s()(),e.j41(45,"pre")(46,"code",18),e.EFF(47,"\nimport { NestFactory } from '@nestjs/core';\nimport { join } from 'path';\nimport { AppModule } from './app.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(\n    AppModule,\n  );\n\n  app.useStaticAssets(join(__dirname, '..', 'public'));\n  app.setBaseViewsDir(join(__dirname, '..', 'views'));\n  app.setViewEngine('hbs');\n\n  await app.listen(process.env.PORT ?? 3000);\n}\nbootstrap();\n"),e.k0s()()(),e.j41(48,"p"),e.EFF(49,"Nous avons dit \xe0 "),e.j41(50,"a",11),e.EFF(51,"Express"),e.k0s(),e.EFF(52," que le r\xe9pertoire "),e.j41(53,"code"),e.EFF(54,"public"),e.k0s(),e.EFF(55," sera utilis\xe9 pour stocker les actifs statiques, que "),e.j41(56,"code"),e.EFF(57,"views"),e.k0s(),e.EFF(58," contiendra les templates, et que le moteur de template "),e.j41(59,"code"),e.EFF(60,"hbs"),e.k0s(),e.EFF(61," sera utilis\xe9 pour g\xe9n\xe9rer les sorties HTML."),e.k0s(),e.j41(62,"h4",19)(63,"span"),e.EFF(64,"Rendu des mod\xe8les"),e.k0s()(),e.j41(65,"p"),e.EFF(66,"Maintenant, cr\xe9ons un r\xe9pertoire "),e.j41(67,"code"),e.EFF(68,"views"),e.k0s(),e.EFF(69," et un mod\xe8le "),e.j41(70,"code"),e.EFF(71,"index.hbs"),e.k0s(),e.EFF(72," \xe0 l'int\xe9rieur. Dans le template, nous allons imprimer un "),e.j41(73,"code"),e.EFF(74,"message"),e.k0s(),e.EFF(75," pass\xe9 par le contr\xf4leur :"),e.k0s(),e.j41(76,"pre")(77,"code",20),e.EFF(78),e.k0s()(),e.j41(79,"p"),e.EFF(80,"Ensuite, ouvrez le fichier "),e.j41(81,"code"),e.EFF(82,"app.controller"),e.k0s(),e.EFF(83," et remplacez la m\xe9thode "),e.j41(84,"code"),e.EFF(85,"root()"),e.k0s(),e.EFF(86," par le code suivant :"),e.k0s(),e.j41(87,"app-copy-button",16)(88,"span",17),e.EFF(89),e.nI1(90,"extension"),e.nrm(91,"app-tabs",null,2),e.k0s(),e.j41(93,"pre")(94,"code",18),e.EFF(95,"\nimport { Get, Controller, Render } from '@nestjs/common';\n\n@Controller()\nexport class AppController {\n  @Get()\n  @Render('index')\n  root() {\n    return { message: 'Hello world!' };\n  }\n}\n"),e.k0s()()(),e.j41(96,"p"),e.EFF(97,"Dans ce code, nous sp\xe9cifions le template \xe0 utiliser dans le d\xe9corateur "),e.j41(98,"code"),e.EFF(99,"@Render()"),e.k0s(),e.EFF(100,", et la valeur de retour de la m\xe9thode du gestionnaire de route est pass\xe9e au template pour le rendu. Notez que la valeur de retour est un objet avec une propri\xe9t\xe9 "),e.j41(101,"code"),e.EFF(102,"message"),e.k0s(),e.EFF(103,", correspondant \xe0 l'espace r\xe9serv\xe9 "),e.j41(104,"code"),e.EFF(105,"message"),e.k0s(),e.EFF(106," que nous avons cr\xe9\xe9 dans le mod\xe8le."),e.k0s(),e.j41(107,"p"),e.EFF(108,"Pendant que l'application fonctionne, ouvrez votre navigateur et naviguez jusqu'\xe0 "),e.j41(109,"code"),e.EFF(110,"http://localhost:3000"),e.k0s(),e.EFF(111,". Vous devriez voir le message "),e.j41(112,"code"),e.EFF(113,"Hello world!"),e.k0s(),e.EFF(114,"."),e.k0s(),e.j41(115,"h4",21)(116,"span"),e.EFF(117,"Rendu dynamique des mod\xe8les"),e.k0s()(),e.j41(118,"p"),e.EFF(119,"Si la logique de l'application doit d\xe9cider dynamiquement du mod\xe8le \xe0 afficher, alors nous devrions utiliser le d\xe9corateur "),e.j41(120,"code"),e.EFF(121,"@Res()"),e.k0s(),e.EFF(122,", et fournir le nom de la vue dans notre gestionnaire de route, plut\xf4t que dans le d\xe9corateur "),e.j41(123,"code"),e.EFF(124,"@Render()"),e.k0s(),e.EFF(125," :"),e.k0s(),e.j41(126,"blockquote",22)(127,"strong"),e.EFF(128,"Astuce"),e.k0s(),e.EFF(129," Lorsque Nest d\xe9tecte le d\xe9corateur "),e.j41(130,"code"),e.EFF(131,"@Res()"),e.k0s(),e.EFF(132,", il injecte l'objet "),e.j41(133,"code"),e.EFF(134,"response"),e.k0s(),e.EFF(135," sp\xe9cifique \xe0 la biblioth\xe8que. Nous pouvons utiliser cet objet pour effectuer un rendu dynamique du mod\xe8le. Pour en savoir plus sur l'API de l'objet "),e.j41(136,"code"),e.EFF(137,"response"),e.k0s(),e.j41(138,"a",23),e.EFF(139,"lisez ceci"),e.k0s(),e.EFF(140,".\n"),e.k0s(),e.j41(141,"app-copy-button",16)(142,"span",17),e.EFF(143),e.nI1(144,"extension"),e.nrm(145,"app-tabs",null,3),e.k0s(),e.j41(147,"pre")(148,"code",18),e.EFF(149,"\nimport { Get, Controller, Res, Render } from '@nestjs/common';\nimport { Response } from 'express';\nimport { AppService } from './app.service';\n\n@Controller()\nexport class AppController {\n  constructor(private appService: AppService) {}\n\n  @Get()\n  root(@Res() res: Response) {\n    return res.render(\n      this.appService.getViewName(),\n      { message: 'Hello world!' },\n    );\n  }\n}\n"),e.k0s()()(),e.j41(150,"h4",24)(151,"span"),e.EFF(152,"Exemple"),e.k0s()(),e.j41(153,"p"),e.EFF(154,"Un exemple concret est disponible "),e.j41(155,"a",25),e.EFF(156,"ici"),e.k0s(),e.EFF(157,"."),e.k0s(),e.j41(158,"h4",26)(159,"span"),e.EFF(160,"Fastify"),e.k0s()(),e.j41(161,"p"),e.EFF(162,"Comme indiqu\xe9 dans ce "),e.j41(163,"a",27),e.EFF(164,"chapitre"),e.k0s(),e.EFF(165,", nous pouvons utiliser n'importe quel fournisseur HTTP compatible avec Nest. L'une de ces biblioth\xe8ques est "),e.j41(166,"a",28),e.EFF(167,"Fastify"),e.k0s(),e.EFF(168,". Afin de cr\xe9er une application MVC avec Fastify, nous devons installer les packages suivants :"),e.k0s(),e.j41(169,"pre")(170,"code",13),e.EFF(171,"\n$ npm i --save @fastify/static @fastify/view handlebars\n"),e.k0s()(),e.j41(172,"p"),e.EFF(173,"Les \xe9tapes suivantes couvrent presque le m\xeame processus utilis\xe9 avec Express, avec des diff\xe9rences mineures sp\xe9cifiques \xe0 la plateforme. Une fois le processus d'installation termin\xe9, ouvrez le fichier "),e.j41(174,"code"),e.EFF(175,"main.ts"),e.k0s(),e.EFF(176," et mettez \xe0 jour son contenu :"),e.k0s(),e.j41(177,"app-copy-button",16)(178,"span",17),e.EFF(179),e.nI1(180,"extension"),e.nrm(181,"app-tabs",null,4),e.k0s(),e.j41(183,"pre")(184,"code",18),e.EFF(185,"\nimport { NestFactory } from '@nestjs/core';\nimport { NestFastifyApplication, FastifyAdapter } from '@nestjs/platform-fastify';\nimport { AppModule } from './app.module';\nimport { join } from 'path';\n\nasync function bootstrap() {\n  const app = await NestFactory.create<NestFastifyApplication>(\n    AppModule,\n    new FastifyAdapter(),\n  );\n  app.useStaticAssets({\n    root: join(__dirname, '..', 'public'),\n    prefix: '/public/',\n  });\n  app.setViewEngine({\n    engine: {\n      handlebars: require('handlebars'),\n    },\n    templates: join(__dirname, '..', 'views'),\n  });\n  await app.listen(process.env.PORT ?? 3000);\n}\nbootstrap();\n"),e.k0s()(),e.j41(186,"pre")(187,"code",18),e.EFF(188,"\nimport { NestFactory } from '@nestjs/core';\nimport { FastifyAdapter } from '@nestjs/platform-fastify';\nimport { AppModule } from './app.module';\nimport { join } from 'path';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule, new FastifyAdapter());\n  app.useStaticAssets({\n    root: join(__dirname, '..', 'public'),\n    prefix: '/public/',\n  });\n  app.setViewEngine({\n    engine: {\n      handlebars: require('handlebars'),\n    },\n    templates: join(__dirname, '..', 'views'),\n  });\n  await app.listen(process.env.PORT ?? 3000);\n}\nbootstrap();\n"),e.k0s()()(),e.j41(189,"p"),e.EFF(190,"L'API Fastify a quelques diff\xe9rences, mais le r\xe9sultat final de ces appels de m\xe9thode est le m\xeame. Une diff\xe9rence notable est que lorsque vous utilisez Fastify, le nom du mod\xe8le que vous passez dans le d\xe9corateur "),e.j41(191,"code"),e.EFF(192,"@Render()"),e.k0s(),e.EFF(193," doit inclure l'extension du fichier."),e.k0s(),e.j41(194,"p"),e.EFF(195,"Voici comment vous pouvez le configurer :"),e.k0s(),e.j41(196,"app-copy-button",16)(197,"span",17),e.EFF(198),e.nI1(199,"extension"),e.nrm(200,"app-tabs",null,5),e.k0s(),e.j41(202,"pre")(203,"code",18),e.EFF(204,"\nimport { Get, Controller, Render } from '@nestjs/common';\n\n@Controller()\nexport class AppController {\n  @Get()\n  @Render('index.hbs')\n  root() {\n    return { message: 'Hello world!' };\n  }\n}\n"),e.k0s()()(),e.j41(205,"p"),e.EFF(206,"Alternativement, vous pouvez utiliser le d\xe9corateur "),e.j41(207,"code"),e.EFF(208,"@Res()"),e.k0s(),e.EFF(209," pour injecter directement la r\xe9ponse et sp\xe9cifier la vue que vous voulez rendre, comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(210,"app-copy-button")(211,"pre")(212,"code",18),e.EFF(213,"\nimport { Res } from '@nestjs/common';\nimport { FastifyReply } from 'fastify';\n\n@Get()\nroot(@Res() res: FastifyReply) {\n  return res.view('index.hbs', { title: 'Hello world!' });\n}\n"),e.k0s()()(),e.j41(214,"p"),e.EFF(215,"Pendant que l'application fonctionne, ouvrez votre navigateur et naviguez jusqu'\xe0 "),e.j41(216,"code"),e.EFF(217,"http://localhost:3000"),e.k0s(),e.EFF(218,". Vous devriez voir le message "),e.j41(219,"code"),e.EFF(220,"Hello world!"),e.k0s(),e.EFF(221,"."),e.k0s(),e.j41(222,"h4",29)(223,"span"),e.EFF(224,"Exemple"),e.k0s()(),e.j41(225,"p"),e.EFF(226,"Un exemple concret est disponible "),e.j41(227,"a",30),e.EFF(228,"ici"),e.k0s(),e.EFF(229,"."),e.k0s()()),2&o){const u=e.sdS(41),r=e.sdS(92),p=e.sdS(146),l=e.sdS(182),d=e.sdS(201);e.R7$(38),e.SpI(" ",e.i5U(39,14,"main",u.isJsActive),"\n"),e.R7$(4),e.AVh("hide",u.isJsActive),e.R7$(3),e.AVh("hide",!u.isJsActive),e.R7$(33),e.SpI('\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset="utf-8" />\n    <title>App</title>\n  </head>\n  <body>\n    ',"{{ message }}","\n  </body>\n</html>\n"),e.R7$(11),e.SpI(" ",e.i5U(90,17,"app.controller",r.isJsActive),"\n"),e.R7$(54),e.SpI(" ",e.i5U(144,20,"app.controller",p.isJsActive),"\n"),e.R7$(36),e.SpI(" ",e.i5U(180,23,"main",l.isJsActive),"\n"),e.R7$(4),e.AVh("hide",l.isJsActive),e.R7$(3),e.AVh("hide",!l.isJsActive),e.R7$(12),e.SpI(" ",e.i5U(199,26,"app.controller",d.isJsActive),"\n")}},dependencies:[E.O,i.a,c.z,j.Wk,k.M],encapsulation:2,changeDetection:0})}return s})(),B=(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-performance"]],features:[e.Vt3],decls:191,vars:12,consts:[["contentReference",""],["app061a365ae98f74b38a27417780e92729c20fae10",""],["app428a22612beaa2002f55b12d0a38edda165dc123",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/performance.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","performance-fastify"],["rel","nofollow","target","_blank","href","https://expressjs.com/"],["rel","nofollow","target","_blank","href","https://github.com/fastify/fastify"],[1,"info"],["appAnchor","","id","installation"],[1,"language-bash"],["appAnchor","","id","adaptateur"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],["rel","nofollow","target","_blank","href","https://www.fastify.io/docs/latest/Guides/Getting-Started/#your-first-server"],["appAnchor","","id","packages-sp\xe9cifiques-\xe0-la-plate-forme"],["appAnchor","","id","r\xe9ponse-de-redirection"],["appAnchor","","id","options-fastify"],["appAnchor","","id","middleware"],["rel","nofollow","target","_blank","href","https://www.fastify.io/docs/latest/Reference/Middleware/"],["appAnchor","","id","configuration-de-route"],["rel","nofollow","target","_blank","href","https://fastify.dev/docs/latest/Reference/Routes/#config"],["appAnchor","","id","contraintes-de-routes"],["rel","nofollow","target","_blank","href","https://fastify.dev/docs/latest/Reference/Routes/#constraints"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/10-fastify"]],template:function(o,t){if(1&o&&(e.j41(0,"div",3,0)(2,"div",4)(3,"a",5),e.nrm(4,"i",6),e.k0s()(),e.j41(5,"h3",7),e.EFF(6,"Performance (Fastify)"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Par d\xe9faut, Nest utilise le framework "),e.j41(9,"a",8),e.EFF(10,"Express"),e.k0s(),e.EFF(11,". Comme mentionn\xe9 pr\xe9c\xe9demment, Nest offre \xe9galement une compatibilit\xe9 avec d'autres biblioth\xe8ques telles que, par exemple, "),e.j41(12,"a",9),e.EFF(13,"Fastify"),e.k0s(),e.EFF(14,". Nest r\xe9alise cette ind\xe9pendance vis-\xe0-vis du framework en impl\xe9mentant un adaptateur de framework dont la fonction principale est de fournir un middleware et des gestionnaires \xe0 des impl\xe9mentations appropri\xe9es sp\xe9cifiques \xe0 la biblioth\xe8que."),e.k0s(),e.j41(15,"blockquote",10)(16,"strong"),e.EFF(17,"Astuce"),e.k0s(),e.EFF(18," Notez que pour qu'un adaptateur de framework soit mis en \u0153uvre, la biblioth\xe8que cible doit fournir un traitement de pipeline requ\xeate/r\xe9ponse similaire \xe0 celui que l'on trouve dans Express.\n"),e.k0s(),e.j41(19,"p")(20,"a",9),e.EFF(21,"Fastify"),e.k0s(),e.EFF(22," fournit un bon framework alternatif \xe0 Nest car il r\xe9sout les probl\xe8mes de conception d'une mani\xe8re similaire \xe0 Express. Cependant, fastify est bien "),e.j41(23,"strong"),e.EFF(24,"plus rapide"),e.k0s(),e.EFF(25," qu'Express, obtenant des r\xe9sultats presque deux fois meilleurs. Une question l\xe9gitime est de savoir pourquoi Nest utilise Express comme fournisseur HTTP par d\xe9faut ? La raison est qu'Express est largement utilis\xe9, bien connu, et qu'il dispose d'un \xe9norme ensemble de middlewares compatibles, qui sont disponibles pour les utilisateurs de Nest imm\xe9diatement."),e.k0s(),e.j41(26,"p"),e.EFF(27,"Mais comme Nest est ind\xe9pendant du framework, vous pouvez facilement passer de l'un \xe0 l'autre. Fastify peut \xeatre un meilleur choix lorsque vous accordez une grande importance \xe0 des performances tr\xe8s rapides. Pour utiliser Fastify, il suffit de choisir l'adaptateur int\xe9gr\xe9 "),e.j41(28,"code"),e.EFF(29,"FastifyAdapter"),e.k0s(),e.EFF(30," comme montr\xe9 dans ce chapitre."),e.k0s(),e.j41(31,"h4",11)(32,"span"),e.EFF(33,"Installation"),e.k0s()(),e.j41(34,"p"),e.EFF(35,"Tout d'abord, nous devons installer le package requis :"),e.k0s(),e.j41(36,"pre")(37,"code",12),e.EFF(38,"\n$ npm i --save @nestjs/platform-fastify\n"),e.k0s()(),e.j41(39,"h4",13)(40,"span"),e.EFF(41,"Adaptateur"),e.k0s()(),e.j41(42,"p"),e.EFF(43,"Une fois la plateforme Fastify install\xe9e, nous pouvons utiliser le "),e.j41(44,"code"),e.EFF(45,"FastifyAdapter"),e.k0s(),e.EFF(46,"."),e.k0s(),e.j41(47,"app-copy-button",14)(48,"span",15),e.EFF(49),e.nI1(50,"extension"),e.nrm(51,"app-tabs",null,1),e.k0s(),e.j41(53,"pre")(54,"code",16),e.EFF(55,"\nimport { NestFactory } from '@nestjs/core';\nimport {\n  FastifyAdapter,\n  NestFastifyApplication,\n} from '@nestjs/platform-fastify';\nimport { AppModule } from './app.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.create<NestFastifyApplication>(\n    AppModule,\n    new FastifyAdapter()\n  );\n  await app.listen(process.env.PORT ?? 3000);\n}\nbootstrap();\n"),e.k0s()()(),e.j41(56,"p"),e.EFF(57,"Par d\xe9faut, Fastify n'\xe9coute que sur l'interface "),e.j41(58,"code"),e.EFF(59,"localhost 127.0.0.1"),e.k0s(),e.EFF(60," ("),e.j41(61,"a",17),e.EFF(62,"en savoir plus"),e.k0s(),e.EFF(63,"). Si vous voulez accepter des connexions sur d'autres h\xf4tes, vous devez sp\xe9cifier "),e.j41(64,"code"),e.EFF(65,"'0.0.0.0'"),e.k0s(),e.EFF(66," dans l'appel "),e.j41(67,"code"),e.EFF(68,"listen()"),e.k0s(),e.EFF(69," :"),e.k0s(),e.j41(70,"app-copy-button")(71,"pre")(72,"code",16),e.EFF(73,"\nasync function bootstrap() {\n  const app = await NestFactory.create<NestFastifyApplication>(\n    AppModule,\n    new FastifyAdapter(),\n  );\n  await app.listen(3000, '0.0.0.0');\n}\n"),e.k0s()()(),e.j41(74,"h4",18)(75,"span"),e.EFF(76,"Packages sp\xe9cifiques \xe0 la plate-forme"),e.k0s()(),e.j41(77,"p"),e.EFF(78,"Gardez \xe0 l'esprit que lorsque vous utilisez le "),e.j41(79,"code"),e.EFF(80,"FastifyAdapter"),e.k0s(),e.EFF(81,", Nest utilise Fastify comme "),e.j41(82,"strong"),e.EFF(83,"fournisseur HTTP"),e.k0s(),e.EFF(84,". Cela signifie que toutes les recettes qui s'appuient sur Express peuvent ne plus fonctionner. Vous devez, \xe0 la place, utiliser des packages \xe9quivalents \xe0 Fastify."),e.k0s(),e.j41(85,"h4",19)(86,"span"),e.EFF(87,"R\xe9ponse de redirection"),e.k0s()(),e.j41(88,"p"),e.EFF(89,"Fastify g\xe8re les r\xe9ponses de redirection l\xe9g\xe8rement diff\xe9remment d'Express. Pour effectuer une redirection correcte avec Fastify, renvoyez le code d'\xe9tat et l'URL, comme suit :"),e.k0s(),e.j41(90,"app-copy-button")(91,"pre")(92,"code",16),e.EFF(93,"\n@Get()\nindex(@Res() res) {\n  res.status(302).redirect('/login');\n}\n"),e.k0s()()(),e.j41(94,"h4",20)(95,"span"),e.EFF(96,"Options Fastify"),e.k0s()(),e.j41(97,"p"),e.EFF(98,"Vous pouvez passer des options au constructeur de Fastify \xe0 travers le constructeur "),e.j41(99,"code"),e.EFF(100,"FastifyAdapter"),e.k0s(),e.EFF(101,". Par exemple :"),e.k0s(),e.j41(102,"app-copy-button")(103,"pre")(104,"code",16),e.EFF(105,"\nnew FastifyAdapter({ logger: true });\n"),e.k0s()()(),e.j41(106,"h4",21)(107,"span"),e.EFF(108,"Middleware"),e.k0s()(),e.j41(109,"p"),e.EFF(110,"Les fonctions du middleware r\xe9cup\xe8rent les objets "),e.j41(111,"code"),e.EFF(112,"req"),e.k0s(),e.EFF(113," et "),e.j41(114,"code"),e.EFF(115,"res"),e.k0s(),e.EFF(116," bruts au lieu des wrappers de Fastify. C'est ainsi que fonctionne le package "),e.j41(117,"code"),e.EFF(118,"middie"),e.k0s(),e.EFF(119," (qui est utilis\xe9 sous le capot) et "),e.j41(120,"code"),e.EFF(121,"fastify"),e.k0s(),e.EFF(122," - consultez cette "),e.j41(123,"a",22),e.EFF(124,"page"),e.k0s(),e.EFF(125," pour plus d'informations,"),e.k0s(),e.j41(126,"app-copy-button",14)(127,"span",15),e.EFF(128),e.nI1(129,"extension"),e.nrm(130,"app-tabs",null,2),e.k0s(),e.j41(132,"pre")(133,"code",16),e.EFF(134,"\nimport { Injectable, NestMiddleware } from '@nestjs/common';\nimport { FastifyRequest, FastifyReply } from 'fastify';\n\n@Injectable()\nexport class LoggerMiddleware implements NestMiddleware {\n  use(req: FastifyRequest['raw'], res: FastifyReply['raw'], next: () => void) {\n    console.log('Request...');\n    next();\n  }\n}\n"),e.k0s()(),e.j41(135,"pre")(136,"code",16),e.EFF(137,"\nimport { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class LoggerMiddleware {\n  use(req, res, next) {\n    console.log('Request...');\n    next();\n  }\n}\n"),e.k0s()()(),e.j41(138,"h4",23)(139,"span"),e.EFF(140,"Configuration de route"),e.k0s()(),e.j41(141,"p"),e.EFF(142,"Vous pouvez la fonctionnalit\xe9 de "),e.j41(143,"a",24),e.EFF(144,"configuration de route"),e.k0s(),e.EFF(145," de Fastify avec le d\xe9corateur "),e.j41(146,"code"),e.EFF(147,"@RouteConfig()"),e.k0s(),e.EFF(148,"."),e.k0s(),e.j41(149,"app-copy-button")(150,"pre")(151,"code",16),e.EFF(152,"\n@RouteConfig({ output: 'hello world' })\n@Get()\nindex(@Req() req) {\n  return req.routeConfig.output;\n}\n"),e.k0s()()(),e.j41(153,"h4",25)(154,"span"),e.EFF(155,"Contraintes de routes"),e.k0s()(),e.j41(156,"p"),e.EFF(157,"Depuis la version 10.3.0, "),e.j41(158,"code"),e.EFF(159,"@nestjs/platform-fastify"),e.k0s(),e.EFF(160," supporte la fonctionnalit\xe9 de "),e.j41(161,"a",26),e.EFF(162,"contraintes de routes"),e.k0s(),e.EFF(163," de Fastify avec le d\xe9corateur "),e.j41(164,"code"),e.EFF(165,"@RouteConstraints"),e.k0s(),e.EFF(166,"."),e.k0s(),e.j41(167,"app-copy-button")(168,"pre")(169,"code",16),e.EFF(170,"\n@RouteConstraints({ version: '1.2.x' })\nnewFeature() {\n  return 'Cela ne fonctionne que pour les versions >= 1.2.x';\n}\n"),e.k0s()()(),e.j41(171,"blockquote",10)(172,"strong"),e.EFF(173,"Astuce"),e.k0s(),e.j41(174,"code"),e.EFF(175,"@RouteConfig()"),e.k0s(),e.EFF(176," et "),e.j41(177,"code"),e.EFF(178,"@RouteConstraints"),e.k0s(),e.EFF(179," sont import\xe9s de "),e.j41(180,"code"),e.EFF(181,"@nestjs/platform-fastify"),e.k0s(),e.EFF(182,".\n"),e.k0s(),e.j41(183,"h4",27)(184,"span"),e.EFF(185,"Exemple"),e.k0s()(),e.j41(186,"p"),e.EFF(187,"Un exemple concret est disponible "),e.j41(188,"a",28),e.EFF(189,"ici"),e.k0s(),e.EFF(190,"."),e.k0s()()),2&o){const u=e.sdS(52),r=e.sdS(131);e.R7$(49),e.SpI(" ",e.i5U(50,6,"main",u.isJsActive),"\n"),e.R7$(79),e.SpI(" ",e.i5U(129,9,"logger.middleware",r.isJsActive),"\n"),e.R7$(4),e.AVh("hide",r.isJsActive),e.R7$(3),e.AVh("hide",!r.isJsActive)}},dependencies:[E.O,i.a,c.z,k.M],encapsulation:2,changeDetection:0})}return s})();var x=F(8149);const J=[{path:"authentication",redirectTo:"/security/authentication"},{path:"mvc",component:_,data:{title:"Mod\xe8le-Vue-Contr\xf4leur"}},{path:"serialization",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-serialization"]],features:[e.Vt3],decls:206,vars:2,consts:[["contentReference",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/serialization.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","s\xe9rialisation"],["appAnchor","","id","vue-densemble"],["rel","nofollow","target","_blank","href","https://github.com/typestack/class-transformer"],[1,"info"],["rel","nofollow","target","_blank","href","https://docs.nestjs.com/techniques/streaming-files#streamable-file-class"],["appAnchor","","id","exclure-des-propri\xe9t\xe9s"],[1,"language-typescript"],[1,""],[1,"language-json"],["rel","nofollow","target","_blank","href","https://docs.nestjs.com/interceptors#binding-interceptors"],["appAnchor","","id","exposer-des-propri\xe9t\xe9s"],["appAnchor","","id","transformer"],["appAnchor","","id","passer-des-options"],["appAnchor","","id","transformer-des-objets-simples"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/21-serializer"],["appAnchor","","id","websockets-et-microservices"],["appAnchor","","id","en-savoir-plus"]],template:function(o,t){1&o&&(e.j41(0,"div",1,0)(2,"div",2)(3,"a",3),e.nrm(4,"i",4),e.k0s()(),e.j41(5,"h3",5),e.EFF(6,"S\xe9rialisation"),e.k0s(),e.j41(7,"p"),e.EFF(8,"La s\xe9rialisation est un processus qui se d\xe9roule avant que les objets ne soient renvoy\xe9s dans une r\xe9ponse r\xe9seau. Il s'agit d'un endroit appropri\xe9 pour fournir des r\xe8gles de transformation et d'assainissement des donn\xe9es \xe0 renvoyer au client. Par exemple, les donn\xe9es sensibles telles que les mots de passe doivent toujours \xeatre exclues de la r\xe9ponse. Par ailleurs, certaines propri\xe9t\xe9s peuvent n\xe9cessiter une transformation suppl\xe9mentaire, comme l'envoi d'un sous-ensemble de propri\xe9t\xe9s d'une entit\xe9. Effectuer ces transformations manuellement peut s'av\xe9rer fastidieux et source d'erreurs, et peut vous laisser dans l'incertitude que tous les cas ont \xe9t\xe9 pris en compte."),e.k0s(),e.j41(9,"h4",6)(10,"span"),e.EFF(11,"Vue d'ensemble"),e.k0s()(),e.j41(12,"p"),e.EFF(13,"Nest fournit une fonctionnalit\xe9 int\xe9gr\xe9e qui permet de s'assurer que ces op\xe9rations peuvent \xeatre effectu\xe9es de mani\xe8re simple. L'intercepteur "),e.j41(14,"code"),e.EFF(15,"ClassSerializerInterceptor"),e.k0s(),e.EFF(16," utilise le puissant package "),e.j41(17,"a",7),e.EFF(18,"class-transformer"),e.k0s(),e.EFF(19," pour fournir un moyen d\xe9claratif et extensible de transformer les objets. L'op\xe9ration de base qu'il effectue est de prendre la valeur retourn\xe9e par un gestionnaire de m\xe9thode et d'appliquer la fonction "),e.j41(20,"code"),e.EFF(21,"instanceToPlain()"),e.k0s(),e.EFF(22," de "),e.j41(23,"a",7),e.EFF(24,"class-transformer"),e.k0s(),e.EFF(25,". Ce faisant, il peut appliquer les r\xe8gles exprim\xe9es par les d\xe9corateurs "),e.j41(26,"code"),e.EFF(27,"class-transformer"),e.k0s(),e.EFF(28," sur une classe entit\xe9/DTO, comme d\xe9crit ci-dessous."),e.k0s(),e.j41(29,"blockquote",8)(30,"strong"),e.EFF(31,"Astuce"),e.k0s(),e.EFF(32," La s\xe9rialisation ne s'applique pas aux r\xe9ponses "),e.j41(33,"a",9),e.EFF(34,"StreamableFile"),e.k0s(),e.EFF(35,".\n"),e.k0s(),e.j41(36,"h4",10)(37,"span"),e.EFF(38,"Exclure des propri\xe9t\xe9s"),e.k0s()(),e.j41(39,"p"),e.EFF(40,"Supposons que nous voulions exclure automatiquement une propri\xe9t\xe9 "),e.j41(41,"code"),e.EFF(42,"password"),e.k0s(),e.EFF(43," d'une entit\xe9 utilisateur. Nous annotons l'entit\xe9 comme suit :"),e.k0s(),e.j41(44,"app-copy-button")(45,"pre")(46,"code",11),e.EFF(47,"\nimport { Exclude } from 'class-transformer';\n\nexport class UserEntity {\n  id: number;\n  firstName: string;\n  lastName: string;\n\n  @Exclude()\n  password: string;\n\n  constructor(partial: Partial<UserEntity>) {\n    Object.assign(this, partial);\n  }\n}\n"),e.k0s()()(),e.j41(48,"p"),e.EFF(49,"Consid\xe9rons maintenant un contr\xf4leur avec un gestionnaire de m\xe9thode qui renvoie une instance de cette classe."),e.k0s(),e.j41(50,"app-copy-button")(51,"pre")(52,"code",11),e.EFF(53,"\n@UseInterceptors(ClassSerializerInterceptor)\n@Get()\nfindOne(): UserEntity {\n  return new UserEntity({\n    id: 1,\n    firstName: 'John',\n    lastName: 'Doe',\n    password: 'password',\n  });\n}\n"),e.k0s()()(),e.j41(54,"blockquote",12)(55,"strong"),e.EFF(56,"Attention"),e.k0s(),e.EFF(57," Notez que nous devons renvoyer une instance de la classe. Si vous renvoyez un simple objet JavaScript, par exemple, "),e.j41(58,"code"),e.EFF(59),e.k0s(),e.EFF(60,", l'objet ne sera pas correctement s\xe9rialis\xe9.\n"),e.k0s(),e.j41(61,"blockquote",8)(62,"strong"),e.EFF(63,"Astuce"),e.k0s(),e.EFF(64," La classe "),e.j41(65,"code"),e.EFF(66,"ClassSerializerInterceptor"),e.k0s(),e.EFF(67," est import\xe9e de "),e.j41(68,"code"),e.EFF(69,"@nestjs/common"),e.k0s(),e.EFF(70,".\n"),e.k0s(),e.j41(71,"p"),e.EFF(72,"Lorsque ce point d'acc\xe8s est sollicit\xe9, le client re\xe7oit la r\xe9ponse suivante :"),e.k0s(),e.j41(73,"pre")(74,"code",13),e.EFF(75,'\n{\n  "id": 1,\n  "firstName": "John",\n  "lastName": "Doe"\n}\n'),e.k0s()(),e.j41(76,"p"),e.EFF(77,"Notez que l'intercepteur peut \xeatre appliqu\xe9 \xe0 l'ensemble de l'application (comme indiqu\xe9 "),e.j41(78,"a",14),e.EFF(79,"ici"),e.k0s(),e.EFF(80,"). La combinaison de l'intercepteur et de la d\xe9claration de la classe d'entit\xe9 assure que **n'importe quelle m\xe9thode qui retourne une "),e.j41(81,"code"),e.EFF(82,"UserEntity"),e.k0s(),e.EFF(83," sera s\xfbre de supprimer la propri\xe9t\xe9 "),e.j41(84,"code"),e.EFF(85,"password"),e.k0s(),e.EFF(86,". Cela permet de centraliser l'application de cette r\xe8gle de gestion."),e.k0s(),e.j41(87,"h4",15)(88,"span"),e.EFF(89,"Exposer des propri\xe9t\xe9s"),e.k0s()(),e.j41(90,"p"),e.EFF(91,"Vous pouvez utiliser le d\xe9corateur "),e.j41(92,"code"),e.EFF(93,"@Expose()"),e.k0s(),e.EFF(94," pour fournir des noms d'alias pour les propri\xe9t\xe9s, ou pour ex\xe9cuter une fonction afin de calculer la valeur d'une propri\xe9t\xe9 (analogue aux fonctions "),e.j41(95,"strong"),e.EFF(96,"getter"),e.k0s(),e.EFF(97,"), comme illustr\xe9 ci-dessous."),e.k0s(),e.j41(98,"app-copy-button")(99,"pre")(100,"code",11),e.EFF(101,"\n@Expose()\nget fullName(): string {\n  return `${this.firstName} ${this.lastName}`;\n}\n"),e.k0s()()(),e.j41(102,"h4",16)(103,"span"),e.EFF(104,"Transformer"),e.k0s()(),e.j41(105,"p"),e.EFF(106,"Vous pouvez effectuer des transformations de donn\xe9es suppl\xe9mentaires en utilisant le d\xe9corateur "),e.j41(107,"code"),e.EFF(108,"@Transform()"),e.k0s(),e.EFF(109,". Par exemple, la construction suivante renvoie la propri\xe9t\xe9 name de l'entit\xe9 "),e.j41(110,"code"),e.EFF(111,"RoleEntity"),e.k0s(),e.EFF(112," au lieu de renvoyer l'objet entier."),e.k0s(),e.j41(113,"app-copy-button")(114,"pre")(115,"code",11),e.EFF(116,"\n@Transform(({ value }) => value.name)\nrole: RoleEntity;\n"),e.k0s()()(),e.j41(117,"h4",17)(118,"span"),e.EFF(119,"Passer des options"),e.k0s()(),e.j41(120,"p"),e.EFF(121,"Vous pouvez vouloir modifier le comportement par d\xe9faut des fonctions de transformation. Pour surcharger les param\xe8tres par d\xe9faut, passez-les dans un objet "),e.j41(122,"code"),e.EFF(123,"options"),e.k0s(),e.EFF(124," avec le d\xe9corateur "),e.j41(125,"code"),e.EFF(126,"@SerializeOptions()"),e.k0s(),e.EFF(127,"."),e.k0s(),e.j41(128,"app-copy-button")(129,"pre")(130,"code",11),e.EFF(131,"\n@SerializeOptions({\n  excludePrefixes: ['_'],\n})\n@Get()\nfindOne(): UserEntity {\n  return new UserEntity();\n}\n"),e.k0s()()(),e.j41(132,"blockquote",8)(133,"strong"),e.EFF(134,"Astuce"),e.k0s(),e.EFF(135," Le d\xe9corateur "),e.j41(136,"code"),e.EFF(137,"@SerializeOptions()"),e.k0s(),e.EFF(138," est import\xe9 de "),e.j41(139,"code"),e.EFF(140,"@nestjs/common"),e.k0s(),e.EFF(141,".\n"),e.k0s(),e.j41(142,"p"),e.EFF(143,"Les options pass\xe9es via "),e.j41(144,"code"),e.EFF(145,"@SerializeOptions()"),e.k0s(),e.EFF(146," sont pass\xe9es en tant que second argument de la fonction sous-jacente "),e.j41(147,"code"),e.EFF(148,"instanceToPlain()"),e.k0s(),e.EFF(149,". Dans cet exemple, nous excluons automatiquement toutes les propri\xe9t\xe9s qui commencent par le pr\xe9fixe "),e.j41(150,"code"),e.EFF(151,"_"),e.k0s(),e.EFF(152,"."),e.k0s(),e.j41(153,"h4",18)(154,"span"),e.EFF(155,"Transformer des objets simples"),e.k0s()(),e.j41(156,"p"),e.EFF(157,"Vous pouvez imposer des transformations au niveau du contr\xf4leur en utilisant le d\xe9corateur "),e.j41(158,"code"),e.EFF(159,"@SerializeOptions"),e.k0s(),e.EFF(160,". Cela garantit que toutes les r\xe9ponses sont transform\xe9es en instances de la classe sp\xe9cifi\xe9e, en appliquant tous les d\xe9corateurs de class-validator ou class-transformer, m\xeame lorsque des objets simples sont retourn\xe9s. Cette approche conduit \xe0 un code plus propre sans avoir besoin de r\xe9p\xe9ter l'instanciation de la classe ou d'appeler "),e.j41(161,"code"),e.EFF(162,"plainToInstance"),e.k0s(),e.EFF(163,"."),e.k0s(),e.j41(164,"p"),e.EFF(165,"Dans l'exemple ci-dessous, malgr\xe9 le retour d'objets JavaScript simples dans les deux branches conditionnelles, ils seront automatiquement convertis en instances "),e.j41(166,"code"),e.EFF(167,"UserEntity"),e.k0s(),e.EFF(168,", avec les d\xe9corateurs appropri\xe9s appliqu\xe9s :"),e.k0s(),e.j41(169,"app-copy-button")(170,"pre")(171,"code",11),e.EFF(172,"\n@UseInterceptors(ClassSerializerInterceptor)\n@SerializeOptions({ type: UserEntity })\n@Get()\nfindOne(@Query() { id }: { id: number }): UserEntity {\n  if (id === 1) {\n    return {\n      id: 1,\n      firstName: 'John',\n      lastName: 'Doe',\n      password: 'password',\n    };\n  }\n\n  return {\n    id: 2,\n    firstName: 'Kamil',\n    lastName: 'Mysliwiec',\n    password: 'password2',\n  };\n}\n"),e.k0s()()(),e.j41(173,"blockquote",8)(174,"strong"),e.EFF(175,"Astuce"),e.k0s(),e.EFF(176," En sp\xe9cifiant le type de retour attendu pour le contr\xf4leur, vous pouvez exploiter les capacit\xe9s de v\xe9rification de type de TypeScript pour vous assurer que l'objet simple renvoy\xe9 adh\xe8re \xe0 la forme du DTO ou de l'entit\xe9. La fonction "),e.j41(177,"code"),e.EFF(178,"plainToInstance"),e.k0s(),e.EFF(179," ne fournit pas ce niveau d'indication de type, ce qui peut conduire \xe0 des bugs potentiels si l'objet simple ne correspond pas \xe0 la structure attendue du DTO ou de l'entit\xe9.\n"),e.k0s(),e.j41(180,"h4",19)(181,"span"),e.EFF(182,"Exemple"),e.k0s()(),e.j41(183,"p"),e.EFF(184,"Un exemple concret est disponible "),e.j41(185,"a",20),e.EFF(186,"ici"),e.k0s(),e.EFF(187,"."),e.k0s(),e.j41(188,"h4",21)(189,"span"),e.EFF(190,"WebSockets et Microservices"),e.k0s()(),e.j41(191,"p"),e.EFF(192,"Bien que ce chapitre montre des exemples utilisant des applications de type HTTP (par exemple, Express ou Fastify), le "),e.j41(193,"code"),e.EFF(194,"ClassSerializerInterceptor"),e.k0s(),e.EFF(195," fonctionne de la m\xeame mani\xe8re pour les WebSockets et les Microservices, quelle que soit la m\xe9thode de transport utilis\xe9e."),e.k0s(),e.j41(196,"h4",22)(197,"span"),e.EFF(198,"En savoir plus"),e.k0s()(),e.j41(199,"p"),e.EFF(200,"Pour en savoir plus sur les d\xe9corateurs et options disponibles dans le package "),e.j41(201,"code"),e.EFF(202,"class-transformer"),e.k0s(),e.j41(203,"a",7),e.EFF(204,"lisez ceci"),e.k0s(),e.EFF(205,"."),e.k0s()()),2&o&&(e.R7$(59),e.Lme("","{"," user : new UserEntity() ","}",""))},dependencies:[i.a,c.z],encapsulation:2,changeDetection:0})}return s})(),data:{title:"S\xe9rialisation"}},{path:"caching",component:L,data:{title:"Gestion du cache"}},{path:"validation",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-validation"]],features:[e.Vt3],decls:775,vars:8,consts:[["contentReference",""],["appb983077c9e56a2cb9dcd82728046b38a19ae4315",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/validation.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","validation"],["rel","nofollow","target","_blank","href","https://github.com/typestack/class-validator"],["appAnchor","","id","aper\xe7u"],["routerLink","/pipes"],["appAnchor","","id","utilisation-du-validationpipe-int\xe9gr\xe9"],[1,"language-bash"],[1,"info"],["rel","nofollow","target","_blank","href","https://github.com/typestack/class-transformer"],[1,"language-typescript"],["appAnchor","","id","validation-automatique"],["rel","nofollow","target","_blank","href","https://github.com/typestack/class-validator#validation-decorators"],[1,"language-json"],["appAnchor","","id","d\xe9sactivation-des-erreurs-d\xe9taill\xe9es"],["appAnchor","","id","exclusion-de-propri\xe9t\xe9s"],["appAnchor","","id","transformer-les-objets-de-charge-utile-payloads"],[1,"with-heading"],[1,"filename"],["appAnchor","","id","conversion-explicite"],["appAnchor","","id","types-mapp\xe9s"],[1,""],["routerLink","/openapi/mapped-types"],["routerLink","/graphql/mapped-types"],["appAnchor","","id","analyse-et-validation-des-tableaux"],["appAnchor","","id","websockets-et-microservices"],["appAnchor","","id","en-savoir-plus"]],template:function(o,t){if(1&o&&(e.j41(0,"div",2,0)(2,"div",3)(3,"a",4),e.nrm(4,"i",5),e.k0s()(),e.j41(5,"h3",6),e.EFF(6,"Validation"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Il est fortement recommand\xe9 de valider la v\xe9racit\xe9 de toutes les donn\xe9es envoy\xe9es \xe0 une application web. Pour valider automatiquement les requ\xeates entrantes, Nest propose plusieurs pipes imm\xe9diatement pr\xeats \xe0 l'emploi :"),e.k0s(),e.j41(9,"ul")(10,"li")(11,"code"),e.EFF(12,"ValidationPipe"),e.k0s()(),e.j41(13,"li")(14,"code"),e.EFF(15,"ParseIntPipe"),e.k0s()(),e.j41(16,"li")(17,"code"),e.EFF(18,"ParseBoolPipe"),e.k0s()(),e.j41(19,"li")(20,"code"),e.EFF(21,"ParseArrayPipe"),e.k0s()(),e.j41(22,"li")(23,"code"),e.EFF(24,"ParseUUIDPipe"),e.k0s()()(),e.j41(25,"p"),e.EFF(26,"Le "),e.j41(27,"code"),e.EFF(28,"ValidationPipe"),e.k0s(),e.EFF(29," utilise le puissant paquet "),e.j41(30,"a",7),e.EFF(31,"class-validator"),e.k0s(),e.EFF(32," et ses d\xe9corateurs de validation d\xe9claratifs. Le "),e.j41(33,"code"),e.EFF(34,"ValidationPipe"),e.k0s(),e.EFF(35," offre une approche pratique pour appliquer des r\xe8gles de validation \xe0 toutes les charges utiles (payloads) clients entrantes, o\xf9 les r\xe8gles sp\xe9cifiques sont d\xe9clar\xe9es avec des annotations simples dans les d\xe9clarations de classe/DTO locales de chaque module."),e.k0s(),e.j41(36,"h4",8)(37,"span"),e.EFF(38,"Aper\xe7u"),e.k0s()(),e.j41(39,"p"),e.EFF(40,"Dans le chapitre sur les "),e.j41(41,"a",9),e.EFF(42,"Pipes"),e.k0s(),e.EFF(43,", nous avons parcouru le processus de construction de pipes simples et de leur liaison avec les contr\xf4leurs, les m\xe9thodes ou avec l'application globale pour illustrer comment le processus fonctionne. Assurez-vous de revoir ce chapitre pour mieux comprendre les sujets de ce chapitre. Ici, nous allons nous concentrer sur divers cas d'utilisation du "),e.j41(44,"strong"),e.EFF(45,"monde r\xe9el"),e.k0s(),e.EFF(46," du "),e.j41(47,"code"),e.EFF(48,"ValidationPipe"),e.k0s(),e.EFF(49,", et montrer comment utiliser certaines de ses fonctionnalit\xe9s de personnalisation avanc\xe9es."),e.k0s(),e.j41(50,"h4",10)(51,"span"),e.EFF(52,"Utilisation du ValidationPipe int\xe9gr\xe9"),e.k0s()(),e.j41(53,"p"),e.EFF(54,"Pour commencer \xe0 l'utiliser, nous installons d'abord la d\xe9pendance requise."),e.k0s(),e.j41(55,"pre")(56,"code",11),e.EFF(57,"\n$ npm i --save class-validator class-transformer\n"),e.k0s()(),e.j41(58,"blockquote",12)(59,"strong"),e.EFF(60,"Astuce"),e.k0s(),e.EFF(61," Le "),e.j41(62,"code"),e.EFF(63,"ValidationPipe"),e.k0s(),e.EFF(64," est export\xe9 du paquet "),e.j41(65,"code"),e.EFF(66,"@nestjs/common"),e.k0s(),e.EFF(67,".\n"),e.k0s(),e.j41(68,"p"),e.EFF(69,"Comme ce pipe utilise les librairies "),e.j41(70,"a",7)(71,"code"),e.EFF(72,"class-validator"),e.k0s()(),e.EFF(73," et "),e.j41(74,"a",13)(75,"code"),e.EFF(76,"class-transformer"),e.k0s()(),e.EFF(77,", il y a beaucoup d'options disponibles. Vous configurez ces param\xe8tres via un objet de configuration transmis au pipe. Voici les options int\xe9gr\xe9es disponibles :"),e.k0s(),e.j41(78,"app-copy-button")(79,"pre")(80,"code",14),e.EFF(81,"\nexport interface ValidationPipeOptions extends ValidatorOptions {\n  transform?: boolean;\n  disableErrorMessages?: boolean;\n  exceptionFactory?: (errors: ValidationError[]) => any;\n}\n"),e.k0s()()(),e.j41(82,"p"),e.EFF(83,"En plus de celles-ci, toutes les options de "),e.j41(84,"code"),e.EFF(85,"class-validator"),e.k0s(),e.EFF(86," (h\xe9rit\xe9es de l'interface "),e.j41(87,"code"),e.EFF(88,"ValidatorOptions"),e.k0s(),e.EFF(89,") sont disponibles :"),e.k0s(),e.j41(90,"table")(91,"tr")(92,"th"),e.EFF(93,"Option"),e.k0s(),e.j41(94,"th"),e.EFF(95,"Type"),e.k0s(),e.j41(96,"th"),e.EFF(97,"Description"),e.k0s()(),e.j41(98,"tr")(99,"td")(100,"code"),e.EFF(101,"enableDebugMessages"),e.k0s()(),e.j41(102,"td")(103,"code"),e.EFF(104,"bool\xe9en"),e.k0s()(),e.j41(105,"td"),e.EFF(106,"Si d\xe9fini sur true, le validateur affichera des messages d'avertissement suppl\xe9mentaires dans la console lorsque quelque chose ne va pas."),e.k0s()(),e.j41(107,"tr")(108,"td")(109,"code"),e.EFF(110,"skipUndefinedProperties"),e.k0s()(),e.j41(111,"td")(112,"code"),e.EFF(113,"bool\xe9en"),e.k0s()(),e.j41(114,"td"),e.EFF(115,"Si d\xe9fini sur true, le validateur ignorera la validation de toutes les propri\xe9t\xe9s qui sont ind\xe9finies dans l'objet \xe0 valider."),e.k0s()(),e.j41(116,"tr")(117,"td")(118,"code"),e.EFF(119,"skipNullProperties"),e.k0s()(),e.j41(120,"td")(121,"code"),e.EFF(122,"bool\xe9en"),e.k0s()(),e.j41(123,"td"),e.EFF(124,"Si d\xe9fini sur true, le validateur ignorera la validation de toutes les propri\xe9t\xe9s qui sont nulles dans l'objet \xe0 valider."),e.k0s()(),e.j41(125,"tr")(126,"td")(127,"code"),e.EFF(128,"skipMissingProperties"),e.k0s()(),e.j41(129,"td")(130,"code"),e.EFF(131,"bool\xe9en"),e.k0s()(),e.j41(132,"td"),e.EFF(133,"Si d\xe9fini sur true, le validateur ignorera la validation de toutes les propri\xe9t\xe9s qui sont nulles ou ind\xe9finies dans l'objet \xe0 valider."),e.k0s()(),e.j41(134,"tr")(135,"td")(136,"code"),e.EFF(137,"whitelist"),e.k0s()(),e.j41(138,"td")(139,"code"),e.EFF(140,"bool\xe9en"),e.k0s()(),e.j41(141,"td"),e.EFF(142,"Si d\xe9fini sur true, le validateur supprimera de l'objet valid\xe9 (retourn\xe9) toutes les propri\xe9t\xe9s qui n'utilisent pas de d\xe9corateurs de validation."),e.k0s()(),e.j41(143,"tr")(144,"td")(145,"code"),e.EFF(146,"forbidNonWhitelisted"),e.k0s()(),e.j41(147,"td")(148,"code"),e.EFF(149,"bool\xe9en"),e.k0s()(),e.j41(150,"td"),e.EFF(151,"Si d\xe9fini sur true, au lieu de supprimer les propri\xe9t\xe9s non autoris\xe9es, le validateur l\xe8vera une exception."),e.k0s()(),e.j41(152,"tr")(153,"td")(154,"code"),e.EFF(155,"forbidUnknownValues"),e.k0s()(),e.j41(156,"td")(157,"code"),e.EFF(158,"bool\xe9en"),e.k0s()(),e.j41(159,"td"),e.EFF(160,"Si d\xe9fini sur true, les tentatives de validation d'objets inconnus \xe9chouent imm\xe9diatement."),e.k0s()(),e.j41(161,"tr")(162,"td")(163,"code"),e.EFF(164,"disableErrorMessages"),e.k0s()(),e.j41(165,"td")(166,"code"),e.EFF(167,"bool\xe9en"),e.k0s()(),e.j41(168,"td"),e.EFF(169,"Si d\xe9fini sur true, les erreurs de validation ne seront pas renvoy\xe9es au client."),e.k0s()(),e.j41(170,"tr")(171,"td")(172,"code"),e.EFF(173,"errorHttpStatusCode"),e.k0s()(),e.j41(174,"td")(175,"code"),e.EFF(176,"nombre"),e.k0s()(),e.j41(177,"td"),e.EFF(178,"Ce param\xe8tre vous permet de sp\xe9cifier le type d'exception qui sera utilis\xe9 en cas d'erreur. Par d\xe9faut, il g\xe9n\xe8re l'exception "),e.j41(179,"code"),e.EFF(180,"BadRequestException"),e.k0s(),e.EFF(181,"."),e.k0s()(),e.j41(182,"tr")(183,"td")(184,"code"),e.EFF(185,"exceptionFactory"),e.k0s()(),e.j41(186,"td")(187,"code"),e.EFF(188,"Fonction"),e.k0s()(),e.j41(189,"td"),e.EFF(190,"Prend un tableau d'erreurs de validation et renvoie un objet d'exception."),e.k0s()(),e.j41(191,"tr")(192,"td")(193,"code"),e.EFF(194,"groups"),e.k0s()(),e.j41(195,"td")(196,"code"),e.EFF(197,"string[]"),e.k0s()(),e.j41(198,"td"),e.EFF(199,"Groupes \xe0 utiliser lors de la validation de l'objet."),e.k0s()(),e.j41(200,"tr")(201,"td")(202,"code"),e.EFF(203,"always"),e.k0s()(),e.j41(204,"td")(205,"code"),e.EFF(206,"bool\xe9en"),e.k0s()(),e.j41(207,"td"),e.EFF(208,"D\xe9fini la valeur par d\xe9faut pour l'option "),e.j41(209,"code"),e.EFF(210,"always"),e.k0s(),e.EFF(211," des d\xe9corateurs. La valeur par d\xe9faut peut \xeatre remplac\xe9e dans les options du d\xe9corateur."),e.k0s()(),e.j41(212,"tr")(213,"td")(214,"code"),e.EFF(215,"strictGroups"),e.k0s()(),e.j41(216,"td")(217,"code"),e.EFF(218,"bool\xe9en"),e.k0s()(),e.j41(219,"td"),e.EFF(220,"Si "),e.j41(221,"code"),e.EFF(222,"groups"),e.k0s(),e.EFF(223," n'est pas fourni ou est vide, ignore les d\xe9corateurs ayant au moins un groupe."),e.k0s()(),e.j41(224,"tr")(225,"td")(226,"code"),e.EFF(227,"dismissDefaultMessages"),e.k0s()(),e.j41(228,"td")(229,"code"),e.EFF(230,"bool\xe9en"),e.k0s()(),e.j41(231,"td"),e.EFF(232,"Si d\xe9fini sur true, la validation n'utilisera pas les messages par d\xe9faut. Le message d'erreur sera toujours "),e.j41(233,"code"),e.EFF(234,"undefined"),e.k0s(),e.EFF(235," s'il n'est pas d\xe9fini explicitement."),e.k0s()(),e.j41(236,"tr")(237,"td")(238,"code"),e.EFF(239,"validationError.target"),e.k0s()(),e.j41(240,"td")(241,"code"),e.EFF(242,"bool\xe9en"),e.k0s()(),e.j41(243,"td"),e.EFF(244,"Indique si la cible doit \xeatre expos\xe9e dans "),e.j41(245,"code"),e.EFF(246,"ValidationError"),e.k0s(),e.EFF(247,"."),e.k0s()(),e.j41(248,"tr")(249,"td")(250,"code"),e.EFF(251,"validationError.value"),e.k0s()(),e.j41(252,"td")(253,"code"),e.EFF(254,"bool\xe9en"),e.k0s()(),e.j41(255,"td"),e.EFF(256,"Indique si la valeur valid\xe9e doit \xeatre expos\xe9e dans "),e.j41(257,"code"),e.EFF(258,"ValidationError"),e.k0s(),e.EFF(259,"."),e.k0s()(),e.j41(260,"tr")(261,"td")(262,"code"),e.EFF(263,"stopAtFirstError"),e.k0s()(),e.j41(264,"td")(265,"code"),e.EFF(266,"bool\xe9en"),e.k0s()(),e.j41(267,"td"),e.EFF(268,"Lorsqu'il est d\xe9fini sur true, la validation de la propri\xe9t\xe9 donn\xe9e s'arr\xeatera apr\xe8s avoir rencontr\xe9 la premi\xe8re erreur. Par d\xe9faut, il est d\xe9fini sur false."),e.k0s()()(),e.j41(269,"blockquote",12)(270,"strong"),e.EFF(271,"Remarque"),e.k0s(),e.EFF(272," Trouvez plus d'informations sur le paquet "),e.j41(273,"code"),e.EFF(274,"class-validator"),e.k0s(),e.EFF(275," dans son "),e.j41(276,"a",7),e.EFF(277,"d\xe9p\xf4t"),e.k0s(),e.EFF(278,".\n"),e.k0s(),e.j41(279,"h4",15)(280,"span"),e.EFF(281,"Validation automatique"),e.k0s()(),e.j41(282,"p"),e.EFF(283,"Nous commencerons par lier "),e.j41(284,"code"),e.EFF(285,"ValidationPipe"),e.k0s(),e.EFF(286," au niveau de l'application, garantissant ainsi que tous endpoints sont prot\xe9g\xe9s contre la r\xe9ception de donn\xe9es incorrectes."),e.k0s(),e.j41(287,"app-copy-button")(288,"pre")(289,"code",14),e.EFF(290,"\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  app.useGlobalPipes(new ValidationPipe());\n  await app.listen(process.env.PORT ?? 3000);\n}\nbootstrap();\n"),e.k0s()()(),e.j41(291,"p"),e.EFF(292,"Pour tester notre pipe, cr\xe9ons un endpoint basique."),e.k0s(),e.j41(293,"app-copy-button")(294,"pre")(295,"code",14),e.EFF(296,"\n@Post()\ncreate(@Body() createUserDto: CreateUserDto) {\n  return 'This action adds a new user';\n}\n"),e.k0s()()(),e.j41(297,"blockquote",12)(298,"strong"),e.EFF(299,"Astuce"),e.k0s(),e.EFF(300," \xc9tant donn\xe9 que TypeScript ne stocke pas de m\xe9tadonn\xe9es sur les "),e.j41(301,"strong"),e.EFF(302,"interfaces ou types g\xe9n\xe9riques"),e.k0s(),e.EFF(303,", lorsque vous les utilisez dans vos DTO, "),e.j41(304,"code"),e.EFF(305,"ValidationPipe"),e.k0s(),e.EFF(306," pourrait ne pas \xeatre en mesure de valider correctement les donn\xe9es entrantes. Pour cette raison, envisagez d'utiliser des classes concr\xe8tes dans vos DTO.\n"),e.k0s(),e.j41(307,"blockquote",12)(308,"strong"),e.EFF(309,"Astuce"),e.k0s(),e.EFF(310," Lors de l'importation de vos DTO, vous ne pouvez pas utiliser une importation de type uniquement, car cela serait effac\xe9 \xe0 l'ex\xe9cution, c'est-\xe0-dire rappelez vous d'importer : "),e.j41(311,"code"),e.EFF(312),e.k0s(),e.EFF(313," au lieu de : "),e.j41(314,"code"),e.EFF(315),e.k0s(),e.EFF(316,".\n"),e.k0s(),e.j41(317,"p"),e.EFF(318,"Maintenant, nous pouvons ajouter quelques r\xe8gles de validation dans notre "),e.j41(319,"code"),e.EFF(320,"CreateUserDto"),e.k0s(),e.EFF(321,". Nous le faisons en utilisant des d\xe9corateurs fournis par le paquet "),e.j41(322,"code"),e.EFF(323,"class-validator"),e.k0s(),e.EFF(324,", d\xe9crits en d\xe9tail "),e.j41(325,"a",16),e.EFF(326,"ici"),e.k0s(),e.EFF(327,". De cette mani\xe8re, toute route qui utilise le "),e.j41(328,"code"),e.EFF(329,"CreateUserDto"),e.k0s(),e.EFF(330," appliquera automatiquement ces r\xe8gles de validation."),e.k0s(),e.j41(331,"app-copy-button")(332,"pre")(333,"code",14),e.EFF(334,"\nimport { IsEmail, IsNotEmpty } from 'class-validator';\n\nexport class CreateUserDto {\n  @IsEmail()\n  email: string;\n\n  @IsNotEmpty()\n  password: string;\n}\n"),e.k0s()()(),e.j41(335,"p"),e.EFF(336,"Avec ces r\xe8gles en place, si une requ\xeate atteint notre endpoint avec une propri\xe9t\xe9 "),e.j41(337,"code"),e.EFF(338,"email"),e.k0s(),e.EFF(339," invalide dans le corps de la requ\xeate, l'application r\xe9pondra automatiquement avec un code "),e.j41(340,"code"),e.EFF(341,"400 Bad Request"),e.k0s(),e.EFF(342,", ainsi qu'avec le corps de r\xe9ponse suivant :"),e.k0s(),e.j41(343,"pre")(344,"code",17),e.EFF(345,'\n{\n  "statusCode": 400,\n  "error": "Bad Request",\n  "message": ["email must be an email"]\n}\n'),e.k0s()(),e.j41(346,"p"),e.EFF(347,"En plus de valider les corps de requ\xeate, le "),e.j41(348,"code"),e.EFF(349,"ValidationPipe"),e.k0s(),e.EFF(350," peut \xeatre utilis\xe9 avec d'autres propri\xe9t\xe9s de l'objet de requ\xeate. Imaginons que nous voulions accepter "),e.j41(351,"code"),e.EFF(352,":id"),e.k0s(),e.EFF(353," dans le chemin du endpoint. Pour garantir que seuls les nombres sont accept\xe9s pour ce param\xe8tre de requ\xeate, nous pouvons utiliser la construction suivante :"),e.k0s(),e.j41(354,"app-copy-button")(355,"pre")(356,"code",14),e.EFF(357,"\n@Get(':id')\nfindOne(@Param() params: FindOneParams) {\n  return 'This action returns a user';\n}\n"),e.k0s()()(),e.j41(358,"p")(359,"code"),e.EFF(360,"FindOneParams"),e.k0s(),e.EFF(361,", tout comme un DTO, est simplement une classe qui d\xe9finit des r\xe8gles de validation en utilisant "),e.j41(362,"code"),e.EFF(363,"class-validator"),e.k0s(),e.EFF(364,". Cela ressemblerait \xe0 \xe7a :"),e.k0s(),e.j41(365,"app-copy-button")(366,"pre")(367,"code",14),e.EFF(368,"\nimport { IsNumberString } from 'class-validator';\n\nexport class FindOneParams {\n  @IsNumberString()\n  id: number;\n}\n"),e.k0s()()(),e.j41(369,"h4",18)(370,"span"),e.EFF(371,"D\xe9sactivation des erreurs d\xe9taill\xe9es."),e.k0s()(),e.j41(372,"p"),e.EFF(373,"Les messages d'erreur peuvent \xeatre utiles pour expliquer ce qui \xe9tait incorrect dans une requ\xeate. Cependant, certains environnements de production pr\xe9f\xe8rent d\xe9sactiver les erreurs d\xe9taill\xe9es. Faites cela en passant un objet d'options au "),e.j41(374,"code"),e.EFF(375,"ValidationPipe"),e.k0s(),e.EFF(376," :"),e.k0s(),e.j41(377,"app-copy-button")(378,"pre")(379,"code",14),e.EFF(380,"\napp.useGlobalPipes(\n  new ValidationPipe({\n    disableErrorMessages: true,\n  }),\n);\n"),e.k0s()()(),e.j41(381,"p"),e.EFF(382,"En cons\xe9quence, les messages d'erreur d\xe9taill\xe9s ne seront pas affich\xe9s dans le corps de la r\xe9ponse."),e.k0s(),e.j41(383,"h4",19)(384,"span"),e.EFF(385,"Exclusion de propri\xe9t\xe9s"),e.k0s()(),e.j41(386,"p"),e.EFF(387,"Notre "),e.j41(388,"code"),e.EFF(389,"ValidationPipe"),e.k0s(),e.EFF(390," peut \xe9galement filtrer les propri\xe9t\xe9s qui ne devraient pas \xeatre re\xe7ues par le gestionnaire de m\xe9thode. Dans ce cas, nous pouvons mettre sur la "),e.j41(391,"strong"),e.EFF(392,"whitelist"),e.k0s(),e.EFF(393," les propri\xe9t\xe9s acceptables, et toute propri\xe9t\xe9 non incluse dans la liste d'acceptation est automatiquement supprim\xe9e de l'objet r\xe9sultant.Par exemple, si notre gestionnaire attend les propri\xe9t\xe9s "),e.j41(394,"code"),e.EFF(395,"email"),e.k0s(),e.EFF(396," et "),e.j41(397,"code"),e.EFF(398,"password"),e.k0s(),e.EFF(399," , mais qu'une requ\xeate inclut \xe9galement une propri\xe9t\xe9 "),e.j41(400,"code"),e.EFF(401,"age"),e.k0s(),e.EFF(402,", cette propri\xe9t\xe9 peut \xeatre automatiquement supprim\xe9e du DTO r\xe9sultant. Pour activer ce comportement, d\xe9finissez "),e.j41(403,"code"),e.EFF(404,"whitelist"),e.k0s(),e.EFF(405," sur "),e.j41(406,"code"),e.EFF(407,"true"),e.k0s(),e.EFF(408,"."),e.k0s(),e.j41(409,"app-copy-button")(410,"pre")(411,"code",14),e.EFF(412,"\napp.useGlobalPipes(\n  new ValidationPipe({\n    whitelist: true,\n  }),\n);\n"),e.k0s()()(),e.j41(413,"p"),e.EFF(414,"Lorsque cette valeur est d\xe9finie sur true, cela supprimera automatiquement les propri\xe9t\xe9s non autoris\xe9es (celles sans aucun d\xe9corateur dans la classe de validation)."),e.k0s(),e.j41(415,"p"),e.EFF(416,"Alternativement, vous pouvez arr\xeater le traitement de la requ\xeate lorsque des propri\xe9t\xe9s non autoris\xe9es sont pr\xe9sentes, et renvoyer une r\xe9ponse d'erreur \xe0 l'utilisateur. Pour activer cela, d\xe9finissez la propri\xe9t\xe9 "),e.j41(417,"code"),e.EFF(418,"forbidNonWhitelisted"),e.k0s(),e.EFF(419," sur "),e.j41(420,"code"),e.EFF(421,"true"),e.k0s(),e.EFF(422,", en combinaison avec le r\xe9glage de "),e.j41(423,"code"),e.EFF(424,"whitelist"),e.k0s(),e.EFF(425," sur "),e.j41(426,"code"),e.EFF(427,"true"),e.k0s(),e.EFF(428,"."),e.k0s(),e.j41(429,"p"),e.nrm(430,"app-banner-courses"),e.k0s(),e.j41(431,"h4",20)(432,"span"),e.EFF(433,"Transformer les objets de charge utile (payloads)"),e.k0s()(),e.j41(434,"p"),e.EFF(435,"Les charges utiles provenant du r\xe9seau sont des objets JavaScript simples. Le "),e.j41(436,"code"),e.EFF(437,"ValidationPipe"),e.k0s(),e.EFF(438," peut automatiquement transformer les charges utiles en objets typ\xe9s selon leurs classes de DTO. Pour activer la transformation automatique, d\xe9finissez "),e.j41(439,"code"),e.EFF(440,"transform"),e.k0s(),e.EFF(441," sur "),e.j41(442,"code"),e.EFF(443,"true"),e.k0s(),e.EFF(444,". Cela peut \xeatre fait au niveau de la m\xe9thode :"),e.k0s(),e.j41(445,"app-copy-button",21)(446,"span",22),e.EFF(447),e.nI1(448,"extension"),e.nrm(449,"app-tabs",null,1),e.k0s(),e.j41(451,"pre")(452,"code",14),e.EFF(453,"\n@Post()\n@UsePipes(new ValidationPipe({ transform: true }))\nasync create(@Body() createCatDto: CreateCatDto) {\n  this.catsService.create(createCatDto);\n}\n"),e.k0s()()(),e.j41(454,"p"),e.EFF(455,"Pour activer ce comportement au niveau global, d\xe9finissez l'option sur un pipe global :"),e.k0s(),e.j41(456,"app-copy-button")(457,"pre")(458,"code",14),e.EFF(459,"\napp.useGlobalPipes(\n  new ValidationPipe({\n    transform: true,\n  }),\n);\n"),e.k0s()()(),e.j41(460,"p"),e.EFF(461,"Avec l'option auto-transformation activ\xe9e, le "),e.j41(462,"code"),e.EFF(463,"ValidationPipe"),e.k0s(),e.EFF(464," effectuera \xe9galement la conversion des types primitifs. Dans l'exemple suivant, la m\xe9thode "),e.j41(465,"code"),e.EFF(466,"findOne()"),e.k0s(),e.EFF(467," prend un argument qui repr\xe9sente un param\xe8tre d'extraction "),e.j41(468,"code"),e.EFF(469,"id"),e.k0s(),e.EFF(470," du chemin :"),e.k0s(),e.j41(471,"app-copy-button")(472,"pre")(473,"code",14),e.EFF(474,"\n@Get(':id')\nfindOne(@Param('id') id: number) {\n  console.log(typeof id === 'number'); // true\n  return 'This action returns a user';\n}\n"),e.k0s()()(),e.j41(475,"p"),e.EFF(476,"Par d\xe9faut, chaque param\xe8tre de chemin et param\xe8tre de requ\xeate arrive sur le r\xe9seau en tant que "),e.j41(477,"code"),e.EFF(478,"string"),e.k0s(),e.EFF(479,". Dans l'exemple ci-dessus, nous avons sp\xe9cifi\xe9 le type "),e.j41(480,"code"),e.EFF(481,"id"),e.k0s(),e.EFF(482," comme \xe9tant un "),e.j41(483,"code"),e.EFF(484,"number"),e.k0s(),e.EFF(485," (dans la signature de la m\xe9thode). Par cons\xe9quent, le "),e.j41(486,"code"),e.EFF(487,"ValidationPipe"),e.k0s(),e.EFF(488," tentera de convertir automatiquement un identifiant de type cha\xeene en un nombre."),e.k0s(),e.j41(489,"h4",23)(490,"span"),e.EFF(491,"Conversion explicite"),e.k0s()(),e.j41(492,"p"),e.EFF(493,"Dans la section pr\xe9c\xe9dente, nous avons montr\xe9 comment le "),e.j41(494,"code"),e.EFF(495,"ValidationPipe"),e.k0s(),e.EFF(496," peut implicitement transformer les param\xe8tres de requ\xeate et de chemin en fonction du type attendu. Cependant, cette fonctionnalit\xe9 n\xe9cessite d'avoir la transformation automatique activ\xe9e."),e.k0s(),e.j41(497,"p"),e.EFF(498,"Alternativement (avec l'auto-transformation d\xe9sactiv\xe9e), vous pouvez caster explicitement les valeurs en utilisant "),e.j41(499,"code"),e.EFF(500,"ParseIntPipe"),e.k0s(),e.EFF(501," ou "),e.j41(502,"code"),e.EFF(503,"ParseBoolPipe"),e.k0s(),e.EFF(504," (notez que "),e.j41(505,"code"),e.EFF(506,"ParseStringPipe"),e.k0s(),e.EFF(507," n'est pas n\xe9cessaire car, comme mentionn\xe9 pr\xe9c\xe9demment, chaque param\xe8tre de chemin et de requ\xeate arrive sur le r\xe9seau en tant que "),e.j41(508,"code"),e.EFF(509,"string"),e.k0s(),e.EFF(510," par d\xe9faut)."),e.k0s(),e.j41(511,"app-copy-button")(512,"pre")(513,"code",14),e.EFF(514,"\n@Get(':id')\nfindOne(\n  @Param('id', ParseIntPipe) id: number,\n  @Query('sort', ParseBoolPipe) sort: boolean,\n) {\n  console.log(typeof id === 'number'); // true\n  console.log(typeof sort === 'boolean'); // true\n  return 'This action returns a user';\n}\n"),e.k0s()()(),e.j41(515,"blockquote",12)(516,"strong"),e.EFF(517,"Astuce"),e.k0s(),e.EFF(518," Le "),e.j41(519,"code"),e.EFF(520,"ParseIntPipe"),e.k0s(),e.EFF(521," et le "),e.j41(522,"code"),e.EFF(523,"ParseBoolPipe"),e.k0s(),e.EFF(524," sont export\xe9s du paquet "),e.j41(525,"code"),e.EFF(526,"@nestjs/common"),e.k0s(),e.EFF(527,".\n"),e.k0s(),e.j41(528,"h4",24)(529,"span"),e.EFF(530,"Types mapp\xe9s"),e.k0s()(),e.j41(531,"p"),e.EFF(532,"Lorsque vous d\xe9veloppez des fonctionnalit\xe9s telles que "),e.j41(533,"strong"),e.EFF(534,"CRUD"),e.k0s(),e.EFF(535," (Create/Read/Update/Delete) il est souvent utile de construire des variantes d'un type d'entit\xe9 de base. Nest fournit plusieurs fonctions utilitaires qui effectuent des transformations de type pour rendre cette t\xe2che plus pratique."),e.k0s(),e.j41(536,"blockquote",25)(537,"strong"),e.EFF(538,"Attention"),e.k0s(),e.EFF(539," Si votre application utilise le paquet "),e.j41(540,"code"),e.EFF(541,"@nestjs/swagger"),e.k0s(),e.EFF(542,", consultez "),e.j41(543,"a",26),e.EFF(544,"ce chapitre"),e.k0s(),e.EFF(545," pour plus d'informations sur les types mapp\xe9s. De m\xeame, si vous utilisez le paquet "),e.j41(546,"code"),e.EFF(547,"@nestjs/graphql"),e.k0s(),e.EFF(548,", consultez "),e.j41(549,"a",27),e.EFF(550,"ce chapitre"),e.k0s(),e.EFF(551,". Les deux packages reposent fortement sur les types et n\xe9cessitent donc une importation diff\xe9rente pour \xeatre utilis\xe9s. Par cons\xe9quent, si vous avez utilis\xe9 "),e.j41(552,"code"),e.EFF(553,"@nestjs/mapped-types"),e.k0s(),e.EFF(554," (au lieu de celui appropri\xe9, soit "),e.j41(555,"code"),e.EFF(556,"@nestjs/swagger"),e.k0s(),e.EFF(557," ou "),e.j41(558,"code"),e.EFF(559,"@nestjs/graphql"),e.k0s(),e.EFF(560," en fonction du type de votre application), vous pourriez rencontrer divers effets secondaires non document\xe9s.\n"),e.k0s(),e.j41(561,"p"),e.EFF(562,"Lors de la construction de types de validation d'entr\xe9e (\xe9galement appel\xe9s DTO), il est souvent utile de cr\xe9er des variations "),e.j41(563,"strong"),e.EFF(564,"create"),e.k0s(),e.EFF(565," et "),e.j41(566,"strong"),e.EFF(567,"update"),e.k0s(),e.EFF(568," du m\xeame type. Par exemple, la variante "),e.j41(569,"strong"),e.EFF(570,"create"),e.k0s(),e.EFF(571," peut n\xe9cessiter tous les champs, tandis que la variante "),e.j41(572,"strong"),e.EFF(573,"update"),e.k0s(),e.EFF(574," peut rendre tous les champs facultatifs."),e.k0s(),e.j41(575,"p"),e.EFF(576,"Nest fournit la fonction utilitaire "),e.j41(577,"code"),e.EFF(578,"PartialType()"),e.k0s(),e.EFF(579," pour faciliter cette t\xe2che et r\xe9duire le code redondant."),e.k0s(),e.j41(580,"p"),e.EFF(581,"La fonction "),e.j41(582,"code"),e.EFF(583,"PartialType()"),e.k0s(),e.EFF(584," renvoie un type (classe) avec toutes les propri\xe9t\xe9s du type d'entr\xe9e d\xe9finies comme facultatives. Par exemple, supposons que nous ayons un type "),e.j41(585,"strong"),e.EFF(586,"create"),e.k0s(),e.EFF(587," comme suit :"),e.k0s(),e.j41(588,"app-copy-button")(589,"pre")(590,"code",14),e.EFF(591,"\nexport class CreateCatDto {\n  name: string;\n  age: number;\n  breed: string;\n}\n"),e.k0s()()(),e.j41(592,"p"),e.EFF(593,"Par d\xe9faut, tous ces champs sont obligatoires. Pour cr\xe9er un type avec les m\xeames champs, mais en les rendant tous facultatifs, utilisez "),e.j41(594,"code"),e.EFF(595,"PartialType()"),e.k0s(),e.EFF(596," en passant la r\xe9f\xe9rence de classe ("),e.j41(597,"code"),e.EFF(598,"CreateCatDto"),e.k0s(),e.EFF(599,") en argument :"),e.k0s(),e.j41(600,"app-copy-button")(601,"pre")(602,"code",14),e.EFF(603,"\nexport class UpdateCatDto extends PartialType(CreateCatDto) {}\n"),e.k0s()()(),e.j41(604,"blockquote",12)(605,"strong"),e.EFF(606,"Astuce"),e.k0s(),e.EFF(607," La fonction "),e.j41(608,"code"),e.EFF(609,"PartialType()"),e.k0s(),e.EFF(610," est import\xe9e depuis le package "),e.j41(611,"code"),e.EFF(612,"@nestjs/mapped-types"),e.k0s(),e.EFF(613,".\n"),e.k0s(),e.j41(614,"p"),e.EFF(615,"La fonction "),e.j41(616,"code"),e.EFF(617,"PickType()"),e.k0s(),e.EFF(618," construit un nouveau type (classe) en s\xe9lectionnant un ensemble de propri\xe9t\xe9s \xe0 partir d'un type d'entr\xe9e. Par exemple, supposons que nous commencions avec un type comme :"),e.k0s(),e.j41(619,"app-copy-button")(620,"pre")(621,"code",14),e.EFF(622,"\nexport class CreateCatDto {\n  name: string;\n  age: number;\n  breed: string;\n}\n"),e.k0s()()(),e.j41(623,"p"),e.EFF(624,"Nous pouvons s\xe9lectionner un ensemble de propri\xe9t\xe9s de cette classe en utilisant la fonction utilitaire "),e.j41(625,"code"),e.EFF(626,"PickType()"),e.k0s(),e.EFF(627," :"),e.k0s(),e.j41(628,"app-copy-button")(629,"pre")(630,"code",14),e.EFF(631,"\nexport class UpdateCatAgeDto extends PickType(CreateCatDto, ['age'] as const) {}\n"),e.k0s()()(),e.j41(632,"blockquote",12)(633,"strong"),e.EFF(634,"Astuce"),e.k0s(),e.EFF(635," La fonction "),e.j41(636,"code"),e.EFF(637,"PickType()"),e.k0s(),e.EFF(638," est import\xe9e depuis le paquet "),e.j41(639,"code"),e.EFF(640,"@nestjs/mapped-types"),e.k0s(),e.EFF(641,".\n"),e.k0s(),e.j41(642,"p"),e.EFF(643,"La fonction "),e.j41(644,"code"),e.EFF(645,"OmitType()"),e.k0s(),e.EFF(646," construit un type en s\xe9lectionnant toutes les propri\xe9t\xe9s d'un type d'entr\xe9e, puis en supprimant un ensemble particulier de cl\xe9s. Par exemple, supposons que nous commen\xe7ons avec un type comme :"),e.k0s(),e.j41(647,"app-copy-button")(648,"pre")(649,"code",14),e.EFF(650,"\nexport class CreateCatDto {\n  name: string;\n  age: number;\n  breed: string;\n}\n"),e.k0s()()(),e.j41(651,"p"),e.EFF(652,"Nous pouvons g\xe9n\xe9rer un type d\xe9riv\xe9 qui poss\xe8de toutes les propri\xe9t\xe9s "),e.j41(653,"strong"),e.EFF(654,"sauf"),e.k0s(),e.j41(655,"code"),e.EFF(656,"name"),e.k0s(),e.EFF(657," comme indiqu\xe9 ci-dessous. Dans cette construction, le deuxi\xe8me argument de "),e.j41(658,"code"),e.EFF(659,"OmitType"),e.k0s(),e.EFF(660," est un tableau de noms de propri\xe9t\xe9s."),e.k0s(),e.j41(661,"app-copy-button")(662,"pre")(663,"code",14),e.EFF(664,"\nexport class UpdateCatDto extends OmitType(CreateCatDto, ['name'] as const) {}\n"),e.k0s()()(),e.j41(665,"blockquote",12)(666,"strong"),e.EFF(667,"Astuce"),e.k0s(),e.EFF(668," La fonction "),e.j41(669,"code"),e.EFF(670,"OmitType()"),e.k0s(),e.EFF(671," est import\xe9e depuis le paquet "),e.j41(672,"code"),e.EFF(673,"@nestjs/mapped-types"),e.k0s(),e.EFF(674,".\n"),e.k0s(),e.j41(675,"p"),e.EFF(676,"La fonction "),e.j41(677,"code"),e.EFF(678,"IntersectionType()"),e.k0s(),e.EFF(679," combine deux types en un nouveau type (classe). Par exemple, supposons que nous ayons deux types comme suit :"),e.k0s(),e.j41(680,"app-copy-button")(681,"pre")(682,"code",14),e.EFF(683,"\nexport class CreateCatDto {\n  name: string;\n  breed: string;\n}\n\nexport class AdditionalCatInfo {\n  color: string;\n}\n"),e.k0s()()(),e.j41(684,"p"),e.EFF(685,"Nous pouvons g\xe9n\xe9rer un nouveau type qui combine toutes les propri\xe9t\xe9s des deux types."),e.k0s(),e.j41(686,"app-copy-button")(687,"pre")(688,"code",14),e.EFF(689,"\nexport class UpdateCatDto extends IntersectionType(\n  CreateCatDto,\n  AdditionalCatInfo,\n) {}\n"),e.k0s()()(),e.j41(690,"blockquote",12)(691,"strong"),e.EFF(692,"Astuce"),e.k0s(),e.EFF(693," La fonction "),e.j41(694,"code"),e.EFF(695,"IntersectionType()"),e.k0s(),e.EFF(696," est import\xe9e depuis le paquet "),e.j41(697,"code"),e.EFF(698,"@nestjs/mapped-types"),e.k0s(),e.EFF(699,".\n"),e.k0s(),e.j41(700,"p"),e.EFF(701,"Les fonctions utilitaires de mappage de types sont composables. Par exemple, ce qui suit produira un type (classe) qui a toutes les propri\xe9t\xe9s du type "),e.j41(702,"code"),e.EFF(703,"CreateCatDto"),e.k0s(),e.EFF(704," sauf "),e.j41(705,"code"),e.EFF(706,"name"),e.k0s(),e.EFF(707,", et ces propri\xe9t\xe9s seront d\xe9finies comme facultatives :"),e.k0s(),e.j41(708,"app-copy-button")(709,"pre")(710,"code",14),e.EFF(711,"\nexport class UpdateCatDto extends PartialType(\n  OmitType(CreateCatDto, ['name'] as const),\n) {}\n"),e.k0s()()(),e.j41(712,"h4",28)(713,"span"),e.EFF(714,"Analyse et validation des tableaux."),e.k0s()(),e.j41(715,"p"),e.EFF(716,"TypeScript ne stocke pas de m\xe9tadonn\xe9es sur les g\xe9n\xe9riques ou les interfaces, de sorte que lorsque vous les utilisez dans vos DTO, le "),e.j41(717,"code"),e.EFF(718,"ValidationPipe"),e.k0s(),e.EFF(719," peut ne pas \xeatre en mesure de valider correctement les donn\xe9es entrantes. Par exemple, dans le code suivant, les "),e.j41(720,"code"),e.EFF(721,"createUserDtos"),e.k0s(),e.EFF(722," ne seront pas correctement valid\xe9s :"),e.k0s(),e.j41(723,"app-copy-button")(724,"pre")(725,"code",14),e.EFF(726,"\n@Post()\ncreateBulk(@Body() createUserDtos: CreateUserDto[]) {\n  return 'This action adds new users';\n}\n"),e.k0s()()(),e.j41(727,"p"),e.EFF(728,"Pour valider le tableau, cr\xe9ez une classe d\xe9di\xe9e qui contient une propri\xe9t\xe9 enveloppant le tableau, ou utilisez le "),e.j41(729,"code"),e.EFF(730,"ParseArrayPipe"),e.k0s(),e.EFF(731,"."),e.k0s(),e.j41(732,"app-copy-button")(733,"pre")(734,"code",14),e.EFF(735,"\n@Post()\ncreateBulk(\n  @Body(new ParseArrayPipe({ items: CreateUserDto }))\n  createUserDtos: CreateUserDto[],\n) {\n  return 'This action adds new users';\n}\n"),e.k0s()()(),e.j41(736,"p"),e.EFF(737,"De plus, le "),e.j41(738,"code"),e.EFF(739,"ParseArrayPipe"),e.k0s(),e.EFF(740," peut \xeatre utile lors de l'analyse des param\xe8tres de requ\xeate. Consid\xe9rons une m\xe9thode "),e.j41(741,"code"),e.EFF(742,"findByIds()"),e.k0s(),e.EFF(743," qui renvoie des utilisateurs en fonction des identifiants pass\xe9s en tant que param\xe8tres de requ\xeate."),e.k0s(),e.j41(744,"app-copy-button")(745,"pre")(746,"code",14),e.EFF(747,"\n@Get()\nfindByIds(\n  @Query('ids', new ParseArrayPipe({ items: Number, separator: ',' }))\n  ids: number[],\n) {\n  return 'This action returns users by ids';\n}\n"),e.k0s()()(),e.j41(748,"p"),e.EFF(749,"Cette construction valide les param\xe8tres de requ\xeate entrants d'une requ\xeate HTTP "),e.j41(750,"code"),e.EFF(751,"GET"),e.k0s(),e.EFF(752," comme suit :"),e.k0s(),e.j41(753,"pre")(754,"code",11),e.EFF(755,"\nGET /?ids=1,2,3\n"),e.k0s()(),e.j41(756,"h4",29)(757,"span"),e.EFF(758,"WebSockets et Microservices"),e.k0s()(),e.j41(759,"p"),e.EFF(760,"Bien que ce chapitre montre des exemples utilisant des applications de style HTTP (par exemple, Express ou Fastify), le "),e.j41(761,"code"),e.EFF(762,"ValidationPipe"),e.k0s(),e.EFF(763," fonctionne de la m\xeame mani\xe8re pour les WebSockets et les microservices, quelle que soit la m\xe9thode de transport utilis\xe9e."),e.k0s(),e.j41(764,"h4",30)(765,"span"),e.EFF(766,"En savoir plus"),e.k0s()(),e.j41(767,"p"),e.EFF(768,"Pour en savoir plus sur les validateurs personnalis\xe9s, les messages d'erreur et les d\xe9corateurs disponibles fournis par le paquet "),e.j41(769,"code"),e.EFF(770,"class-validator"),e.k0s(),e.EFF(771," rendez-vous "),e.j41(772,"a",7),e.EFF(773,"ici"),e.k0s(),e.EFF(774,"."),e.k0s()()),2&o){const u=e.sdS(450);e.R7$(312),e.Lme("import ","{"," CreateUserDto ","}",""),e.R7$(3),e.Lme("import type ","{"," CreateUserDto ","}",""),e.R7$(132),e.SpI(" ",e.i5U(448,5,"cats.controller",u.isJsActive),"\n")}},dependencies:[E.O,i.a,A.Q,c.z,j.Wk,k.M],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Validation"}},{path:"sql",redirectTo:"database"},{path:"database",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-sql"]],features:[e.Vt3],decls:1524,vars:96,consts:[["contentReference",""],["appc0abb5412f425689f0f1b979347c8813989b3546",""],["app09d3ad299d91a5a843a5d437c5aaac2c7dba7904",""],["app4d0b28fb76e7217df7f396b9c60af3179f8772a4",""],["appc71396eae667fa0301491f92d2eeed07f01e2bff",""],["app992a870fa3e8158b90289ad230a426ee1dc66fdd",""],["appbcbe5fcb942560c3fe264308b1a724382ce54647",""],["app6c9eca167b2244352d03229b2d590f94d8c5802e",""],["appfcefb490b179fed26283889d4c2144f8b784b5a9",""],["app18f635b75f35239bffbc73da13387d62a883dd12",""],["app3ab3307fffcc183c682c79857386da1911f103da",""],["app311fc1cb834dc99427694ea0c5f341d23ff787ae",""],["app306707d9f9a4162ffaffa260036423660c6b25e6",""],["app68610a36d8438f70286cab21f6d14221ca8fd7a7",""],["appc66e02909878155af485461bdc186387297edb6b",""],["app8f43ec56a218cc5342e002cccdb9ac2c2818ee24",""],["app35d576a17ff9c93ab5e11c065ddee26c9ef62d48",""],["app99f2b66945f01536880e9b8666f4f7c73521f01a",""],["app4d9b2df016dd46a89a31a738fc77c0ce845e8268",""],["app68df65ca5e1326f75b5b2e56f1f05757cea7447a",""],["appacc976b81cf50cd649b29feea7c924a32a464342",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/sql.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","base-de-donn\xe9es"],["rel","nofollow","target","_blank","href","https://expressjs.com/en/guide/database-integration.html"],["rel","nofollow","target","_blank","href","https://mikro-orm.io/"],["routerLink","/recipes/mikroorm"],["rel","nofollow","target","_blank","href","https://sequelize.org/"],["href","/techniques/database#int%C3%A9gration-sequelize"],["rel","nofollow","target","_blank","href","https://knexjs.org/"],["rel","nofollow","target","_blank","href","https://dev.to/nestjs/build-a-nestjs-module-for-knex-js-or-other-resource-based-libraries-in-5-minutes-12an"],["rel","nofollow","target","_blank","href","https://github.com/typeorm/typeorm"],["rel","nofollow","target","_blank","href","https://www.github.com/prisma/prisma"],["routerLink","/recipes/prisma"],["routerLink","/techniques/mongodb"],["id","int\xe9gration-typeorm"],["rel","nofollow","target","_blank","href","https://www.mysql.com/"],[1,"language-bash"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],[1,"warning"],["rel","nofollow","target","_blank","href","https://typeorm.io/data-source-options#common-data-source-options"],[1,"info"],["rel","nofollow","target","_blank","href","https://typeorm.io/data-source-options"],["appAnchor","","id","mod\xe8le-de-r\xe9pertoire"],["rel","nofollow","target","_blank","href","https://typeorm.io/#/entities"],["appAnchor","","id","relations"],["rel","nofollow","target","_blank","href","https://typeorm.io/#/relations"],["appAnchor","","id","chargement-automatique-des-entit\xe9s"],["appAnchor","","id","s\xe9paration-de-la-d\xe9finition-de-lentit\xe9"],["rel","nofollow","target","_blank","href","https://typeorm.io/#/separating-entity-definition"],[1,"warning","error"],["appAnchor","","id","transactions-typeorm"],["rel","nofollow","target","_blank","href","https://en.wikipedia.org/wiki/Database_transaction"],["rel","nofollow","target","_blank","href","https://typeorm.io/#/transactions"],["rel","nofollow","target","_blank","href","https://typeorm.io/#/transactions/creating-and-using-transactions"],["appAnchor","","id","abonn\xe9s"],["rel","nofollow","target","_blank","href","https://typeorm.io/#/listeners-and-subscribers/what-is-a-subscriber"],[1,"error"],["routerLink","/fundamentals/injection-scopes"],["appAnchor","","id","migrations"],["rel","nofollow","target","_blank","href","https://typeorm.io/#/migrations"],["rel","nofollow","target","_blank","href","https://typeorm.io/#/migrations/creating-a-new-migration"],["appAnchor","","id","bases-de-donn\xe9es-multiples"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/typeorm/issues/86"],["appAnchor","","id","tests"],["routerLink","/fundamentals/custom-providers"],["appAnchor","","id","configuration-asynchrone"],["routerLink","/fundamentals/async-providers"],["appAnchor","","id","factory-de-sources-de-donn\xe9es-personnalis\xe9es"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/05-sql-typeorm"],["id","int\xe9gration-sequelize"],["rel","nofollow","target","_blank","href","https://github.com/RobinBuschmann/sequelize-typescript"],["rel","nofollow","target","_blank","href","https://sequelize.org/docs/v6/getting-started/#connecting-to-a-database"],["appAnchor","","id","mod\xe8les"],["rel","nofollow","target","_blank","href","https://github.com/RobinBuschmann/sequelize-typescript#column"],["appAnchor","","id","relations-1"],["rel","nofollow","target","_blank","href","https://github.com/RobinBuschmann/sequelize-typescript#model-association"],["appAnchor","","id","chargement-automatique-des-mod\xe8les"],["appAnchor","","id","transactions-sequelize"],["rel","nofollow","target","_blank","href","https://sequelize.org/docs/v6/other-topics/transactions/"],["appAnchor","","id","migrations-1"],["rel","nofollow","target","_blank","href","https://sequelize.org/docs/v6/other-topics/migrations/"],["rel","nofollow","target","_blank","href","https://sequelize.org/docs/v6/other-topics/migrations/#installing-the-cli"],["appAnchor","","id","bases-de-donn\xe9es-multiples-1"],["appAnchor","","id","tests-1"],["appAnchor","","id","configuration-asynchrone-1"],["appAnchor","","id","exemple-1"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/07-sequelize"]],template:function(o,t){if(1&o&&(e.j41(0,"div",21,0)(2,"div",22)(3,"a",23),e.nrm(4,"i",24),e.k0s()(),e.j41(5,"h3",25),e.EFF(6,"Base de donn\xe9es"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Nest est agnostique en mati\xe8re de bases de donn\xe9es, ce qui vous permet de l'int\xe9grer facilement \xe0 n'importe quelle base de donn\xe9es SQL ou NoSQL. Vous disposez d'un certain nombre d'options, en fonction de vos pr\xe9f\xe9rences. Au niveau le plus g\xe9n\xe9ral, connecter Nest \xe0 une base de donn\xe9es consiste simplement \xe0 charger un pilote Node.js appropri\xe9 pour la base de donn\xe9es, comme vous le feriez avec "),e.j41(9,"a",26),e.EFF(10,"Express"),e.k0s(),e.EFF(11," ou Fastify."),e.k0s(),e.j41(12,"p"),e.EFF(13,"Vous pouvez \xe9galement utiliser directement n'importe quelle "),e.j41(14,"strong"),e.EFF(15,"biblioth\xe8que"),e.k0s(),e.EFF(16," d'int\xe9gration de base de donn\xe9es Node.js ou ORM, comme "),e.j41(17,"a",27),e.EFF(18,"MikroORM"),e.k0s(),e.EFF(19," (voir "),e.j41(20,"a",28),e.EFF(21,"MikroORM recipe"),e.k0s(),e.EFF(22,"), "),e.j41(23,"a",29),e.EFF(24,"Sequelize"),e.k0s(),e.EFF(25," (voir l'"),e.j41(26,"a",30),e.EFF(27,"int\xe9gration Sequelize"),e.k0s(),e.EFF(28,"), "),e.j41(29,"a",31),e.EFF(30,"Knex.js"),e.k0s(),e.EFF(31," (voir le "),e.j41(32,"a",32),e.EFF(33,"tutoriel Knex.js"),e.k0s(),e.EFF(34,"), "),e.j41(35,"a",33),e.EFF(36,"TypeORM"),e.k0s(),e.EFF(37,", et "),e.j41(38,"a",34),e.EFF(39,"Prisma"),e.k0s(),e.EFF(40," (voir la "),e.j41(41,"a",35),e.EFF(42,"Recette Prisma"),e.k0s(),e.EFF(43,"), pour op\xe9rer \xe0 un niveau d'abstraction plus \xe9lev\xe9."),e.k0s(),e.j41(44,"p"),e.EFF(45,"Par commodit\xe9, Nest fournit une int\xe9gration \xe9troite avec TypeORM et Sequelize avec les packages "),e.j41(46,"code"),e.EFF(47,"@nestjs/typeorm"),e.k0s(),e.EFF(48," et "),e.j41(49,"code"),e.EFF(50,"@nestjs/sequelize"),e.k0s(),e.EFF(51," respectivement, que nous couvrirons dans le chapitre actuel, et Mongoose avec "),e.j41(52,"code"),e.EFF(53,"@nestjs/mongoose"),e.k0s(),e.EFF(54,", qui est couvert dans "),e.j41(55,"a",36),e.EFF(56,"cet autre chapitre"),e.k0s(),e.EFF(57,". Ces int\xe9grations fournissent des fonctionnalit\xe9s suppl\xe9mentaires sp\xe9cifiques \xe0 NestJS, telles que l'injection de mod\xe8le/r\xe9f\xe9rentiel, la testabilit\xe9, et la configuration asynchrone pour rendre l'acc\xe8s \xe0 la base de donn\xe9es choisie encore plus facile."),e.k0s(),e.j41(58,"h3",37),e.EFF(59,"Int\xe9gration TypeORM"),e.k0s(),e.j41(60,"p"),e.EFF(61,"Pour l'int\xe9gration avec les bases de donn\xe9es SQL et NoSQL, Nest fournit le package "),e.j41(62,"code"),e.EFF(63,"@nestjs/typeorm"),e.k0s(),e.EFF(64,". "),e.j41(65,"a",33),e.EFF(66,"TypeORM"),e.k0s(),e.EFF(67," est l'ORM (Object Relational Mapper) le plus mature disponible pour TypeScript. Comme il est \xe9crit en TypeScript, il s'int\xe8gre bien au framework Nest."),e.k0s(),e.j41(68,"p"),e.EFF(69,"Pour commencer \xe0 l'utiliser, nous installons d'abord les d\xe9pendances n\xe9cessaires. Dans ce chapitre, nous allons d\xe9montrer l'utilisation du populaire SGBD relationnel "),e.j41(70,"a",38),e.EFF(71,"MySQL"),e.k0s(),e.EFF(72,", mais TypeORM fournit un support pour de nombreuses bases de donn\xe9es relationnelles, telles que PostgreSQL, Oracle, Microsoft SQL Server, SQLite, et m\xeame des bases de donn\xe9es NoSQL comme MongoDB. La proc\xe9dure d\xe9crite dans ce chapitre est la m\xeame pour toutes les bases de donn\xe9es support\xe9es par TypeORM. Vous devrez simplement installer les biblioth\xe8ques API client associ\xe9es \xe0 la base de donn\xe9es que vous avez s\xe9lectionn\xe9e."),e.k0s(),e.j41(73,"pre")(74,"code",39),e.EFF(75,"\n$ npm install --save @nestjs/typeorm typeorm mysql2\n"),e.k0s()(),e.j41(76,"p"),e.EFF(77,"Une fois le processus d'installation termin\xe9, nous pouvons importer le "),e.j41(78,"code"),e.EFF(79,"TypeOrmModule"),e.k0s(),e.EFF(80," dans la racine "),e.j41(81,"code"),e.EFF(82,"AppModule"),e.k0s(),e.EFF(83,"."),e.k0s(),e.j41(84,"app-copy-button",40)(85,"span",41),e.EFF(86),e.nI1(87,"extension"),e.nrm(88,"app-tabs",null,1),e.k0s(),e.j41(90,"pre")(91,"code",42),e.EFF(92,"\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\n\n@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      type: 'mysql',\n      host: 'localhost',\n      port: 3306,\n      username: 'root',\n      password: 'root',\n      database: 'test',\n      entities: [],\n      synchronize: true,\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(93,"blockquote",43)(94,"strong"),e.EFF(95,"Attention"),e.k0s(),e.EFF(96," Le param\xe8tre "),e.j41(97,"code"),e.EFF(98,"synchronize : true"),e.k0s(),e.EFF(99," ne doit pas \xeatre utilis\xe9 en production - sinon vous pouvez perdre des donn\xe9es de production.\n"),e.k0s(),e.j41(100,"p"),e.EFF(101,"La m\xe9thode "),e.j41(102,"code"),e.EFF(103,"forRoot()"),e.k0s(),e.EFF(104," supporte toutes les propri\xe9t\xe9s de configuration expos\xe9es par le constructeur "),e.j41(105,"code"),e.EFF(106,"DataSource"),e.k0s(),e.EFF(107," du package "),e.j41(108,"a",44),e.EFF(109,"TypeORM"),e.k0s(),e.EFF(110,". En outre, il existe plusieurs propri\xe9t\xe9s de configuration suppl\xe9mentaires d\xe9crites ci-dessous."),e.k0s(),e.j41(111,"table")(112,"tr")(113,"td")(114,"code"),e.EFF(115,"retryAttempts"),e.k0s()(),e.j41(116,"td"),e.EFF(117,"Nombre de tentatives de connexion \xe0 la base de donn\xe9es (par d\xe9faut : "),e.j41(118,"code"),e.EFF(119,"10"),e.k0s(),e.EFF(120,")"),e.k0s()(),e.j41(121,"tr")(122,"td")(123,"code"),e.EFF(124,"retryDelay"),e.k0s()(),e.j41(125,"td"),e.EFF(126,"D\xe9lai entre les tentatives de reconnexion (ms) (par d\xe9faut : "),e.j41(127,"code"),e.EFF(128,"3000"),e.k0s(),e.EFF(129,")"),e.k0s()(),e.j41(130,"tr")(131,"td")(132,"code"),e.EFF(133,"autoLoadEntities"),e.k0s()(),e.j41(134,"td"),e.EFF(135,"Si "),e.j41(136,"code"),e.EFF(137,"true"),e.k0s(),e.EFF(138,", les entit\xe9s seront charg\xe9es automatiquement (par d\xe9faut : "),e.j41(139,"code"),e.EFF(140,"false"),e.k0s(),e.EFF(141,")"),e.k0s()()(),e.j41(142,"blockquote",45)(143,"strong"),e.EFF(144,"Astuce"),e.k0s(),e.EFF(145," Apprenez-en plus sur les options de source de donn\xe9es "),e.j41(146,"a",46),e.EFF(147,"ici"),e.k0s(),e.EFF(148,".\n"),e.k0s(),e.j41(149,"p"),e.EFF(150,"Une fois cela fait, les objets TypeORM "),e.j41(151,"code"),e.EFF(152,"DataSource"),e.k0s(),e.EFF(153," et "),e.j41(154,"code"),e.EFF(155,"EntityManager"),e.k0s(),e.EFF(156," seront disponibles pour \xeatre inject\xe9s dans l'ensemble du projet (sans avoir besoin d'importer des modules), par exemple :"),e.k0s(),e.j41(157,"app-copy-button",40)(158,"span",41),e.EFF(159),e.nI1(160,"extension"),e.nrm(161,"app-tabs",null,2),e.k0s(),e.j41(163,"pre")(164,"code",42),e.EFF(165,"\nimport { DataSource } from 'typeorm';\n\n@Module({\n  imports: [TypeOrmModule.forRoot(), UsersModule],\n})\nexport class AppModule {\n  constructor(private dataSource: DataSource) {}\n}\n"),e.k0s()(),e.j41(166,"pre")(167,"code",42),e.EFF(168,"\nimport { DataSource } from 'typeorm';\n\n@Dependencies(DataSource)\n@Module({\n  imports: [TypeOrmModule.forRoot(), UsersModule],\n})\nexport class AppModule {\n  constructor(dataSource) {\n    this.dataSource = dataSource;\n  }\n}\n"),e.k0s()()(),e.j41(169,"h4",47)(170,"span"),e.EFF(171,"Mod\xe8le de r\xe9pertoire"),e.k0s()(),e.j41(172,"p")(173,"a",33),e.EFF(174,"TypeORM"),e.k0s(),e.EFF(175," prend en charge le "),e.j41(176,"strong"),e.EFF(177,"mod\xe8le de conception de r\xe9pertoire"),e.k0s(),e.EFF(178,", de sorte que chaque entit\xe9 dispose de son propre r\xe9pertoire. Ces r\xe9pertoires peuvent \xeatre obtenus \xe0 partir de la source de donn\xe9es de la base de donn\xe9es."),e.k0s(),e.j41(179,"p"),e.EFF(180,"Pour continuer l'exemple, nous avons besoin d'au moins une entit\xe9. D\xe9finissons l'entit\xe9 "),e.j41(181,"code"),e.EFF(182,"User"),e.k0s(),e.EFF(183,"."),e.k0s(),e.j41(184,"app-copy-button",40)(185,"span",41),e.EFF(186),e.nI1(187,"extension"),e.nrm(188,"app-tabs",null,3),e.k0s(),e.j41(190,"pre")(191,"code",42),e.EFF(192,"\nimport { Entity, Column, PrimaryGeneratedColumn } from 'typeorm';\n\n@Entity()\nexport class User {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column()\n  firstName: string;\n\n  @Column()\n  lastName: string;\n\n  @Column({ default: true })\n  isActive: boolean;\n}\n"),e.k0s()()(),e.j41(193,"blockquote",45)(194,"strong"),e.EFF(195,"Astuce"),e.k0s(),e.EFF(196," Pour en savoir plus sur les entit\xe9s, consultez la "),e.j41(197,"a",48),e.EFF(198,"documentation TypeORM"),e.k0s(),e.EFF(199,".\n"),e.k0s(),e.j41(200,"p"),e.EFF(201,"Le fichier d'entit\xe9 "),e.j41(202,"code"),e.EFF(203,"User"),e.k0s(),e.EFF(204," se trouve dans le r\xe9pertoire "),e.j41(205,"code"),e.EFF(206,"users"),e.k0s(),e.EFF(207,". Ce r\xe9pertoire contient tous les fichiers relatifs au module "),e.j41(208,"code"),e.EFF(209,"Users"),e.k0s(),e.EFF(210,". Vous pouvez d\xe9cider de l'endroit o\xf9 vous voulez garder vos fichiers de mod\xe8le, cependant, nous recommandons de les cr\xe9er pr\xe8s de leur "),e.j41(211,"strong"),e.EFF(212,"domaine"),e.k0s(),e.EFF(213,", dans le r\xe9pertoire du module correspondant."),e.k0s(),e.j41(214,"p"),e.EFF(215,"Pour commencer \xe0 utiliser l'entit\xe9 "),e.j41(216,"code"),e.EFF(217,"User"),e.k0s(),e.EFF(218,", nous devons la faire conna\xeetre \xe0 TypeORM en l'ins\xe9rant dans le tableau "),e.j41(219,"code"),e.EFF(220,"entities"),e.k0s(),e.EFF(221," dans les options de la m\xe9thode "),e.j41(222,"code"),e.EFF(223,"forRoot()"),e.k0s(),e.EFF(224," du module (\xe0 moins que vous n'utilisiez un chemin global statique) :"),e.k0s(),e.j41(225,"app-copy-button",40)(226,"span",41),e.EFF(227),e.nI1(228,"extension"),e.nrm(229,"app-tabs",null,4),e.k0s(),e.j41(231,"pre")(232,"code",42),e.EFF(233,"\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { User } from './users/user.entity';\n\n@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      type: 'mysql',\n      host: 'localhost',\n      port: 3306,\n      username: 'root',\n      password: 'root',\n      database: 'test',\n      entities: [User],\n      synchronize: true,\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(234,"p"),e.EFF(235,"Ensuite, regardons le module "),e.j41(236,"code"),e.EFF(237,"UsersModule"),e.k0s(),e.EFF(238," :"),e.k0s(),e.j41(239,"app-copy-button",40)(240,"span",41),e.EFF(241),e.nI1(242,"extension"),e.nrm(243,"app-tabs",null,5),e.k0s(),e.j41(245,"pre")(246,"code",42),e.EFF(247,"\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { UsersService } from './users.service';\nimport { UsersController } from './users.controller';\nimport { User } from './user.entity';\n\n@Module({\n  imports: [TypeOrmModule.forFeature([User])],\n  providers: [UsersService],\n  controllers: [UsersController],\n})\nexport class UsersModule {}\n"),e.k0s()()(),e.j41(248,"p"),e.EFF(249,"Ce module utilise la m\xe9thode "),e.j41(250,"code"),e.EFF(251,"forFeature()"),e.k0s(),e.EFF(252," pour d\xe9finir quels r\xe9f\xe9rentiels sont enregistr\xe9s dans le scope courant. Avec cela en place, nous pouvons injecter le "),e.j41(253,"code"),e.EFF(254,"UsersRepository"),e.k0s(),e.EFF(255," dans le "),e.j41(256,"code"),e.EFF(257,"UsersService"),e.k0s(),e.EFF(258," en utilisant le d\xe9corateur "),e.j41(259,"code"),e.EFF(260,"@InjectRepository()"),e.k0s(),e.EFF(261," :"),e.k0s(),e.j41(262,"app-copy-button",40)(263,"span",41),e.EFF(264),e.nI1(265,"extension"),e.nrm(266,"app-tabs",null,6),e.k0s(),e.j41(268,"pre")(269,"code",42),e.EFF(270,"\nimport { Injectable } from '@nestjs/common';\nimport { InjectRepository } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport { User } from './user.entity';\n\n@Injectable()\nexport class UsersService {\n  constructor(\n    @InjectRepository(User)\n    private usersRepository: Repository<User>,\n  ) {}\n\n  findAll(): Promise<User[]> {\n    return this.usersRepository.find();\n  }\n\n  findOne(id: number): Promise<User | null> {\n    return this.usersRepository.findOneBy({ id });\n  }\n\n  async remove(id: number): Promise<void> {\n    await this.usersRepository.delete(id);\n  }\n}\n"),e.k0s()(),e.j41(271,"pre")(272,"code",42),e.EFF(273,"\nimport { Injectable, Dependencies } from '@nestjs/common';\nimport { getRepositoryToken } from '@nestjs/typeorm';\nimport { User } from './user.entity';\n\n@Injectable()\n@Dependencies(getRepositoryToken(User))\nexport class UsersService {\n  constructor(usersRepository) {\n    this.usersRepository = usersRepository;\n  }\n\n  findAll() {\n    return this.usersRepository.find();\n  }\n\n  findOne(id) {\n    return this.usersRepository.findOneBy({ id });\n  }\n\n  async remove(id) {\n    await this.usersRepository.delete(id);\n  }\n}\n"),e.k0s()()(),e.j41(274,"blockquote",43)(275,"strong"),e.EFF(276,"Remarque"),e.k0s(),e.EFF(277," N'oubliez pas d'importer le module "),e.j41(278,"code"),e.EFF(279,"UsersModule"),e.k0s(),e.EFF(280," dans le module racine "),e.j41(281,"code"),e.EFF(282,"AppModule"),e.k0s(),e.EFF(283,".\n"),e.k0s(),e.j41(284,"p"),e.EFF(285,"Si vous voulez utiliser le r\xe9f\xe9rentiel en dehors du module qui importe "),e.j41(286,"code"),e.EFF(287,"TypeOrmModule.forFeature"),e.k0s(),e.EFF(288,", vous devrez r\xe9exporter les fournisseurs g\xe9n\xe9r\xe9s par ce module.\nVous pouvez le faire en exportant le module entier, comme ceci :"),e.k0s(),e.j41(289,"app-copy-button",40)(290,"span",41),e.EFF(291),e.nI1(292,"extension"),e.nrm(293,"app-tabs",null,7),e.k0s(),e.j41(295,"pre")(296,"code",42),e.EFF(297,"\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { User } from './user.entity';\n\n@Module({\n  imports: [TypeOrmModule.forFeature([User])],\n  exports: [TypeOrmModule]\n})\nexport class UsersModule {}\n"),e.k0s()()(),e.j41(298,"p"),e.EFF(299,"Maintenant, si nous importons "),e.j41(300,"code"),e.EFF(301,"UsersModule"),e.k0s(),e.EFF(302," dans "),e.j41(303,"code"),e.EFF(304,"UserHttpModule"),e.k0s(),e.EFF(305,", nous pouvons utiliser "),e.j41(306,"code"),e.EFF(307,"@InjectRepository(User)"),e.k0s(),e.EFF(308," dans les fournisseurs de ce dernier module."),e.k0s(),e.j41(309,"app-copy-button",40)(310,"span",41),e.EFF(311),e.nI1(312,"extension"),e.nrm(313,"app-tabs",null,8),e.k0s(),e.j41(315,"pre")(316,"code",42),e.EFF(317,"\nimport { Module } from '@nestjs/common';\nimport { UsersModule } from './users.module';\nimport { UsersService } from './users.service';\nimport { UsersController } from './users.controller';\n\n@Module({\n  imports: [UsersModule],\n  providers: [UsersService],\n  controllers: [UsersController]\n})\nexport class UserHttpModule {}\n"),e.k0s()()(),e.j41(318,"h4",49)(319,"span"),e.EFF(320,"Relations"),e.k0s()(),e.j41(321,"p"),e.EFF(322,"Les relations sont des associations \xe9tablies entre deux ou plusieurs tables. Les relations sont bas\xe9es sur des champs communs \xe0 chaque table, impliquant souvent des cl\xe9s primaires et \xe9trang\xe8res."),e.k0s(),e.j41(323,"p"),e.EFF(324,"Il existe trois types de relations :"),e.k0s(),e.j41(325,"table")(326,"tr")(327,"td")(328,"code"),e.EFF(329,"One-to-one"),e.k0s()(),e.j41(330,"td"),e.EFF(331,"Chaque ligne de la table primaire a une et une seule ligne associ\xe9e dans la table \xe9trang\xe8re. Utilisez le d\xe9corateur "),e.j41(332,"code"),e.EFF(333,"@OneToOne()"),e.k0s(),e.EFF(334," pour d\xe9finir ce type de relation."),e.k0s()(),e.j41(335,"tr")(336,"td")(337,"code"),e.EFF(338,"One-to-many / Many-to-one"),e.k0s()(),e.j41(339,"td"),e.EFF(340,"Chaque ligne de la table primaire a une ou plusieurs lignes li\xe9es dans la table \xe9trang\xe8re. Utilisez les d\xe9corateurs "),e.j41(341,"code"),e.EFF(342,"@OneToMany()"),e.k0s(),e.EFF(343," et "),e.j41(344,"code"),e.EFF(345,"@ManyToOne()"),e.k0s(),e.EFF(346," pour d\xe9finir ce type de relation."),e.k0s()(),e.j41(347,"tr")(348,"td")(349,"code"),e.EFF(350,"Many-to-many"),e.k0s()(),e.j41(351,"td"),e.EFF(352,"Chaque ligne de la table primaire a plusieurs lignes apparent\xe9es dans la table \xe9trang\xe8re, et chaque enregistrement de la table \xe9trang\xe8re a plusieurs lignes apparent\xe9es dans la table primaire. Utilisez le d\xe9corateur "),e.j41(353,"code"),e.EFF(354,"@ManyToMany()"),e.k0s(),e.EFF(355," pour d\xe9finir ce type de relation."),e.k0s()()(),e.j41(356,"p"),e.EFF(357,"Pour d\xe9finir des relations dans les entit\xe9s, utilisez les "),e.j41(358,"strong"),e.EFF(359,"d\xe9corateurs"),e.k0s(),e.EFF(360," correspondants. Par exemple, pour d\xe9finir que chaque "),e.j41(361,"code"),e.EFF(362,"User"),e.k0s(),e.EFF(363," peut avoir plusieurs photos, utilisez le d\xe9corateur "),e.j41(364,"code"),e.EFF(365,"@OneToMany()"),e.k0s(),e.EFF(366,"."),e.k0s(),e.j41(367,"app-copy-button",40)(368,"span",41),e.EFF(369),e.nI1(370,"extension"),e.nrm(371,"app-tabs",null,9),e.k0s(),e.j41(373,"pre")(374,"code",42),e.EFF(375,"\nimport { Entity, Column, PrimaryGeneratedColumn, OneToMany } from 'typeorm';\nimport { Photo } from '../photos/photo.entity';\n\n@Entity()\nexport class User {\n  @PrimaryGeneratedColumn()\n  id: number;\n\n  @Column()\n  firstName: string;\n\n  @Column()\n  lastName: string;\n\n  @Column({ default: true })\n  isActive: boolean;\n\n  @OneToMany(type => Photo, photo => photo.user)\n  photos: Photo[];\n}\n"),e.k0s()()(),e.j41(376,"blockquote",45)(377,"strong"),e.EFF(378,"Astuce"),e.k0s(),e.EFF(379," Pour en savoir plus sur les relations au sein de TypeORM, visitez le "),e.j41(380,"a",50),e.EFF(381,"TypeORM documentation"),e.k0s(),e.EFF(382,".\n"),e.k0s(),e.j41(383,"h4",51)(384,"span"),e.EFF(385,"Chargement automatique des entit\xe9s"),e.k0s()(),e.j41(386,"p"),e.EFF(387,"L'ajout manuel d'entit\xe9s au tableau "),e.j41(388,"code"),e.EFF(389,"entities"),e.k0s(),e.EFF(390," des options de la source de donn\xe9es peut \xeatre fastidieux. En outre, le r\xe9f\xe9rencement des entit\xe9s \xe0 partir du module racine ne respecte pas les limites du domaine d'application et provoque des fuites de d\xe9tails d'impl\xe9mentation vers d'autres parties de l'application. Pour r\xe9soudre ce probl\xe8me, une solution alternative est fournie. Pour charger automatiquement les entit\xe9s, d\xe9finissez la propri\xe9t\xe9 "),e.j41(391,"code"),e.EFF(392,"autoLoadEntities"),e.k0s(),e.EFF(393," de l'objet de configuration (pass\xe9 dans la m\xe9thode "),e.j41(394,"code"),e.EFF(395,"forRoot()"),e.k0s(),e.EFF(396,") \xe0 "),e.j41(397,"code"),e.EFF(398,"true"),e.k0s(),e.EFF(399,", comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(400,"app-copy-button",40)(401,"span",41),e.EFF(402),e.nI1(403,"extension"),e.nrm(404,"app-tabs",null,10),e.k0s(),e.j41(406,"pre")(407,"code",42),e.EFF(408,"\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\n\n@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      ...\n      autoLoadEntities: true,\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(409,"p"),e.EFF(410,"Si cette option est sp\xe9cifi\xe9e, chaque entit\xe9 enregistr\xe9e par la m\xe9thode "),e.j41(411,"code"),e.EFF(412,"forFeature()"),e.k0s(),e.EFF(413," sera automatiquement ajout\xe9e au tableau "),e.j41(414,"code"),e.EFF(415,"entities"),e.k0s(),e.EFF(416," de l'objet de configuration."),e.k0s(),e.j41(417,"blockquote",43)(418,"strong"),e.EFF(419,"Attention"),e.k0s(),e.EFF(420," Notez que les entit\xe9s qui ne sont pas enregistr\xe9es via la m\xe9thode "),e.j41(421,"code"),e.EFF(422,"forFeature()"),e.k0s(),e.EFF(423,", mais qui sont seulement r\xe9f\xe9renc\xe9es \xe0 partir de l'entit\xe9 (via une relation), ne seront pas incluses par le biais du param\xe8tre "),e.j41(424,"code"),e.EFF(425,"autoLoadEntities"),e.k0s(),e.EFF(426,".\n"),e.k0s(),e.j41(427,"h4",52)(428,"span"),e.EFF(429,"S\xe9paration de la d\xe9finition de l'entit\xe9"),e.k0s()(),e.j41(430,"p"),e.EFF(431,"Vous pouvez d\xe9finir une entit\xe9 et ses colonnes directement dans le mod\xe8le, en utilisant des d\xe9corateurs. Mais certaines personnes pr\xe9f\xe8rent d\xe9finir les entit\xe9s et leurs colonnes dans des fichiers s\xe9par\xe9s en utilisant les "),e.j41(432,"a",53),e.EFF(433,'" sch\xe9mas d\'entit\xe9 "'),e.k0s(),e.EFF(434,"."),e.k0s(),e.j41(435,"app-copy-button")(436,"pre")(437,"code",42),e.EFF(438,"\nimport { EntitySchema } from 'typeorm';\nimport { User } from './user.entity';\n\nexport const UserSchema = new EntitySchema<User>({\n  name: 'User',\n  target: User,\n  columns: {\n    id: {\n      type: Number,\n      primary: true,\n      generated: true,\n    },\n    firstName: {\n      type: String,\n    },\n    lastName: {\n      type: String,\n    },\n    isActive: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  relations: {\n    photos: {\n      type: 'one-to-many',\n      target: 'Photo', // le nom du PhotoSchema\n    },\n  },\n});\n"),e.k0s()()(),e.j41(439,"blockquote",54)(440,"strong"),e.EFF(441,"Attention"),e.k0s(),e.EFF(442," Si vous fournissez l'option "),e.j41(443,"code"),e.EFF(444,"target"),e.k0s(),e.EFF(445,", la valeur de l'option "),e.j41(446,"code"),e.EFF(447,"name"),e.k0s(),e.EFF(448," doit \xeatre la m\xeame que le nom de la classe cible.\nSi vous ne fournissez pas de "),e.j41(449,"code"),e.EFF(450,"target"),e.k0s(),e.EFF(451,", vous pouvez utiliser n'importe quel nom.\n"),e.k0s(),e.j41(452,"p"),e.EFF(453,"Nest vous permet d'utiliser une instance de "),e.j41(454,"code"),e.EFF(455,"EntitySchema"),e.k0s(),e.EFF(456," partout o\xf9 une "),e.j41(457,"code"),e.EFF(458,"Entity"),e.k0s(),e.EFF(459," est attendue, par exemple :"),e.k0s(),e.j41(460,"app-copy-button")(461,"pre")(462,"code",42),e.EFF(463,"\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { UserSchema } from './user.schema';\nimport { UsersController } from './users.controller';\nimport { UsersService } from './users.service';\n\n@Module({\n  imports: [TypeOrmModule.forFeature([UserSchema])],\n  providers: [UsersService],\n  controllers: [UsersController],\n})\nexport class UsersModule {}\n"),e.k0s()()(),e.j41(464,"h4",55)(465,"span"),e.EFF(466,"Transactions TypeORM"),e.k0s()(),e.j41(467,"p"),e.EFF(468,"Une transaction de base de donn\xe9es symbolise une unit\xe9 de travail effectu\xe9e au sein d'un syst\xe8me de gestion de base de donn\xe9es par rapport \xe0 une base de donn\xe9es, et trait\xe9e de mani\xe8re coh\xe9rente et fiable, ind\xe9pendamment des autres transactions. Une transaction repr\xe9sente g\xe9n\xe9ralement toute modification apport\xe9e \xe0 une base de donn\xe9es ("),e.j41(469,"a",56),e.EFF(470,"en savoir plus"),e.k0s(),e.EFF(471,")."),e.k0s(),e.j41(472,"p"),e.EFF(473,"Il existe de nombreuses strat\xe9gies diff\xe9rentes pour g\xe9rer les "),e.j41(474,"a",57),e.EFF(475,"transactions TypeORM"),e.k0s(),e.EFF(476,". Nous recommandons d'utiliser la classe "),e.j41(477,"code"),e.EFF(478,"QueryRunner"),e.k0s(),e.EFF(479," car elle donne un contr\xf4le total sur la transaction."),e.k0s(),e.j41(480,"p"),e.EFF(481,"Tout d'abord, nous devons injecter l'objet "),e.j41(482,"code"),e.EFF(483,"DataSource"),e.k0s(),e.EFF(484," dans une classe de la mani\xe8re habituelle :"),e.k0s(),e.j41(485,"app-copy-button")(486,"pre")(487,"code",42),e.EFF(488,"\n@Injectable()\nexport class UsersService {\n  constructor(private dataSource: DataSource) {}\n}\n"),e.k0s()()(),e.j41(489,"blockquote",45)(490,"strong"),e.EFF(491,"Astuce"),e.k0s(),e.EFF(492," La classe "),e.j41(493,"code"),e.EFF(494,"DataSource"),e.k0s(),e.EFF(495," est import\xe9e du package "),e.j41(496,"code"),e.EFF(497,"typeorm"),e.k0s(),e.EFF(498,".\n"),e.k0s(),e.j41(499,"p"),e.EFF(500,"Nous pouvons maintenant utiliser cet objet pour cr\xe9er une transaction."),e.k0s(),e.j41(501,"app-copy-button")(502,"pre")(503,"code",42),e.EFF(504,"\nasync createMany(users: User[]) {\n  const queryRunner = this.dataSource.createQueryRunner();\n\n  await queryRunner.connect();\n  await queryRunner.startTransaction();\n  try {\n    await queryRunner.manager.save(users[0]);\n    await queryRunner.manager.save(users[1]);\n\n    await queryRunner.commitTransaction();\n  } catch (err) {\n    // Puisque nous avons des erreurs, revenons sur les changements que nous avons effectu\xe9s.\n    await queryRunner.rollbackTransaction();\n  } finally {\n    // Vous devez lib\xe9rer un queryRunner qui a \xe9t\xe9 instanci\xe9 manuellement\n    await queryRunner.release();\n  }\n}\n"),e.k0s()()(),e.j41(505,"blockquote",45)(506,"strong"),e.EFF(507,"Astuce"),e.k0s(),e.EFF(508," Notez que la "),e.j41(509,"code"),e.EFF(510,"dataSource"),e.k0s(),e.EFF(511," n'est utilis\xe9e que pour cr\xe9er le "),e.j41(512,"code"),e.EFF(513,"QueryRunner"),e.k0s(),e.EFF(514,". Cependant, pour tester cette classe, il faudrait simuler l'objet "),e.j41(515,"code"),e.EFF(516,"DataSource"),e.k0s(),e.EFF(517," entier (qui expose plusieurs m\xe9thodes). Ainsi, nous recommandons d'utiliser une classe fabrique d'aide (par exemple, "),e.j41(518,"code"),e.EFF(519,"QueryRunnerFactory"),e.k0s(),e.EFF(520,") et de d\xe9finir une interface avec un ensemble limit\xe9 de m\xe9thodes n\xe9cessaires pour maintenir les transactions. Cette technique rend l'utilisation de ces m\xe9thodes assez simple.\n"),e.k0s(),e.j41(521,"p"),e.nrm(522,"app-banner-devtools"),e.k0s(),e.j41(523,"p"),e.EFF(524,"Vous pouvez \xe9galement utiliser une approche de type callback avec la m\xe9thode "),e.j41(525,"code"),e.EFF(526,"transaction"),e.k0s(),e.EFF(527," de l'objet "),e.j41(528,"code"),e.EFF(529,"DataSource"),e.k0s(),e.EFF(530," ("),e.j41(531,"a",58),e.EFF(532,"lire la suite"),e.k0s(),e.EFF(533,")."),e.k0s(),e.j41(534,"app-copy-button")(535,"pre")(536,"code",42),e.EFF(537,"\nasync createMany(users: User[]) {\n  await this.dataSource.transaction(async manager => {\n    await manager.save(users[0]);\n    await manager.save(users[1]);\n  });\n}\n"),e.k0s()()(),e.j41(538,"h4",59)(539,"span"),e.EFF(540,"Abonn\xe9s"),e.k0s()(),e.j41(541,"p"),e.EFF(542,"Avec les "),e.j41(543,"a",60),e.EFF(544,"abonn\xe9s TypeORM"),e.k0s(),e.EFF(545,", vous pouvez \xe9couter des \xe9v\xe9nements sp\xe9cifiques de l'entit\xe9."),e.k0s(),e.j41(546,"app-copy-button")(547,"pre")(548,"code",42),e.EFF(549,"\nimport {\n  DataSource,\n  EntitySubscriberInterface,\n  EventSubscriber,\n  InsertEvent,\n} from 'typeorm';\nimport { User } from './user.entity';\n\n@EventSubscriber()\nexport class UserSubscriber implements EntitySubscriberInterface<User> {\n  constructor(dataSource: DataSource) {\n    dataSource.subscribers.push(this);\n  }\n\n  listenTo() {\n    return User;\n  }\n\n  beforeInsert(event: InsertEvent<User>) {\n    console.log(`BEFORE USER INSERTED: `, event.entity);\n  }\n}\n"),e.k0s()()(),e.j41(550,"blockquote",61)(551,"strong"),e.EFF(552,"Attention"),e.k0s(),e.EFF(553," Les abonn\xe9s aux \xe9v\xe9nements ne peuvent pas \xeatre "),e.j41(554,"a",62),e.EFF(555,"\xe0 port\xe9e de requ\xeate"),e.k0s(),e.EFF(556,".\n"),e.k0s(),e.j41(557,"p"),e.EFF(558,"Maintenant, ajoutez la classe "),e.j41(559,"code"),e.EFF(560,"UserSubscriber"),e.k0s(),e.EFF(561," au tableau "),e.j41(562,"code"),e.EFF(563,"providers"),e.k0s(),e.EFF(564," :"),e.k0s(),e.j41(565,"app-copy-button")(566,"pre")(567,"code",42),e.EFF(568,"\nimport { Module } from '@nestjs/common';\nimport { TypeOrmModule } from '@nestjs/typeorm';\nimport { User } from './user.entity';\nimport { UsersController } from './users.controller';\nimport { UsersService } from './users.service';\nimport { UserSubscriber } from './user.subscriber';\n\n@Module({\n  imports: [TypeOrmModule.forFeature([User])],\n  providers: [UsersService, UserSubscriber],\n  controllers: [UsersController],\n})\nexport class UsersModule {}\n"),e.k0s()()(),e.j41(569,"blockquote",45)(570,"strong"),e.EFF(571,"Astuce"),e.k0s(),e.EFF(572," Apprenez-en plus sur les abonn\xe9s de l'entit\xe9 "),e.j41(573,"a",60),e.EFF(574,"ici"),e.k0s(),e.EFF(575,".\n"),e.k0s(),e.j41(576,"h4",63)(577,"span"),e.EFF(578,"Migrations"),e.k0s()(),e.j41(579,"p"),e.EFF(580,"Les "),e.j41(581,"a",64),e.EFF(582,"migrations"),e.k0s(),e.EFF(583," permettent de mettre \xe0 jour de mani\xe8re incr\xe9mentale le sch\xe9ma de la base de donn\xe9es afin de le maintenir en phase avec le mod\xe8le de donn\xe9es de l'application tout en pr\xe9servant les donn\xe9es existantes dans la base de donn\xe9es. Pour g\xe9n\xe9rer, ex\xe9cuter et inverser les migrations, TypeORM fournit une "),e.j41(584,"a",65),e.EFF(585,"CLI d\xe9di\xe9e"),e.k0s(),e.EFF(586,"."),e.k0s(),e.j41(587,"p"),e.EFF(588,"Les classes de migration sont distinctes du code source de l'application Nest. Leur cycle de vie est g\xe9r\xe9 par le CLI TypeORM. Par cons\xe9quent, vous n'\xeates pas en mesure de tirer parti de l'injection de d\xe9pendance et d'autres fonctionnalit\xe9s sp\xe9cifiques \xe0 Nest avec les migrations. Pour en savoir plus sur les migrations, suivez le guide dans la "),e.j41(589,"a",65),e.EFF(590,"documentation TypeORM"),e.k0s(),e.EFF(591,"."),e.k0s(),e.j41(592,"h4",66)(593,"span"),e.EFF(594,"Bases de donn\xe9es multiples"),e.k0s()(),e.j41(595,"p"),e.EFF(596,"Certains projets n\xe9cessitent des connexions multiples \xe0 des bases de donn\xe9es. Ce module permet \xe9galement d'y parvenir. Pour travailler avec des connexions multiples, il faut d'abord cr\xe9er les connexions. Dans ce cas, le nom de la source de donn\xe9es devient "),e.j41(597,"strong"),e.EFF(598,"obligatoire"),e.k0s(),e.EFF(599,"."),e.k0s(),e.j41(600,"p"),e.EFF(601,"Supposons que vous ayez une entit\xe9 "),e.j41(602,"code"),e.EFF(603,"Album"),e.k0s(),e.EFF(604," stock\xe9e dans sa propre base de donn\xe9es."),e.k0s(),e.j41(605,"app-copy-button")(606,"pre")(607,"code",42),e.EFF(608,"\nconst defaultOptions = {\n  type: 'postgres',\n  port: 5432,\n  username: 'user',\n  password: 'password',\n  database: 'db',\n  synchronize: true,\n};\n\n@Module({\n  imports: [\n    TypeOrmModule.forRoot({\n      ...defaultOptions,\n      host: 'user_db_host',\n      entities: [User],\n    }),\n    TypeOrmModule.forRoot({\n      ...defaultOptions,\n      name: 'albumsConnection',\n      host: 'album_db_host',\n      entities: [Album],\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(609,"blockquote",43)(610,"strong"),e.EFF(611,"Remarque"),e.k0s(),e.EFF(612," Si vous ne d\xe9finissez pas le "),e.j41(613,"code"),e.EFF(614,"name"),e.k0s(),e.EFF(615," d'une source de donn\xe9es, son nom sera fix\xe9 \xe0 "),e.j41(616,"code"),e.EFF(617,"default"),e.k0s(),e.EFF(618,". Notez que vous ne devriez pas avoir plusieurs connexions sans nom, ou avec le m\xeame nom, sinon elles seront \xe9cras\xe9es.\n"),e.k0s(),e.j41(619,"blockquote",43)(620,"strong"),e.EFF(621,"Remarque"),e.k0s(),e.EFF(622," Si vous utilisez "),e.j41(623,"code"),e.EFF(624,"TypeOrmModule.forRootAsync"),e.k0s(),e.EFF(625,", vous devez "),e.j41(626,"strong"),e.EFF(627,"\xe9galement"),e.k0s(),e.EFF(628," d\xe9finir le nom de la source de donn\xe9es en dehors de "),e.j41(629,"code"),e.EFF(630,"useFactory"),e.k0s(),e.EFF(631,". Par exemple :\n"),e.j41(632,"app-copy-button")(633,"pre")(634,"code",42),e.EFF(635,"\nTypeOrmModule.forRootAsync({\n  name: 'albumsConnection',\n  useFactory: ...,\n  inject: ...,\n}),\n"),e.k0s()()(),e.j41(636,"p"),e.EFF(637,"Voir "),e.j41(638,"a",67),e.EFF(639,"cette issue"),e.k0s(),e.EFF(640," pour plus de d\xe9tails."),e.k0s()(),e.j41(641,"p"),e.EFF(642,"A ce stade, vous avez les entit\xe9s "),e.j41(643,"code"),e.EFF(644,"User"),e.k0s(),e.EFF(645," et "),e.j41(646,"code"),e.EFF(647,"Album"),e.k0s(),e.EFF(648," enregistr\xe9es avec leur propre source de donn\xe9es. Avec cette configuration, vous devez indiquer \xe0 la m\xe9thode "),e.j41(649,"code"),e.EFF(650,"TypeOrmModule.forFeature()"),e.k0s(),e.EFF(651," et au d\xe9corateur "),e.j41(652,"code"),e.EFF(653,"@InjectRepository()"),e.k0s(),e.EFF(654," quelle source de donn\xe9es doit \xeatre utilis\xe9e. Si vous ne passez pas de nom de source de donn\xe9es, la source de donn\xe9es "),e.j41(655,"code"),e.EFF(656,"default"),e.k0s(),e.EFF(657," est utilis\xe9e."),e.k0s(),e.j41(658,"app-copy-button")(659,"pre")(660,"code",42),e.EFF(661,"\n@Module({\n  imports: [\n    TypeOrmModule.forFeature([User]),\n    TypeOrmModule.forFeature([Album], 'albumsConnection'),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(662,"p"),e.EFF(663,"Vous pouvez \xe9galement injecter le "),e.j41(664,"code"),e.EFF(665,"DataSource"),e.k0s(),e.EFF(666," ou le "),e.j41(667,"code"),e.EFF(668,"EntityManager"),e.k0s(),e.EFF(669," pour une source de donn\xe9es donn\xe9e :"),e.k0s(),e.j41(670,"app-copy-button")(671,"pre")(672,"code",42),e.EFF(673,"\n@Injectable()\nexport class AlbumsService {\n  constructor(\n    @InjectDataSource('albumsConnection')\n    private dataSource: DataSource,\n    @InjectEntityManager('albumsConnection')\n    private entityManager: EntityManager,\n  ) {}\n}\n"),e.k0s()()(),e.j41(674,"p"),e.EFF(675,"Il est \xe9galement possible d'injecter n'importe quelle "),e.j41(676,"code"),e.EFF(677,"DataSource"),e.k0s(),e.EFF(678," dans les fournisseurs :"),e.k0s(),e.j41(679,"app-copy-button")(680,"pre")(681,"code",42),e.EFF(682,"\n@Module({\n  providers: [\n    {\n      provide: AlbumsService,\n      useFactory: (albumsConnection: DataSource) => {\n        return new AlbumsService(albumsConnection);\n      },\n      inject: [getDataSourceToken('albumsConnection')],\n    },\n  ],\n})\nexport class AlbumsModule {}\n"),e.k0s()()(),e.j41(683,"h4",68)(684,"span"),e.EFF(685,"Tests"),e.k0s()(),e.j41(686,"p"),e.EFF(687,"Lorsqu'il s'agit de tester une application de mani\xe8re unitaire, nous voulons g\xe9n\xe9ralement \xe9viter d'\xe9tablir une connexion \xe0 la base de donn\xe9es, afin que nos suites de tests restent ind\xe9pendantes et que leur processus d'ex\xe9cution soit aussi rapide que possible. Mais nos classes peuvent d\xe9pendre de r\xe9f\xe9rentiels qui sont tir\xe9s de l'instance de la source de donn\xe9es (connexion). Comment g\xe9rer cela ? La solution consiste \xe0 cr\xe9er des r\xe9f\xe9rentiels fictifs. Pour ce faire, nous mettons en place des "),e.j41(688,"a",69),e.EFF(689,"fournisseurs personnalis\xe9s"),e.k0s(),e.EFF(690,". Chaque r\xe9f\xe9rentiel enregistr\xe9 est automatiquement repr\xe9sent\xe9 par un jeton "),e.j41(691,"code"),e.EFF(692,"<EntityName>Repository"),e.k0s(),e.EFF(693,", o\xf9 "),e.j41(694,"code"),e.EFF(695,"EntityName"),e.k0s(),e.EFF(696," est le nom de votre classe d'entit\xe9."),e.k0s(),e.j41(697,"p"),e.EFF(698,"Le package "),e.j41(699,"code"),e.EFF(700,"@nestjs/typeorm"),e.k0s(),e.EFF(701," expose la fonction "),e.j41(702,"code"),e.EFF(703,"getRepositoryToken()"),e.k0s(),e.EFF(704," qui retourne un jeton pr\xe9par\xe9 bas\xe9 sur une entit\xe9 donn\xe9e."),e.k0s(),e.j41(705,"app-copy-button")(706,"pre")(707,"code",42),e.EFF(708,"\n@Module({\n  providers: [\n    UsersService,\n    {\n      provide: getRepositoryToken(User),\n      useValue: mockRepository,\n    },\n  ],\n})\nexport class UsersModule {}\n"),e.k0s()()(),e.j41(709,"p"),e.EFF(710,"Maintenant un substitut "),e.j41(711,"code"),e.EFF(712,"mockRepository"),e.k0s(),e.EFF(713," sera utilis\xe9 comme "),e.j41(714,"code"),e.EFF(715,"UsersRepository"),e.k0s(),e.EFF(716,". Chaque fois qu'une classe demandera le "),e.j41(717,"code"),e.EFF(718,"UsersRepository"),e.k0s(),e.EFF(719," en utilisant un d\xe9corateur "),e.j41(720,"code"),e.EFF(721,"@InjectRepository()"),e.k0s(),e.EFF(722,", Nest utilisera l'objet "),e.j41(723,"code"),e.EFF(724,"mockRepository"),e.k0s(),e.EFF(725," enregistr\xe9."),e.k0s(),e.j41(726,"h4",70)(727,"span"),e.EFF(728,"Configuration asynchrone"),e.k0s()(),e.j41(729,"p"),e.EFF(730,"Vous pouvez vouloir passer les options de votre module de d\xe9p\xf4t de mani\xe8re asynchrone plut\xf4t que statique. Dans ce cas, utilisez la m\xe9thode "),e.j41(731,"code"),e.EFF(732,"forRootAsync()"),e.k0s(),e.EFF(733,", qui fournit plusieurs fa\xe7ons de g\xe9rer la configuration asynchrone."),e.k0s(),e.j41(734,"p"),e.EFF(735,"Une approche consiste \xe0 utiliser une fonction factory :"),e.k0s(),e.j41(736,"app-copy-button")(737,"pre")(738,"code",42),e.EFF(739,"\nTypeOrmModule.forRootAsync({\n  useFactory: () => ({\n    type: 'mysql',\n    host: 'localhost',\n    port: 3306,\n    username: 'root',\n    password: 'root',\n    database: 'test',\n    entities: [],\n    synchronize: true,\n  }),\n});\n"),e.k0s()()(),e.j41(740,"p"),e.EFF(741,"Notre fabrique se comporte comme n'importe quel autre "),e.j41(742,"a",71),e.EFF(743,"fournisseur asynchrone"),e.k0s(),e.EFF(744," (par exemple, il peut \xeatre "),e.j41(745,"code"),e.EFF(746,"async"),e.k0s(),e.EFF(747," et il est capable d'injecter des d\xe9pendances via "),e.j41(748,"code"),e.EFF(749,"inject"),e.k0s(),e.EFF(750,")."),e.k0s(),e.j41(751,"app-copy-button")(752,"pre")(753,"code",42),e.EFF(754,"\nTypeOrmModule.forRootAsync({\n  imports: [ConfigModule],\n  useFactory: (configService: ConfigService) => ({\n    type: 'mysql',\n    host: configService.get('HOST'),\n    port: +configService.get('PORT'),\n    username: configService.get('USERNAME'),\n    password: configService.get('PASSWORD'),\n    database: configService.get('DATABASE'),\n    entities: [],\n    synchronize: true,\n  }),\n  inject: [ConfigService],\n});\n"),e.k0s()()(),e.j41(755,"p"),e.EFF(756,"Vous pouvez \xe9galement utiliser la syntaxe "),e.j41(757,"code"),e.EFF(758,"useClass"),e.k0s(),e.EFF(759," :"),e.k0s(),e.j41(760,"app-copy-button")(761,"pre")(762,"code",42),e.EFF(763,"\nTypeOrmModule.forRootAsync({\n  useClass: TypeOrmConfigService,\n});\n"),e.k0s()()(),e.j41(764,"p"),e.EFF(765,"La construction ci-dessus instanciera "),e.j41(766,"code"),e.EFF(767,"TypeOrmConfigService"),e.k0s(),e.EFF(768," dans "),e.j41(769,"code"),e.EFF(770,"TypeOrmModule"),e.k0s(),e.EFF(771," et l'utilisera pour fournir un objet d'options en appelant "),e.j41(772,"code"),e.EFF(773,"createTypeOrmOptions()"),e.k0s(),e.EFF(774,". Notez que cela signifie que le "),e.j41(775,"code"),e.EFF(776,"TypeOrmConfigService"),e.k0s(),e.EFF(777," doit impl\xe9menter l'interface "),e.j41(778,"code"),e.EFF(779,"TypeOrmOptionsFactory"),e.k0s(),e.EFF(780,", comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(781,"app-copy-button")(782,"pre")(783,"code",42),e.EFF(784,"\n@Injectable()\nexport class TypeOrmConfigService implements TypeOrmOptionsFactory {\n  createTypeOrmOptions(): TypeOrmModuleOptions {\n    return {\n      type: 'mysql',\n      host: 'localhost',\n      port: 3306,\n      username: 'root',\n      password: 'root',\n      database: 'test',\n      entities: [],\n      synchronize: true,\n    };\n  }\n}\n"),e.k0s()()(),e.j41(785,"p"),e.EFF(786,"Afin d'\xe9viter la cr\xe9ation de "),e.j41(787,"code"),e.EFF(788,"TypeOrmConfigService"),e.k0s(),e.EFF(789," dans "),e.j41(790,"code"),e.EFF(791,"TypeOrmModule"),e.k0s(),e.EFF(792," et d'utiliser un fournisseur import\xe9 d'un module diff\xe9rent, vous pouvez utiliser la syntaxe "),e.j41(793,"code"),e.EFF(794,"useExisting"),e.k0s(),e.EFF(795,"."),e.k0s(),e.j41(796,"app-copy-button")(797,"pre")(798,"code",42),e.EFF(799,"\nTypeOrmModule.forRootAsync({\n  imports: [ConfigModule],\n  useExisting: ConfigService,\n});\n"),e.k0s()()(),e.j41(800,"p"),e.EFF(801,"Cette construction fonctionne de la m\xeame mani\xe8re que "),e.j41(802,"code"),e.EFF(803,"useClass"),e.k0s(),e.EFF(804," avec une diff\xe9rence essentielle - "),e.j41(805,"code"),e.EFF(806,"TypeOrmModule"),e.k0s(),e.EFF(807," va chercher dans les modules import\xe9s pour r\xe9utiliser un "),e.j41(808,"code"),e.EFF(809,"ConfigService"),e.k0s(),e.EFF(810," existant au lieu d'en instancier un nouveau."),e.k0s(),e.j41(811,"blockquote",45)(812,"strong"),e.EFF(813,"Astuce"),e.k0s(),e.EFF(814," Assurez-vous que la propri\xe9t\xe9 "),e.j41(815,"code"),e.EFF(816,"name"),e.k0s(),e.EFF(817," est d\xe9finie au m\xeame niveau que la propri\xe9t\xe9 "),e.j41(818,"code"),e.EFF(819,"useFactory"),e.k0s(),e.EFF(820,", "),e.j41(821,"code"),e.EFF(822,"useClass"),e.k0s(),e.EFF(823,", ou "),e.j41(824,"code"),e.EFF(825,"useValue"),e.k0s(),e.EFF(826,". Cela permettra \xe0 Nest d'enregistrer correctement la source de donn\xe9es sous le jeton d'injection appropri\xe9.\n"),e.k0s(),e.j41(827,"h4",72)(828,"span"),e.EFF(829,"Factory de sources de donn\xe9es personnalis\xe9es"),e.k0s()(),e.j41(830,"p"),e.EFF(831,"En conjonction avec la configuration asynchrone utilisant "),e.j41(832,"code"),e.EFF(833,"useFactory"),e.k0s(),e.EFF(834,", "),e.j41(835,"code"),e.EFF(836,"useClass"),e.k0s(),e.EFF(837,", ou "),e.j41(838,"code"),e.EFF(839,"useExisting"),e.k0s(),e.EFF(840,", vous pouvez optionnellement sp\xe9cifier une fonction "),e.j41(841,"code"),e.EFF(842,"dataSourceFactory"),e.k0s(),e.EFF(843," qui vous permettra de fournir votre propre source de donn\xe9es TypeORM plut\xf4t que d'autoriser "),e.j41(844,"code"),e.EFF(845,"TypeOrmModule"),e.k0s(),e.EFF(846," \xe0 cr\xe9er la source de donn\xe9es."),e.k0s(),e.j41(847,"p")(848,"code"),e.EFF(849,"dataSourceFactory"),e.k0s(),e.EFF(850," re\xe7oit les "),e.j41(851,"code"),e.EFF(852,"DataSourceOptions"),e.k0s(),e.EFF(853," TypeORM configur\xe9es lors de la configuration asynchrone avec "),e.j41(854,"code"),e.EFF(855,"useFactory"),e.k0s(),e.EFF(856,", "),e.j41(857,"code"),e.EFF(858,"useClass"),e.k0s(),e.EFF(859,", ou "),e.j41(860,"code"),e.EFF(861,"useExisting"),e.k0s(),e.EFF(862," et retourne une "),e.j41(863,"code"),e.EFF(864,"Promesse"),e.k0s(),e.EFF(865," qui r\xe9sout une "),e.j41(866,"code"),e.EFF(867,"DataSource"),e.k0s(),e.EFF(868," TypeORM."),e.k0s(),e.j41(869,"app-copy-button")(870,"pre")(871,"code",42),e.EFF(872,"\nTypeOrmModule.forRootAsync({\n  imports: [ConfigModule],\n  inject: [ConfigService],\n  // Utilisez useFactory, useClass, ou useExisting\n  // pour configurer les DataSourceOptions.\n  useFactory: (configService: ConfigService) => ({\n    type: 'mysql',\n    host: configService.get('HOST'),\n    port: +configService.get('PORT'),\n    username: configService.get('USERNAME'),\n    password: configService.get('PASSWORD'),\n    database: configService.get('DATABASE'),\n    entities: [],\n    synchronize: true,\n  }),\n  // dataSource re\xe7oit les DataSourceOptions configur\xe9es\n  // et renvoie une Promise<DataSource>.\n  dataSourceFactory: async (options) => {\n    const dataSource = await new DataSource(options).initialize();\n    return dataSource;\n  },\n});\n"),e.k0s()()(),e.j41(873,"blockquote",45)(874,"strong"),e.EFF(875,"Astuce"),e.k0s(),e.EFF(876," La classe "),e.j41(877,"code"),e.EFF(878,"DataSource"),e.k0s(),e.EFF(879," est import\xe9e du package "),e.j41(880,"code"),e.EFF(881,"typeorm"),e.k0s(),e.EFF(882,".\n"),e.k0s(),e.j41(883,"h4",73)(884,"span"),e.EFF(885,"Exemple"),e.k0s()(),e.j41(886,"p"),e.EFF(887,"Un exemple concret est disponible "),e.j41(888,"a",74),e.EFF(889,"ici"),e.k0s(),e.EFF(890,"."),e.k0s(),e.j41(891,"p"),e.nrm(892,"app-banner-enterprise"),e.k0s(),e.j41(893,"h3",75),e.EFF(894,"Int\xe9gration Sequelize"),e.k0s(),e.j41(895,"p"),e.EFF(896,"Une alternative \xe0 l'utilisation de TypeORM est d'utiliser l'ORM "),e.j41(897,"a",29),e.EFF(898,"Sequelize"),e.k0s(),e.EFF(899," avec le package "),e.j41(900,"code"),e.EFF(901,"@nestjs/sequelize"),e.k0s(),e.EFF(902,". De plus, nous nous appuyons sur le package "),e.j41(903,"a",76),e.EFF(904,"sequelize-typescript"),e.k0s(),e.EFF(905," qui fournit un ensemble de d\xe9corateurs suppl\xe9mentaires pour d\xe9finir les entit\xe9s de mani\xe8re d\xe9clarative."),e.k0s(),e.j41(906,"p"),e.EFF(907,"Pour commencer \xe0 l'utiliser, nous devons d'abord installer les d\xe9pendances n\xe9cessaires. Dans ce chapitre, nous utiliserons le populaire SGBD relationnel "),e.j41(908,"a",38),e.EFF(909,"MySQL"),e.k0s(),e.EFF(910,", mais Sequelize prend en charge de nombreuses bases de donn\xe9es relationnelles, telles que PostgreSQL, MySQL, Microsoft SQL Server, SQLite et MariaDB. La proc\xe9dure d\xe9crite dans ce chapitre est la m\xeame pour toutes les bases de donn\xe9es prises en charge par Sequelize. Vous devrez simplement installer les biblioth\xe8ques API client associ\xe9es \xe0 la base de donn\xe9es que vous avez s\xe9lectionn\xe9e."),e.k0s(),e.j41(911,"pre")(912,"code",39),e.EFF(913,"\n$ npm install --save @nestjs/sequelize sequelize sequelize-typescript mysql2\n$ npm install --save-dev @types/sequelize\n"),e.k0s()(),e.j41(914,"p"),e.EFF(915,"Une fois le processus d'installation termin\xe9, nous pouvons importer le module "),e.j41(916,"code"),e.EFF(917,"SequelizeModule"),e.k0s(),e.EFF(918," dans le module racine "),e.j41(919,"code"),e.EFF(920,"AppModule"),e.k0s(),e.EFF(921,"."),e.k0s(),e.j41(922,"app-copy-button",40)(923,"span",41),e.EFF(924),e.nI1(925,"extension"),e.nrm(926,"app-tabs",null,11),e.k0s(),e.j41(928,"pre")(929,"code",42),e.EFF(930,"\nimport { Module } from '@nestjs/common';\nimport { SequelizeModule } from '@nestjs/sequelize';\n\n@Module({\n  imports: [\n    SequelizeModule.forRoot({\n      dialect: 'mysql',\n      host: 'localhost',\n      port: 3306,\n      username: 'root',\n      password: 'root',\n      database: 'test',\n      models: [],\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(931,"p"),e.EFF(932,"La m\xe9thode "),e.j41(933,"code"),e.EFF(934,"forRoot()"),e.k0s(),e.EFF(935," supporte toutes les propri\xe9t\xe9s de configuration expos\xe9es par le constructeur Sequelize ("),e.j41(936,"a",77),e.EFF(937,"lire la suite"),e.k0s(),e.EFF(938,"). En outre, il existe plusieurs propri\xe9t\xe9s de configuration suppl\xe9mentaires d\xe9crites ci-dessous."),e.k0s(),e.j41(939,"table")(940,"tr")(941,"td")(942,"code"),e.EFF(943,"retryAttempts"),e.k0s()(),e.j41(944,"td"),e.EFF(945,"Nombre de tentatives de connexion \xe0 la base de donn\xe9es (par d\xe9faut : "),e.j41(946,"code"),e.EFF(947,"10"),e.k0s(),e.EFF(948,")"),e.k0s()(),e.j41(949,"tr")(950,"td")(951,"code"),e.EFF(952,"retryDelay"),e.k0s()(),e.j41(953,"td"),e.EFF(954,"D\xe9lai entre les tentatives de reconnexion (ms) (par d\xe9faut : "),e.j41(955,"code"),e.EFF(956,"3000"),e.k0s(),e.EFF(957,")"),e.k0s()(),e.j41(958,"tr")(959,"td")(960,"code"),e.EFF(961,"autoLoadModels"),e.k0s()(),e.j41(962,"td"),e.EFF(963,"Si "),e.j41(964,"code"),e.EFF(965,"true"),e.k0s(),e.EFF(966,", les mod\xe8les seront charg\xe9s automatiquement (par d\xe9faut : "),e.j41(967,"code"),e.EFF(968,"false"),e.k0s(),e.EFF(969,")"),e.k0s()(),e.j41(970,"tr")(971,"td")(972,"code"),e.EFF(973,"keepConnectionAlive"),e.k0s()(),e.j41(974,"td"),e.EFF(975,"Si "),e.j41(976,"code"),e.EFF(977,"true"),e.k0s(),e.EFF(978,", la connexion ne sera pas ferm\xe9e lors de l'arr\xeat de l'application (par d\xe9faut : "),e.j41(979,"code"),e.EFF(980,"false"),e.k0s(),e.EFF(981,")"),e.k0s()(),e.j41(982,"tr")(983,"td")(984,"code"),e.EFF(985,"synchronize"),e.k0s()(),e.j41(986,"td"),e.EFF(987,"Si "),e.j41(988,"code"),e.EFF(989,"true"),e.k0s(),e.EFF(990,", les mod\xe8les charg\xe9s automatiquement seront synchronis\xe9s (par d\xe9faut : "),e.j41(991,"code"),e.EFF(992,"true"),e.k0s(),e.EFF(993,")"),e.k0s()()(),e.j41(994,"p"),e.EFF(995,"Une fois cela fait, l'objet "),e.j41(996,"code"),e.EFF(997,"Sequelize"),e.k0s(),e.EFF(998," sera disponible pour \xeatre inject\xe9 dans l'ensemble du projet (sans avoir besoin d'importer des modules), par exemple :"),e.k0s(),e.j41(999,"app-copy-button",40)(1e3,"span",41),e.EFF(1001),e.nI1(1002,"extension"),e.nrm(1003,"app-tabs",null,12),e.k0s(),e.j41(1005,"pre")(1006,"code",42),e.EFF(1007,"\nimport { Injectable } from '@nestjs/common';\nimport { Sequelize } from 'sequelize-typescript';\n\n@Injectable()\nexport class AppService {\n  constructor(private sequelize: Sequelize) {}\n}\n"),e.k0s()(),e.j41(1008,"pre")(1009,"code",42),e.EFF(1010,"\nimport { Injectable } from '@nestjs/common';\nimport { Sequelize } from 'sequelize-typescript';\n\n@Dependencies(Sequelize)\n@Injectable()\nexport class AppService {\n  constructor(sequelize) {\n    this.sequelize = sequelize;\n  }\n}\n"),e.k0s()()(),e.j41(1011,"h4",78)(1012,"span"),e.EFF(1013,"Mod\xe8les"),e.k0s()(),e.j41(1014,"p"),e.EFF(1015,"Sequelize met en \u0153uvre le mod\xe8le Active Record. Avec ce mod\xe8le, vous utilisez directement les classes de mod\xe8le pour interagir avec la base de donn\xe9es. Pour continuer l'exemple, nous avons besoin d'au moins un mod\xe8le. D\xe9finissons le mod\xe8le "),e.j41(1016,"code"),e.EFF(1017,"User"),e.k0s(),e.EFF(1018,"."),e.k0s(),e.j41(1019,"app-copy-button",40)(1020,"span",41),e.EFF(1021),e.nI1(1022,"extension"),e.nrm(1023,"app-tabs",null,13),e.k0s(),e.j41(1025,"pre")(1026,"code",42),e.EFF(1027,"\nimport { Column, Model, Table } from 'sequelize-typescript';\n\n@Table\nexport class User extends Model {\n  @Column\n  firstName: string;\n\n  @Column\n  lastName: string;\n\n  @Column({ defaultValue: true })\n  isActive: boolean;\n}\n"),e.k0s()()(),e.j41(1028,"blockquote",45)(1029,"strong"),e.EFF(1030,"Astuce"),e.k0s(),e.EFF(1031," Apprenez-en plus sur les d\xe9corateurs disponibles "),e.j41(1032,"a",79),e.EFF(1033,"ici"),e.k0s(),e.EFF(1034,".\n"),e.k0s(),e.j41(1035,"p"),e.EFF(1036,"Le fichier mod\xe8le "),e.j41(1037,"code"),e.EFF(1038,"User"),e.k0s(),e.EFF(1039," se trouve dans le r\xe9pertoire "),e.j41(1040,"code"),e.EFF(1041,"users"),e.k0s(),e.EFF(1042,". Ce r\xe9pertoire contient tous les fichiers relatifs au module "),e.j41(1043,"code"),e.EFF(1044,"Users"),e.k0s(),e.EFF(1045,". Vous pouvez d\xe9cider de l'emplacement de vos fichiers de mod\xe8le, cependant, nous recommandons de les cr\xe9er pr\xe8s de leur "),e.j41(1046,"strong"),e.EFF(1047,"domaine"),e.k0s(),e.EFF(1048,", dans le r\xe9pertoire du module correspondant."),e.k0s(),e.j41(1049,"p"),e.EFF(1050,"Pour commencer \xe0 utiliser le mod\xe8le "),e.j41(1051,"code"),e.EFF(1052,"User"),e.k0s(),e.EFF(1053,", nous devons le faire conna\xeetre \xe0 Sequelize en l'ins\xe9rant dans le tableau "),e.j41(1054,"code"),e.EFF(1055,"models"),e.k0s(),e.EFF(1056," dans les options de la m\xe9thode "),e.j41(1057,"code"),e.EFF(1058,"forRoot()"),e.k0s(),e.EFF(1059," du module :"),e.k0s(),e.j41(1060,"app-copy-button",40)(1061,"span",41),e.EFF(1062),e.nI1(1063,"extension"),e.nrm(1064,"app-tabs",null,14),e.k0s(),e.j41(1066,"pre")(1067,"code",42),e.EFF(1068,"\nimport { Module } from '@nestjs/common';\nimport { SequelizeModule } from '@nestjs/sequelize';\nimport { User } from './users/user.model';\n\n@Module({\n  imports: [\n    SequelizeModule.forRoot({\n      dialect: 'mysql',\n      host: 'localhost',\n      port: 3306,\n      username: 'root',\n      password: 'root',\n      database: 'test',\n      models: [User],\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(1069,"p"),e.EFF(1070,"Ensuite, regardons le module "),e.j41(1071,"code"),e.EFF(1072,"UsersModule"),e.k0s(),e.EFF(1073," :"),e.k0s(),e.j41(1074,"app-copy-button",40)(1075,"span",41),e.EFF(1076),e.nI1(1077,"extension"),e.nrm(1078,"app-tabs",null,15),e.k0s(),e.j41(1080,"pre")(1081,"code",42),e.EFF(1082,"\nimport { Module } from '@nestjs/common';\nimport { SequelizeModule } from '@nestjs/sequelize';\nimport { User } from './user.model';\nimport { UsersController } from './users.controller';\nimport { UsersService } from './users.service';\n\n@Module({\n  imports: [SequelizeModule.forFeature([User])],\n  providers: [UsersService],\n  controllers: [UsersController],\n})\nexport class UsersModule {}\n"),e.k0s()()(),e.j41(1083,"p"),e.EFF(1084,"Ce module utilise la m\xe9thode "),e.j41(1085,"code"),e.EFF(1086,"forFeature()"),e.k0s(),e.EFF(1087," pour d\xe9finir quels mod\xe8les sont enregistr\xe9s dans la port\xe9e courante. Avec cela en place, nous pouvons injecter le "),e.j41(1088,"code"),e.EFF(1089,"UserModel"),e.k0s(),e.EFF(1090," dans le "),e.j41(1091,"code"),e.EFF(1092,"UsersService"),e.k0s(),e.EFF(1093," en utilisant le d\xe9corateur "),e.j41(1094,"code"),e.EFF(1095,"@InjectModel()"),e.k0s(),e.EFF(1096," :"),e.k0s(),e.j41(1097,"app-copy-button",40)(1098,"span",41),e.EFF(1099),e.nI1(1100,"extension"),e.nrm(1101,"app-tabs",null,16),e.k0s(),e.j41(1103,"pre")(1104,"code",42),e.EFF(1105,"\nimport { Injectable } from '@nestjs/common';\nimport { InjectModel } from '@nestjs/sequelize';\nimport { User } from './user.model';\n\n@Injectable()\nexport class UsersService {\n  constructor(\n    @InjectModel(User)\n    private userModel: typeof User,\n  ) {}\n\n  async findAll(): Promise<User[]> {\n    return this.userModel.findAll();\n  }\n\n  findOne(id: string): Promise<User> {\n    return this.userModel.findOne({\n      where: {\n        id,\n      },\n    });\n  }\n\n  async remove(id: string): Promise<void> {\n    const user = await this.findOne(id);\n    await user.destroy();\n  }\n}\n"),e.k0s()(),e.j41(1106,"pre")(1107,"code",42),e.EFF(1108,"\nimport { Injectable, Dependencies } from '@nestjs/common';\nimport { getModelToken } from '@nestjs/sequelize';\nimport { User } from './user.model';\n\n@Injectable()\n@Dependencies(getModelToken(User))\nexport class UsersService {\n  constructor(usersRepository) {\n    this.usersRepository = usersRepository;\n  }\n\n  async findAll() {\n    return this.userModel.findAll();\n  }\n\n  findOne(id) {\n    return this.userModel.findOne({\n      where: {\n        id,\n      },\n    });\n  }\n\n  async remove(id) {\n    const user = await this.findOne(id);\n    await user.destroy();\n  }\n}\n"),e.k0s()()(),e.j41(1109,"blockquote",43)(1110,"strong"),e.EFF(1111,"Remarque"),e.k0s(),e.EFF(1112," N'oubliez pas d'importer le module "),e.j41(1113,"code"),e.EFF(1114,"UsersModule"),e.k0s(),e.EFF(1115," dans le module racine "),e.j41(1116,"code"),e.EFF(1117,"AppModule"),e.k0s(),e.EFF(1118,".\n"),e.k0s(),e.j41(1119,"p"),e.EFF(1120,"Si vous voulez utiliser le r\xe9pertoire en dehors du module qui importe "),e.j41(1121,"code"),e.EFF(1122,"SequelizeModule.forFeature"),e.k0s(),e.EFF(1123,", vous devrez r\xe9exporter les fournisseurs g\xe9n\xe9r\xe9s par ce module.\nVous pouvez le faire en exportant le module entier, comme ceci :"),e.k0s(),e.j41(1124,"app-copy-button",40)(1125,"span",41),e.EFF(1126),e.nI1(1127,"extension"),e.nrm(1128,"app-tabs",null,17),e.k0s(),e.j41(1130,"pre")(1131,"code",42),e.EFF(1132,"\nimport { Module } from '@nestjs/common';\nimport { SequelizeModule } from '@nestjs/sequelize';\nimport { User } from './user.entity';\n\n@Module({\n  imports: [SequelizeModule.forFeature([User])],\n  exports: [SequelizeModule]\n})\nexport class UsersModule {}\n"),e.k0s()()(),e.j41(1133,"p"),e.EFF(1134,"Maintenant, si nous importons "),e.j41(1135,"code"),e.EFF(1136,"UsersModule"),e.k0s(),e.EFF(1137," dans "),e.j41(1138,"code"),e.EFF(1139,"UserHttpModule"),e.k0s(),e.EFF(1140,", nous pouvons utiliser "),e.j41(1141,"code"),e.EFF(1142,"@InjectModel(User)"),e.k0s(),e.EFF(1143," dans les fournisseurs de ce dernier module."),e.k0s(),e.j41(1144,"app-copy-button",40)(1145,"span",41),e.EFF(1146),e.nI1(1147,"extension"),e.nrm(1148,"app-tabs",null,18),e.k0s(),e.j41(1150,"pre")(1151,"code",42),e.EFF(1152,"\nimport { Module } from '@nestjs/common';\nimport { UsersModule } from './users.module';\nimport { UsersService } from './users.service';\nimport { UsersController } from './users.controller';\n\n@Module({\n  imports: [UsersModule],\n  providers: [UsersService],\n  controllers: [UsersController]\n})\nexport class UserHttpModule {}\n"),e.k0s()()(),e.j41(1153,"h4",80)(1154,"span"),e.EFF(1155,"Relations"),e.k0s()(),e.j41(1156,"p"),e.EFF(1157,"Les relations sont des associations \xe9tablies entre deux ou plusieurs tables. Les relations sont bas\xe9es sur des champs communs \xe0 chaque table, impliquant souvent des cl\xe9s primaires et \xe9trang\xe8res."),e.k0s(),e.j41(1158,"p"),e.EFF(1159,"Il existe trois types de relations :"),e.k0s(),e.j41(1160,"table")(1161,"tr")(1162,"td")(1163,"code"),e.EFF(1164,"One-to-one"),e.k0s()(),e.j41(1165,"td"),e.EFF(1166,"Chaque ligne de la table primaire a une et une seule ligne associ\xe9e dans la table \xe9trang\xe8re."),e.k0s()(),e.j41(1167,"tr")(1168,"td")(1169,"code"),e.EFF(1170,"One-to-many / Many-to-one"),e.k0s()(),e.j41(1171,"td"),e.EFF(1172,"Chaque ligne de la table primaire a une ou plusieurs lignes apparent\xe9es dans la table \xe9trang\xe8re."),e.k0s()(),e.j41(1173,"tr")(1174,"td")(1175,"code"),e.EFF(1176,"Many-to-many"),e.k0s()(),e.j41(1177,"td"),e.EFF(1178,"Chaque ligne de la table primaire a plusieurs lignes apparent\xe9es dans la table \xe9trang\xe8re, et chaque enregistrement de la table \xe9trang\xe8re a plusieurs lignes apparent\xe9es dans la table primaire."),e.k0s()()(),e.j41(1179,"p"),e.EFF(1180,"Pour d\xe9finir des relations entre les mod\xe8les, utilisez les "),e.j41(1181,"strong"),e.EFF(1182,"d\xe9corateurs"),e.k0s(),e.EFF(1183," correspondants. Par exemple, pour d\xe9finir que chaque "),e.j41(1184,"code"),e.EFF(1185,"User"),e.k0s(),e.EFF(1186," peut avoir plusieurs photos, utilisez le d\xe9corateur "),e.j41(1187,"code"),e.EFF(1188,"@HasMany()"),e.k0s(),e.EFF(1189,"."),e.k0s(),e.j41(1190,"app-copy-button",40)(1191,"span",41),e.EFF(1192),e.nI1(1193,"extension"),e.nrm(1194,"app-tabs",null,19),e.k0s(),e.j41(1196,"pre")(1197,"code",42),e.EFF(1198,"\nimport { Column, Model, Table, HasMany } from 'sequelize-typescript';\nimport { Photo } from '../photos/photo.model';\n\n@Table\nexport class User extends Model {\n  @Column\n  firstName: string;\n\n  @Column\n  lastName: string;\n\n  @Column({ defaultValue: true })\n  isActive: boolean;\n\n  @HasMany(() => Photo)\n  photos: Photo[];\n}\n"),e.k0s()()(),e.j41(1199,"blockquote",45)(1200,"strong"),e.EFF(1201,"Astuce"),e.k0s(),e.EFF(1202," Pour en savoir plus sur les associations dans Sequelize, lisez "),e.j41(1203,"a",81),e.EFF(1204,"ce chapitre"),e.k0s(),e.EFF(1205,".\n"),e.k0s(),e.j41(1206,"h4",82)(1207,"span"),e.EFF(1208,"Chargement automatique des mod\xe8les"),e.k0s()(),e.j41(1209,"p"),e.EFF(1210,"Ajouter manuellement des mod\xe8les au tableau "),e.j41(1211,"code"),e.EFF(1212,"models"),e.k0s(),e.EFF(1213," des options de connexion peut \xeatre fastidieux. De plus, r\xe9f\xe9rencer des mod\xe8les \xe0 partir du module racine brise les fronti\xe8res du domaine d'application et provoque des fuites de d\xe9tails d'impl\xe9mentation vers d'autres parties de l'application. Pour r\xe9soudre ce probl\xe8me, chargez automatiquement les mod\xe8les en d\xe9finissant les propri\xe9t\xe9s "),e.j41(1214,"code"),e.EFF(1215,"autoLoadModels"),e.k0s(),e.EFF(1216," et "),e.j41(1217,"code"),e.EFF(1218,"synchronize"),e.k0s(),e.EFF(1219," de l'objet de configuration (pass\xe9 dans la m\xe9thode "),e.j41(1220,"code"),e.EFF(1221,"forRoot()"),e.k0s(),e.EFF(1222,") \xe0 "),e.j41(1223,"code"),e.EFF(1224,"true"),e.k0s(),e.EFF(1225,", comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(1226,"app-copy-button",40)(1227,"span",41),e.EFF(1228),e.nI1(1229,"extension"),e.nrm(1230,"app-tabs",null,20),e.k0s(),e.j41(1232,"pre")(1233,"code",42),e.EFF(1234,"\nimport { Module } from '@nestjs/common';\nimport { SequelizeModule } from '@nestjs/sequelize';\n\n@Module({\n  imports: [\n    SequelizeModule.forRoot({\n      ...\n      autoLoadModels: true,\n      synchronize: true,\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(1235,"p"),e.EFF(1236,"Si cette option est sp\xe9cifi\xe9e, chaque mod\xe8le enregistr\xe9 par la m\xe9thode "),e.j41(1237,"code"),e.EFF(1238,"forFeature()"),e.k0s(),e.EFF(1239," sera automatiquement ajout\xe9 au tableau "),e.j41(1240,"code"),e.EFF(1241,"models"),e.k0s(),e.EFF(1242," de l'objet de configuration."),e.k0s(),e.j41(1243,"blockquote",43)(1244,"strong"),e.EFF(1245,"Attention"),e.k0s(),e.EFF(1246," Notez que les mod\xe8les qui ne sont pas enregistr\xe9s via la m\xe9thode "),e.j41(1247,"code"),e.EFF(1248,"forFeature()"),e.k0s(),e.EFF(1249,", mais qui sont seulement r\xe9f\xe9renc\xe9s \xe0 partir du mod\xe8le (via une association), ne seront pas inclus.\n"),e.k0s(),e.j41(1250,"h4",83)(1251,"span"),e.EFF(1252,"Transactions Sequelize"),e.k0s()(),e.j41(1253,"p"),e.EFF(1254,"Une transaction de base de donn\xe9es symbolise une unit\xe9 de travail effectu\xe9e au sein d'un syst\xe8me de gestion de base de donn\xe9es par rapport \xe0 une base de donn\xe9es, et trait\xe9e de mani\xe8re coh\xe9rente et fiable, ind\xe9pendamment des autres transactions. Une transaction repr\xe9sente g\xe9n\xe9ralement toute modification apport\xe9e \xe0 une base de donn\xe9es ("),e.j41(1255,"a",56),e.EFF(1256,"en savoir plus"),e.k0s(),e.EFF(1257,")."),e.k0s(),e.j41(1258,"p"),e.EFF(1259,"Il existe de nombreuses strat\xe9gies diff\xe9rentes pour g\xe9rer les "),e.j41(1260,"a",84),e.EFF(1261,"transactions Sequelize"),e.k0s(),e.EFF(1262,". Vous trouverez ci-dessous un exemple de mise en \u0153uvre d'une transaction g\xe9r\xe9e (auto-callback)."),e.k0s(),e.j41(1263,"p"),e.EFF(1264,"Tout d'abord, nous devons injecter l'objet "),e.j41(1265,"code"),e.EFF(1266,"Sequelize"),e.k0s(),e.EFF(1267," dans une classe de la mani\xe8re habituelle :"),e.k0s(),e.j41(1268,"app-copy-button")(1269,"pre")(1270,"code",42),e.EFF(1271,"\n@Injectable()\nexport class UsersService {\n  constructor(private sequelize: Sequelize) {}\n}\n"),e.k0s()()(),e.j41(1272,"blockquote",45)(1273,"strong"),e.EFF(1274,"Astuce"),e.k0s(),e.EFF(1275," La classe "),e.j41(1276,"code"),e.EFF(1277,"Sequelize"),e.k0s(),e.EFF(1278," est import\xe9e du package "),e.j41(1279,"code"),e.EFF(1280,"sequelize-typescript"),e.k0s(),e.EFF(1281,".\n"),e.k0s(),e.j41(1282,"p"),e.EFF(1283,"Nous pouvons maintenant utiliser cet objet pour cr\xe9er une transaction."),e.k0s(),e.j41(1284,"app-copy-button")(1285,"pre")(1286,"code",42),e.EFF(1287,"\nasync createMany() {\n  try {\n    await this.sequelize.transaction(async t => {\n      const transactionHost = { transaction: t };\n\n      await this.userModel.create(\n          { firstName: 'Abraham', lastName: 'Lincoln' },\n          transactionHost,\n      );\n      await this.userModel.create(\n          { firstName: 'John', lastName: 'Boothe' },\n          transactionHost,\n      );\n    });\n  } catch (err) {\n    // La transaction a \xe9t\xe9 annul\xe9e\n    // err est le rejet de la cha\xeene de promesses renvoy\xe9e au callback de la transaction\n  }\n}\n"),e.k0s()()(),e.j41(1288,"blockquote",45)(1289,"strong"),e.EFF(1290,"Astuce"),e.k0s(),e.EFF(1291," Notez que l'instance "),e.j41(1292,"code"),e.EFF(1293,"Sequelize"),e.k0s(),e.EFF(1294," n'est utilis\xe9e que pour d\xe9marrer la transaction. Cependant, pour tester cette classe, il faudrait simuler l'objet "),e.j41(1295,"code"),e.EFF(1296,"Sequelize"),e.k0s(),e.EFF(1297," entier (qui expose plusieurs m\xe9thodes). Nous recommandons donc d'utiliser une classe factory d'aide (par exemple, "),e.j41(1298,"code"),e.EFF(1299,"TransactionRunner"),e.k0s(),e.EFF(1300,") et de d\xe9finir une interface avec un ensemble limit\xe9 de m\xe9thodes n\xe9cessaires pour maintenir les transactions. Cette technique rend l'utilisation de ces m\xe9thodes assez simple.\n"),e.k0s(),e.j41(1301,"h4",85)(1302,"span"),e.EFF(1303,"Migrations"),e.k0s()(),e.j41(1304,"p"),e.EFF(1305,"Les "),e.j41(1306,"a",86),e.EFF(1307,"Migrations"),e.k0s(),e.EFF(1308," permettent de mettre \xe0 jour de mani\xe8re incr\xe9mentale le sch\xe9ma de la base de donn\xe9es afin de le maintenir en phase avec le mod\xe8le de donn\xe9es de l'application tout en pr\xe9servant les donn\xe9es existantes dans la base de donn\xe9es. Pour g\xe9n\xe9rer, ex\xe9cuter et inverser les migrations, Sequelize fournit une "),e.j41(1309,"a",87),e.EFF(1310,"CLI"),e.k0s(),e.EFF(1311," d\xe9di\xe9."),e.k0s(),e.j41(1312,"p"),e.EFF(1313,"Les classes de migration sont distinctes du code source de l'application Nest. Leur cycle de vie est g\xe9r\xe9 par l'interface de programmation Sequelize. Par cons\xe9quent, vous n'\xeates pas en mesure de tirer parti de l'injection de d\xe9pendances et d'autres fonctionnalit\xe9s sp\xe9cifiques \xe0 Nest avec les migrations. Pour en savoir plus sur les migrations, suivez le guide dans la "),e.j41(1314,"a",87),e.EFF(1315,"documentation Sequelize"),e.k0s(),e.EFF(1316,"."),e.k0s(),e.j41(1317,"p"),e.nrm(1318,"app-banner-courses"),e.k0s(),e.j41(1319,"h4",88)(1320,"span"),e.EFF(1321,"Bases de donn\xe9es multiples"),e.k0s()(),e.j41(1322,"p"),e.EFF(1323,"Certains projets n\xe9cessitent des connexions multiples \xe0 des bases de donn\xe9es. Ce module permet \xe9galement d'y parvenir. Pour travailler avec plusieurs connexions, il faut d'abord cr\xe9er les connexions. Dans ce cas, le nom de la connexion devient "),e.j41(1324,"strong"),e.EFF(1325,"obligatoire"),e.k0s(),e.EFF(1326,"."),e.k0s(),e.j41(1327,"p"),e.EFF(1328,"Supposons que vous ayez une entit\xe9 "),e.j41(1329,"code"),e.EFF(1330,"Album"),e.k0s(),e.EFF(1331," stock\xe9e dans sa propre base de donn\xe9es."),e.k0s(),e.j41(1332,"app-copy-button")(1333,"pre")(1334,"code",42),e.EFF(1335,"\nconst defaultOptions = {\n  dialect: 'postgres',\n  port: 5432,\n  username: 'user',\n  password: 'password',\n  database: 'db',\n  synchronize: true,\n};\n\n@Module({\n  imports: [\n    SequelizeModule.forRoot({\n      ...defaultOptions,\n      host: 'user_db_host',\n      models: [User],\n    }),\n    SequelizeModule.forRoot({\n      ...defaultOptions,\n      name: 'albumsConnection',\n      host: 'album_db_host',\n      models: [Album],\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(1336,"blockquote",43)(1337,"strong"),e.EFF(1338,"Remarque"),e.k0s(),e.EFF(1339," Si vous ne d\xe9finissez pas le "),e.j41(1340,"code"),e.EFF(1341,"name"),e.k0s(),e.EFF(1342," d'une connexion, son nom sera fix\xe9 \xe0 "),e.j41(1343,"code"),e.EFF(1344,"default"),e.k0s(),e.EFF(1345,". Notez que vous ne devriez pas avoir plusieurs connexions sans nom, ou avec le m\xeame nom, sinon elles seront \xe9cras\xe9es.\n"),e.k0s(),e.j41(1346,"p"),e.EFF(1347,"A ce stade, vous avez les mod\xe8les "),e.j41(1348,"code"),e.EFF(1349,"User"),e.k0s(),e.EFF(1350," et "),e.j41(1351,"code"),e.EFF(1352,"Album"),e.k0s(),e.EFF(1353," enregistr\xe9s avec leur propre connexion. Avec cette configuration, vous devez indiquer \xe0 la m\xe9thode "),e.j41(1354,"code"),e.EFF(1355,"SequelizeModule.forFeature()"),e.k0s(),e.EFF(1356," et au d\xe9corateur "),e.j41(1357,"code"),e.EFF(1358,"@InjectModel()"),e.k0s(),e.EFF(1359," quelle connexion doit \xeatre utilis\xe9e. Si vous ne passez pas de nom de connexion, la connexion "),e.j41(1360,"code"),e.EFF(1361,"default"),e.k0s(),e.EFF(1362," est utilis\xe9e."),e.k0s(),e.j41(1363,"app-copy-button")(1364,"pre")(1365,"code",42),e.EFF(1366,"\n@Module({\n  imports: [\n    SequelizeModule.forFeature([User]),\n    SequelizeModule.forFeature([Album], 'albumsConnection'),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(1367,"p"),e.EFF(1368,"Vous pouvez \xe9galement injecter l'instance "),e.j41(1369,"code"),e.EFF(1370,"Sequelize"),e.k0s(),e.EFF(1371," pour une connexion donn\xe9e :"),e.k0s(),e.j41(1372,"app-copy-button")(1373,"pre")(1374,"code",42),e.EFF(1375,"\n@Injectable()\nexport class AlbumsService {\n  constructor(\n    @InjectConnection('albumsConnection')\n    private sequelize: Sequelize,\n  ) {}\n}\n"),e.k0s()()(),e.j41(1376,"p"),e.EFF(1377,"Il est \xe9galement possible d'injecter n'importe quelle instance de "),e.j41(1378,"code"),e.EFF(1379,"Sequelize"),e.k0s(),e.EFF(1380," dans les fournisseurs :"),e.k0s(),e.j41(1381,"app-copy-button")(1382,"pre")(1383,"code",42),e.EFF(1384,"\n@Module({\n  providers: [\n    {\n      provide: AlbumsService,\n      useFactory: (albumsSequelize: Sequelize) => {\n        return new AlbumsService(albumsSequelize);\n      },\n      inject: [getDataSourceToken('albumsConnection')],\n    },\n  ],\n})\nexport class AlbumsModule {}\n"),e.k0s()()(),e.j41(1385,"h4",89)(1386,"span"),e.EFF(1387,"Tests"),e.k0s()(),e.j41(1388,"p"),e.EFF(1389,"Lorsqu'il s'agit de tester une application de mani\xe8re unitaire, nous voulons g\xe9n\xe9ralement \xe9viter d'\xe9tablir une connexion \xe0 la base de donn\xe9es, afin que nos suites de tests restent ind\xe9pendantes et que leur processus d'ex\xe9cution soit aussi rapide que possible. Mais nos classes peuvent d\xe9pendre de mod\xe8les qui sont tir\xe9s de l'instance de connexion. Comment g\xe9rer cela ? La solution consiste \xe0 cr\xe9er des mod\xe8les fictifs. Pour ce faire, nous mettons en place des "),e.j41(1390,"a",69),e.EFF(1391,"fournisseurs personnalis\xe9s"),e.k0s(),e.EFF(1392,". Chaque mod\xe8le enregistr\xe9 est automatiquement repr\xe9sent\xe9 par un jeton "),e.j41(1393,"code"),e.EFF(1394,"<ModelName>Model"),e.k0s(),e.EFF(1395,", o\xf9 "),e.j41(1396,"code"),e.EFF(1397,"ModelName"),e.k0s(),e.EFF(1398," est le nom de votre classe de mod\xe8le."),e.k0s(),e.j41(1399,"p"),e.EFF(1400,"Le package "),e.j41(1401,"code"),e.EFF(1402,"@nestjs/sequelize"),e.k0s(),e.EFF(1403," expose la fonction "),e.j41(1404,"code"),e.EFF(1405,"getModelToken()"),e.k0s(),e.EFF(1406," qui retourne un jeton pr\xe9par\xe9 bas\xe9 sur un mod\xe8le donn\xe9."),e.k0s(),e.j41(1407,"app-copy-button")(1408,"pre")(1409,"code",42),e.EFF(1410,"\n@Module({\n  providers: [\n    UsersService,\n    {\n      provide: getModelToken(User),\n      useValue: mockModel,\n    },\n  ],\n})\nexport class UsersModule {}\n"),e.k0s()()(),e.j41(1411,"p"),e.EFF(1412,"Maintenant, un substitut "),e.j41(1413,"code"),e.EFF(1414,"mockModel"),e.k0s(),e.EFF(1415," sera utilis\xe9 comme "),e.j41(1416,"code"),e.EFF(1417,"UserModel"),e.k0s(),e.EFF(1418,". Chaque fois qu'une classe demandera le "),e.j41(1419,"code"),e.EFF(1420,"Mod\xe8leUtilisateur"),e.k0s(),e.EFF(1421," en utilisant un d\xe9corateur "),e.j41(1422,"code"),e.EFF(1423,"@InjectModel()"),e.k0s(),e.EFF(1424,", Nest utilisera l'objet "),e.j41(1425,"code"),e.EFF(1426,"mockModel"),e.k0s(),e.EFF(1427," enregistr\xe9."),e.k0s(),e.j41(1428,"h4",90)(1429,"span"),e.EFF(1430,"Configuration asynchrone"),e.k0s()(),e.j41(1431,"p"),e.EFF(1432,"Vous pouvez vouloir passer vos options "),e.j41(1433,"code"),e.EFF(1434,"SequelizeModule"),e.k0s(),e.EFF(1435," de mani\xe8re asynchrone plut\xf4t que statique. Dans ce cas, utilisez la m\xe9thode "),e.j41(1436,"code"),e.EFF(1437,"forRootAsync()"),e.k0s(),e.EFF(1438,", qui fournit plusieurs fa\xe7ons de g\xe9rer la configuration asynchrone."),e.k0s(),e.j41(1439,"p"),e.EFF(1440,"Une approche consiste \xe0 utiliser une fonction d'usine :"),e.k0s(),e.j41(1441,"app-copy-button")(1442,"pre")(1443,"code",42),e.EFF(1444,"\nSequelizeModule.forRootAsync({\n  useFactory: () => ({\n    dialect: 'mysql',\n    host: 'localhost',\n    port: 3306,\n    username: 'root',\n    password: 'root',\n    database: 'test',\n    models: [],\n  }),\n});\n"),e.k0s()()(),e.j41(1445,"p"),e.EFF(1446,"Notre factory se comporte comme n'importe quel autre "),e.j41(1447,"a",71),e.EFF(1448,"fournisseur asynchrone"),e.k0s(),e.EFF(1449," (par exemple, il peut \xeatre "),e.j41(1450,"code"),e.EFF(1451,"async"),e.k0s(),e.EFF(1452," et il est capable d'injecter des d\xe9pendances via "),e.j41(1453,"code"),e.EFF(1454,"inject"),e.k0s(),e.EFF(1455,")."),e.k0s(),e.j41(1456,"app-copy-button")(1457,"pre")(1458,"code",42),e.EFF(1459,"\nSequelizeModule.forRootAsync({\n  imports: [ConfigModule],\n  useFactory: (configService: ConfigService) => ({\n    dialect: 'mysql',\n    host: configService.get('HOST'),\n    port: +configService.get('PORT'),\n    username: configService.get('USERNAME'),\n    password: configService.get('PASSWORD'),\n    database: configService.get('DATABASE'),\n    models: [],\n  }),\n  inject: [ConfigService],\n});\n"),e.k0s()()(),e.j41(1460,"p"),e.EFF(1461,"Vous pouvez \xe9galement utiliser la syntaxe "),e.j41(1462,"code"),e.EFF(1463,"useClass"),e.k0s(),e.EFF(1464," :"),e.k0s(),e.j41(1465,"app-copy-button")(1466,"pre")(1467,"code",42),e.EFF(1468,"\nSequelizeModule.forRootAsync({\n  useClass: SequelizeConfigService,\n});\n"),e.k0s()()(),e.j41(1469,"p"),e.EFF(1470,"La construction ci-dessus instanciera "),e.j41(1471,"code"),e.EFF(1472,"SequelizeConfigService"),e.k0s(),e.EFF(1473," dans "),e.j41(1474,"code"),e.EFF(1475,"SequelizeModule"),e.k0s(),e.EFF(1476," et l'utilisera pour fournir un objet d'options en appelant "),e.j41(1477,"code"),e.EFF(1478,"createSequelizeOptions()"),e.k0s(),e.EFF(1479,". Notez que cela signifie que le "),e.j41(1480,"code"),e.EFF(1481,"SequelizeConfigService"),e.k0s(),e.EFF(1482," doit impl\xe9menter l'interface "),e.j41(1483,"code"),e.EFF(1484,"SequelizeOptionsFactory"),e.k0s(),e.EFF(1485,", comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(1486,"app-copy-button")(1487,"pre")(1488,"code",42),e.EFF(1489,"\n@Injectable()\nclass SequelizeConfigService implements SequelizeOptionsFactory {\n  createSequelizeOptions(): SequelizeModuleOptions {\n    return {\n      dialect: 'mysql',\n      host: 'localhost',\n      port: 3306,\n      username: 'root',\n      password: 'root',\n      database: 'test',\n      models: [],\n    };\n  }\n}\n"),e.k0s()()(),e.j41(1490,"p"),e.EFF(1491,"Afin d'\xe9viter la cr\xe9ation de "),e.j41(1492,"code"),e.EFF(1493,"SequelizeConfigService"),e.k0s(),e.EFF(1494," dans "),e.j41(1495,"code"),e.EFF(1496,"SequelizeModule"),e.k0s(),e.EFF(1497," et d'utiliser un fournisseur import\xe9 d'un module diff\xe9rent, vous pouvez utiliser la syntaxe "),e.j41(1498,"code"),e.EFF(1499,"useExisting"),e.k0s(),e.EFF(1500,"."),e.k0s(),e.j41(1501,"app-copy-button")(1502,"pre")(1503,"code",42),e.EFF(1504,"\nSequelizeModule.forRootAsync({\n  imports: [ConfigModule],\n  useExisting: ConfigService,\n});\n"),e.k0s()()(),e.j41(1505,"p"),e.EFF(1506,"Cette construction fonctionne de la m\xeame mani\xe8re que "),e.j41(1507,"code"),e.EFF(1508,"useClass"),e.k0s(),e.EFF(1509," avec une diff\xe9rence essentielle - "),e.j41(1510,"code"),e.EFF(1511,"SequelizeModule"),e.k0s(),e.EFF(1512," va chercher dans les modules import\xe9s pour r\xe9utiliser un "),e.j41(1513,"code"),e.EFF(1514,"ConfigService"),e.k0s(),e.EFF(1515," existant au lieu d'en instancier un nouveau."),e.k0s(),e.j41(1516,"h4",91)(1517,"span"),e.EFF(1518,"Exemple"),e.k0s()(),e.j41(1519,"p"),e.EFF(1520,"Un exemple concret est disponible "),e.j41(1521,"a",92),e.EFF(1522,"ici"),e.k0s(),e.EFF(1523,"."),e.k0s()()),2&o){const u=e.sdS(89),r=e.sdS(162),p=e.sdS(189),l=e.sdS(230),d=e.sdS(244),m=e.sdS(267),f=e.sdS(294),v=e.sdS(314),b=e.sdS(372),h=e.sdS(405),y=e.sdS(927),g=e.sdS(1004),q=e.sdS(1024),C=e.sdS(1065),Q=e.sdS(1079),S=e.sdS(1102),H=e.sdS(1129),G=e.sdS(1149),W=e.sdS(1195),K=e.sdS(1231);e.R7$(86),e.SpI(" ",e.i5U(87,36,"app.module",u.isJsActive),"\n"),e.R7$(73),e.SpI(" ",e.i5U(160,39,"app.module",r.isJsActive),"\n"),e.R7$(4),e.AVh("hide",r.isJsActive),e.R7$(3),e.AVh("hide",!r.isJsActive),e.R7$(20),e.SpI(" ",e.i5U(187,42,"user.entity",p.isJsActive),"\n"),e.R7$(41),e.SpI(" ",e.i5U(228,45,"app.module",l.isJsActive),"\n"),e.R7$(14),e.SpI(" ",e.i5U(242,48,"users.module",d.isJsActive),"\n"),e.R7$(23),e.SpI(" ",e.i5U(265,51,"users.service",m.isJsActive),"\n"),e.R7$(4),e.AVh("hide",m.isJsActive),e.R7$(3),e.AVh("hide",!m.isJsActive),e.R7$(20),e.SpI(" ",e.i5U(292,54,"users.module",f.isJsActive),"\n"),e.R7$(20),e.SpI(" ",e.i5U(312,57,"users-http.module",v.isJsActive),"\n"),e.R7$(58),e.SpI(" ",e.i5U(370,60,"user.entity",b.isJsActive),"\n"),e.R7$(33),e.SpI(" ",e.i5U(403,63,"app.module",h.isJsActive),"\n"),e.R7$(522),e.SpI(" ",e.i5U(925,66,"app.module",y.isJsActive),"\n"),e.R7$(77),e.SpI(" ",e.i5U(1002,69,"app.service",g.isJsActive),"\n"),e.R7$(4),e.AVh("hide",g.isJsActive),e.R7$(3),e.AVh("hide",!g.isJsActive),e.R7$(13),e.SpI(" ",e.i5U(1022,72,"user.model",q.isJsActive),"\n"),e.R7$(41),e.SpI(" ",e.i5U(1063,75,"app.module",C.isJsActive),"\n"),e.R7$(14),e.SpI(" ",e.i5U(1077,78,"users.module",Q.isJsActive),"\n"),e.R7$(23),e.SpI(" ",e.i5U(1100,81,"users.service",S.isJsActive),"\n"),e.R7$(4),e.AVh("hide",S.isJsActive),e.R7$(3),e.AVh("hide",!S.isJsActive),e.R7$(20),e.SpI(" ",e.i5U(1127,84,"users.module",H.isJsActive),"\n"),e.R7$(20),e.SpI(" ",e.i5U(1147,87,"users-http.module",G.isJsActive),"\n"),e.R7$(46),e.SpI(" ",e.i5U(1193,90,"user.model",W.isJsActive),"\n"),e.R7$(36),e.SpI(" ",e.i5U(1229,93,"app.module",K.isJsActive),"\n")}},dependencies:[E.O,i.a,A.Q,x.d,z._,c.z,j.Wk,k.M],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Base de donn\xe9es"}},{path:"mongodb",component:D,data:{title:"MongoDB"}},{path:"file-upload",component:O,data:{title:"T\xe9l\xe9chargement de fichiers"}},{path:"streaming-files",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-streaming-files"]],features:[e.Vt3],decls:106,vars:0,consts:[["contentReference",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/streaming-files.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","flux-de-fichier"],[1,"info"],[1,"language-ts"],["appAnchor","","id","classe-streamablefile"],["appAnchor","","id","support-multi-plateforme"],["appAnchor","","id","exemple"],["href","/controllers#headers"]],template:function(o,t){1&o&&(e.j41(0,"div",1,0)(2,"div",2)(3,"a",3),e.nrm(4,"i",4),e.k0s()(),e.j41(5,"h3",5),e.EFF(6,"Flux de fichier"),e.k0s(),e.j41(7,"blockquote",6)(8,"strong"),e.EFF(9,"Note"),e.k0s(),e.EFF(10," Ce chapitre montre comment vous pouvez diffuser des fichiers \xe0 partir de votre "),e.j41(11,"strong"),e.EFF(12,"application HTTP"),e.k0s(),e.EFF(13,". Les exemples pr\xe9sent\xe9s ci-dessous ne s'appliquent pas aux applications GraphQL ou Microservice.\n"),e.k0s(),e.j41(14,"p"),e.EFF(15,"Il peut arriver que vous souhaitiez renvoyer un fichier au client \xe0 partir de votre API REST. Pour ce faire avec Nest, vous devez normalement proc\xe9der comme suit :"),e.k0s(),e.j41(16,"app-copy-button")(17,"pre")(18,"code",7),e.EFF(19,"\n@Controller('file')\nexport class FileController {\n  @Get()\n  getFile(@Res() res: Response) {\n    const file = createReadStream(join(process.cwd(), 'package.json'));\n    file.pipe(res);\n  }\n}\n"),e.k0s()()(),e.j41(20,"p"),e.EFF(21,"Mais en faisant cela, vous finissez par perdre l'acc\xe8s \xe0 votre logique d'interception post-contr\xf4leur. Pour g\xe9rer cela, vous pouvez retourner une instance de "),e.j41(22,"code"),e.EFF(23,"StreamableFile"),e.k0s(),e.EFF(24," et sous le capot, le framework s'occupera du piping de la r\xe9ponse."),e.k0s(),e.j41(25,"h4",8)(26,"span"),e.EFF(27,"Classe StreamableFile"),e.k0s()(),e.j41(28,"p"),e.EFF(29,"Un "),e.j41(30,"code"),e.EFF(31,"StreamableFile"),e.k0s(),e.EFF(32," est une classe qui conserve le flux qui doit \xeatre retourn\xe9. Pour cr\xe9er un nouveau "),e.j41(33,"code"),e.EFF(34,"StreamableFile"),e.k0s(),e.EFF(35,", vous pouvez passer un "),e.j41(36,"code"),e.EFF(37,"Buffer"),e.k0s(),e.EFF(38," ou un "),e.j41(39,"code"),e.EFF(40,"Stream"),e.k0s(),e.EFF(41," au constructeur de "),e.j41(42,"code"),e.EFF(43,"StreamableFile"),e.k0s(),e.EFF(44,"."),e.k0s(),e.j41(45,"blockquote",6)(46,"strong"),e.EFF(47,"Astuce"),e.k0s(),e.EFF(48," La classe "),e.j41(49,"code"),e.EFF(50,"StreamableFile"),e.k0s(),e.EFF(51," peut \xeatre import\xe9e depuis "),e.j41(52,"code"),e.EFF(53,"@nestjs/common"),e.k0s(),e.EFF(54,".\n"),e.k0s(),e.j41(55,"h4",9)(56,"span"),e.EFF(57,"Support multi-plateforme"),e.k0s()(),e.j41(58,"p"),e.EFF(59,"Fastify, par d\xe9faut, peut supporter l'envoi de fichiers sans avoir besoin d'appeler "),e.j41(60,"code"),e.EFF(61,"stream.pipe(res)"),e.k0s(),e.EFF(62,", donc vous n'avez pas besoin d'utiliser la classe "),e.j41(63,"code"),e.EFF(64,"StreamableFile"),e.k0s(),e.EFF(65,". Cependant, Nest supporte l'utilisation de "),e.j41(66,"code"),e.EFF(67,"StreamableFile"),e.k0s(),e.EFF(68," dans les deux types de plateformes, donc si vous passez d'Express \xe0 Fastify, il n'y a pas besoin de s'inqui\xe9ter de la compatibilit\xe9 entre les deux moteurs."),e.k0s(),e.j41(69,"h4",10)(70,"span"),e.EFF(71,"Exemple"),e.k0s()(),e.j41(72,"p"),e.EFF(73,"Vous pouvez trouver un exemple simple de retour du "),e.j41(74,"code"),e.EFF(75,"package.json"),e.k0s(),e.EFF(76," comme un fichier au lieu d'un JSON ci-dessous, mais l'id\xe9e s'\xe9tend naturellement aux images, aux documents, et \xe0 tout autre type de fichier."),e.k0s(),e.j41(77,"app-copy-button")(78,"pre")(79,"code",7),e.EFF(80,"\nimport { Controller, Get, StreamableFile } from '@nestjs/common';\nimport { createReadStream } from 'fs';\nimport { join } from 'path';\n\n@Controller('file')\nexport class FileController {\n  @Get()\n  getFile(): StreamableFile {\n    const file = createReadStream(join(process.cwd(), 'package.json'));\n    return new StreamableFile(file);\n  }\n}\n"),e.k0s()()(),e.j41(81,"p"),e.EFF(82,"Le type de contenu par d\xe9faut (la valeur de l'en-t\xeate de r\xe9ponse HTTP "),e.j41(83,"code"),e.EFF(84,"Content-Type"),e.k0s(),e.EFF(85,") est "),e.j41(86,"code"),e.EFF(87,"application/octet-stream"),e.k0s(),e.EFF(88,". Si vous avez besoin de personnaliser cette valeur, vous pouvez utiliser l'option "),e.j41(89,"code"),e.EFF(90,"type"),e.k0s(),e.EFF(91," de "),e.j41(92,"code"),e.EFF(93,"StreamableFile"),e.k0s(),e.EFF(94,", ou utiliser la m\xe9thode "),e.j41(95,"code"),e.EFF(96,"res.set"),e.k0s(),e.EFF(97," ou le d\xe9corateur "),e.j41(98,"a",11)(99,"code"),e.EFF(100,"@Header()"),e.k0s()(),e.EFF(101,", comme ceci :"),e.k0s(),e.j41(102,"app-copy-button")(103,"pre")(104,"code",7),e.EFF(105,"\nimport { Controller, Get, StreamableFile, Res } from '@nestjs/common';\nimport { createReadStream } from 'fs';\nimport { join } from 'path';\nimport type { Response } from 'express'; // En partant du principe que nous utilisons l'adaptateur HTTP ExpressJS\n\n@Controller('file')\nexport class FileController {\n  @Get()\n  getFile(): StreamableFile {\n    const file = createReadStream(join(process.cwd(), 'package.json'));\n    return new StreamableFile(file, {\n      type: 'application/json',\n      disposition: 'attachment; filename=\"package.json\"',\n      // Si vous souhaitez d\xe9finir la valeur Content-Length avec une autre valeur au lieu de la longueur du fichier :\n      // length: 123,\n    });\n  }\n\n  // Or even:\n  @Get()\n  getFileChangingResponseObjDirectly(@Res({ passthrough: true }) res: Response): StreamableFile {\n    const file = createReadStream(join(process.cwd(), 'package.json'));\n    res.set({\n      'Content-Type': 'application/json',\n      'Content-Disposition': 'attachment; filename=\"package.json\"',\n    });\n    return new StreamableFile(file);\n  }\n\n  // Ou m\xeame :\n  @Get()\n  @Header('Content-Type', 'application/json')\n  @Header('Content-Disposition', 'attachment; filename=\"package.json\"')\n  getFileUsingStaticValues(): StreamableFile {\n    const file = createReadStream(join(process.cwd(), 'package.json'));\n    return new StreamableFile(file);\n  }  \n}\n"),e.k0s()()()())},dependencies:[i.a,c.z],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Flux de fichier"}},{path:"logger",component:N,data:{title:"Journalisation"}},{path:"performance",component:B,data:{title:"Performance (Fastify)"}},{path:"http-module",component:V,data:{title:"Module HTTP"}},{path:"configuration",component:w,data:{title:"Configuration"}},{path:"security",redirectTo:"/security/helmet"},{path:"cookies",component:T,data:{title:"Cookies"}},{path:"task-scheduling",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-task-scheduling"]],features:[e.Vt3],decls:671,vars:4,consts:[["contentReference",""],["app0db2cc9a7b69e0a5816817d64abd07b8200b33fb",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/task-scheduling.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","planification-des-t\xe2ches"],["rel","nofollow","target","_blank","href","https://en.wikipedia.org/wiki/Cron"],["rel","nofollow","target","_blank","href","https://github.com/kelektiv/node-cron"],["appAnchor","","id","installation"],[1,"language-bash"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],["href","techniques/task-scheduling#t\xe2ches-cron-d\xe9claratives"],["href","techniques/task-scheduling#d\xe9lais-d\xe9claratifs"],["href","techniques/task-scheduling#intervalles-d\xe9claratifs"],["appAnchor","","id","t\xe2ches-cron-d\xe9claratives"],["rel","nofollow","target","_blank","href","http://crontab.org/"],[1,"language-javascript"],[1,"info"],["href","http://momentjs.com/timezone/"],["href","/techniques/task-scheduling#dynamic-schedule-module-api"],["appAnchor","","id","intervalles-d\xe9claratifs"],["appAnchor","","id","d\xe9lais-d\xe9claratifs"],["appAnchor","","id","api-du-module-de-programmation-dynamique"],["appAnchor","","id","t\xe2ches-cron-dynamiques"],["href","/techniques/task-scheduling#t%C3%A2ches-cron-d%C3%A9claratives"],[1,"warning"],["appAnchor","","id","intervalles-dynamiques"],["appAnchor","","id","d\xe9lais-dynamiques"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/27-scheduling"]],template:function(o,t){if(1&o&&(e.j41(0,"div",2,0)(2,"div",3)(3,"a",4),e.nrm(4,"i",5),e.k0s()(),e.j41(5,"h3",6),e.EFF(6,"Planification des t\xe2ches"),e.k0s(),e.j41(7,"p"),e.EFF(8,"La planification des t\xe2ches vous permet de programmer l'ex\xe9cution d'un code arbitraire (m\xe9thodes/fonctions) \xe0 une date/heure fixe, \xe0 des intervalles r\xe9currents ou une fois apr\xe8s un intervalle sp\xe9cifi\xe9. Dans le monde Linux, cela est souvent g\xe9r\xe9 par des packages comme "),e.j41(9,"a",7),e.EFF(10,"cron"),e.k0s(),e.EFF(11," au niveau du syst\xe8me d'exploitation. Pour les applications Node.js, il existe plusieurs packages qui \xe9mulent les fonctionnalit\xe9s de type cron. Nest fournit le package "),e.j41(12,"code"),e.EFF(13,"@nestjs/schedule"),e.k0s(),e.EFF(14,", qui s'int\xe8gre au populaire package Node.js "),e.j41(15,"a",8),e.EFF(16,"cron"),e.k0s(),e.EFF(17,". Nous aborderons ce package dans le pr\xe9sent chapitre."),e.k0s(),e.j41(18,"h4",9)(19,"span"),e.EFF(20,"Installation"),e.k0s()(),e.j41(21,"p"),e.EFF(22,"Pour commencer \xe0 l'utiliser, nous devons d'abord installer les d\xe9pendances n\xe9cessaires."),e.k0s(),e.j41(23,"pre")(24,"code",10),e.EFF(25,"\n$ npm install --save @nestjs/schedule\n"),e.k0s()(),e.j41(26,"p"),e.EFF(27,"Pour activer la planification des t\xe2ches, importez le module "),e.j41(28,"code"),e.EFF(29,"ScheduleModule"),e.k0s(),e.EFF(30," dans le module racine "),e.j41(31,"code"),e.EFF(32,"AppModule"),e.k0s(),e.EFF(33," et ex\xe9cutez la m\xe9thode statique "),e.j41(34,"code"),e.EFF(35,"forRoot()"),e.k0s(),e.EFF(36," comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(37,"app-copy-button",11)(38,"span",12),e.EFF(39),e.nI1(40,"extension"),e.nrm(41,"app-tabs",null,1),e.k0s(),e.j41(43,"pre")(44,"code",13),e.EFF(45,"\nimport { Module } from '@nestjs/common';\nimport { ScheduleModule } from '@nestjs/schedule';\n\n@Module({\n  imports: [\n    ScheduleModule.forRoot()\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(46,"p"),e.EFF(47,"L'appel \xe0 "),e.j41(48,"code"),e.EFF(49,".forRoot()"),e.k0s(),e.EFF(50," initialise l'ordonnanceur et enregistre tous les "),e.j41(51,"a",14),e.EFF(52,"t\xe2ches cron"),e.k0s(),e.EFF(53,", "),e.j41(54,"a",15),e.EFF(55,"d\xe9lais"),e.k0s(),e.EFF(56," et "),e.j41(57,"a",16),e.EFF(58,"intervalles"),e.k0s(),e.EFF(59," d\xe9claratifs qui existent dans votre application. L'enregistrement a lieu lorsque le hook du cycle de vie "),e.j41(60,"code"),e.EFF(61,"onApplicationBootstrap"),e.k0s(),e.EFF(62," se produit, ce qui permet de s'assurer que tous les modules ont \xe9t\xe9 charg\xe9s et qu'ils ont d\xe9clar\xe9 tous les travaux programm\xe9s. "),e.k0s(),e.j41(63,"h4",17)(64,"span"),e.EFF(65,"T\xe2ches cron d\xe9claratives"),e.k0s()(),e.j41(66,"p"),e.EFF(67,"Un cron job planifie l'ex\xe9cution automatique d'une fonction arbitraire (appel de m\xe9thode). Les t\xe2ches cron peuvent s'ex\xe9cuter :"),e.k0s(),e.j41(68,"ul")(69,"li"),e.EFF(70,"Une fois, \xe0 une date/heure donn\xe9e."),e.k0s(),e.j41(71,"li"),e.EFF(72,"Sur une base r\xe9currente ; les t\xe2ches r\xe9currentes peuvent \xeatre ex\xe9cut\xe9es \xe0 un moment pr\xe9cis dans un intervalle donn\xe9 (par exemple, une fois par heure, une fois par semaine, une fois toutes les 5 minutes)."),e.k0s()(),e.j41(73,"p"),e.EFF(74,"D\xe9clarez un cron job avec le d\xe9corateur "),e.j41(75,"code"),e.EFF(76,"@Cron()"),e.k0s(),e.EFF(77," pr\xe9c\xe9dant la d\xe9finition de la m\xe9thode contenant le code \xe0 ex\xe9cuter, comme suit :"),e.k0s(),e.j41(78,"app-copy-button")(79,"pre")(80,"code",13),e.EFF(81,"\nimport { Injectable, Logger } from '@nestjs/common';\nimport { Cron } from '@nestjs/schedule';\n\n@Injectable()\nexport class TasksService {\n  private readonly logger = new Logger(TasksService.name);\n\n  @Cron('45 * * * * *')\n  handleCron() {\n    this.logger.debug('Appel\xe9 lorsque la seconde courante est \xe0 45');\n  }\n}\n"),e.k0s()()(),e.j41(82,"p"),e.EFF(83,"Dans cet exemple, la m\xe9thode "),e.j41(84,"code"),e.EFF(85,"handleCron()"),e.k0s(),e.EFF(86," sera appel\xe9e chaque fois que la seconde courante est "),e.j41(87,"code"),e.EFF(88,"45"),e.k0s(),e.EFF(89,". En d'autres termes, la m\xe9thode sera ex\xe9cut\xe9e une fois par minute, au bout de 45 secondes."),e.k0s(),e.j41(90,"p"),e.EFF(91,"Le d\xe9corateur "),e.j41(92,"code"),e.EFF(93,"@Cron()"),e.k0s(),e.EFF(94," supporte les "),e.j41(95,"a",18),e.EFF(96,"motifs cron"),e.k0s(),e.EFF(97," standards suivants :"),e.k0s(),e.j41(98,"ul")(99,"li"),e.EFF(100,"Ast\xe9risque (par exemple "),e.j41(101,"code"),e.EFF(102,"*"),e.k0s(),e.EFF(103,")"),e.k0s(),e.j41(104,"li"),e.EFF(105,"Plages (par exemple "),e.j41(106,"code"),e.EFF(107,"1-3,5"),e.k0s(),e.EFF(108,")"),e.k0s(),e.j41(109,"li"),e.EFF(110,"Pas (par exemple "),e.j41(111,"code"),e.EFF(112,"*/2"),e.k0s(),e.EFF(113,")"),e.k0s()(),e.j41(114,"p"),e.EFF(115,"Dans l'exemple ci-dessus, nous avons pass\xe9 "),e.j41(116,"code"),e.EFF(117,"45 * * * * *"),e.k0s(),e.EFF(118," au d\xe9corateur. La cl\xe9 suivante montre comment chaque position dans la cha\xeene de caract\xe8res du motif cron est interpr\xe9t\xe9e :"),e.k0s(),e.j41(119,"pre",19)(120,"code",19),e.EFF(121,"\n* * * * * *\n| | | | | |\n| | | | | jour de la semaine\n| | | | mois\n| | jour du mois\n| heures\n| minutes\nsecondes (facultatif)\n"),e.k0s()(),e.j41(122,"p"),e.EFF(123,"Voici quelques exemples de mod\xe8les de cron :"),e.k0s(),e.j41(124,"table")(125,"tbody")(126,"tr")(127,"td")(128,"code"),e.EFF(129,"* * * * * *"),e.k0s()(),e.j41(130,"td"),e.EFF(131,"chaque seconde"),e.k0s()(),e.j41(132,"tr")(133,"td")(134,"code"),e.EFF(135,"45 * * * * *"),e.k0s()(),e.j41(136,"td"),e.EFF(137,"toutes les minutes, \xe0 la 45e seconde"),e.k0s()(),e.j41(138,"tr")(139,"td")(140,"code"),e.EFF(141,"0 10 * * * *"),e.k0s()(),e.j41(142,"td"),e.EFF(143,"toutes les heures, au d\xe9but de la 10e minute"),e.k0s()(),e.j41(144,"tr")(145,"td")(146,"code"),e.EFF(147,"0 */30 9-17 * * *"),e.k0s()(),e.j41(148,"td"),e.EFF(149,"toutes les 30 minutes entre 9h et 17h"),e.k0s()(),e.j41(150,"tr")(151,"td")(152,"code"),e.EFF(153,"0 30 11 * * 1-5"),e.k0s()(),e.j41(154,"td"),e.EFF(155,"Du lundi au vendredi \xe0 11h30"),e.k0s()()()(),e.j41(156,"p"),e.EFF(157,"Le package "),e.j41(158,"code"),e.EFF(159,"@nestjs/schedule"),e.k0s(),e.EFF(160," fournit un enum pratique avec des mod\xe8les de cron couramment utilis\xe9s. Vous pouvez utiliser cette liste comme suit :"),e.k0s(),e.j41(161,"app-copy-button")(162,"pre")(163,"code",13),e.EFF(164,"\nimport { Injectable, Logger } from '@nestjs/common';\nimport { Cron, CronExpression } from '@nestjs/schedule';\n\n@Injectable()\nexport class TasksService {\n  private readonly logger = new Logger(TasksService.name);\n\n  @Cron(CronExpression.EVERY_30_SECONDS)\n  handleCron() {\n    this.logger.debug('Appel\xe9 toutes les 30 secondes');\n  }\n}\n"),e.k0s()()(),e.j41(165,"p"),e.EFF(166,"Dans cet exemple, la m\xe9thode "),e.j41(167,"code"),e.EFF(168,"handleCron()"),e.k0s(),e.EFF(169," sera appel\xe9e toutes les "),e.j41(170,"code"),e.EFF(171,"30"),e.k0s(),e.EFF(172," secondes. Si une exception se produit, elle sera enregistr\xe9e dans la console, car chaque m\xe9thode annot\xe9e avec "),e.j41(173,"code"),e.EFF(174,"@Cron()"),e.k0s(),e.EFF(175," est automatiquement envelopp\xe9e dans un bloc "),e.j41(176,"code"),e.EFF(177,"try-catch"),e.k0s(),e.EFF(178,"."),e.k0s(),e.j41(179,"p"),e.EFF(180,"Vous pouvez \xe9galement fournir un objet JavaScript "),e.j41(181,"code"),e.EFF(182,"Date"),e.k0s(),e.EFF(183," au d\xe9corateur "),e.j41(184,"code"),e.EFF(185,"@Cron()"),e.k0s(),e.EFF(186,". Dans ce cas, la t\xe2che sera ex\xe9cut\xe9e une seule fois, \xe0 la date sp\xe9cifi\xe9e."),e.k0s(),e.j41(187,"blockquote",20)(188,"strong"),e.EFF(189,"Astuce"),e.k0s(),e.EFF(190," Utilisez l'arithm\xe9tique de date JavaScript pour planifier des t\xe2ches par rapport \xe0 la date actuelle. Par exemple, "),e.j41(191,"code"),e.EFF(192,"@Cron(new Date(Date.now() + 10 * 1000))"),e.k0s(),e.EFF(193," pour programmer une t\xe2che \xe0 ex\xe9cuter 10 secondes apr\xe8s le d\xe9marrage de l'application.\n"),e.k0s(),e.j41(194,"p"),e.EFF(195,"Vous pouvez \xe9galement fournir des options suppl\xe9mentaires en tant que second param\xe8tre du d\xe9corateur "),e.j41(196,"code"),e.EFF(197,"@Cron()"),e.k0s(),e.EFF(198,"."),e.k0s(),e.j41(199,"table")(200,"tbody")(201,"tr")(202,"td")(203,"code"),e.EFF(204,"name"),e.k0s()(),e.j41(205,"td"),e.EFF(206," Utile pour acc\xe9der \xe0 une t\xe2che cron et la contr\xf4ler apr\xe8s qu'elle a \xe9t\xe9 d\xe9clar\xe9e. "),e.k0s()(),e.j41(207,"tr")(208,"td")(209,"code"),e.EFF(210,"timeZone"),e.k0s()(),e.j41(211,"td"),e.EFF(212," Sp\xe9cifiez le fuseau horaire pour l'ex\xe9cution. Ceci modifiera l'heure actuelle par rapport \xe0 votre fuseau horaire. Si la zone horaire n'est pas valide, une erreur est g\xe9n\xe9r\xe9e. Vous pouvez consulter tous les fuseaux horaires disponibles sur le site "),e.j41(213,"a",21),e.EFF(214,"Moment Timezone"),e.k0s(),e.EFF(215,". "),e.k0s()(),e.j41(216,"tr")(217,"td")(218,"code"),e.EFF(219,"utcOffset"),e.k0s()(),e.j41(220,"td"),e.EFF(221," Cela vous permet de sp\xe9cifier le d\xe9calage de votre fuseau horaire plut\xf4t que d'utiliser le param\xe8tre "),e.j41(222,"code"),e.EFF(223,"timeZone"),e.k0s(),e.EFF(224,". "),e.k0s()(),e.j41(225,"tr")(226,"td")(227,"code"),e.EFF(228,"disabled"),e.k0s()(),e.j41(229,"td"),e.EFF(230," Ceci indique si la t\xe2che sera ex\xe9cut\xe9e ou non. "),e.k0s()()()(),e.j41(231,"app-copy-button")(232,"pre")(233,"code",13),e.EFF(234,"\nimport { Injectable } from '@nestjs/common';\nimport { Cron, CronExpression } from '@nestjs/schedule';\n\n@Injectable()\nexport class NotificationService {\n  @Cron('* * 0 * * *', {\n    name: 'notifications',\n    timeZone: 'Europe/Paris',\n  })\n  triggerNotifications() {}\n}\n"),e.k0s()()(),e.j41(235,"p"),e.EFF(236,"Vous pouvez acc\xe9der et contr\xf4ler une t\xe2che cron apr\xe8s qu'elle ait \xe9t\xe9 d\xe9clar\xe9e, ou cr\xe9er dynamiquement une t\xe2che cron (o\xf9 son mod\xe8le cron est d\xe9fini \xe0 l'ex\xe9cution) avec l'"),e.j41(237,"a",22),e.EFF(238,"Dynamic API"),e.k0s(),e.EFF(239,". Pour acc\xe9der \xe0 une t\xe2che cron d\xe9clarative via l'API, vous devez associer la t\xe2che \xe0 un nom en passant la propri\xe9t\xe9 "),e.j41(240,"code"),e.EFF(241,"name"),e.k0s(),e.EFF(242," dans un objet optionnel d'options en tant que deuxi\xe8me argument du d\xe9corateur."),e.k0s(),e.j41(243,"h4",23)(244,"span"),e.EFF(245,"Intervalles d\xe9claratifs"),e.k0s()(),e.j41(246,"p"),e.EFF(247,"Pour d\xe9clarer qu'une m\xe9thode doit s'ex\xe9cuter \xe0 un intervalle sp\xe9cifi\xe9 (r\xe9current), pr\xe9fixez la d\xe9finition de la m\xe9thode avec le d\xe9corateur "),e.j41(248,"code"),e.EFF(249,"@Interval()"),e.k0s(),e.EFF(250,". Passez la valeur de l'intervalle, sous la forme d'un nombre en millisecondes, au d\xe9corateur comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(251,"app-copy-button")(252,"pre")(253,"code",13),e.EFF(254,"\n@Interval(10000)\nhandleInterval() {\n  this.logger.debug('Appel\xe9 toutes les 10 secondes');\n}\n"),e.k0s()()(),e.j41(255,"blockquote",20)(256,"strong"),e.EFF(257,"Astuce"),e.k0s(),e.EFF(258," Ce m\xe9canisme utilise la fonction JavaScript "),e.j41(259,"code"),e.EFF(260,"setInterval()"),e.k0s(),e.EFF(261," sous le capot. Vous pouvez \xe9galement utiliser une t\xe2che cron pour programmer des t\xe2ches r\xe9currentes.\n"),e.k0s(),e.j41(262,"p"),e.EFF(263,"Si vous souhaitez contr\xf4ler votre intervalle d\xe9claratif depuis l'ext\xe9rieur de la classe d\xe9clarante via l'"),e.j41(264,"a",22),e.EFF(265,"API dynamique"),e.k0s(),e.EFF(266,", associez un nom \xe0 l'intervalle \xe0 l'aide de la construction suivante :"),e.k0s(),e.j41(267,"app-copy-button")(268,"pre")(269,"code",13),e.EFF(270,"\n@Interval('notifications', 2500)\nhandleInterval() {}\n"),e.k0s()()(),e.j41(271,"p"),e.EFF(272,"Si une exception se produit, elle sera enregistr\xe9e dans la console, car chaque m\xe9thode annot\xe9e avec "),e.j41(273,"code"),e.EFF(274,"@Interval()"),e.k0s(),e.EFF(275," est automatiquement envelopp\xe9e dans un bloc "),e.j41(276,"code"),e.EFF(277,"try-catch"),e.k0s(),e.EFF(278,"."),e.k0s(),e.j41(279,"p"),e.EFF(280,"L'"),e.j41(281,"a",22),e.EFF(282,"API dynamique"),e.k0s(),e.EFF(283," permet \xe9galement de "),e.j41(284,"strong"),e.EFF(285,"cr\xe9er"),e.k0s(),e.EFF(286," des intervalles dynamiques, dont les propri\xe9t\xe9s sont d\xe9finies au moment de l'ex\xe9cution, et de "),e.j41(287,"strong"),e.EFF(288,"lister et supprimer"),e.k0s(),e.EFF(289," ces intervalles."),e.k0s(),e.j41(290,"p"),e.nrm(291,"app-banner-enterprise"),e.k0s(),e.j41(292,"h4",24)(293,"span"),e.EFF(294,"D\xe9lais d\xe9claratifs"),e.k0s()(),e.j41(295,"p"),e.EFF(296,"Pour d\xe9clarer qu'une m\xe9thode doit s'ex\xe9cuter (une fois) \xe0 un d\xe9lai sp\xe9cifi\xe9, pr\xe9fixez la d\xe9finition de la m\xe9thode avec le d\xe9corateur "),e.j41(297,"code"),e.EFF(298,"@Timeout()"),e.k0s(),e.EFF(299,". Passez le d\xe9calage temporel relatif (en millisecondes), \xe0 partir du d\xe9marrage de l'application, au d\xe9corateur comme indiqu\xe9 ci-dessous :"),e.k0s(),e.j41(300,"app-copy-button")(301,"pre")(302,"code",13),e.EFF(303,"\n@Timeout(5000)\nhandleTimeout() {\n  this.logger.debug('Appel\xe9 une fois apr\xe8s 5 secondes');\n}\n"),e.k0s()()(),e.j41(304,"blockquote",20)(305,"strong"),e.EFF(306,"Astuce"),e.k0s(),e.EFF(307," Ce m\xe9canisme utilise la fonction JavaScript "),e.j41(308,"code"),e.EFF(309,"setTimeout()"),e.k0s(),e.EFF(310," sous le capot.\n"),e.k0s(),e.j41(311,"p"),e.EFF(312,"Si une exception se produit, elle sera enregistr\xe9e dans la console, car chaque m\xe9thode annot\xe9e avec "),e.j41(313,"code"),e.EFF(314,"@Timeout()"),e.k0s(),e.EFF(315," est automatiquement envelopp\xe9e dans un bloc "),e.j41(316,"code"),e.EFF(317,"try-catch"),e.k0s(),e.EFF(318,"."),e.k0s(),e.j41(319,"p"),e.EFF(320,"Si vous souhaitez contr\xf4ler votre d\xe9lai d\xe9claratif depuis l'ext\xe9rieur de la classe d\xe9clarante via l'"),e.j41(321,"a",22),e.EFF(322,"API dynamique"),e.k0s(),e.EFF(323,", associez le d\xe9lai \xe0 un nom \xe0 l'aide de la construction suivante :"),e.k0s(),e.j41(324,"app-copy-button")(325,"pre")(326,"code",13),e.EFF(327,"\n@Timeout('notifications', 2500)\nhandleTimeout() {}\n"),e.k0s()()(),e.j41(328,"p"),e.EFF(329,"L'"),e.j41(330,"a",22),e.EFF(331,"API dynamique"),e.k0s(),e.EFF(332," permet \xe9galement de "),e.j41(333,"strong"),e.EFF(334,"cr\xe9er"),e.k0s(),e.EFF(335," des d\xe9lais dynamiques, dont les propri\xe9t\xe9s sont d\xe9finies au moment de l'ex\xe9cution, et de "),e.j41(336,"strong"),e.EFF(337,"lister et supprimer"),e.k0s(),e.EFF(338," ces d\xe9lais."),e.k0s(),e.j41(339,"h4",25)(340,"span"),e.EFF(341,"API du module de programmation dynamique"),e.k0s()(),e.j41(342,"p"),e.EFF(343,"Le module "),e.j41(344,"code"),e.EFF(345,"@nestjs/schedule"),e.k0s(),e.EFF(346," fournit une API dynamique qui permet d'administrer les "),e.j41(347,"a",14),e.EFF(348,"t\xe2ches cron"),e.k0s(),e.EFF(349,", "),e.j41(350,"a",15),e.EFF(351,"d\xe9lais"),e.k0s(),e.EFF(352," et "),e.j41(353,"a",16),e.EFF(354,"intervalles"),e.k0s(),e.EFF(355," d\xe9claratifs. L'API permet \xe9galement de cr\xe9er et de g\xe9rer des t\xe2ches cron "),e.j41(356,"strong"),e.EFF(357,"dynamiques"),e.k0s(),e.EFF(358,", des d\xe9lais et des intervalles, dont les propri\xe9t\xe9s sont d\xe9finies au moment de l'ex\xe9cution."),e.k0s(),e.j41(359,"h4",26)(360,"span"),e.EFF(361,"T\xe2ches cron dynamiques"),e.k0s()(),e.j41(362,"p"),e.EFF(363,"Obtenir une r\xe9f\xe9rence \xe0 une instance de "),e.j41(364,"code"),e.EFF(365,"CronJob"),e.k0s(),e.EFF(366," par son nom depuis n'importe quel endroit de votre code en utilisant l'API "),e.j41(367,"code"),e.EFF(368,"SchedulerRegistry"),e.k0s(),e.EFF(369,". Tout d'abord, injectez "),e.j41(370,"code"),e.EFF(371,"SchedulerRegistry"),e.k0s(),e.EFF(372," en utilisant l'injection de constructeur standard :"),e.k0s(),e.j41(373,"app-copy-button")(374,"pre")(375,"code",13),e.EFF(376,"\nconstructor(private schedulerRegistry: SchedulerRegistry) {}\n"),e.k0s()()(),e.j41(377,"blockquote",20)(378,"strong"),e.EFF(379,"Astuce"),e.k0s(),e.EFF(380," Importez le "),e.j41(381,"code"),e.EFF(382,"SchedulerRegistry"),e.k0s(),e.EFF(383," depuis le package "),e.j41(384,"code"),e.EFF(385,"@nestjs/schedule"),e.k0s(),e.EFF(386,".\n"),e.k0s(),e.j41(387,"p"),e.EFF(388,"Utilisez-le ensuite dans une classe comme suit. Supposons qu'une t\xe2che cron ait \xe9t\xe9 cr\xe9\xe9e avec la d\xe9claration suivante :"),e.k0s(),e.j41(389,"app-copy-button")(390,"pre")(391,"code",13),e.EFF(392,"\n@Cron('* * 8 * * *', {\n  name: 'notifications',\n})\ntriggerNotifications() {}\n"),e.k0s()()(),e.j41(393,"p"),e.EFF(394,"Acc\xe9dez \xe0 ce poste en utilisant les moyens suivants :"),e.k0s(),e.j41(395,"app-copy-button")(396,"pre")(397,"code",13),e.EFF(398,"\nconst job = this.schedulerRegistry.getCronJob('notifications');\n\njob.stop();\nconsole.log(job.lastDate());\n"),e.k0s()()(),e.j41(399,"p"),e.EFF(400,"La m\xe9thode "),e.j41(401,"code"),e.EFF(402,"getCronJob()"),e.k0s(),e.EFF(403," retourne la t\xe2che cron nomm\xe9e. L'objet "),e.j41(404,"code"),e.EFF(405,"CronJob"),e.k0s(),e.EFF(406," retourn\xe9 poss\xe8de les m\xe9thodes suivantes :"),e.k0s(),e.j41(407,"ul")(408,"li")(409,"code"),e.EFF(410,"stop()"),e.k0s(),e.EFF(411," - arr\xeate une t\xe2che dont l'ex\xe9cution est programm\xe9e."),e.k0s(),e.j41(412,"li")(413,"code"),e.EFF(414,"start()"),e.k0s(),e.EFF(415," - red\xe9marre une t\xe2che qui a \xe9t\xe9 arr\xeat\xe9e."),e.k0s(),e.j41(416,"li")(417,"code"),e.EFF(418,"setTime(time: CronTime)"),e.k0s(),e.EFF(419," - arr\xeate une t\xe2che, fixe une nouvelle heure pour celle-ci, puis la d\xe9marre"),e.k0s(),e.j41(420,"li")(421,"code"),e.EFF(422,"lastDate()"),e.k0s(),e.EFF(423," - renvoie une repr\xe9sentation "),e.j41(424,"code"),e.EFF(425,"DateTime"),e.k0s(),e.EFF(426," de la date \xe0 laquelle la derni\xe8re ex\xe9cution d'une t\xe2che a eu lieu."),e.k0s(),e.j41(427,"li")(428,"code"),e.EFF(429,"nextDate()"),e.k0s(),e.EFF(430," - renvoie une repr\xe9sentation "),e.j41(431,"code"),e.EFF(432,"DateTime"),e.k0s(),e.EFF(433," de la date \xe0 laquelle la prochaine ex\xe9cution d'une t\xe2che est programm\xe9e."),e.k0s(),e.j41(434,"li")(435,"code"),e.EFF(436,"nextDates(count: number)"),e.k0s(),e.EFF(437," - Fournit un tableau (de taille "),e.j41(438,"code"),e.EFF(439,"count"),e.k0s(),e.EFF(440,") de repr\xe9sentations "),e.j41(441,"code"),e.EFF(442,"DateTime"),e.k0s(),e.EFF(443," pour la prochaine s\xe9rie de dates qui d\xe9clencheront l'ex\xe9cution de la t\xe2che. La valeur par d\xe9faut de "),e.j41(444,"code"),e.EFF(445,"count"),e.k0s(),e.EFF(446," est 0, ce qui renvoie un tableau vide."),e.k0s()(),e.j41(447,"blockquote",20)(448,"strong"),e.EFF(449,"Astuce"),e.k0s(),e.EFF(450," Utilisez "),e.j41(451,"code"),e.EFF(452,"toJSDate()"),e.k0s(),e.EFF(453," sur les objets "),e.j41(454,"code"),e.EFF(455,"DateTime"),e.k0s(),e.EFF(456," pour les convertir en une date JavaScript \xe9quivalente \xe0 cette DateTime.\n"),e.k0s(),e.j41(457,"p")(458,"strong"),e.EFF(459,"Cr\xe9ez"),e.k0s(),e.EFF(460," un nouveau job cron dynamiquement en utilisant la m\xe9thode "),e.j41(461,"code"),e.EFF(462,"SchedulerRegistry#addCronJob"),e.k0s(),e.EFF(463,", comme suit :"),e.k0s(),e.j41(464,"app-copy-button")(465,"pre")(466,"code",13),e.EFF(467,"\naddCronJob(name: string, seconds: string) {\n  const job = new CronJob(`${seconds} * * * * *`, () => {\n    this.logger.warn(`il est temps (${seconds}) pour la t\xe2che ${name} d'\xeatre ex\xe9cut\xe9e !`);\n  });\n\n  this.schedulerRegistry.addCronJob(name, job);\n  job.start();\n\n  this.logger.warn(\n    `t\xe2che ${name} ajout\xe9e pour chaque minute \xe0 ${seconds} secondes !`,\n  );\n}\n"),e.k0s()()(),e.j41(468,"p"),e.EFF(469,"Dans ce code nous utilisons l'objet "),e.j41(470,"code"),e.EFF(471,"CronJob"),e.k0s(),e.EFF(472," du package "),e.j41(473,"code"),e.EFF(474,"cron"),e.k0s(),e.EFF(475," pour cr\xe9er la t\xe2che cron. Le constructeur "),e.j41(476,"code"),e.EFF(477,"CronJob"),e.k0s(),e.EFF(478," prend un motif cron (tout comme le "),e.j41(479,"a",27),e.EFF(480,"d\xe9corateur"),e.k0s(),e.j41(481,"code"),e.EFF(482,"@Cron()"),e.k0s(),e.EFF(483,") comme premier argument, et un callback \xe0 ex\xe9cuter lorsque le timer cron se d\xe9clenche comme second argument. La m\xe9thode "),e.j41(484,"code"),e.EFF(485,"SchedulerRegistry#addCronJob"),e.k0s(),e.EFF(486," prend deux arguments : un nom pour le "),e.j41(487,"code"),e.EFF(488,"CronJob"),e.k0s(),e.EFF(489,", et l'objet "),e.j41(490,"code"),e.EFF(491,"CronJob"),e.k0s(),e.EFF(492," lui-m\xeame."),e.k0s(),e.j41(493,"blockquote",28)(494,"strong"),e.EFF(495,"Attention"),e.k0s(),e.EFF(496," N'oubliez pas d'injecter le "),e.j41(497,"code"),e.EFF(498,"SchedulerRegistry"),e.k0s(),e.EFF(499," avant d'y acc\xe9der. Importez "),e.j41(500,"code"),e.EFF(501,"CronJob"),e.k0s(),e.EFF(502," depuis le package "),e.j41(503,"code"),e.EFF(504,"cron"),e.k0s(),e.EFF(505,".\n"),e.k0s(),e.j41(506,"p")(507,"strong"),e.EFF(508,"Supprimez"),e.k0s(),e.EFF(509," une t\xe2che cron nomm\xe9e en utilisant la m\xe9thode "),e.j41(510,"code"),e.EFF(511,"SchedulerRegistry#deleteCronJob"),e.k0s(),e.EFF(512,", comme suit :"),e.k0s(),e.j41(513,"app-copy-button")(514,"pre")(515,"code",13),e.EFF(516,"\ndeleteCron(name: string) {\n  this.schedulerRegistry.deleteCronJob(name);\n  this.logger.warn(`t\xe2che ${name} supprim\xe9e !`);\n}\n"),e.k0s()()(),e.j41(517,"p")(518,"strong"),e.EFF(519,"Listez"),e.k0s(),e.EFF(520," tous les jobs cron en utilisant la m\xe9thode "),e.j41(521,"code"),e.EFF(522,"SchedulerRegistry#getCronJobs"),e.k0s(),e.EFF(523," comme suit :"),e.k0s(),e.j41(524,"app-copy-button")(525,"pre")(526,"code",13),e.EFF(527,"\ngetCrons() {\n  const jobs = this.schedulerRegistry.getCronJobs();\n  jobs.forEach((value, key, map) => {\n    let next;\n    try {\n      next = value.nextDate().toJSDate();\n    } catch (e) {\n      next = 'erreur : la date de la prochaine ex\xe9cution est d\xe9pass\xe9e !';\n    }\n    this.logger.log(`t\xe2che : ${key} -> prochaine : ${next}`);\n  });\n}\n"),e.k0s()()(),e.j41(528,"p"),e.EFF(529,"La m\xe9thode "),e.j41(530,"code"),e.EFF(531,"getCronJobs()"),e.k0s(),e.EFF(532," retourne une "),e.j41(533,"code"),e.EFF(534,"map"),e.k0s(),e.EFF(535,". Dans ce code, nous it\xe9rons sur la carte et essayons d'acc\xe9der \xe0 la m\xe9thode "),e.j41(536,"code"),e.EFF(537,"nextDate()"),e.k0s(),e.EFF(538," de chaque "),e.j41(539,"code"),e.EFF(540,"CronJob"),e.k0s(),e.EFF(541,". Dans l'API "),e.j41(542,"code"),e.EFF(543,"CronJob"),e.k0s(),e.EFF(544,", si un job a d\xe9j\xe0 \xe9t\xe9 ex\xe9cut\xe9 et n'a pas de date d'ex\xe9cution future, une exception est lev\xe9e."),e.k0s(),e.j41(545,"h4",29)(546,"span"),e.EFF(547,"Intervalles dynamiques"),e.k0s()(),e.j41(548,"p"),e.EFF(549,"Obtenez une r\xe9f\xe9rence \xe0 un intervalle avec la m\xe9thode "),e.j41(550,"code"),e.EFF(551,"SchedulerRegistry#getInterval"),e.k0s(),e.EFF(552,". Comme ci-dessus, injectez "),e.j41(553,"code"),e.EFF(554,"SchedulerRegistry"),e.k0s(),e.EFF(555," en utilisant l'injection de constructeur standard :"),e.k0s(),e.j41(556,"app-copy-button")(557,"pre")(558,"code",13),e.EFF(559,"\nconstructor(private schedulerRegistry: SchedulerRegistry) {}\n"),e.k0s()()(),e.j41(560,"p"),e.EFF(561,"Et utilisez-la comme suit :"),e.k0s(),e.j41(562,"app-copy-button")(563,"pre")(564,"code",13),e.EFF(565,"\nconst interval = this.schedulerRegistry.getInterval('notifications');\nclearInterval(interval);\n"),e.k0s()()(),e.j41(566,"p")(567,"strong"),e.EFF(568,"Cr\xe9ez"),e.k0s(),e.EFF(569," un nouvel intervalle dynamiquement en utilisant la m\xe9thode "),e.j41(570,"code"),e.EFF(571,"SchedulerRegistry#addInterval"),e.k0s(),e.EFF(572,", comme suit :"),e.k0s(),e.j41(573,"app-copy-button")(574,"pre")(575,"code",13),e.EFF(576,"\naddInterval(name: string, milliseconds: number) {\n  const callback = () => {\n    this.logger.warn(`Intervalle ${name} ex\xe9cut\xe9 \xe0 (${milliseconds}) !`);\n  };\n\n  const interval = setInterval(callback, milliseconds);\n  this.schedulerRegistry.addInterval(name, interval);\n}\n"),e.k0s()()(),e.j41(577,"p"),e.EFF(578,"Dans ce code, nous cr\xe9ons un intervalle JavaScript standard, puis nous le passons \xe0 la m\xe9thode "),e.j41(579,"code"),e.EFF(580,"SchedulerRegistry#addInterval"),e.k0s(),e.EFF(581,".\nCette m\xe9thode prend deux arguments : un nom pour l'intervalle et l'intervalle lui-m\xeame."),e.k0s(),e.j41(582,"p")(583,"strong"),e.EFF(584,"Supprimez"),e.k0s(),e.EFF(585," un intervalle nomm\xe9 en utilisant la m\xe9thode "),e.j41(586,"code"),e.EFF(587,"SchedulerRegistry#deleteInterval"),e.k0s(),e.EFF(588,", comme suit :"),e.k0s(),e.j41(589,"app-copy-button")(590,"pre")(591,"code",13),e.EFF(592,"\ndeleteInterval(name: string) {\n  this.schedulerRegistry.deleteInterval(name);\n  this.logger.warn(`Intervalle ${name} supprim\xe9 !`);\n}\n"),e.k0s()()(),e.j41(593,"p")(594,"strong"),e.EFF(595,"Listez"),e.k0s(),e.EFF(596," tous les intervalles en utilisant la m\xe9thode "),e.j41(597,"code"),e.EFF(598,"SchedulerRegistry#getIntervals"),e.k0s(),e.EFF(599," comme suit :"),e.k0s(),e.j41(600,"app-copy-button")(601,"pre")(602,"code",13),e.EFF(603,"\ngetIntervals() {\n  const intervals = this.schedulerRegistry.getIntervals();\n  intervals.forEach(key => this.logger.log(`Intervalle : ${key}`));\n}\n"),e.k0s()()(),e.j41(604,"h4",30)(605,"span"),e.EFF(606,"D\xe9lais dynamiques"),e.k0s()(),e.j41(607,"p"),e.EFF(608,"Obtenir une r\xe9f\xe9rence \xe0 un d\xe9lai avec la m\xe9thode "),e.j41(609,"code"),e.EFF(610,"SchedulerRegistry#getTimeout"),e.k0s(),e.EFF(611,". Comme ci-dessus, injectez "),e.j41(612,"code"),e.EFF(613,"SchedulerRegistry"),e.k0s(),e.EFF(614," en utilisant l'injection de constructeur standard :"),e.k0s(),e.j41(615,"app-copy-button")(616,"pre")(617,"code",13),e.EFF(618,"\nconstructor(private readonly schedulerRegistry: SchedulerRegistry) {}\n"),e.k0s()()(),e.j41(619,"p"),e.EFF(620,"Et utilisez-le comme suit :"),e.k0s(),e.j41(621,"app-copy-button")(622,"pre")(623,"code",13),e.EFF(624,"\nconst timeout = this.schedulerRegistry.getTimeout('notifications');\nclearTimeout(timeout);\n"),e.k0s()()(),e.j41(625,"p")(626,"strong"),e.EFF(627,"Cr\xe9ez"),e.k0s(),e.EFF(628," un nouveau timeout dynamiquement en utilisant la m\xe9thode "),e.j41(629,"code"),e.EFF(630,"SchedulerRegistry#addTimeout"),e.k0s(),e.EFF(631,", comme suit :"),e.k0s(),e.j41(632,"app-copy-button")(633,"pre")(634,"code",13),e.EFF(635,"\naddTimeout(name: string, milliseconds: number) {\n  const callback = () => {\n    this.logger.warn(`D\xe9lai ${name} ex\xe9cut\xe9 apr\xe8s (${milliseconds}) !`);\n  };\n\n  const timeout = setTimeout(callback, milliseconds);\n  this.schedulerRegistry.addTimeout(name, timeout);\n}\n"),e.k0s()()(),e.j41(636,"p"),e.EFF(637,"Dans ce code, nous cr\xe9ons un timeout JavaScript standard, puis nous le passons \xe0 la m\xe9thode "),e.j41(638,"code"),e.EFF(639,"ScheduleRegistry#addTimeout"),e.k0s(),e.EFF(640,".\nCette m\xe9thode prend deux arguments : un nom pour le d\xe9lai d'attente et le d\xe9lai d'attente lui-m\xeame."),e.k0s(),e.j41(641,"p")(642,"strong"),e.EFF(643,"Supprimez"),e.k0s(),e.EFF(644," un timeout nomm\xe9 en utilisant la m\xe9thode "),e.j41(645,"code"),e.EFF(646,"SchedulerRegistry#deleteTimeout"),e.k0s(),e.EFF(647,", comme suit :"),e.k0s(),e.j41(648,"app-copy-button")(649,"pre")(650,"code",13),e.EFF(651,"\ndeleteTimeout(name: string) {\n  this.schedulerRegistry.deleteTimeout(name);\n  this.logger.warn(`Timeout ${name} deleted!`);\n}\n"),e.k0s()()(),e.j41(652,"p")(653,"strong"),e.EFF(654,"Listez"),e.k0s(),e.EFF(655," tous les timeouts en utilisant la m\xe9thode "),e.j41(656,"code"),e.EFF(657,"SchedulerRegistry#getTimeouts"),e.k0s(),e.EFF(658," de la mani\xe8re suivante :"),e.k0s(),e.j41(659,"app-copy-button")(660,"pre")(661,"code",13),e.EFF(662,"\ngetTimeouts() {\n  const timeouts = this.schedulerRegistry.getTimeouts();\n  timeouts.forEach(key => this.logger.log(`Timeout: ${key}`));\n}\n"),e.k0s()()(),e.j41(663,"h4",31)(664,"span"),e.EFF(665,"Exemple"),e.k0s()(),e.j41(666,"p"),e.EFF(667,"Un exemple pratique est disponible "),e.j41(668,"a",32),e.EFF(669,"ici"),e.k0s(),e.EFF(670,"."),e.k0s()()),2&o){const u=e.sdS(42);e.R7$(39),e.SpI(" ",e.i5U(40,1,"app.module",u.isJsActive),"\n")}},dependencies:[E.O,i.a,x.d,c.z,k.M],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Planification des t\xe2ches"}},{path:"compression",component:I,data:{title:"Compression"}},{path:"queues",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-queues"]],features:[e.Vt3],decls:1614,vars:22,consts:[["contentReference",""],["app6805444f06173c2d6c1bac5c6eae62340cfb4fb3",""],["app14331045826c7601ab422bb1631c730196ec8dac",""],["appf8548c6634a05581b1ac4b184358d0fa27d31120",""],["appf7a23d7fdfc8b359af955f9ac12827156627f140",""],["appdb057d175f020c0cde1e4e3600901b4b422a9ed8",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/queues.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","files-dattente"],["rel","nofollow","target","_blank","href","https://redis.io/"],["href","techniques/queues#producteurs"],["href","techniques/queues#consommateurs"],["href","techniques/queues#auditeurs"],["rel","nofollow","target","_blank","href","https://docs.bullmq.io/"],["rel","nofollow","target","_blank","href","https://github.com/OptimalBits/bull/blob/master/REFERENCE.md"],["appAnchor","","id","installation-bullmq"],[1,"language-bash"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],["rel","nofollow","target","_blank","href","https://docs.bullmq.io/guide/connections"],["rel","nofollow","target","_blank","href","https://github.com/OptimalBits/bull/blob/master/REFERENCE.md#queueadd"],["rel","nofollow","target","_blank","href","https://github.com/OptimalBits/bull/blob/master/REFERENCE.md#queue"],["rel","nofollow","target","_blank","href","https://api.docs.bullmq.io/interfaces/v4.QueueOptions.html"],[1,"info"],["rel","nofollow","target","_blank","href","https://docs.bullmq.io/guide/flows"],["appAnchor","","id","configurations-nomm\xe9es"],["appAnchor","","id","producteurs"],["routerLink","/providers"],["appAnchor","","id","options-de-t\xe2ches"],["rel","nofollow","target","_blank","href","https://api.docs.bullmq.io/types/v4.JobsOptions.html"],["rel","nofollow","target","_blank","href","https://api.docs.bullmq.io/interfaces/v4.BaseJobOptions.html"],["appAnchor","","id","consommateurs"],["rel","nofollow","target","_blank","href","https://api.docs.bullmq.io/classes/v4.Job.html"],[1,"warning"],["rel","nofollow","target","_blank","href","https://docs.bullmq.io/patterns/named-processor"],["appAnchor","","id","consommateurs-\xe0-l\xe9chelle-de-la-requ\xeate"],["href","/fundamentals/injection-scopes#provider-scope"],["appAnchor","","id","\xe9couteurs-d\xe9v\xe9nements"],["href","techniques/queues#consumers"],["rel","nofollow","target","_blank","href","https://api.docs.bullmq.io/interfaces/v4.WorkerListener.html"],["rel","nofollow","target","_blank","href","https://api.docs.bullmq.io/interfaces/v4.QueueEventsListener.html"],["appAnchor","","id","gestion-des-files-dattente"],["rel","nofollow","target","_blank","href","https://api.docs.bullmq.io/classes/v4.Queue.html"],["appAnchor","","id","processus-s\xe9par\xe9s"],["rel","nofollow","target","_blank","href","https://docs.bullmq.io/guide/workers/sandboxed-processors"],["appAnchor","","id","configuration-asynchrone"],["routerLink","/fundamentals/async-providers"],["appAnchor","","id","installation-bull"],["rel","nofollow","target","_blank","href","https://github.com/taskforcesh/bullmq/issues/1034"],["appAnchor","","id","configurations-nomm\xe9es-1"],["appAnchor","","id","producteurs-1"],["appAnchor","","id","travaux-nomm\xe9s"],[1,"Warning"],["appAnchor","","id","options-de-travaux"],["appAnchor","","id","consommateurs-1"],["rel","nofollow","target","_blank","href","https://github.com/OptimalBits/bull/blob/master/REFERENCE.md#job"],["appAnchor","","id","consommateurs-\xe0-port\xe9e-de-requ\xeate"],["href","/fundamentals/injection-scopes#port%C3%A9e-du-fournisseur"],["appAnchor","","id","auditeurs"],["rel","nofollow","target","_blank","href","https://github.com/OptimalBits/bull/blob/master/REFERENCE.md#events"],["appAnchor","","id","gestion-des-files-dattente-1"],["appAnchor","","id","processus-distincts"],["rel","nofollow","target","_blank","href","https://github.com/OptimalBits/bull#separate-processes"],[1,"language-ts"],["appAnchor","","id","configuration-asynchrone-1"],["rel","nofollow","target","_blank","href","https://docs.nestjs.com/fundamentals/async-providers"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/26-queues"]],template:function(o,t){if(1&o&&(e.j41(0,"div",6,0)(2,"div",7)(3,"a",8),e.nrm(4,"i",9),e.k0s()(),e.j41(5,"h3",10),e.EFF(6,"Files d'attente"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Les files d'attente sont un puissant mod\xe8le de conception qui vous aide \xe0 relever les d\xe9fis courants en mati\xe8re de mise \xe0 l'\xe9chelle et de performance des applications. Voici quelques exemples de probl\xe8mes que les files d'attente peuvent vous aider \xe0 r\xe9soudre :"),e.k0s(),e.j41(9,"ul")(10,"li"),e.EFF(11,"Lisser les pics de traitement. Par exemple, si les utilisateurs peuvent lancer des t\xe2ches gourmandes en ressources \xe0 des moments arbitraires, vous pouvez ajouter ces t\xe2ches \xe0 une file d'attente au lieu de les ex\xe9cuter de mani\xe8re synchrone. Vous pouvez ensuite demander aux processus de travail d'extraire les t\xe2ches de la file d'attente de mani\xe8re contr\xf4l\xe9e. Vous pouvez facilement ajouter de nouveaux consommateurs de file d'attente pour augmenter la gestion des t\xe2ches en arri\xe8re-plan au fur et \xe0 mesure que l'application \xe9volue."),e.k0s(),e.j41(12,"li"),e.EFF(13,"D\xe9composer les t\xe2ches monolithiques qui risquent de bloquer la boucle \xe9v\xe9nementielle de Node.js. Par exemple, si une demande d'utilisateur n\xe9cessite un travail intensif au niveau du processeur, comme le transcodage audio, vous pouvez d\xe9l\xe9guer cette t\xe2che \xe0 d'autres processus, lib\xe9rant ainsi les processus orient\xe9s vers l'utilisateur pour qu'ils restent r\xe9actifs."),e.k0s(),e.j41(14,"li"),e.EFF(15,"Fournir un canal de communication fiable entre les diff\xe9rents services. Par exemple, vous pouvez mettre en file d'attente des t\xe2ches (jobs) dans un processus ou un service, et les consommer dans un autre. Vous pouvez \xeatre inform\xe9 (en \xe9coutant les \xe9v\xe9nements d'\xe9tat) de l'ach\xe8vement, de l'erreur ou d'autres changements d'\xe9tat dans le cycle de vie du travail \xe0 partir de n'importe quel processus ou service. Lorsque les producteurs ou les consommateurs de la file d'attente tombent en panne, leur \xe9tat est pr\xe9serv\xe9 et le traitement des t\xe2ches peut reprendre automatiquement lorsque les n\u0153uds sont red\xe9marr\xe9s."),e.k0s()(),e.j41(16,"p"),e.EFF(17,"Nest fournit le package "),e.j41(18,"code"),e.EFF(19,"@nestjs/bullmq"),e.k0s(),e.EFF(20," pour l'int\xe9gration de BullMQ et le package "),e.j41(21,"code"),e.EFF(22,"@nestjs/bull"),e.k0s(),e.EFF(23," pour l'int\xe9gration de Bull. Les deux packages sont des abstractions/wrappers au-dessus de leurs biblioth\xe8ques respectives, qui ont \xe9t\xe9 d\xe9velopp\xe9es par la m\xeame \xe9quipe. Bull est actuellement en mode maintenance, l'\xe9quipe se concentrant sur la correction des bugs, tandis que BullMQ est activement d\xe9velopp\xe9, avec une impl\xe9mentation TypeScript moderne et un ensemble diff\xe9rent de fonctionnalit\xe9s. Si Bull r\xe9pond \xe0 vos besoins, il reste un choix fiable et \xe9prouv\xe9. Les packages Nest permettent d'int\xe9grer facilement BullMQ ou Bull Queues dans votre application Nest."),e.k0s(),e.j41(24,"p"),e.EFF(25,"Both BullMQ and Bull utilise "),e.j41(26,"a",11),e.EFF(27,"Redis"),e.k0s(),e.EFF(28," pour conserver les donn\xe9es des travaux, vous devez donc avoir install\xe9 Redis sur votre syst\xe8me. Parce qu'ils sont soutenus par Redis, votre architecture de file d'attente peut \xeatre compl\xe8tement distribu\xe9e et ind\xe9pendante de la plate-forme. Par exemple, certains "),e.j41(29,"a",12),e.EFF(30,"producteurs"),e.k0s(),e.EFF(31,", "),e.j41(32,"a",13),e.EFF(33,"consommateurs"),e.k0s(),e.EFF(34," et "),e.j41(35,"a",14),e.EFF(36,"auditeurs"),e.k0s(),e.EFF(37," de files d'attente peuvent \xeatre ex\xe9cut\xe9s dans Nest sur un (ou plusieurs) n\u0153uds, et d'autres producteurs, consommateurs et auditeurs peuvent \xeatre ex\xe9cut\xe9s sur d'autres plates-formes Node.js sur d'autres n\u0153uds du r\xe9seau."),e.k0s(),e.j41(38,"p"),e.EFF(39,"Ce chapitre couvre les packages "),e.j41(40,"code"),e.EFF(41,"@nestjs/bullmq"),e.k0s(),e.EFF(42," et "),e.j41(43,"code"),e.EFF(44,"@nestjs/bull"),e.k0s(),e.EFF(45,". Nous recommandons \xe9galement la lecture des documentations "),e.j41(46,"a",15),e.EFF(47,"BullMQ"),e.k0s(),e.EFF(48," et "),e.j41(49,"a",16),e.EFF(50,"Bull"),e.k0s(),e.EFF(51," pour plus de d\xe9tails sur le contexte et l'impl\xe9mentation."),e.k0s(),e.j41(52,"h4",17)(53,"span"),e.EFF(54,"Installation BullMQ"),e.k0s()(),e.j41(55,"p"),e.EFF(56,"Pour commencer \xe0 utiliser BullMQ, nous devons d'abord installer les d\xe9pendances n\xe9cessaires."),e.k0s(),e.j41(57,"pre")(58,"code",18),e.EFF(59,"\n$ npm install --save @nestjs/bullmq bullmq\n"),e.k0s()(),e.j41(60,"p"),e.EFF(61,"Une fois le processus d'installation termin\xe9, nous pouvons importer le "),e.j41(62,"code"),e.EFF(63,"BullModule"),e.k0s(),e.EFF(64," dans la racine "),e.j41(65,"code"),e.EFF(66,"AppModule"),e.k0s(),e.EFF(67,"."),e.k0s(),e.j41(68,"app-copy-button",19)(69,"span",20),e.EFF(70),e.nI1(71,"extension"),e.nrm(72,"app-tabs",null,1),e.k0s(),e.j41(74,"pre")(75,"code",21),e.EFF(76,"\nimport { Module } from '@nestjs/common';\nimport { BullModule } from '@nestjs/bullmq';\n\n@Module({\n  imports: [\n    BullModule.forRoot({\n      connection: {\n        host: 'localhost',\n        port: 6379,\n      },\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(77,"p"),e.EFF(78,"La m\xe9thode "),e.j41(79,"code"),e.EFF(80,"forRoot()"),e.k0s(),e.EFF(81," est utilis\xe9e pour enregistrer un objet de configuration du paquet "),e.j41(82,"code"),e.EFF(83,"bullmq"),e.k0s(),e.EFF(84," qui sera utilis\xe9 par toutes les files d'attente enregistr\xe9es dans l'application (sauf indication contraire). Pour votre r\xe9f\xe9rence, voici quelques-unes des propri\xe9t\xe9s d'un objet de configuration :"),e.k0s(),e.j41(85,"ul")(86,"li")(87,"code"),e.EFF(88,"connection : ConnectionOptions"),e.k0s(),e.EFF(89," - Options pour configurer la connexion Redis. Voir "),e.j41(90,"a",22),e.EFF(91,"Connections"),e.k0s(),e.EFF(92," pour plus d'informations. Optionnel."),e.k0s(),e.j41(93,"li")(94,"code"),e.EFF(95,"prefix : string"),e.k0s(),e.EFF(96," - Pr\xe9fixe pour toutes les cl\xe9s de file d'attente. Facultatif."),e.k0s(),e.j41(97,"li")(98,"code"),e.EFF(99,"defaultJobOptions : JobOpts"),e.k0s(),e.EFF(100," - Options pour contr\xf4ler les param\xe8tres par d\xe9faut des nouveaux travaux. Voir "),e.j41(101,"a",23),e.EFF(102,"JobOpts"),e.k0s(),e.EFF(103," pour plus d'informations. Facultatif."),e.k0s(),e.j41(104,"li")(105,"code"),e.EFF(106,"settings : AdvancedSettings"),e.k0s(),e.EFF(107," - Param\xe8tres de configuration avanc\xe9e de la file d'attente. Ces param\xe8tres ne doivent g\xe9n\xe9ralement pas \xeatre modifi\xe9s. Voir "),e.j41(108,"a",24),e.EFF(109,"AdvancedSettings"),e.k0s(),e.EFF(110," pour plus d'informations. Facultatif."),e.k0s()(),e.j41(111,"p"),e.EFF(112,"Toutes les options sont optionnelles, fournissant un contr\xf4le d\xe9taill\xe9 sur le comportement de la file d'attente. Elles sont pass\xe9es directement au constructeur de BullMQ "),e.j41(113,"code"),e.EFF(114,"Queue"),e.k0s(),e.EFF(115,". Pour en savoir plus sur ces options et d'autres "),e.j41(116,"a",25),e.EFF(117,"ici"),e.k0s(),e.EFF(118,"."),e.k0s(),e.j41(119,"p"),e.EFF(120,"Pour enregistrer une file d'attente, importez le module dynamique "),e.j41(121,"code"),e.EFF(122,"BullModule.registerQueue()"),e.k0s(),e.EFF(123," comme suit :"),e.k0s(),e.j41(124,"app-copy-button")(125,"pre")(126,"code",21),e.EFF(127,"\nBullModule.registerQueue({\n  name: 'audio',\n});\n"),e.k0s()()(),e.j41(128,"blockquote",26)(129,"strong"),e.EFF(130,"Astuce"),e.k0s(),e.EFF(131," Cr\xe9ez plusieurs files d'attente en passant plusieurs objets de configuration s\xe9par\xe9s par des virgules \xe0 la m\xe9thode "),e.j41(132,"code"),e.EFF(133,"registerQueue()"),e.k0s(),e.EFF(134,".\n"),e.k0s(),e.j41(135,"p"),e.EFF(136,"La m\xe9thode "),e.j41(137,"code"),e.EFF(138,"registerQueue()"),e.k0s(),e.EFF(139," est utilis\xe9e pour instancier et/ou enregistrer des files d'attente. Les files d'attente sont partag\xe9es entre les modules et les processus qui se connectent \xe0 la m\xeame base de donn\xe9es Redis sous-jacente avec les m\xeames informations d'identification. Chaque file d'attente est unique par sa propri\xe9t\xe9 name. Le nom d'une file d'attente est utilis\xe9 \xe0 la fois comme jeton d'injection (pour injecter la file d'attente dans les contr\xf4leurs/fournisseurs) et comme argument pour les d\xe9corateurs afin d'associer les classes de consommateurs et les auditeurs aux files d'attente."),e.k0s(),e.j41(140,"p"),e.EFF(141,"Vous pouvez \xe9galement remplacer certaines des options pr\xe9configur\xe9es pour une file d'attente sp\xe9cifique, comme suit :"),e.k0s(),e.j41(142,"app-copy-button")(143,"pre")(144,"code",21),e.EFF(145,"\nBullModule.registerQueue({\n  name: 'audio',\n  connection: {\n    port: 6380,\n  },\n});\n"),e.k0s()()(),e.j41(146,"p"),e.EFF(147,"BullMQ prend \xe9galement en charge les relations parent-enfant entre les t\xe2ches. Cette fonctionnalit\xe9 permet de cr\xe9er des flux o\xf9 les t\xe2ches sont les n\u0153uds d'arbres de profondeur arbitraire. Pour en savoir plus, consultez "),e.j41(148,"a",27),e.EFF(149,"ici"),e.k0s(),e.EFF(150,"."),e.k0s(),e.j41(151,"p"),e.EFF(152,"Pour ajouter un flux, vous pouvez proc\xe9der comme suit :"),e.k0s(),e.j41(153,"app-copy-button")(154,"pre")(155,"code",21),e.EFF(156,"\nBullModule.registerFlowProducer({\n  name: 'flowProducerName',\n});\n"),e.k0s()()(),e.j41(157,"p"),e.EFF(158,"Puisque les travaux sont conserv\xe9s dans Redis, chaque fois qu'une file d'attente sp\xe9cifique est instanci\xe9e (par exemple, lorsqu'une application est d\xe9marr\xe9e/red\xe9marr\xe9e), elle tente de traiter tous les anciens travaux qui peuvent exister \xe0 partir d'une session pr\xe9c\xe9dente inachev\xe9e."),e.k0s(),e.j41(159,"p"),e.EFF(160,"Chaque file d'attente peut avoir un ou plusieurs producteurs, consommateurs et auditeurs. Les consommateurs r\xe9cup\xe8rent les travaux de la file d'attente dans un ordre sp\xe9cifique : FIFO (par d\xe9faut), LIFO ou selon les priorit\xe9s. Le contr\xf4le de l'ordre de traitement des files d'attente est abord\xe9 "),e.j41(161,"a",13),e.EFF(162,"ici"),e.k0s(),e.EFF(163,"."),e.k0s(),e.j41(164,"p"),e.nrm(165,"app-banner-enterprise"),e.k0s(),e.j41(166,"h4",28)(167,"span"),e.EFF(168,"Configurations nomm\xe9es"),e.k0s()(),e.j41(169,"p"),e.EFF(170,"Si vos files d'attente se connectent \xe0 plusieurs instances Redis diff\xe9rentes, vous pouvez utiliser une technique appel\xe9e "),e.j41(171,"strong"),e.EFF(172,"configurations nomm\xe9es"),e.k0s(),e.EFF(173,". Cette fonctionnalit\xe9 vous permet d'enregistrer plusieurs configurations sous des cl\xe9s sp\xe9cifiques, auxquelles vous pouvez ensuite vous r\xe9f\xe9rer dans les options de la file d'attente."),e.k0s(),e.j41(174,"p"),e.EFF(175,"Par exemple, en supposant que vous ayez une instance Redis suppl\xe9mentaire (en plus de celle par d\xe9faut) utilis\xe9e par quelques files d'attente enregistr\xe9es dans votre application, vous pouvez enregistrer sa configuration comme suit :"),e.k0s(),e.j41(176,"app-copy-button")(177,"pre")(178,"code",21),e.EFF(179,"\nBullModule.forRoot('alternative-config', {\n  connection: {\n    port: 6381,\n  },\n});\n"),e.k0s()()(),e.j41(180,"p"),e.EFF(181,"Dans l'exemple ci-dessus, "),e.j41(182,"code"),e.EFF(183,"'alternative-config'"),e.k0s(),e.EFF(184," est juste une cl\xe9 de configuration (elle peut \xeatre n'importe quelle cha\xeene arbitraire)."),e.k0s(),e.j41(185,"p"),e.EFF(186,"Avec ceci en place, vous pouvez maintenant pointer vers cette configuration dans l'objet d'options "),e.j41(187,"code"),e.EFF(188,"registerQueue()"),e.k0s(),e.EFF(189," :"),e.k0s(),e.j41(190,"app-copy-button")(191,"pre")(192,"code",21),e.EFF(193,"\nBullModule.registerQueue({\n  configKey: 'alternative-config',\n  name: 'video',\n});\n"),e.k0s()()(),e.j41(194,"h4",29)(195,"span"),e.EFF(196,"Producteurs"),e.k0s()(),e.j41(197,"p"),e.EFF(198,"Les producteurs de travaux ajoutent des travaux aux files d'attente. Les producteurs sont g\xe9n\xe9ralement des services d'application (Nest "),e.j41(199,"a",30),e.EFF(200,"providers"),e.k0s(),e.EFF(201,"). Pour ajouter des travaux \xe0 une file d'attente, il faut d'abord injecter la file d'attente dans le service comme suit :"),e.k0s(),e.j41(202,"app-copy-button")(203,"pre")(204,"code",21),e.EFF(205,"\nimport { Injectable } from '@nestjs/common';\nimport { Queue } from 'bullmq';\nimport { InjectQueue } from '@nestjs/bullmq';\n\n@Injectable()\nexport class AudioService {\n  constructor(@InjectQueue('audio') private audioQueue: Queue) {}\n}\n"),e.k0s()()(),e.j41(206,"blockquote",26)(207,"strong"),e.EFF(208,"Astuce"),e.k0s(),e.EFF(209," Le d\xe9corateur "),e.j41(210,"code"),e.EFF(211,"@InjectQueue()"),e.k0s(),e.EFF(212," identifie la file d'attente par son nom, tel qu'il est fourni dans l'appel \xe0 la m\xe9thode "),e.j41(213,"code"),e.EFF(214,"registerQueue()"),e.k0s(),e.EFF(215," (par exemple, "),e.j41(216,"code"),e.EFF(217,"'audio'"),e.k0s(),e.EFF(218,").\n"),e.k0s(),e.j41(219,"p"),e.EFF(220,"Maintenant, ajoutez un travail en appelant la m\xe9thode "),e.j41(221,"code"),e.EFF(222,"add()"),e.k0s(),e.EFF(223," de la file d'attente, en passant un objet de travail d\xe9fini par l'utilisateur. Les travaux sont repr\xe9sent\xe9s comme des objets JavaScript s\xe9rialisables (puisque c'est ainsi qu'ils sont stock\xe9s dans la base de donn\xe9es Redis). La forme du job que vous passez est arbitraire ; utilisez-la pour repr\xe9senter la s\xe9mantique de votre objet job. Vous devez \xe9galement lui donner un nom. Cela vous permet de cr\xe9er des "),e.j41(224,"a",13),e.EFF(225,"consommateurs"),e.k0s(),e.EFF(226," sp\xe9cialis\xe9s qui ne traiteront que les travaux portant un nom donn\xe9."),e.k0s(),e.j41(227,"app-copy-button")(228,"pre")(229,"code",21),e.EFF(230,"\nconst job = await this.audioQueue.add('transcode', {\n  foo: 'bar',\n});\n"),e.k0s()()(),e.j41(231,"h4",31)(232,"span"),e.EFF(233,"Options de t\xe2ches"),e.k0s()(),e.j41(234,"p"),e.EFF(235,"Les t\xe2ches peuvent \xeatre associ\xe9es \xe0 des options suppl\xe9mentaires. Passez un objet options apr\xe8s l'argument "),e.j41(236,"code"),e.EFF(237,"job"),e.k0s(),e.EFF(238," dans la m\xe9thode "),e.j41(239,"code"),e.EFF(240,"Queue.add()"),e.k0s(),e.EFF(241,". Voici quelques-unes des propri\xe9t\xe9s des options du travail :"),e.k0s(),e.j41(242,"ul")(243,"li")(244,"code"),e.EFF(245,"priority"),e.k0s(),e.EFF(246," : "),e.j41(247,"code"),e.EFF(248,"number"),e.k0s(),e.EFF(249," - Valeur de priorit\xe9 optionnelle. Elle va de 1 (priorit\xe9 la plus \xe9lev\xe9e) \xe0 MAX_INT (priorit\xe9 la plus basse). Notez que l'utilisation des priorit\xe9s a un l\xe9ger impact sur les performances, donc utilisez-les avec pr\xe9caution."),e.k0s(),e.j41(250,"li")(251,"code"),e.EFF(252,"delay"),e.k0s(),e.EFF(253," : "),e.j41(254,"code"),e.EFF(255,"number"),e.k0s(),e.EFF(256," - Temps d'attente (en millisecondes) avant que ce travail puisse \xeatre trait\xe9. Notez que pour des d\xe9lais pr\xe9cis, le serveur et les clients doivent avoir leurs horloges synchronis\xe9es."),e.k0s(),e.j41(257,"li")(258,"code"),e.EFF(259,"attempts"),e.k0s(),e.EFF(260," : "),e.j41(261,"code"),e.EFF(262,"number"),e.k0s(),e.EFF(263," - Le nombre total de tentatives pour essayer le travail jusqu'\xe0 ce qu'il se termine."),e.k0s(),e.j41(264,"li")(265,"code"),e.EFF(266,"repeat"),e.k0s(),e.EFF(267," : "),e.j41(268,"code"),e.EFF(269,"RepeatOpts"),e.k0s(),e.EFF(270," - R\xe9p\xe9ter le travail selon une sp\xe9cification cron. Voir "),e.j41(271,"a",23),e.EFF(272,"RepeatOpts"),e.k0s(),e.EFF(273,"."),e.k0s(),e.j41(274,"li")(275,"code"),e.EFF(276,"backoff"),e.k0s(),e.EFF(277," : "),e.j41(278,"code"),e.EFF(279,"number | BackoffOpts"),e.k0s(),e.EFF(280," - Param\xe8tre de backoff pour les tentatives automatiques en cas d'\xe9chec du travail. Voir "),e.j41(281,"a",23),e.EFF(282,"BackoffOpts"),e.k0s(),e.EFF(283,"."),e.k0s(),e.j41(284,"li")(285,"code"),e.EFF(286,"lifo"),e.k0s(),e.EFF(287," : "),e.j41(288,"code"),e.EFF(289,"boolean"),e.k0s(),e.EFF(290," - Si true, ajoute le job \xe0 l'extr\xe9mit\xe9 droite de la file d'attente au lieu de l'extr\xe9mit\xe9 gauche (default false)."),e.k0s(),e.j41(291,"li")(292,"code"),e.EFF(293,"jobId"),e.k0s(),e.EFF(294," : "),e.j41(295,"code"),e.EFF(296,"number"),e.k0s(),e.EFF(297," | "),e.j41(298,"code"),e.EFF(299,"string"),e.k0s(),e.EFF(300," - Surcharge l'ID du travail - par d\xe9faut, l'ID du travail est un entier unique, mais vous pouvez utiliser ce param\xe8tre pour le surcharger. Si vous utilisez cette option, c'est \xe0 vous de vous assurer que l'ID du travail est unique. Si vous essayez d'ajouter un travail avec un identifiant qui existe d\xe9j\xe0, il ne sera pas ajout\xe9."),e.k0s(),e.j41(301,"li")(302,"code"),e.EFF(303,"removeOnComplete"),e.k0s(),e.EFF(304," : "),e.j41(305,"code"),e.EFF(306,"boolean | number"),e.k0s(),e.EFF(307," - Si true, supprime le job lorsqu'il se termine avec succ\xe8s. Un nombre sp\xe9cifie le nombre de travaux \xe0 conserver. Le comportement par d\xe9faut est de conserver le travail dans l'ensemble des travaux termin\xe9s."),e.k0s(),e.j41(308,"li")(309,"code"),e.EFF(310,"removeOnFail"),e.k0s(),e.EFF(311," : "),e.j41(312,"code"),e.EFF(313,"boolean | number"),e.k0s(),e.EFF(314," - Si true, supprime le travail lorsqu'il \xe9choue apr\xe8s toutes les tentatives. Un nombre sp\xe9cifie le nombre de travaux \xe0 conserver. Le comportement par d\xe9faut est de conserver le travail dans l'ensemble des \xe9checs."),e.k0s(),e.j41(315,"li")(316,"code"),e.EFF(317,"stackTraceLimit"),e.k0s(),e.EFF(318," : "),e.j41(319,"code"),e.EFF(320,"number"),e.k0s(),e.EFF(321," - Limite le nombre de lignes de trace de pile qui seront enregistr\xe9es dans la trace de pile."),e.k0s()(),e.j41(322,"p"),e.EFF(323,"Voici quelques exemples de personnalisation des t\xe2ches avec les options de t\xe2ches."),e.k0s(),e.j41(324,"p"),e.EFF(325,"Pour retarder le d\xe9marrage d'un job, utilisez la propri\xe9t\xe9 de configuration "),e.j41(326,"code"),e.EFF(327,"delay"),e.k0s(),e.EFF(328,"."),e.k0s(),e.j41(329,"app-copy-button")(330,"pre")(331,"code",21),e.EFF(332,"\nconst job = await this.audioQueue.add(\n  'transcode',\n  {\n    foo: 'bar',\n  },\n  { delay: 3000 }, // 3 seconds delayed\n);\n"),e.k0s()()(),e.j41(333,"p"),e.EFF(334,"Pour ajouter un travail \xe0 l'extr\xe9mit\xe9 droite de la file d'attente (traiter le travail comme "),e.j41(335,"strong"),e.EFF(336,"LIFO"),e.k0s(),e.EFF(337," (Last In First Out)), d\xe9finissez la propri\xe9t\xe9 "),e.j41(338,"code"),e.EFF(339,"lifo"),e.k0s(),e.EFF(340," de l'objet de configuration \xe0 "),e.j41(341,"code"),e.EFF(342,"true"),e.k0s(),e.EFF(343,"."),e.k0s(),e.j41(344,"app-copy-button")(345,"pre")(346,"code",21),e.EFF(347,"\nconst job = await this.audioQueue.add(\n  'transcode',\n  {\n    foo: 'bar',\n  },\n  { lifo: true },\n);\n"),e.k0s()()(),e.j41(348,"p"),e.EFF(349,"Pour classer un travail par ordre de priorit\xe9, utilisez la propri\xe9t\xe9 "),e.j41(350,"code"),e.EFF(351,"priority"),e.k0s(),e.EFF(352,"."),e.k0s(),e.j41(353,"app-copy-button")(354,"pre")(355,"code",21),e.EFF(356,"\nconst job = await this.audioQueue.add(\n  'transcode',\n  {\n    foo: 'bar',\n  },\n  { priority: 2 },\n);\n"),e.k0s()()(),e.j41(357,"p"),e.EFF(358,"Pour une liste compl\xe8te des options, consultez la documentation de l'API "),e.j41(359,"a",32),e.EFF(360,"ici"),e.k0s(),e.EFF(361," et "),e.j41(362,"a",33),e.EFF(363,"ici"),e.k0s(),e.EFF(364,"."),e.k0s(),e.j41(365,"h4",34)(366,"span"),e.EFF(367,"Consommateurs"),e.k0s()(),e.j41(368,"p"),e.EFF(369,"Un consommateur est une "),e.j41(370,"strong"),e.EFF(371,"classe"),e.k0s(),e.EFF(372," d\xe9finissant des m\xe9thodes qui traitent les travaux ajout\xe9s \xe0 la file d'attente, ou qui \xe9coutent les \xe9v\xe9nements de la file d'attente, ou les deux. D\xe9clarez une classe de consommateur en utilisant le d\xe9corateur "),e.j41(373,"code"),e.EFF(374,"@Processor()"),e.k0s(),e.EFF(375," comme suit :"),e.k0s(),e.j41(376,"app-copy-button")(377,"pre")(378,"code",21),e.EFF(379,"\nimport { Processor } from '@nestjs/bullmq';\n\n@Processor('audio')\nexport class AudioConsumer {}\n"),e.k0s()()(),e.j41(380,"blockquote",26)(381,"strong"),e.EFF(382,"Astuce"),e.k0s(),e.EFF(383," Les consommateurs doivent \xeatre enregistr\xe9s en tant que "),e.j41(384,"code"),e.EFF(385,"providers"),e.k0s(),e.EFF(386," pour que le paquet "),e.j41(387,"code"),e.EFF(388,"@nestjs/bullmq"),e.k0s(),e.EFF(389," puisse les r\xe9cup\xe9rer.\n"),e.k0s(),e.j41(390,"p"),e.EFF(391,"O\xf9 l'argument cha\xeene du d\xe9corateur (par exemple, "),e.j41(392,"code"),e.EFF(393,"'audio'"),e.k0s(),e.EFF(394,") est le nom de la file d'attente \xe0 associer aux m\xe9thodes de la classe."),e.k0s(),e.j41(395,"app-copy-button")(396,"pre")(397,"code",21),e.EFF(398,"\nimport { Processor, WorkerHost } from '@nestjs/bullmq';\nimport { Job } from 'bullmq';\n\n@Processor('audio')\nexport class AudioConsumer extends WorkerHost {\n  async process(job: Job<any, any, string>): Promise<any> {\n    let progress = 0;\n    for (i = 0; i < 100; i++) {\n      await doSomething(job.data);\n      progress += 1;\n      await job.progress(progress);\n    }\n    return {};\n  }\n}\n"),e.k0s()()(),e.j41(399,"p"),e.EFF(400,"La m\xe9thode process est appel\xe9e chaque fois que le worker est inactif et qu'il y a des travaux \xe0 traiter dans la file d'attente. Cette m\xe9thode de traitement re\xe7oit l'objet "),e.j41(401,"code"),e.EFF(402,"job"),e.k0s(),e.EFF(403," comme seul argument. La valeur retourn\xe9e par la m\xe9thode handler est stock\xe9e dans l'objet job et peut \xeatre acc\xe9d\xe9e ult\xe9rieurement, par exemple dans un \xe9couteur pour l'\xe9v\xe9nement completed."),e.k0s(),e.j41(404,"p"),e.EFF(405,"Les objets "),e.j41(406,"code"),e.EFF(407,"Job"),e.k0s(),e.EFF(408," ont plusieurs m\xe9thodes qui vous permettent d'interagir avec leur \xe9tat. Par exemple, le code ci-dessus utilise la m\xe9thode "),e.j41(409,"code"),e.EFF(410,"progress()"),e.k0s(),e.EFF(411," pour mettre \xe0 jour la progression du travail. Voir "),e.j41(412,"a",35),e.EFF(413,"ici"),e.k0s(),e.EFF(414," pour la r\xe9f\xe9rence compl\xe8te de l'API de l'objet "),e.j41(415,"code"),e.EFF(416,"Job"),e.k0s(),e.EFF(417,"."),e.k0s(),e.j41(418,"p"),e.EFF(419,"Dans l'ancienne version, Bull, vous pouviez indiquer qu'une m\xe9thode de gestion des jobs ne traiterait que les jobs d'un certain type (les jobs avec un "),e.j41(420,"code"),e.EFF(421,"nom"),e.k0s(),e.EFF(422," sp\xe9cifique) en passant ce "),e.j41(423,"code"),e.EFF(424,"nom"),e.k0s(),e.EFF(425," au d\xe9corateur "),e.j41(426,"code"),e.EFF(427,"@Process()"),e.k0s(),e.EFF(428," comme indiqu\xe9 ci-dessous."),e.k0s(),e.j41(429,"blockquote",36)(430,"strong"),e.EFF(431,"Attention"),e.k0s(),e.EFF(432," Cela ne fonctionne pas avec BullMQ, continuez \xe0 lire.\n"),e.k0s(),e.j41(433,"app-copy-button")(434,"pre")(435,"code",21),e.EFF(436,"\n@Process('transcode')\nasync transcode(job: Job<unknown>) { ... }\n"),e.k0s()()(),e.j41(437,"p"),e.EFF(438,"Ce comportement n'est pas support\xe9 par BullMQ en raison des confusions qu'il g\xe9n\xe8re. Au lieu de cela, vous avez besoin de switch cases pour appeler diff\xe9rents services ou logiques pour chaque nom de job :"),e.k0s(),e.j41(439,"app-copy-button")(440,"pre")(441,"code",21),e.EFF(442,"\nimport { Processor, WorkerHost } from '@nestjs/bullmq';\nimport { Job } from 'bullmq';\n\n@Processor('audio')\nexport class AudioConsumer extends WorkerHost {\n  async process(job: Job<any, any, string>): Promise<any> {\n    switch (job.name) {\n      case 'transcode': {\n        let progress = 0;\n        for (i = 0; i < 100; i++) {\n          await doSomething(job.data);\n          progress += 1;\n          await job.progress(progress);\n        }\n        return {};\n      }\n      case 'concatenate': {\n        await doSomeLogic2();\n        break;\n      }\n    }\n  }\n}\n"),e.k0s()()(),e.j41(443,"p"),e.EFF(444,"Ceci est couvert dans la section "),e.j41(445,"a",37),e.EFF(446,"named processor"),e.k0s(),e.EFF(447," de la documentation de BullMQ."),e.k0s(),e.j41(448,"h4",38)(449,"span"),e.EFF(450,"Consommateurs \xe0 l'\xe9chelle de la requ\xeate"),e.k0s()(),e.j41(451,"p"),e.EFF(452,"Lorsqu'un consommateur est marqu\xe9 comme \xe9tant \xe0 port\xe9e de requ\xeate (en savoir plus sur les port\xe9es d'injection "),e.j41(453,"a",39),e.EFF(454,"ici"),e.k0s(),e.EFF(455,"), une nouvelle instance de la classe sera cr\xe9\xe9e exclusivement pour chaque t\xe2che. L'instance sera ramass\xe9e une fois le travail termin\xe9."),e.k0s(),e.j41(456,"app-copy-button")(457,"pre")(458,"code",21),e.EFF(459,"\n@Processor({\n  name: 'audio',\n  scope: Scope.REQUEST,\n})\n"),e.k0s()()(),e.j41(460,"p"),e.EFF(461,"Puisque les classes de consommateurs \xe0 port\xe9e de requ\xeate sont instanci\xe9es dynamiquement et \xe0 port\xe9e d'un seul travail, vous pouvez injecter un "),e.j41(462,"code"),e.EFF(463,"JOB_REF"),e.k0s(),e.EFF(464," \xe0 travers le constructeur en utilisant une approche standard."),e.k0s(),e.j41(465,"app-copy-button")(466,"pre")(467,"code",21),e.EFF(468,"\nconstructor(@Inject(JOB_REF) jobRef: Job) {\n  console.log(jobRef);\n}\n"),e.k0s()()(),e.j41(469,"blockquote",26)(470,"strong"),e.EFF(471,"Astuce"),e.k0s(),e.EFF(472," Le jeton "),e.j41(473,"code"),e.EFF(474,"JOB_REF"),e.k0s(),e.EFF(475," est import\xe9 du paquetage "),e.j41(476,"code"),e.EFF(477,"@nestjs/bullmq"),e.k0s(),e.EFF(478,".\n"),e.k0s(),e.j41(479,"h4",40)(480,"span"),e.EFF(481,"\xc9couteurs d'\xe9v\xe9nements"),e.k0s()(),e.j41(482,"p"),e.EFF(483,"BullMQ g\xe9n\xe8re un ensemble d'\xe9v\xe9nements utiles lorsque des changements d'\xe9tat de la file d'attente et/ou du travail se produisent. On peut s'abonner \xe0 ces \xe9v\xe9nements au niveau du travailleur en utilisant le d\xe9corateur "),e.j41(484,"code"),e.EFF(485,"@OnWorkerEvent(event)"),e.k0s(),e.EFF(486,", ou au niveau de la file d'attente avec une classe d'\xe9coute d\xe9di\xe9e et le d\xe9corateur "),e.j41(487,"code"),e.EFF(488,"@OnQueueEvent(event)"),e.k0s(),e.EFF(489,"."),e.k0s(),e.j41(490,"p"),e.EFF(491,"Les \xe9v\xe9nements Worker doivent \xeatre d\xe9clar\xe9s dans une classe "),e.j41(492,"a",41),e.EFF(493,"consumer"),e.k0s(),e.EFF(494," (c'est-\xe0-dire dans une classe d\xe9cor\xe9e avec le d\xe9corateur "),e.j41(495,"code"),e.EFF(496,"@Processor()"),e.k0s(),e.EFF(497,"). Pour \xe9couter un \xe9v\xe9nement, utilisez le d\xe9corateur "),e.j41(498,"code"),e.EFF(499,"@OnWorkerEvent(event)"),e.k0s(),e.EFF(500," avec l'\xe9v\xe9nement que vous voulez g\xe9rer. Par exemple, pour \xe9couter l'\xe9v\xe9nement \xe9mis lorsqu'un travail entre dans l'\xe9tat actif dans la file d'attente "),e.j41(501,"code"),e.EFF(502,"audio"),e.k0s(),e.EFF(503,", utilisez la construction suivante :"),e.k0s(),e.j41(504,"app-copy-button")(505,"pre")(506,"code",21),e.EFF(507,"\nimport { Processor, Process, OnWorkerEvent } from '@nestjs/bullmq';\nimport { Job } from 'bullmq';\n\n@Processor('audio')\nexport class AudioConsumer {\n  @OnWorkerEvent('active')\n  onActive(job: Job) {\n    console.log(\n      `Processing job ${job.id} of type ${job.name} with data ${job.data}...`,\n    );\n  }\n\n  // ...\n}\n"),e.k0s()()(),e.j41(508,"p"),e.EFF(509,"Vous pouvez consulter la liste compl\xe8te des \xe9v\xe9nements et de leurs arguments en tant que propri\xe9t\xe9s de WorkerListener "),e.j41(510,"a",42),e.EFF(511,"ici"),e.k0s(),e.EFF(512,"."),e.k0s(),e.j41(513,"p"),e.EFF(514,"Les auditeurs de QueueEvent doivent utiliser le d\xe9corateur "),e.j41(515,"code"),e.EFF(516,"@QueueEventsListener(queue)"),e.k0s(),e.EFF(517," et \xe9tendre la classe "),e.j41(518,"code"),e.EFF(519,"QueueEventsHost"),e.k0s(),e.EFF(520," fournie par "),e.j41(521,"code"),e.EFF(522,"@nestjs/bullmq"),e.k0s(),e.EFF(523,". Pour \xe9couter un \xe9v\xe9nement, utilisez le d\xe9corateur "),e.j41(524,"code"),e.EFF(525,"@OnQueueEvent(event)"),e.k0s(),e.EFF(526," avec l'\xe9v\xe9nement que vous voulez g\xe9rer. Par exemple, pour \xe9couter l'\xe9v\xe9nement \xe9mis lorsqu'un travail entre dans l'\xe9tat actif dans la file d'attente "),e.j41(527,"code"),e.EFF(528,"audio"),e.k0s(),e.EFF(529,", utilisez la construction suivante :"),e.k0s(),e.j41(530,"app-copy-button")(531,"pre")(532,"code",21),e.EFF(533,"\nimport {\n  QueueEventsHost,\n  QueueEventsListener,\n  OnQueueEvent,\n} from '@nestjs/bullmq';\n\n@QueueEventsListener('audio')\nexport class AudioEventsListener extends QueueEventsHost {\n  @OnQueueEvent('active')\n  onActive(job: { jobId: string; prev?: string }) {\n    console.log(`Processing job ${job.jobId}...`);\n  }\n\n  // ...\n}\n"),e.k0s()()(),e.j41(534,"blockquote",26)(535,"strong"),e.EFF(536,"Astuce"),e.k0s(),e.EFF(537," Les QueueEvent Listeners doivent \xeatre enregistr\xe9s en tant que "),e.j41(538,"code"),e.EFF(539,"providers"),e.k0s(),e.EFF(540," pour que le paquetage "),e.j41(541,"code"),e.EFF(542,"@nestjs/bullmq"),e.k0s(),e.EFF(543," puisse les r\xe9cup\xe9rer.\n"),e.k0s(),e.j41(544,"p"),e.EFF(545,"Vous pouvez consulter la liste compl\xe8te des \xe9v\xe9nements et de leurs arguments en tant que propri\xe9t\xe9s de QueueEventsListener "),e.j41(546,"a",43),e.EFF(547,"ici"),e.k0s(),e.EFF(548,"."),e.k0s(),e.j41(549,"h4",44)(550,"span"),e.EFF(551,"Gestion des files d'attente"),e.k0s()(),e.j41(552,"p"),e.EFF(553,"Les files d'attente disposent d'une API qui vous permet d'ex\xe9cuter des fonctions de gestion telles que la mise en pause et la reprise, la r\xe9cup\xe9ration du nombre de travaux dans diff\xe9rents \xe9tats, et bien d'autres encore. Vous pouvez trouver l'API compl\xe8te des files d'attente "),e.j41(554,"a",45),e.EFF(555,"ici"),e.k0s(),e.EFF(556,". Invoquez n'importe laquelle de ces m\xe9thodes directement sur l'objet "),e.j41(557,"code"),e.EFF(558,"Queue"),e.k0s(),e.EFF(559,", comme illustr\xe9 ci-dessous avec les exemples de pause/reprise."),e.k0s(),e.j41(560,"p"),e.EFF(561,"Mettre en pause une file d'attente avec l'appel de la m\xe9thode "),e.j41(562,"code"),e.EFF(563,"pause()"),e.k0s(),e.EFF(564,". Une file d'attente mise en pause ne traitera pas de nouveaux travaux jusqu'\xe0 ce qu'elle reprenne, mais les travaux en cours de traitement continueront jusqu'\xe0 ce qu'ils soient finalis\xe9s."),e.k0s(),e.j41(565,"app-copy-button")(566,"pre")(567,"code",21),e.EFF(568,"\nawait audioQueue.pause();\n"),e.k0s()()(),e.j41(569,"p"),e.EFF(570,"Pour reprendre une file d'attente en pause, utilisez la m\xe9thode "),e.j41(571,"code"),e.EFF(572,"resume()"),e.k0s(),e.EFF(573,", comme suit :"),e.k0s(),e.j41(574,"app-copy-button")(575,"pre")(576,"code",21),e.EFF(577,"\nawait audioQueue.resume();\n"),e.k0s()()(),e.j41(578,"h4",46)(579,"span"),e.EFF(580,"Processus s\xe9par\xe9s"),e.k0s()(),e.j41(581,"p"),e.EFF(582,"Les gestionnaires de t\xe2ches peuvent \xe9galement \xeatre ex\xe9cut\xe9s dans un processus s\xe9par\xe9 (fork\xe9) ("),e.j41(583,"a",47),e.EFF(584,"source"),e.k0s(),e.EFF(585,"). Cela pr\xe9sente plusieurs avantages :"),e.k0s(),e.j41(586,"ul")(587,"li"),e.EFF(588,"Le processus est prot\xe9g\xe9 par un bac \xe0 sable, de sorte que s'il tombe en panne, cela n'affecte pas le travailleur."),e.k0s(),e.j41(589,"li"),e.EFF(590,"Vous pouvez ex\xe9cuter du code bloquant sans affecter la file d'attente (les travaux ne se bloquent pas)."),e.k0s(),e.j41(591,"li"),e.EFF(592,"Meilleure utilisation des processeurs multi-c\u0153urs."),e.k0s(),e.j41(593,"li"),e.EFF(594,"Moins de connexions \xe0 redis."),e.k0s()(),e.j41(595,"app-copy-button",19)(596,"span",20),e.EFF(597),e.nI1(598,"extension"),e.nrm(599,"app-tabs",null,2),e.k0s(),e.j41(601,"pre")(602,"code",21),e.EFF(603,"\nimport { Module } from '@nestjs/common';\nimport { BullModule } from '@nestjs/bullmq';\nimport { join } from 'path';\n\n@Module({\n  imports: [\n    BullModule.registerQueue({\n      name: 'audio',\n      processors: [join(__dirname, 'processor.js')],\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(604,"blockquote",36)(605,"strong"),e.EFF(606,"Attention"),e.k0s(),e.EFF(607," Veuillez noter qu'\xe9tant donn\xe9 que votre fonction est ex\xe9cut\xe9e dans un processus fork\xe9, l'injection de d\xe9pendance (et le conteneur IoC) ne sera pas disponible. Cela signifie que la fonction de votre processeur devra contenir (ou cr\xe9er) toutes les instances de d\xe9pendances externes dont elle a besoin.\n"),e.k0s(),e.j41(608,"h4",48)(609,"span"),e.EFF(610,"Configuration asynchrone"),e.k0s()(),e.j41(611,"p"),e.EFF(612,"Vous pouvez vouloir passer des options "),e.j41(613,"code"),e.EFF(614,"bullmq"),e.k0s(),e.EFF(615," de mani\xe8re asynchrone plut\xf4t que statique. Dans ce cas, utilisez la m\xe9thode "),e.j41(616,"code"),e.EFF(617,"forRootAsync()"),e.k0s(),e.EFF(618," qui fournit plusieurs fa\xe7ons de g\xe9rer la configuration asynchrone. De m\xeame, si vous voulez passer des options de file d'attente de mani\xe8re asynchrone, utilisez la m\xe9thode "),e.j41(619,"code"),e.EFF(620,"registerQueueAsync()"),e.k0s(),e.EFF(621,"."),e.k0s(),e.j41(622,"p"),e.EFF(623,"Une approche consiste \xe0 utiliser une fonction d'usine :"),e.k0s(),e.j41(624,"app-copy-button")(625,"pre")(626,"code",21),e.EFF(627,"\nBullModule.forRootAsync({\n  useFactory: () => ({\n    connection: {\n      host: 'localhost',\n      port: 6379,\n    },\n  }),\n});\n"),e.k0s()()(),e.j41(628,"p"),e.EFF(629,"Notre fabrique se comporte comme n'importe quel autre "),e.j41(630,"a",49),e.EFF(631,"fournisseur asynchrone"),e.k0s(),e.EFF(632," (par exemple, il peut \xeatre "),e.j41(633,"code"),e.EFF(634,"async"),e.k0s(),e.EFF(635," et il est capable d'injecter des d\xe9pendances via "),e.j41(636,"code"),e.EFF(637,"inject"),e.k0s(),e.EFF(638,")."),e.k0s(),e.j41(639,"app-copy-button")(640,"pre")(641,"code",21),e.EFF(642,"\nBullModule.forRootAsync({\n  imports: [ConfigModule],\n  useFactory: async (configService: ConfigService) => ({\n    connection: {\n      host: configService.get('QUEUE_HOST'),\n      port: configService.get('QUEUE_PORT'),\n    },\n  }),\n  inject: [ConfigService],\n});\n"),e.k0s()()(),e.j41(643,"p"),e.EFF(644,"Vous pouvez \xe9galement utiliser la syntaxe "),e.j41(645,"code"),e.EFF(646,"useClass"),e.k0s(),e.EFF(647," :"),e.k0s(),e.j41(648,"app-copy-button")(649,"pre")(650,"code",21),e.EFF(651,"\nBullModule.forRootAsync({\n  useClass: BullConfigService,\n});\n"),e.k0s()()(),e.j41(652,"p"),e.EFF(653,"La construction ci-dessus instanciera "),e.j41(654,"code"),e.EFF(655,"BullConfigService"),e.k0s(),e.EFF(656," dans "),e.j41(657,"code"),e.EFF(658,"BullModule"),e.k0s(),e.EFF(659," et l'utilisera pour fournir un objet d'options en appelant "),e.j41(660,"code"),e.EFF(661,"createSharedConfiguration()"),e.k0s(),e.EFF(662,". Notez que cela signifie que le "),e.j41(663,"code"),e.EFF(664,"BullConfigService"),e.k0s(),e.EFF(665," doit impl\xe9menter l'interface "),e.j41(666,"code"),e.EFF(667,"SharedBullConfigurationFactory"),e.k0s(),e.EFF(668,", comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(669,"app-copy-button")(670,"pre")(671,"code",21),e.EFF(672,"\n@Injectable()\nclass BullConfigService implements SharedBullConfigurationFactory {\n  createSharedConfiguration(): BullModuleOptions {\n    return {\n      connection: {\n        host: 'localhost',\n        port: 6379,\n      },\n    };\n  }\n}\n"),e.k0s()()(),e.j41(673,"p"),e.EFF(674,"Afin d'\xe9viter la cr\xe9ation de "),e.j41(675,"code"),e.EFF(676,"BullConfigService"),e.k0s(),e.EFF(677," dans "),e.j41(678,"code"),e.EFF(679,"BullModule"),e.k0s(),e.EFF(680," et d'utiliser un fournisseur import\xe9 d'un module diff\xe9rent, vous pouvez utiliser la syntaxe "),e.j41(681,"code"),e.EFF(682,"useExisting"),e.k0s(),e.EFF(683,"."),e.k0s(),e.j41(684,"app-copy-button")(685,"pre")(686,"code",21),e.EFF(687,"\nBullModule.forRootAsync({\n  imports: [ConfigModule],\n  useExisting: ConfigService,\n});\n"),e.k0s()()(),e.j41(688,"p"),e.EFF(689,"Cette construction fonctionne de la m\xeame mani\xe8re que "),e.j41(690,"code"),e.EFF(691,"useClass"),e.k0s(),e.EFF(692," avec une diff\xe9rence essentielle - "),e.j41(693,"code"),e.EFF(694,"BullModule"),e.k0s(),e.EFF(695," va chercher dans les modules import\xe9s pour r\xe9utiliser un "),e.j41(696,"code"),e.EFF(697,"ConfigService"),e.k0s(),e.EFF(698," existant au lieu d'en instancier un nouveau."),e.k0s(),e.j41(699,"p"),e.EFF(700,"De m\xeame, si vous voulez passer des options de file d'attente de mani\xe8re asynchrone, utilisez la m\xe9thode "),e.j41(701,"code"),e.EFF(702,"registerQueueAsync()"),e.k0s(),e.EFF(703,", en n'oubliant pas de sp\xe9cifier l'attribut "),e.j41(704,"code"),e.EFF(705,"name"),e.k0s(),e.EFF(706," \xe0 l'ext\xe9rieur de la fonction factory."),e.k0s(),e.j41(707,"app-copy-button")(708,"pre")(709,"code",21),e.EFF(710,"\nBullModule.registerQueueAsync({\n  name: 'audio',\n  useFactory: () => ({\n    redis: {\n      host: 'localhost',\n      port: 6379,\n    },\n  }),\n});\n"),e.k0s()()(),e.j41(711,"h4",50)(712,"span"),e.EFF(713,"Installation Bull"),e.k0s()(),e.j41(714,"blockquote",36)(715,"strong"),e.EFF(716,"Note"),e.k0s(),e.EFF(717," Si vous avez d\xe9cid\xe9 d'utiliser BullMQ, sautez cette section et les chapitres suivants.\n"),e.k0s(),e.j41(718,"p"),e.EFF(719,"Pour commencer \xe0 utiliser Bull, nous installons d'abord les d\xe9pendances n\xe9cessaires."),e.k0s(),e.j41(720,"pre")(721,"code",18),e.EFF(722,"\n$ npm install --save @nestjs/bull bull\n"),e.k0s()(),e.j41(723,"p"),e.EFF(724,"Une fois le processus d'installation termin\xe9, nous pouvons importer le "),e.j41(725,"code"),e.EFF(726,"BullModule"),e.k0s(),e.EFF(727," dans la racine "),e.j41(728,"code"),e.EFF(729,"AppModule"),e.k0s(),e.EFF(730,"."),e.k0s(),e.j41(731,"app-copy-button",19)(732,"span",20),e.EFF(733),e.nI1(734,"extension"),e.nrm(735,"app-tabs",null,3),e.k0s(),e.j41(737,"pre")(738,"code",21),e.EFF(739,"\nimport { Module } from '@nestjs/common';\nimport { BullModule } from '@nestjs/bull';\n\n@Module({\n  imports: [\n    BullModule.forRoot({\n      redis: {\n        host: 'localhost',\n        port: 6379,\n      },\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(740,"p"),e.EFF(741,"La m\xe9thode "),e.j41(742,"code"),e.EFF(743,"forRoot()"),e.k0s(),e.EFF(744," est utilis\xe9e pour enregistrer un objet de configuration du paquet "),e.j41(745,"code"),e.EFF(746,"bull"),e.k0s(),e.EFF(747," qui sera utilis\xe9 par toutes les files d'attente enregistr\xe9es dans l'application (sauf indication contraire). Un objet de configuration est constitu\xe9 des propri\xe9t\xe9s suivantes :"),e.k0s(),e.j41(748,"ul")(749,"li")(750,"code"),e.EFF(751,"limiter: RateLimiter"),e.k0s(),e.EFF(752," - Options permettant de contr\xf4ler la vitesse \xe0 laquelle les travaux de la file d'attente sont trait\xe9s. Voir "),e.j41(753,"a",24),e.EFF(754,"RateLimiter"),e.k0s(),e.EFF(755," pour plus d'informations. Optionnel."),e.k0s(),e.j41(756,"li")(757,"code"),e.EFF(758,"redis: RedisOpts"),e.k0s(),e.EFF(759," - Options pour configurer la connexion Redis. Voir "),e.j41(760,"a",24),e.EFF(761,"RedisOpts"),e.k0s(),e.EFF(762," pour plus d'informations. Optionnel."),e.k0s(),e.j41(763,"li")(764,"code"),e.EFF(765,"prefix: string"),e.k0s(),e.EFF(766," - Pr\xe9fixe pour toutes les cl\xe9s de file d'attente. Optionnel."),e.k0s(),e.j41(767,"li")(768,"code"),e.EFF(769,"defaultJobOptions: JobOpts"),e.k0s(),e.EFF(770," - Options permettant de contr\xf4ler les param\xe8tres par d\xe9faut des nouveaux travaux. Voir "),e.j41(771,"a",23),e.EFF(772,"JobOpts"),e.k0s(),e.EFF(773," pour plus d'informations. Optionnel. "),e.j41(774,"strong"),e.EFF(775,"Note : Ces \xe9l\xe9ments ne sont pas pris en compte si vous planifiez des t\xe2ches via un FlowProducer. Voir "),e.j41(776,"a",51),e.EFF(777,"bullmq#1034"),e.k0s(),e.EFF(778," pour une explication."),e.k0s()(),e.j41(779,"li")(780,"code"),e.EFF(781,"settings: AdvancedSettings"),e.k0s(),e.EFF(782," - Param\xe8tres avanc\xe9s de configuration de la file d'attente. Ils ne doivent g\xe9n\xe9ralement pas \xeatre modifi\xe9s. Voir "),e.j41(783,"a",24),e.EFF(784,"AdvancedSettings"),e.k0s(),e.EFF(785," pour plus d'informations. Optionnel."),e.k0s()(),e.j41(786,"p"),e.EFF(787,"Toutes les options sont optionnelles et permettent un contr\xf4le d\xe9taill\xe9 du comportement de la file d'attente. Elles sont pass\xe9es directement au constructeur de Bull "),e.j41(788,"code"),e.EFF(789,"Queue"),e.k0s(),e.EFF(790,". Pour en savoir plus sur ces options, cliquez "),e.j41(791,"a",24),e.EFF(792,"ici"),e.k0s(),e.EFF(793,"."),e.k0s(),e.j41(794,"p"),e.EFF(795,"Pour enregistrer une file d'attente, importez le module dynamique "),e.j41(796,"code"),e.EFF(797,"BullModule.registerQueue()"),e.k0s(),e.EFF(798,", comme suit :"),e.k0s(),e.j41(799,"app-copy-button")(800,"pre")(801,"code",21),e.EFF(802,"\nBullModule.registerQueue({\n  name: 'audio',\n});\n"),e.k0s()()(),e.j41(803,"blockquote",26)(804,"strong"),e.EFF(805,"Astuce"),e.k0s(),e.EFF(806," Cr\xe9ez plusieurs files d'attente en passant plusieurs objets de configuration s\xe9par\xe9s par des virgules \xe0 la m\xe9thode "),e.j41(807,"code"),e.EFF(808,"registerQueue()"),e.k0s(),e.EFF(809,".\n"),e.k0s(),e.j41(810,"p"),e.EFF(811,"La m\xe9thode "),e.j41(812,"code"),e.EFF(813,"registerQueue()"),e.k0s(),e.EFF(814," est utilis\xe9e pour instancier et/ou enregistrer des files d'attente. Les files d'attente sont partag\xe9es entre les modules et les processus qui se connectent \xe0 la m\xeame base de donn\xe9es Redis sous-jacente avec les m\xeames informations d'identification. Chaque file d'attente est unique par sa propri\xe9t\xe9 name. Le nom d'une file d'attente est utilis\xe9 \xe0 la fois comme jeton d'injection (pour injecter la file d'attente dans les contr\xf4leurs/fournisseurs) et comme argument pour les d\xe9corateurs afin d'associer les classes de consommateurs et les auditeurs aux files d'attente."),e.k0s(),e.j41(815,"p"),e.EFF(816,"Vous pouvez \xe9galement remplacer certaines des options pr\xe9configur\xe9es pour une file d'attente sp\xe9cifique, comme suit :"),e.k0s(),e.j41(817,"app-copy-button")(818,"pre")(819,"code",21),e.EFF(820,"\nBullModule.registerQueue({\n  name: 'audio',\n  redis: {\n    port: 6380,\n  },\n});\n"),e.k0s()()(),e.j41(821,"p"),e.EFF(822,"Comme les travaux sont conserv\xe9s dans Redis, chaque fois qu'une file d'attente sp\xe9cifique est instanci\xe9e (par exemple, lorsqu'une application est d\xe9marr\xe9e/red\xe9marr\xe9e), elle tente de traiter tous les anciens travaux qui peuvent exister \xe0 partir d'une session pr\xe9c\xe9dente inachev\xe9e."),e.k0s(),e.j41(823,"p"),e.EFF(824,"Chaque file d'attente peut avoir un ou plusieurs producteurs, consommateurs et auditeurs. Les consommateurs r\xe9cup\xe8rent les travaux de la file d'attente dans un ordre sp\xe9cifique : FIFO ( par d\xe9faut), LIFO, ou en fonction des priorit\xe9s. Le contr\xf4le de l'ordre de traitement des files d'attente est abord\xe9 "),e.j41(825,"a",13),e.EFF(826,"ici"),e.k0s()(),e.j41(827,"p"),e.nrm(828,"app-banner-enterprise"),e.k0s(),e.j41(829,"h4",52)(830,"span"),e.EFF(831,"Configurations nomm\xe9es"),e.k0s()(),e.j41(832,"p"),e.EFF(833,"Si vos files d'attente se connectent \xe0 plusieurs instances Redis, vous pouvez utiliser une technique appel\xe9e "),e.j41(834,"strong"),e.EFF(835,"configurations nomm\xe9es"),e.k0s(),e.EFF(836,". Cette fonctionnalit\xe9 vous permet d'enregistrer plusieurs configurations sous des cl\xe9s sp\xe9cifiques, auxquelles vous pouvez ensuite vous r\xe9f\xe9rer dans les options de la file d'attente."),e.k0s(),e.j41(837,"p"),e.EFF(838,"Par exemple, si vous avez une instance Redis suppl\xe9mentaire (en plus de l'instance par d\xe9faut) utilis\xe9e par quelques files d'attente enregistr\xe9es dans votre application, vous pouvez enregistrer sa configuration comme suit :"),e.k0s(),e.j41(839,"app-copy-button")(840,"pre")(841,"code",21),e.EFF(842,"\nBullModule.forRoot('alternative-config', {\n  redis: {\n    port: 6381,\n  },\n});\n"),e.k0s()()(),e.j41(843,"p"),e.EFF(844,"Dans l'exemple ci-dessus, "),e.j41(845,"code"),e.EFF(846,"'alternative-config'"),e.k0s(),e.EFF(847," est juste une cl\xe9 de configuration (elle peut \xeatre n'importe quelle cha\xeene arbitraire)."),e.k0s(),e.j41(848,"p"),e.EFF(849,"Avec ceci en place, vous pouvez maintenant pointer vers cette configuration dans l'objet d'options "),e.j41(850,"code"),e.EFF(851,"registerQueue()"),e.k0s(),e.EFF(852," :"),e.k0s(),e.j41(853,"app-copy-button")(854,"pre")(855,"code",21),e.EFF(856,"\nBullModule.registerQueue({\n  configKey: 'alternative-config',\n  name: 'video',\n});\n"),e.k0s()()(),e.j41(857,"h4",53)(858,"span"),e.EFF(859,"Producteurs"),e.k0s()(),e.j41(860,"p"),e.EFF(861,"Les producteurs de travaux ajoutent des travaux aux files d'attente. Les producteurs sont g\xe9n\xe9ralement des services d'application ("),e.j41(862,"a",30),e.EFF(863,"fournisseurs"),e.k0s(),e.EFF(864," Nest). Pour ajouter des travaux \xe0 une file d'attente, il faut d'abord injecter la file d'attente dans le service comme suit :"),e.k0s(),e.j41(865,"app-copy-button")(866,"pre")(867,"code",21),e.EFF(868,"\nimport { Injectable } from '@nestjs/common';\nimport { Queue } from 'bull';\nimport { InjectQueue } from '@nestjs/bull';\n\n@Injectable()\nexport class AudioService {\n  constructor(@InjectQueue('audio') private audioQueue: Queue) {}\n}\n"),e.k0s()()(),e.j41(869,"blockquote",26)(870,"strong"),e.EFF(871,"Astuce"),e.k0s(),e.EFF(872," Le d\xe9corateur "),e.j41(873,"code"),e.EFF(874,"@InjectQueue()"),e.k0s(),e.EFF(875," identifie la file d'attente par son nom, tel qu'il est fourni dans l'appel \xe0 la m\xe9thode "),e.j41(876,"code"),e.EFF(877,"registerQueue()"),e.k0s(),e.EFF(878," (par exemple, "),e.j41(879,"code"),e.EFF(880,"'audio'"),e.k0s(),e.EFF(881,").\n"),e.k0s(),e.j41(882,"p"),e.EFF(883,"Maintenant, ajoutez un travail en appelant la m\xe9thode "),e.j41(884,"code"),e.EFF(885,"add()"),e.k0s(),e.EFF(886," de la file d'attente, en passant un objet de travail d\xe9fini par l'utilisateur. Les travaux sont repr\xe9sent\xe9s comme des objets JavaScript s\xe9rialisables (puisque c'est ainsi qu'ils sont stock\xe9s dans la base de donn\xe9es Redis). La forme du job que vous passez est arbitraire ; utilisez-la pour repr\xe9senter la s\xe9mantique de votre objet job."),e.k0s(),e.j41(887,"app-copy-button")(888,"pre")(889,"code",21),e.EFF(890,"\nconst job = await this.audioQueue.add({\n  foo: 'bar',\n});\n"),e.k0s()()(),e.j41(891,"h4",54)(892,"span"),e.EFF(893,"Travaux nomm\xe9s"),e.k0s()(),e.j41(894,"p"),e.EFF(895,"Les travaux peuvent avoir des noms uniques. Cela vous permet de cr\xe9er des "),e.j41(896,"a",13),e.EFF(897,"consommateurs"),e.k0s(),e.EFF(898," sp\xe9cialis\xe9s qui ne traiteront que les travaux portant un nom donn\xe9."),e.k0s(),e.j41(899,"app-copy-button")(900,"pre")(901,"code",21),e.EFF(902,"\nconst job = await this.audioQueue.add('transcode', {\n  foo: 'bar',\n});\n"),e.k0s()()(),e.j41(903,"blockquote",55)(904,"strong"),e.EFF(905,"Attention"),e.k0s(),e.EFF(906," Lorsque vous utilisez des travaux nomm\xe9s, vous devez cr\xe9er des processeurs pour chaque nom unique ajout\xe9 \xe0 une file d'attente, sinon la file d'attente se plaindra qu'il manque un processeur pour le travail en question. Voir "),e.j41(907,"a",13),e.EFF(908,"ici"),e.k0s(),e.EFF(909," pour plus d'informations sur l'utilisation des travaux nomm\xe9s.\n"),e.k0s(),e.j41(910,"h4",56)(911,"span"),e.EFF(912,"Options de travaux"),e.k0s()(),e.j41(913,"p"),e.EFF(914,"Les jobs peuvent \xeatre associ\xe9s \xe0 des options suppl\xe9mentaires. Passez un objet options apr\xe8s l'argument "),e.j41(915,"code"),e.EFF(916,"job"),e.k0s(),e.EFF(917," dans la m\xe9thode "),e.j41(918,"code"),e.EFF(919,"Queueue.add()"),e.k0s(),e.EFF(920,". Les propri\xe9t\xe9s des options des jobs sont les suivantes :"),e.k0s(),e.j41(921,"ul")(922,"li")(923,"code"),e.EFF(924,"priority"),e.k0s(),e.EFF(925,": "),e.j41(926,"code"),e.EFF(927,"number"),e.k0s(),e.EFF(928," - Valeur de priorit\xe9 facultative. Elle est comprise entre 1 (priorit\xe9 la plus \xe9lev\xe9e) et MAX_INT (priorit\xe9 la plus faible). Notez que l'utilisation des priorit\xe9s a un l\xe9ger impact sur les performances, il convient donc de les utiliser avec pr\xe9caution."),e.k0s(),e.j41(929,"li")(930,"code"),e.EFF(931,"delay"),e.k0s(),e.EFF(932,": "),e.j41(933,"code"),e.EFF(934,"number"),e.k0s(),e.EFF(935," - Temps d'attente (en millisecondes) jusqu'\xe0 ce que ce travail puisse \xeatre trait\xe9. Pour obtenir des d\xe9lais pr\xe9cis, le serveur et les clients doivent avoir leurs horloges synchronis\xe9es."),e.k0s(),e.j41(936,"li")(937,"code"),e.EFF(938,"attempts"),e.k0s(),e.EFF(939,": "),e.j41(940,"code"),e.EFF(941,"number"),e.k0s(),e.EFF(942," - Nombre total de tentatives pour essayer le travail jusqu'\xe0 ce qu'il s'ach\xe8ve."),e.k0s(),e.j41(943,"li")(944,"code"),e.EFF(945,"repeat"),e.k0s(),e.EFF(946,": "),e.j41(947,"code"),e.EFF(948,"RepeatOpts"),e.k0s(),e.EFF(949," - R\xe9p\xe9ter un travail selon une sp\xe9cification cron. Voir "),e.j41(950,"a",23),e.EFF(951,"RepeatOpts"),e.k0s(),e.EFF(952,"."),e.k0s(),e.j41(953,"li")(954,"code"),e.EFF(955,"backoff"),e.k0s(),e.EFF(956,": "),e.j41(957,"code"),e.EFF(958,"number | BackoffOpts"),e.k0s(),e.EFF(959," - Param\xe8tre de temporisation pour les nouvelles tentatives automatiques en cas d'\xe9chec du travail. Voir "),e.j41(960,"a",23),e.EFF(961,"BackoffOpts"),e.k0s(),e.EFF(962,"."),e.k0s(),e.j41(963,"li")(964,"code"),e.EFF(965,"lifo"),e.k0s(),e.EFF(966,": "),e.j41(967,"code"),e.EFF(968,"boolean"),e.k0s(),e.EFF(969," - Si true, ajoute le travail \xe0 l'extr\xe9mit\xe9 droite de la file d'attente au lieu de l'extr\xe9mit\xe9 gauche (false par d\xe9faut)."),e.k0s(),e.j41(970,"li")(971,"code"),e.EFF(972,"timeout"),e.k0s(),e.EFF(973,": "),e.j41(974,"code"),e.EFF(975,"number"),e.k0s(),e.EFF(976," - Nombre de millisecondes apr\xe8s lequel le travail doit \xe9chouer avec une erreur de d\xe9passement de d\xe9lai."),e.k0s(),e.j41(977,"li")(978,"code"),e.EFF(979,"jobId"),e.k0s(),e.EFF(980,": "),e.j41(981,"code"),e.EFF(982,"number"),e.k0s(),e.EFF(983," | "),e.j41(984,"code"),e.EFF(985,"string"),e.k0s(),e.EFF(986," - Remplace l'identifiant du travail - par d\xe9faut, l'identifiant du travail est un num\xe9ro unique.\ninteger, mais vous pouvez utiliser ce param\xe8tre pour le remplacer. Si vous utilisez cette option, il vous appartient de vous assurer que l'identifiant du travail est unique. Si vous tentez d'ajouter un travail avec un identifiant qui existe d\xe9j\xe0, il ne sera pas ajout\xe9."),e.k0s(),e.j41(987,"li")(988,"code"),e.EFF(989,"removeOnComplete"),e.k0s(),e.EFF(990,": "),e.j41(991,"code"),e.EFF(992,"boolean | number"),e.k0s(),e.EFF(993," - Si true, le travail est supprim\xe9 lorsqu'il s'ach\xe8ve avec succ\xe8s. Un nombre indique le nombre de travaux \xe0 conserver. Par d\xe9faut, le travail est conserv\xe9 dans l'ensemble des travaux termin\xe9s."),e.k0s(),e.j41(994,"li")(995,"code"),e.EFF(996,"removeOnFail"),e.k0s(),e.EFF(997,": "),e.j41(998,"code"),e.EFF(999,"boolean | number"),e.k0s(),e.EFF(1e3," - Si true, supprime le travail lorsqu'il \xe9choue apr\xe8s toutes les tentatives. Un nombre indique le nombre de t\xe2ches \xe0 conserver. Le comportement par d\xe9faut est de conserver le travail dans l'ensemble des \xe9checs."),e.k0s(),e.j41(1001,"li")(1002,"code"),e.EFF(1003,"stackTraceLimit"),e.k0s(),e.EFF(1004,": "),e.j41(1005,"code"),e.EFF(1006,"number"),e.k0s(),e.EFF(1007," - Limite le nombre de lignes de la stacktrace qui seront enregistr\xe9es dans la stacktrace."),e.k0s()(),e.j41(1008,"p"),e.EFF(1009,"Voici quelques exemples de personnalisation de travaux \xe0 l'aide d'options de travaux."),e.k0s(),e.j41(1010,"p"),e.EFF(1011,"Pour retarder le d\xe9marrage d'un travail, utilisez la propri\xe9t\xe9 de configuration "),e.j41(1012,"code"),e.EFF(1013,"delay"),e.k0s(),e.EFF(1014,"."),e.k0s(),e.j41(1015,"app-copy-button")(1016,"pre")(1017,"code",21),e.EFF(1018,"\nconst job = await this.audioQueue.add(\n  {\n    foo: 'bar',\n  },\n  { delay: 3000 }, //3 secondes de d\xe9lai\n);\n"),e.k0s()()(),e.j41(1019,"p"),e.EFF(1020,"Pour ajouter un travail \xe0 l'extr\xe9mit\xe9 droite de la file d'attente (traiter le travail comme "),e.j41(1021,"strong"),e.EFF(1022,"LIFO"),e.k0s(),e.EFF(1023," (Last In First Out)), d\xe9finissez la propri\xe9t\xe9 "),e.j41(1024,"code"),e.EFF(1025,"lifo"),e.k0s(),e.EFF(1026," de l'objet de configuration \xe0 "),e.j41(1027,"code"),e.EFF(1028,"true"),e.k0s(),e.EFF(1029,"."),e.k0s(),e.j41(1030,"app-copy-button")(1031,"pre")(1032,"code",21),e.EFF(1033,"\nconst job = await this.audioQueue.add(\n  {\n    foo: 'bar',\n  },\n  { lifo: true },\n);\n"),e.k0s()()(),e.j41(1034,"p"),e.EFF(1035,"Pour classer un travail par ordre de priorit\xe9, utilisez la propri\xe9t\xe9 "),e.j41(1036,"code"),e.EFF(1037,"priority"),e.k0s(),e.EFF(1038,"."),e.k0s(),e.j41(1039,"app-copy-button")(1040,"pre")(1041,"code",21),e.EFF(1042,"\nconst job = await this.audioQueue.add(\n  {\n    foo: 'bar',\n  },\n  { priority: 2 },\n);\n"),e.k0s()()(),e.j41(1043,"h4",57)(1044,"span"),e.EFF(1045,"Consommateurs"),e.k0s()(),e.j41(1046,"p"),e.EFF(1047,"Un consommateur est une "),e.j41(1048,"strong"),e.EFF(1049,"classe"),e.k0s(),e.EFF(1050," d\xe9finissant des m\xe9thodes qui traitent les travaux ajout\xe9s \xe0 la file d'attente, ou qui \xe9coutent les \xe9v\xe9nements de la file d'attente, ou les deux. D\xe9clarez une classe de consommateur en utilisant le d\xe9corateur "),e.j41(1051,"code"),e.EFF(1052,"@Processor()"),e.k0s(),e.EFF(1053," comme suit :"),e.k0s(),e.j41(1054,"app-copy-button")(1055,"pre")(1056,"code",21),e.EFF(1057,"\nimport { Processor } from '@nestjs/bull';\n\n@Processor('audio')\nexport class AudioConsumer {}\n"),e.k0s()()(),e.j41(1058,"blockquote",26)(1059,"strong"),e.EFF(1060,"Astuce"),e.k0s(),e.EFF(1061," Les consommateurs doivent \xeatre enregistr\xe9s en tant que "),e.j41(1062,"code"),e.EFF(1063,"providers"),e.k0s(),e.EFF(1064," pour que le paquet "),e.j41(1065,"code"),e.EFF(1066,"@nestjs/bull"),e.k0s(),e.EFF(1067," puisse les r\xe9cup\xe9rer.\n"),e.k0s(),e.j41(1068,"p"),e.EFF(1069,"O\xf9 l'argument cha\xeene du d\xe9corateur (par exemple, "),e.j41(1070,"code"),e.EFF(1071,"'audio'"),e.k0s(),e.EFF(1072,") est le nom de la file d'attente \xe0 associer aux m\xe9thodes de la classe."),e.k0s(),e.j41(1073,"p"),e.EFF(1074,"Dans une classe de consommateur, d\xe9clarez des gestionnaires de t\xe2ches en d\xe9corant les m\xe9thodes de gestionnaire avec le d\xe9corateur "),e.j41(1075,"code"),e.EFF(1076,"@Process()"),e.k0s(),e.EFF(1077,"."),e.k0s(),e.j41(1078,"app-copy-button")(1079,"pre")(1080,"code",21),e.EFF(1081,"\nimport { Processor, Process } from '@nestjs/bull';\nimport { Job } from 'bull';\n\n@Processor('audio')\nexport class AudioConsumer {\n  @Process()\n  async transcode(job: Job<unknown>) {\n    let progress = 0;\n    for (let i = 0; i < 100; i++) {\n      await doSomething(job.data);\n      progress += 1;\n      await job.progress(progress);\n    }\n    return {};\n  }\n}\n"),e.k0s()()(),e.j41(1082,"p"),e.EFF(1083,"La m\xe9thode d\xe9cor\xe9e (par exemple, "),e.j41(1084,"code"),e.EFF(1085,"transcode()"),e.k0s(),e.EFF(1086,") est appel\xe9e chaque fois que le worker est inactif et qu'il y a des jobs \xe0 traiter dans la file d'attente. Cette m\xe9thode handler re\xe7oit l'objet "),e.j41(1087,"code"),e.EFF(1088,"job"),e.k0s(),e.EFF(1089," comme seul argument. La valeur retourn\xe9e par la m\xe9thode handler est stock\xe9e dans l'objet job et peut \xeatre acc\xe9d\xe9e ult\xe9rieurement, par exemple dans un \xe9couteur pour l'\xe9v\xe9nement completed."),e.k0s(),e.j41(1090,"p"),e.EFF(1091,"Les objets "),e.j41(1092,"code"),e.EFF(1093,"Job"),e.k0s(),e.EFF(1094," ont plusieurs m\xe9thodes qui vous permettent d'interagir avec leur \xe9tat. Par exemple, le code ci-dessus utilise la m\xe9thode "),e.j41(1095,"code"),e.EFF(1096,"progress()"),e.k0s(),e.EFF(1097," pour mettre \xe0 jour la progression du job. Voir "),e.j41(1098,"a",58),e.EFF(1099,"ici"),e.k0s(),e.EFF(1100," pour la r\xe9f\xe9rence compl\xe8te de l'API de l'objet "),e.j41(1101,"code"),e.EFF(1102,"Job"),e.k0s(),e.EFF(1103,"."),e.k0s(),e.j41(1104,"p"),e.EFF(1105,"Vous pouvez indiquer qu'une m\xe9thode de gestion des travaux ne traitera "),e.j41(1106,"strong"),e.EFF(1107,"que"),e.k0s(),e.EFF(1108," les travaux d'un certain type (les travaux avec un "),e.j41(1109,"code"),e.EFF(1110,"nom"),e.k0s(),e.EFF(1111," sp\xe9cifique) en passant ce "),e.j41(1112,"code"),e.EFF(1113,"nom"),e.k0s(),e.EFF(1114," au d\xe9corateur "),e.j41(1115,"code"),e.EFF(1116,"@Process()"),e.k0s(),e.EFF(1117," comme indiqu\xe9 ci-dessous. Vous pouvez avoir plusieurs gestionnaires "),e.j41(1118,"code"),e.EFF(1119,"@Process()"),e.k0s(),e.EFF(1120," dans une classe de consommateur donn\xe9e, correspondant \xe0 chaque type de travail ("),e.j41(1121,"code"),e.EFF(1122,"nom"),e.k0s(),e.EFF(1123,"). Lorsque vous utilisez des travaux nomm\xe9s, assurez-vous d'avoir un gestionnaire correspondant \xe0 chaque nom."),e.k0s(),e.j41(1124,"app-copy-button")(1125,"pre")(1126,"code",21),e.EFF(1127,"\n@Process('transcode')\nasync transcode(job: Job<unknown>) { ... }\n"),e.k0s()()(),e.j41(1128,"blockquote",36)(1129,"strong"),e.EFF(1130,"Attention"),e.k0s(),e.EFF(1131," Lors de la d\xe9finition de plusieurs consommateurs pour la m\xeame file d'attente, l'option "),e.j41(1132,"code"),e.EFF(1133,"concurrency"),e.k0s(),e.EFF(1134," dans "),e.j41(1135,"code"),e.EFF(1136),e.k0s(),e.EFF(1137," ne sera pas prise en compte. La "),e.j41(1138,"code"),e.EFF(1139,"concurrency"),e.k0s(),e.EFF(1140," minimale correspondra au nombre de consommateurs d\xe9finis. Ceci s'applique m\xeame si les gestionnaires "),e.j41(1141,"code"),e.EFF(1142,"@Process()"),e.k0s(),e.EFF(1143," utilisent un "),e.j41(1144,"code"),e.EFF(1145,"nom"),e.k0s(),e.EFF(1146," diff\xe9rent pour g\xe9rer les travaux nomm\xe9s.\n"),e.k0s(),e.j41(1147,"h4",59)(1148,"span"),e.EFF(1149,"Consommateurs \xe0 port\xe9e de requ\xeate"),e.k0s()(),e.j41(1150,"p"),e.EFF(1151,"Lorsqu'un consommateur est marqu\xe9 comme \xe9tant \xe0 port\xe9e de requ\xeate (en savoir plus sur les port\xe9es d'injection "),e.j41(1152,"a",60),e.EFF(1153,"ici"),e.k0s(),e.EFF(1154,"), une nouvelle instance de la classe sera cr\xe9\xe9e exclusivement pour chaque t\xe2che. L'instance sera ramass\xe9e une fois le travail termin\xe9."),e.k0s(),e.j41(1155,"app-copy-button")(1156,"pre")(1157,"code",21),e.EFF(1158,"\n@Processor({\n  name: 'audio',\n  scope: Scope.REQUEST,\n})\n"),e.k0s()()(),e.j41(1159,"p"),e.EFF(1160,"Puisque les classes de consommateurs \xe0 port\xe9e de requ\xeate sont instanci\xe9es dynamiquement et \xe0 port\xe9e d'un seul travail, vous pouvez injecter un "),e.j41(1161,"code"),e.EFF(1162,"JOB_REF"),e.k0s(),e.EFF(1163," \xe0 travers le constructeur en utilisant une approche standard."),e.k0s(),e.j41(1164,"app-copy-button")(1165,"pre")(1166,"code",21),e.EFF(1167,"\nconstructor(@Inject(JOB_REF) jobRef: Job) {\n  console.log(jobRef);\n}\n"),e.k0s()()(),e.j41(1168,"blockquote",26)(1169,"strong"),e.EFF(1170,"Astuce"),e.k0s(),e.EFF(1171," Le jeton "),e.j41(1172,"code"),e.EFF(1173,"JOB_REF"),e.k0s(),e.EFF(1174," est import\xe9 du paquet "),e.j41(1175,"code"),e.EFF(1176,"@nestjs/bull"),e.k0s(),e.EFF(1177,".\n"),e.k0s(),e.j41(1178,"h4",61)(1179,"span"),e.EFF(1180,"Auditeurs"),e.k0s()(),e.j41(1181,"p"),e.EFF(1182,"Bull g\xe9n\xe8re un ensemble d'\xe9v\xe9nements utiles lorsque des changements d'\xe9tat de la file d'attente et/ou du travail se produisent. Nest fournit un ensemble de d\xe9corateurs qui permettent de s'abonner \xe0 un ensemble d'\xe9v\xe9nements standards. Ceux-ci sont export\xe9s depuis le package "),e.j41(1183,"code"),e.EFF(1184,"@nestjs/bull"),e.k0s(),e.EFF(1185,"."),e.k0s(),e.j41(1186,"p"),e.EFF(1187,"Les r\xe9cepteurs d'\xe9v\xe9nements doivent \xeatre d\xe9clar\xe9s dans une classe "),e.j41(1188,"a",41),e.EFF(1189,"consommateur"),e.k0s(),e.EFF(1190," (c'est-\xe0-dire dans une classe d\xe9cor\xe9e avec le d\xe9corateur "),e.j41(1191,"code"),e.EFF(1192,"@Processor()"),e.k0s(),e.EFF(1193,"). Pour \xe9couter un \xe9v\xe9nement, utilisez l'un des d\xe9corateurs du tableau ci-dessous pour d\xe9clarer un gestionnaire pour l'\xe9v\xe9nement. Par exemple, pour \xe9couter l'\xe9v\xe9nement \xe9mis lorsqu'un travail entre dans l'\xe9tat actif dans la file d'attente "),e.j41(1194,"code"),e.EFF(1195,"audio"),e.k0s(),e.EFF(1196,", utilisez la construction suivante :"),e.k0s(),e.j41(1197,"app-copy-button")(1198,"pre")(1199,"code",21),e.EFF(1200,"\nimport { Processor, Process, OnQueueActive } from '@nestjs/bull';\nimport { Job } from 'bull';\n\n@Processor('audio')\nexport class AudioConsumer {\n\n  @OnQueueActive()\n  onActive(job: Job) {\n    console.log(\n      `Processing job ${job.id} of type ${job.name} with data ${job.data}...`,\n    );\n  }\n  ...\n"),e.k0s()()(),e.j41(1201,"p"),e.EFF(1202,"Bull fonctionnant dans un environnement distribu\xe9 (multi-n\u0153uds), il d\xe9finit le concept de localit\xe9 des \xe9v\xe9nements. Ce concept reconna\xeet que les \xe9v\xe9nements peuvent \xeatre d\xe9clench\xe9s soit enti\xe8rement dans un seul processus, soit sur des files d'attente partag\xe9es par diff\xe9rents processus. Un \xe9v\xe9nement "),e.j41(1203,"strong"),e.EFF(1204,"local"),e.k0s(),e.EFF(1205," est produit lorsqu'une action ou un changement d'\xe9tat est d\xe9clench\xe9 sur une file d'attente dans le processus local. En d'autres termes, lorsque vos producteurs et consommateurs d'\xe9v\xe9nements sont locaux \xe0 un seul processus, tous les \xe9v\xe9nements se produisant sur les files d'attente sont locaux."),e.k0s(),e.j41(1206,"p"),e.EFF(1207,"Lorsqu'une file d'attente est partag\xe9e entre plusieurs processus, nous rencontrons la possibilit\xe9 d'\xe9v\xe9nements "),e.j41(1208,"strong"),e.EFF(1209,"globaux"),e.k0s(),e.EFF(1210,". Pour qu'un auditeur d'un processus re\xe7oive une notification d'\xe9v\xe9nement d\xe9clench\xe9e par un autre processus, il doit s'enregistrer pour un \xe9v\xe9nement global."),e.k0s(),e.j41(1211,"p"),e.EFF(1212,"Les gestionnaires d'\xe9v\xe9nements sont invoqu\xe9s chaque fois que l'\xe9v\xe9nement correspondant est \xe9mis. Le gestionnaire est appel\xe9 avec la signature indiqu\xe9e dans le tableau ci-dessous, ce qui lui permet d'acc\xe9der aux informations relatives \xe0 l'\xe9v\xe9nement. Nous examinons ci-dessous une diff\xe9rence essentielle entre les signatures locales et globales des gestionnaires d'\xe9v\xe9nements."),e.k0s(),e.j41(1213,"table")(1214,"tr")(1215,"th"),e.EFF(1216,"Auditeurs d'\xe9v\xe9nements locaux"),e.k0s(),e.j41(1217,"th"),e.EFF(1218,"Auditeurs d'\xe9v\xe9nements globaux"),e.k0s(),e.j41(1219,"th"),e.EFF(1220,"Signature de la m\xe9thode du gestionnaire / Lors de l'ex\xe9cution"),e.k0s()(),e.j41(1221,"tr")(1222,"td")(1223,"code"),e.EFF(1224,"@OnQueueError()"),e.k0s()(),e.j41(1225,"td")(1226,"code"),e.EFF(1227,"@OnGlobalQueueError()"),e.k0s()(),e.j41(1228,"td")(1229,"code"),e.EFF(1230,"handler(error: Error)"),e.k0s(),e.EFF(1231," - Une erreur s'est produite. "),e.j41(1232,"code"),e.EFF(1233,"error"),e.k0s(),e.EFF(1234," contient l'erreur qui a d\xe9clench\xe9 le message."),e.k0s()(),e.j41(1235,"tr")(1236,"td")(1237,"code"),e.EFF(1238,"@OnQueueWaiting()"),e.k0s()(),e.j41(1239,"td")(1240,"code"),e.EFF(1241,"@OnGlobalQueueWaiting()"),e.k0s()(),e.j41(1242,"td")(1243,"code"),e.EFF(1244,"handler(jobId: number | string)"),e.k0s(),e.EFF(1245," - Un travail attend d'\xeatre trait\xe9 d\xe8s qu'un travailleur est au repos. "),e.j41(1246,"code"),e.EFF(1247,"jobId"),e.k0s(),e.EFF(1248," contient l'identifiant du travail qui est entr\xe9 dans cet \xe9tat."),e.k0s()(),e.j41(1249,"tr")(1250,"td")(1251,"code"),e.EFF(1252,"@OnQueueActive()"),e.k0s()(),e.j41(1253,"td")(1254,"code"),e.EFF(1255,"@OnGlobalQueueActive()"),e.k0s()(),e.j41(1256,"td")(1257,"code"),e.EFF(1258,"handler(job: Job)"),e.k0s(),e.EFF(1259," - Le travail "),e.j41(1260,"code"),e.EFF(1261,"job"),e.k0s(),e.EFF(1262,"a d\xe9but\xe9. "),e.k0s()(),e.j41(1263,"tr")(1264,"td")(1265,"code"),e.EFF(1266,"@OnQueueStalled()"),e.k0s()(),e.j41(1267,"td")(1268,"code"),e.EFF(1269,"@OnGlobalQueueStalled()"),e.k0s()(),e.j41(1270,"td")(1271,"code"),e.EFF(1272,"handler(job: Job)"),e.k0s(),e.EFF(1273," - Le travail "),e.j41(1274,"code"),e.EFF(1275,"job"),e.k0s(),e.EFF(1276," a \xe9t\xe9 marqu\xe9 comme \xe9tant bloqu\xe9. Ceci est utile pour d\xe9bugger les travailleurs qui se plantent ou qui mettent en pause la boucle d'\xe9v\xe9nements."),e.k0s()(),e.j41(1277,"tr")(1278,"td")(1279,"code"),e.EFF(1280,"@OnQueueProgress()"),e.k0s()(),e.j41(1281,"td")(1282,"code"),e.EFF(1283,"@OnGlobalQueueProgress()"),e.k0s()(),e.j41(1284,"td")(1285,"code"),e.EFF(1286,"handler(job: Job, progress: number)"),e.k0s(),e.EFF(1287," - La progression du travail "),e.j41(1288,"code"),e.EFF(1289,"job"),e.k0s(),e.EFF(1290," a \xe9t\xe9 mise \xe0 jour \xe0 la valeur "),e.j41(1291,"code"),e.EFF(1292,"progress"),e.k0s(),e.EFF(1293,"."),e.k0s()(),e.j41(1294,"tr")(1295,"td")(1296,"code"),e.EFF(1297,"@OnQueueCompleted()"),e.k0s()(),e.j41(1298,"td")(1299,"code"),e.EFF(1300,"@OnGlobalQueueCompleted()"),e.k0s()(),e.j41(1301,"td")(1302,"code"),e.EFF(1303,"handler(job: Job, result: any)"),e.k0s(),e.EFF(1304," Le travail "),e.j41(1305,"code"),e.EFF(1306,"job"),e.k0s(),e.EFF(1307," s'est achev\xe9 avec succ\xe8s, avec un r\xe9sultat "),e.j41(1308,"code"),e.EFF(1309,"result"),e.k0s(),e.EFF(1310,"."),e.k0s()(),e.j41(1311,"tr")(1312,"td")(1313,"code"),e.EFF(1314,"@OnQueueFailed()"),e.k0s()(),e.j41(1315,"td")(1316,"code"),e.EFF(1317,"@OnGlobalQueueFailed()"),e.k0s()(),e.j41(1318,"td")(1319,"code"),e.EFF(1320,"handler(job: Job, err: Error)"),e.k0s(),e.EFF(1321," Le travail "),e.j41(1322,"code"),e.EFF(1323,"job"),e.k0s(),e.EFF(1324," a \xe9chou\xe9 avec la raison "),e.j41(1325,"code"),e.EFF(1326,"err"),e.k0s(),e.EFF(1327,"."),e.k0s()(),e.j41(1328,"tr")(1329,"td")(1330,"code"),e.EFF(1331,"@OnQueuePaused()"),e.k0s()(),e.j41(1332,"td")(1333,"code"),e.EFF(1334,"@OnGlobalQueuePaused()"),e.k0s()(),e.j41(1335,"td")(1336,"code"),e.EFF(1337,"handler()"),e.k0s(),e.EFF(1338," La file d'attente a \xe9t\xe9 mise en pause."),e.k0s()(),e.j41(1339,"tr")(1340,"td")(1341,"code"),e.EFF(1342,"@OnQueueResumed()"),e.k0s()(),e.j41(1343,"td")(1344,"code"),e.EFF(1345,"@OnGlobalQueueResumed()"),e.k0s()(),e.j41(1346,"td")(1347,"code"),e.EFF(1348,"handler(job: Job)"),e.k0s(),e.EFF(1349," La file d'attente a \xe9t\xe9 reprise."),e.k0s()(),e.j41(1350,"tr")(1351,"td")(1352,"code"),e.EFF(1353,"@OnQueueCleaned()"),e.k0s()(),e.j41(1354,"td")(1355,"code"),e.EFF(1356,"@OnGlobalQueueCleaned()"),e.k0s()(),e.j41(1357,"td")(1358,"code"),e.EFF(1359,"handler(jobs: Job[], type: string)"),e.k0s(),e.EFF(1360," Les anciens travaux ont \xe9t\xe9 supprim\xe9s de la file d'attente. "),e.j41(1361,"code"),e.EFF(1362,"jobs"),e.k0s(),e.EFF(1363," est un tableau de travaux nettoy\xe9s, et "),e.j41(1364,"code"),e.EFF(1365,"type"),e.k0s(),e.EFF(1366," est le type des travaux nettoy\xe9s."),e.k0s()(),e.j41(1367,"tr")(1368,"td")(1369,"code"),e.EFF(1370,"@OnQueueDrained()"),e.k0s()(),e.j41(1371,"td")(1372,"code"),e.EFF(1373,"@OnGlobalQueueDrained()"),e.k0s()(),e.j41(1374,"td")(1375,"code"),e.EFF(1376,"handler()"),e.k0s(),e.EFF(1377," \xc9mis lorsque la file d'attente a trait\xe9 tous les travaux en attente (m\xeame s'il peut y avoir des travaux retard\xe9s qui n'ont pas encore \xe9t\xe9 trait\xe9s)."),e.k0s()(),e.j41(1378,"tr")(1379,"td")(1380,"code"),e.EFF(1381,"@OnQueueRemoved()"),e.k0s()(),e.j41(1382,"td")(1383,"code"),e.EFF(1384,"@OnGlobalQueueRemoved()"),e.k0s()(),e.j41(1385,"td")(1386,"code"),e.EFF(1387,"handler(job: Job)"),e.k0s(),e.EFF(1388," Le travail "),e.j41(1389,"code"),e.EFF(1390,"job"),e.k0s(),e.EFF(1391," a \xe9t\xe9 supprim\xe9e avec succ\xe8s."),e.k0s()()(),e.j41(1392,"p"),e.EFF(1393,"Lors de l'\xe9coute d'\xe9v\xe9nements globaux, les signatures de m\xe9thodes peuvent \xeatre l\xe9g\xe8rement diff\xe9rentes de leur contrepartie locale. Sp\xe9cifiquement, toute signature de m\xe9thode qui re\xe7oit des objets "),e.j41(1394,"code"),e.EFF(1395,"job"),e.k0s(),e.EFF(1396," dans la version locale, re\xe7oit \xe0 la place un "),e.j41(1397,"code"),e.EFF(1398,"jobId"),e.k0s(),e.EFF(1399," ("),e.j41(1400,"code"),e.EFF(1401,"num\xe9ro"),e.k0s(),e.EFF(1402,") dans la version globale. Pour obtenir une r\xe9f\xe9rence \xe0 l'objet "),e.j41(1403,"code"),e.EFF(1404,"job"),e.k0s(),e.EFF(1405," dans un tel cas, utilisez la m\xe9thode "),e.j41(1406,"code"),e.EFF(1407,"Queueue#getJob"),e.k0s(),e.EFF(1408,". Cet appel doit \xeatre attendu, et donc le gestionnaire doit \xeatre d\xe9clar\xe9 "),e.j41(1409,"code"),e.EFF(1410,"async"),e.k0s(),e.EFF(1411,". Par exemple :"),e.k0s(),e.j41(1412,"app-copy-button")(1413,"pre")(1414,"code",21),e.EFF(1415,"\n@OnGlobalQueueCompleted()\nasync onGlobalCompleted(jobId: number, result: any) {\n  const job = await this.immediateQueue.getJob(jobId);\n  console.log('(Global) on completed: job ', job.id, ' -> result: ', result);\n}\n"),e.k0s()()(),e.j41(1416,"blockquote",26)(1417,"strong"),e.EFF(1418,"Astuce"),e.k0s(),e.EFF(1419," Pour acc\xe9der \xe0 l'objet "),e.j41(1420,"code"),e.EFF(1421,"Queue"),e.k0s(),e.EFF(1422," (pour faire un appel \xe0 "),e.j41(1423,"code"),e.EFF(1424,"getJob()"),e.k0s(),e.EFF(1425,"), vous devez bien s\xfbr l'injecter. De plus, la file d'attente doit \xeatre enregistr\xe9e dans le module o\xf9 vous l'injectez.\n"),e.k0s(),e.j41(1426,"p"),e.EFF(1427,"En plus des d\xe9corateurs d'auditeurs d'\xe9v\xe9nements sp\xe9cifiques, vous pouvez \xe9galement utiliser le d\xe9corateur g\xe9n\xe9rique "),e.j41(1428,"code"),e.EFF(1429,"@OnQueueEvent()"),e.k0s(),e.EFF(1430," en combinaison avec les enums "),e.j41(1431,"code"),e.EFF(1432,"BullQueueEvents"),e.k0s(),e.EFF(1433," ou "),e.j41(1434,"code"),e.EFF(1435,"BullQueueueGlobalEvents"),e.k0s(),e.EFF(1436,". Pour en savoir plus sur les \xe9v\xe9nements "),e.j41(1437,"a",62),e.EFF(1438,"ici"),e.k0s(),e.EFF(1439,"."),e.k0s(),e.j41(1440,"h4",63)(1441,"span"),e.EFF(1442,"Gestion des files d'attente"),e.k0s()(),e.j41(1443,"p"),e.EFF(1444,"Les files d'attente disposent d'une API qui vous permet d'ex\xe9cuter des fonctions de gestion telles que la mise en pause et la reprise, la r\xe9cup\xe9ration du nombre de travaux dans diff\xe9rents \xe9tats, et bien d'autres encore. Vous pouvez trouver l'API compl\xe8te de la file d'attente "),e.j41(1445,"a",24),e.EFF(1446,"ici"),e.k0s(),e.EFF(1447,". Invoquez n'importe laquelle de ces m\xe9thodes directement sur l'objet "),e.j41(1448,"code"),e.EFF(1449,"Queue"),e.k0s(),e.EFF(1450,", comme illustr\xe9 ci-dessous avec les exemples de pause/reprise."),e.k0s(),e.j41(1451,"p"),e.EFF(1452,"Mettez en pause une file d'attente avec l'appel de la m\xe9thode "),e.j41(1453,"code"),e.EFF(1454,"pause()"),e.k0s(),e.EFF(1455,". Une file d'attente mise en pause ne traitera pas de nouveaux travaux jusqu'\xe0 ce qu'elle reprenne, mais les travaux en cours de traitement continueront jusqu'\xe0 ce qu'ils soient finalis\xe9s."),e.k0s(),e.j41(1456,"app-copy-button")(1457,"pre")(1458,"code",21),e.EFF(1459,"\nawait audioQueue.pause();\n"),e.k0s()()(),e.j41(1460,"p"),e.EFF(1461,"Pour reprendre une file d'attente en pause, utilisez la m\xe9thode "),e.j41(1462,"code"),e.EFF(1463,"resume()"),e.k0s(),e.EFF(1464,", comme suit :"),e.k0s(),e.j41(1465,"app-copy-button")(1466,"pre")(1467,"code",21),e.EFF(1468,"\nawait audioQueue.resume();\n"),e.k0s()()(),e.j41(1469,"h4",64)(1470,"span"),e.EFF(1471,"Processus distincts"),e.k0s()(),e.j41(1472,"p"),e.EFF(1473,"Les gestionnaires de t\xe2ches peuvent \xe9galement \xeatre ex\xe9cut\xe9s dans un processus s\xe9par\xe9 (fork\xe9) ("),e.j41(1474,"a",65),e.EFF(1475,"source"),e.k0s(),e.EFF(1476,"). Cela pr\xe9sente plusieurs avantages :"),e.k0s(),e.j41(1477,"ul")(1478,"li"),e.EFF(1479,"Le processus est plac\xe9 dans une sandbox, de sorte que s'il \xe9choue, cela n'affecte pas le travailleur."),e.k0s(),e.j41(1480,"li"),e.EFF(1481,"Vous pouvez ex\xe9cuter du code bloquant sans affecter la file d'attente (les t\xe2ches ne seront pas bloqu\xe9es)."),e.k0s(),e.j41(1482,"li"),e.EFF(1483,"Une meilleure utilisation des processeurs multi-c\u0153urs."),e.k0s(),e.j41(1484,"li"),e.EFF(1485,"Moins de connexions \xe0 redis."),e.k0s()(),e.j41(1486,"app-copy-button",19)(1487,"span",20),e.EFF(1488),e.nI1(1489,"extension"),e.nrm(1490,"app-tabs",null,4),e.k0s(),e.j41(1492,"pre")(1493,"code",66),e.EFF(1494,"\nimport { Module } from '@nestjs/common';\nimport { BullModule } from '@nestjs/bull';\nimport { join } from 'path';\n\n@Module({\n  imports: [\n    BullModule.registerQueue({\n      name: 'audio',\n      processors: [join(__dirname, 'processor.js')],\n    }),\n  ],\n})\nexport class AppModule {}\n"),e.k0s()()(),e.j41(1495,"p"),e.EFF(1496,"Veuillez noter qu'\xe9tant donn\xe9 que votre fonction est ex\xe9cut\xe9e dans un processus fork\xe9, l'injection de d\xe9pendance (et le conteneur IoC) ne sera pas disponible. Cela signifie que la fonction de votre processeur devra contenir (ou cr\xe9er) toutes les instances de d\xe9pendances externes dont elle a besoin."),e.k0s(),e.j41(1497,"app-copy-button",19)(1498,"span",20),e.EFF(1499),e.nI1(1500,"extension"),e.nrm(1501,"app-tabs",null,5),e.k0s(),e.j41(1503,"pre")(1504,"code",66),e.EFF(1505,"\nimport { Job, DoneCallback } from 'bull';\n\nexport default function (job: Job, cb: DoneCallback) {\n  console.log(`[${process.pid}] ${JSON.stringify(job.data)}`);\n  cb(null, 'It works');\n}\n"),e.k0s()()(),e.j41(1506,"h4",67)(1507,"span"),e.EFF(1508,"Configuration asynchrone"),e.k0s()(),e.j41(1509,"p"),e.EFF(1510,"Vous pouvez vouloir passer des options "),e.j41(1511,"code"),e.EFF(1512,"bull"),e.k0s(),e.EFF(1513," de mani\xe8re asynchrone plut\xf4t que statique. Dans ce cas, utilisez la m\xe9thode "),e.j41(1514,"code"),e.EFF(1515,"forRootAsync()"),e.k0s(),e.EFF(1516," qui fournit plusieurs fa\xe7ons de g\xe9rer la configuration asynchrone."),e.k0s(),e.j41(1517,"p"),e.EFF(1518,"Une approche consiste \xe0 utiliser une fonction d'usine :"),e.k0s(),e.j41(1519,"app-copy-button")(1520,"pre")(1521,"code",21),e.EFF(1522,"\nBullModule.forRootAsync({\n  useFactory: () => ({\n    redis: {\n      host: 'localhost',\n      port: 6379,\n    },\n  }),\n});\n"),e.k0s()()(),e.j41(1523,"p"),e.EFF(1524,"Notre fabrique se comporte comme n'importe quel autre "),e.j41(1525,"a",68),e.EFF(1526,"fournisseur asynchrone"),e.k0s(),e.EFF(1527," (par exemple, il peut \xeatre "),e.j41(1528,"code"),e.EFF(1529,"async"),e.k0s(),e.EFF(1530," et il est capable d'injecter des d\xe9pendances via "),e.j41(1531,"code"),e.EFF(1532,"inject"),e.k0s(),e.EFF(1533,")."),e.k0s(),e.j41(1534,"app-copy-button")(1535,"pre")(1536,"code",21),e.EFF(1537,"\nBullModule.forRootAsync({\n  imports: [ConfigModule],\n  useFactory: async (configService: ConfigService) => ({\n    redis: {\n      host: configService.get('QUEUE_HOST'),\n      port: configService.get('QUEUE_PORT'),\n    },\n  }),\n  inject: [ConfigService],\n});\n"),e.k0s()()(),e.j41(1538,"p"),e.EFF(1539,"Alternatively, you can use the "),e.j41(1540,"code"),e.EFF(1541,"useClass"),e.k0s(),e.EFF(1542," syntax:"),e.k0s(),e.j41(1543,"app-copy-button")(1544,"pre")(1545,"code",21),e.EFF(1546,"\nBullModule.forRootAsync({\n  useClass: BullConfigService,\n});\n"),e.k0s()()(),e.j41(1547,"p"),e.EFF(1548,"La construction ci-dessus instanciera "),e.j41(1549,"code"),e.EFF(1550,"BullConfigService"),e.k0s(),e.EFF(1551," dans "),e.j41(1552,"code"),e.EFF(1553,"BullModule"),e.k0s(),e.EFF(1554," et l'utilisera pour fournir un objet d'options en appelant "),e.j41(1555,"code"),e.EFF(1556,"createSharedConfiguration()"),e.k0s(),e.EFF(1557,". Notez que cela signifie que le "),e.j41(1558,"code"),e.EFF(1559,"BullConfigService"),e.k0s(),e.EFF(1560," doit impl\xe9menter l'interface "),e.j41(1561,"code"),e.EFF(1562,"SharedBullConfigurationFactory"),e.k0s(),e.EFF(1563,", comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(1564,"app-copy-button")(1565,"pre")(1566,"code",21),e.EFF(1567,"\n@Injectable()\nclass BullConfigService implements SharedBullConfigurationFactory {\n  createSharedConfiguration(): BullModuleOptions {\n    return {\n      redis: {\n        host: 'localhost',\n        port: 6379,\n      },\n    };\n  }\n}\n"),e.k0s()()(),e.j41(1568,"p"),e.EFF(1569,"Afin d'\xe9viter la cr\xe9ation de "),e.j41(1570,"code"),e.EFF(1571,"BullConfigService"),e.k0s(),e.EFF(1572," dans "),e.j41(1573,"code"),e.EFF(1574,"BullModule"),e.k0s(),e.EFF(1575," et d'utiliser un fournisseur import\xe9 d'un module diff\xe9rent, vous pouvez utiliser la syntaxe "),e.j41(1576,"code"),e.EFF(1577,"useExisting"),e.k0s(),e.EFF(1578,"."),e.k0s(),e.j41(1579,"app-copy-button")(1580,"pre")(1581,"code",21),e.EFF(1582,"\nBullModule.forRootAsync({\n  imports: [ConfigModule],\n  useExisting: ConfigService,\n});\n"),e.k0s()()(),e.j41(1583,"p"),e.EFF(1584,"Cette construction fonctionne de la m\xeame mani\xe8re que "),e.j41(1585,"code"),e.EFF(1586,"useClass"),e.k0s(),e.EFF(1587," avec une diff\xe9rence essentielle - "),e.j41(1588,"code"),e.EFF(1589,"BullModule"),e.k0s(),e.EFF(1590," va chercher dans les modules import\xe9s pour r\xe9utiliser un "),e.j41(1591,"code"),e.EFF(1592,"ConfigService"),e.k0s(),e.EFF(1593," existant au lieu d'en instancier un nouveau."),e.k0s(),e.j41(1594,"p"),e.EFF(1595,"De m\xeame, si vous voulez passer des options de file d'attente de mani\xe8re asynchrone, utilisez la m\xe9thode "),e.j41(1596,"code"),e.EFF(1597,"registerQueueAsync()"),e.k0s(),e.EFF(1598,", en n'oubliant pas de sp\xe9cifier l'attribut "),e.j41(1599,"code"),e.EFF(1600,"name"),e.k0s(),e.EFF(1601," \xe0 l'ext\xe9rieur de la fonction usine."),e.k0s(),e.j41(1602,"app-copy-button")(1603,"pre")(1604,"code",21),e.EFF(1605,"\nBullModule.registerQueueAsync({\n  name: 'audio',\n  useFactory: () => ({\n    redis: {\n      host: 'localhost',\n      port: 6379,\n    },\n  }),\n});\n"),e.k0s()()(),e.j41(1606,"h4",69)(1607,"span"),e.EFF(1608,"Exemple"),e.k0s()(),e.j41(1609,"p"),e.EFF(1610,"Un exemple concret est disponible "),e.j41(1611,"a",70),e.EFF(1612,"ici"),e.k0s(),e.EFF(1613,"."),e.k0s()()),2&o){const u=e.sdS(73),r=e.sdS(600),p=e.sdS(736),l=e.sdS(1491),d=e.sdS(1502);e.R7$(70),e.SpI(" ",e.i5U(71,7,"app.module",u.isJsActive),"\n"),e.R7$(527),e.SpI(" ",e.i5U(598,10,"app.module",r.isJsActive),"\n"),e.R7$(136),e.SpI(" ",e.i5U(734,13,"app.module",p.isJsActive),"\n"),e.R7$(403),e.Lme("@Process(","{"," concurrency : 1 ","}",")"),e.R7$(352),e.SpI(" ",e.i5U(1489,16,"app.module",l.isJsActive),"\n"),e.R7$(11),e.SpI(" ",e.i5U(1500,19,"processor",d.isJsActive),"\n")}},dependencies:[E.O,i.a,x.d,c.z,j.Wk,k.M],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Queues"}},{path:"hot-reload",redirectTo:"/recipes/hot-reload"},{path:"server-sent-events",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-sse"]],features:[e.Vt3],decls:129,vars:0,consts:[["contentReference",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/server-sent-events.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","\xe9v\xe9nements-envoy\xe9s-par-le-serveur"],["rel","nofollow","target","_blank","href","https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events"],["appAnchor","","id","utilisation"],[1,"language-typescript"],[1,"info"],[1,"warning"],["rel","nofollow","target","_blank","href","https://developer.mozilla.org/en-US/docs/Web/API/EventSource"],[1,"language-javascript"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/28-sse"]],template:function(o,t){1&o&&(e.j41(0,"div",1,0)(2,"div",2)(3,"a",3),e.nrm(4,"i",4),e.k0s()(),e.j41(5,"h3",5),e.EFF(6,"\xc9v\xe9nements envoy\xe9s par le serveur"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Server-Sent Events (SSE) est une technologie de push serveur permettant \xe0 un client de recevoir des mises \xe0 jour automatiques d'un serveur via une connexion HTTP. Chaque notification est envoy\xe9e sous la forme d'un bloc de texte termin\xe9 par une paire de nouvelles lignes (pour en savoir plus "),e.j41(9,"a",6),e.EFF(10,"ici"),e.k0s(),e.EFF(11,")."),e.k0s(),e.j41(12,"h4",7)(13,"span"),e.EFF(14,"Utilisation"),e.k0s()(),e.j41(15,"p"),e.EFF(16,"Pour activer les \xe9v\xe9nements envoy\xe9s par le serveur sur une route (route enregistr\xe9e dans une classe "),e.j41(17,"strong"),e.EFF(18,"controller"),e.k0s(),e.EFF(19,"), annoter le gestionnaire de m\xe9thode avec le d\xe9corateur "),e.j41(20,"code"),e.EFF(21,"@Sse()"),e.k0s(),e.EFF(22,"."),e.k0s(),e.j41(23,"app-copy-button")(24,"pre")(25,"code",8),e.EFF(26,"\n@Sse('sse')\nsse(): Observable<MessageEvent> {\n  return interval(1000).pipe(map((_) => ({ data: { hello: 'world' } })));\n}\n"),e.k0s()()(),e.j41(27,"blockquote",9)(28,"strong"),e.EFF(29,"Astuce"),e.k0s(),e.EFF(30," Le d\xe9corateur "),e.j41(31,"code"),e.EFF(32,"@Sse()"),e.k0s(),e.EFF(33," et l'interface "),e.j41(34,"code"),e.EFF(35,"MessageEvent"),e.k0s(),e.EFF(36," sont import\xe9s du package "),e.j41(37,"code"),e.EFF(38,"@nestjs/common"),e.k0s(),e.EFF(39,", tandis que "),e.j41(40,"code"),e.EFF(41,"Observable"),e.k0s(),e.EFF(42,", "),e.j41(43,"code"),e.EFF(44,"interval"),e.k0s(),e.EFF(45,", et "),e.j41(46,"code"),e.EFF(47,"map"),e.k0s(),e.EFF(48," sont import\xe9s du package "),e.j41(49,"code"),e.EFF(50,"rxjs"),e.k0s(),e.EFF(51,".\n"),e.k0s(),e.j41(52,"blockquote",10)(53,"strong"),e.EFF(54,"Attention"),e.k0s(),e.EFF(55," Les routes d'\xe9v\xe9nements envoy\xe9s par le serveur doivent renvoyer un flux "),e.j41(56,"code"),e.EFF(57,"Observable"),e.k0s(),e.EFF(58,".\n"),e.k0s(),e.j41(59,"p"),e.EFF(60,"Dans l'exemple ci-dessus, nous avons d\xe9fini une route nomm\xe9e "),e.j41(61,"code"),e.EFF(62,"sse"),e.k0s(),e.EFF(63," qui nous permettra de propager des mises \xe0 jour en temps r\xe9el. Ces \xe9v\xe9nements peuvent \xeatre \xe9cout\xe9s \xe0 l'aide de l'API "),e.j41(64,"a",11),e.EFF(65,"EventSource"),e.k0s(),e.EFF(66,"."),e.k0s(),e.j41(67,"p"),e.EFF(68,"La m\xe9thode "),e.j41(69,"code"),e.EFF(70,"sse"),e.k0s(),e.EFF(71," retourne un "),e.j41(72,"code"),e.EFF(73,"Observable"),e.k0s(),e.EFF(74," qui \xe9met plusieurs "),e.j41(75,"code"),e.EFF(76,"MessageEvent"),e.k0s(),e.EFF(77," (dans cet exemple, il \xe9met un nouveau "),e.j41(78,"code"),e.EFF(79,"MessageEvent"),e.k0s(),e.EFF(80," toutes les secondes). L'objet "),e.j41(81,"code"),e.EFF(82,"MessageEvent"),e.k0s(),e.EFF(83," doit respecter l'interface suivante pour correspondre \xe0 la sp\xe9cification :"),e.k0s(),e.j41(84,"app-copy-button")(85,"pre")(86,"code",8),e.EFF(87,"\nexport interface MessageEvent {\n  data: string | object;\n  id?: string;\n  type?: string;\n  retry?: number;\n}\n"),e.k0s()()(),e.j41(88,"p"),e.EFF(89,"Avec ceci en place, nous pouvons maintenant cr\xe9er une instance de la classe "),e.j41(90,"code"),e.EFF(91,"EventSource"),e.k0s(),e.EFF(92," dans notre application c\xf4t\xe9 client, en passant la route "),e.j41(93,"code"),e.EFF(94,"/sse"),e.k0s(),e.EFF(95," (qui correspond au point de terminaison que nous avons pass\xe9 dans le d\xe9corateur "),e.j41(96,"code"),e.EFF(97,"@Sse()"),e.k0s(),e.EFF(98," ci-dessus) comme argument du constructeur."),e.k0s(),e.j41(99,"p"),e.EFF(100,"L'instance "),e.j41(101,"code"),e.EFF(102,"EventSource"),e.k0s(),e.EFF(103," ouvre une connexion persistante \xe0 un serveur HTTP, qui envoie des \xe9v\xe9nements au format "),e.j41(104,"code"),e.EFF(105,"text/event-stream"),e.k0s(),e.EFF(106,". La connexion reste ouverte jusqu'\xe0 ce qu'elle soit ferm\xe9e en appelant "),e.j41(107,"code"),e.EFF(108,"EventSource.close()"),e.k0s(),e.EFF(109,"."),e.k0s(),e.j41(110,"p"),e.EFF(111,"Une fois la connexion ouverte, les messages entrants du serveur sont transmis \xe0 votre code sous la forme d'\xe9v\xe9nements. Si le message entrant contient un champ d'\xe9v\xe9nement, l'\xe9v\xe9nement d\xe9clench\xe9 est le m\xeame que la valeur du champ d'\xe9v\xe9nement. Si aucun champ d'\xe9v\xe9nement n'est pr\xe9sent, un \xe9v\xe9nement g\xe9n\xe9rique "),e.j41(112,"code"),e.EFF(113,"message"),e.k0s(),e.EFF(114," est d\xe9clench\xe9 ("),e.j41(115,"a",11),e.EFF(116,"source"),e.k0s(),e.EFF(117,")."),e.k0s(),e.j41(118,"pre")(119,"code",12),e.EFF(120,"\nconst eventSource = new EventSource('/sse');\neventSource.onmessage = ({ data }) => {\n  console.log('Nouveau message', JSON.parse(data));\n};\n"),e.k0s()(),e.j41(121,"h4",13)(122,"span"),e.EFF(123,"Exemple"),e.k0s()(),e.j41(124,"p"),e.EFF(125,"Un exemple concret est disponible "),e.j41(126,"a",14),e.EFF(127,"ici"),e.k0s(),e.EFF(128,"."),e.k0s()())},dependencies:[i.a,c.z],encapsulation:2,changeDetection:0})}return s})(),data:{title:"\xc9v\xe9nements envoy\xe9s par le serveur"}},{path:"versioning",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-versioning"]],features:[e.Vt3],decls:443,vars:56,consts:[["contentReference",""],["app1054a0048794283635bd3da2131afad31f5345ce",""],["app0a8028ca76eb157c68020d4b933d96841be3a56d",""],["appa3c5a24f66e6b434084f58a28fe6a8f4eaffae5d",""],["app35edee64ffbc4ed2c78a6d28a3941bc5e48e1156",""],["app989f53661b3e081e31a1c25184ebce8856397940",""],["appaf25a6c5e770771bf56699be12d205699a8a3110",""],["app9859c8ad0c6a810f9729caf7aa3c6df502f26e3a",""],["app241d15a17f0d61da9e38c6cb2dd52ed1266bb06c",""],["app2c0a99d4f809a1a7c7912922d853b4804b9acff4",""],["appb457132a99321fca1f7db4229b893d3c313dc9f3",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/versioning.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","gestion-des-versions"],[1,"info"],["href","techniques/versioning#versionnage-des-uri"],["href","techniques/versioning#versionnage-des-en-t\xeates"],["href","techniques/versioning#versionnage-des-types-de-m\xe9dias"],["href","techniques/versioning#versionnage-personnalis\xe9"],["appAnchor","","id","versionnage-des-uri"],[1,"warning"],["href","faq/global-prefix"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],["appAnchor","","id","versionnage-des-en-t\xeates"],["appAnchor","","id","versionnage-des-types-de-m\xe9dias"],["appAnchor","","id","versionnage-personnalis\xe9"],["appAnchor","","id","usage"],["appAnchor","","id","versions-de-contr\xf4leurs"],["appAnchor","","id","versions-de-routes"],["appAnchor","","id","versions-multiples"],["appAnchor","","id","version-neutre"],["appAnchor","","id","version-globale-par-d\xe9faut"],["appAnchor","","id","versionnage-des-middlewares"],["routerLink","/middleware"]],template:function(o,t){if(1&o&&(e.j41(0,"div",11,0)(2,"div",12)(3,"a",13),e.nrm(4,"i",14),e.k0s()(),e.j41(5,"h3",15),e.EFF(6,"Gestion des versions"),e.k0s(),e.j41(7,"blockquote",16)(8,"strong"),e.EFF(9,"Astuce"),e.k0s(),e.EFF(10," Ce chapitre ne concerne que les applications bas\xe9es sur le protocole HTTP.\n"),e.k0s(),e.j41(11,"p"),e.EFF(12,"La gestion des versions vous permet d'avoir "),e.j41(13,"strong"),e.EFF(14,"diff\xe9rentes versions"),e.k0s(),e.EFF(15," de vos contr\xf4leurs ou de vos itin\xe9raires individuels fonctionnant dans la m\xeame application. Les applications changent tr\xe8s souvent et il n'est pas rare que vous deviez apporter des modifications radicales tout en continuant \xe0 supporter la version pr\xe9c\xe9dente de l'application."),e.k0s(),e.j41(16,"p"),e.EFF(17,"Il existe 4 types de gestion des versions qui sont pris en charge :"),e.k0s(),e.j41(18,"table")(19,"tr")(20,"td")(21,"a",17)(22,"code"),e.EFF(23,"Versionnage des URI"),e.k0s()()(),e.j41(24,"td"),e.EFF(25,"La version sera transmise dans l'URI de la requ\xeate (par d\xe9faut)"),e.k0s()(),e.j41(26,"tr")(27,"td")(28,"a",18)(29,"code"),e.EFF(30,"Versionnage des en-t\xeates"),e.k0s()()(),e.j41(31,"td"),e.EFF(32,"Un en-t\xeate de requ\xeate personnalis\xe9 sp\xe9cifiera la version"),e.k0s()(),e.j41(33,"tr")(34,"td")(35,"a",19)(36,"code"),e.EFF(37,"Versionnage des types de m\xe9dias"),e.k0s()()(),e.j41(38,"td"),e.EFF(39,"L'en-t\xeate "),e.j41(40,"code"),e.EFF(41,"Accept"),e.k0s(),e.EFF(42," de la requ\xeate sp\xe9cifiera la version"),e.k0s()(),e.j41(43,"tr")(44,"td")(45,"a",20)(46,"code"),e.EFF(47,"Versionnage personnalis\xe9"),e.k0s()()(),e.j41(48,"td"),e.EFF(49,"Tout aspect de la requ\xeate peut \xeatre utilis\xe9 pour sp\xe9cifier la (les) version(s). Une fonction personnalis\xe9e est fournie pour extraire cette (ces) version(s)."),e.k0s()()(),e.j41(50,"h4",21)(51,"span"),e.EFF(52,"Versionnage des URI"),e.k0s()(),e.j41(53,"p"),e.EFF(54,"Le versionnage de l'URI utilise la version transmise dans l'URI de la requ\xeate, comme "),e.j41(55,"code"),e.EFF(56,"https://example.com/v1/route"),e.k0s(),e.EFF(57," et "),e.j41(58,"code"),e.EFF(59,"https://example.com/v2/route"),e.k0s(),e.EFF(60,"."),e.k0s(),e.j41(61,"blockquote",22)(62,"strong"),e.EFF(63,"Remarque"),e.k0s(),e.EFF(64," Avec le versionnage de l'URI, la version sera automatiquement ajout\xe9e \xe0 l'URI apr\xe8s le "),e.j41(65,"a",23),e.EFF(66,"pr\xe9fixe du chemin global"),e.k0s(),e.EFF(67," (s'il existe), et avant tout contr\xf4leur ou chemin d'acc\xe8s.\n"),e.k0s(),e.j41(68,"p"),e.EFF(69,"Pour activer le versionnage des URI pour votre application, proc\xe9dez comme suit :"),e.k0s(),e.j41(70,"app-copy-button",24)(71,"span",25),e.EFF(72),e.nI1(73,"extension"),e.nrm(74,"app-tabs",null,1),e.k0s(),e.j41(76,"pre")(77,"code",26),e.EFF(78,'\nconst app = await NestFactory.create(AppModule);\n// ou "app.enableVersioning()"\napp.enableVersioning({\n  type: VersioningType.URI,\n});\nawait app.listen(process.env.PORT ?? 3000);\n'),e.k0s()()(),e.j41(79,"blockquote",22)(80,"strong"),e.EFF(81,"Remarque"),e.k0s(),e.EFF(82," La version dans l'URI sera automatiquement pr\xe9fix\xe9e par "),e.j41(83,"code"),e.EFF(84,"v"),e.k0s(),e.EFF(85," par d\xe9faut, cependant la valeur du pr\xe9fixe peut \xeatre configur\xe9e en d\xe9finissant la cl\xe9 "),e.j41(86,"code"),e.EFF(87,"prefix"),e.k0s(),e.EFF(88," avec le pr\xe9fixe d\xe9sir\xe9 ou "),e.j41(89,"code"),e.EFF(90,"false"),e.k0s(),e.EFF(91," si vous souhaitez le d\xe9sactiver.\n"),e.k0s(),e.j41(92,"blockquote",16)(93,"strong"),e.EFF(94,"Astuce"),e.k0s(),e.EFF(95," L'enum "),e.j41(96,"code"),e.EFF(97,"VersioningType"),e.k0s(),e.EFF(98," est disponible pour la propri\xe9t\xe9 "),e.j41(99,"code"),e.EFF(100,"type"),e.k0s(),e.EFF(101," et est import\xe9 du package "),e.j41(102,"code"),e.EFF(103,"@nestjs/common"),e.k0s(),e.EFF(104,".\n"),e.k0s(),e.j41(105,"h4",27)(106,"span"),e.EFF(107,"Versionnage des en-t\xeates"),e.k0s()(),e.j41(108,"p"),e.EFF(109,"Le versionnage de l'en-t\xeate utilise un en-t\xeate de requ\xeate personnalis\xe9, sp\xe9cifi\xe9 par l'utilisateur, pour sp\xe9cifier la version, la valeur de l'en-t\xeate \xe9tant la version \xe0 utiliser pour la requ\xeate."),e.k0s(),e.j41(110,"p"),e.EFF(111,"Exemple de requ\xeates HTTP pour le versionnage des en-t\xeates :"),e.k0s(),e.j41(112,"p"),e.EFF(113,"Pour activer le "),e.j41(114,"strong"),e.EFF(115,"versionnage des en-t\xeates"),e.k0s(),e.EFF(116," pour votre application, proc\xe9dez comme suit :"),e.k0s(),e.j41(117,"app-copy-button",24)(118,"span",25),e.EFF(119),e.nI1(120,"extension"),e.nrm(121,"app-tabs",null,2),e.k0s(),e.j41(123,"pre")(124,"code",26),e.EFF(125,"\nconst app = await NestFactory.create(AppModule);\napp.enableVersioning({\n  type: VersioningType.HEADER,\n  header: 'Custom-Header',\n});\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(126,"p"),e.EFF(127,"La propri\xe9t\xe9 "),e.j41(128,"code"),e.EFF(129,"header"),e.k0s(),e.EFF(130," doit \xeatre le nom de l'en-t\xeate qui contiendra la version de la requ\xeate."),e.k0s(),e.j41(131,"blockquote",16)(132,"strong"),e.EFF(133,"Astuce"),e.k0s(),e.EFF(134," L'enum "),e.j41(135,"code"),e.EFF(136,"VersioningType"),e.k0s(),e.EFF(137," est disponible pour la propri\xe9t\xe9 "),e.j41(138,"code"),e.EFF(139,"type"),e.k0s(),e.EFF(140," et est import\xe9 du package "),e.j41(141,"code"),e.EFF(142,"@nestjs/common"),e.k0s(),e.EFF(143,".\n"),e.k0s(),e.j41(144,"h4",28)(145,"span"),e.EFF(146,"Versionnage des types de m\xe9dias"),e.k0s()(),e.j41(147,"p"),e.EFF(148,"Le versionnage du type de m\xe9dia utilise l'en-t\xeate "),e.j41(149,"code"),e.EFF(150,"Accept"),e.k0s(),e.EFF(151," de la requ\xeate pour sp\xe9cifier la version."),e.k0s(),e.j41(152,"p"),e.EFF(153,"Dans l'en-t\xeate "),e.j41(154,"code"),e.EFF(155,"Accept"),e.k0s(),e.EFF(156,", la version sera s\xe9par\xe9e du type de m\xe9dia par un point-virgule, "),e.j41(157,"code"),e.EFF(158,";"),e.k0s(),e.EFF(159,". Il devrait ensuite contenir une paire cl\xe9-valeur qui repr\xe9sente la version \xe0 utiliser pour la requ\xeate, comme "),e.j41(160,"code"),e.EFF(161,"Accept : application/json;v=2"),e.k0s(),e.EFF(162,". La cl\xe9 est plut\xf4t trait\xe9e comme un pr\xe9fixe lors de la d\xe9termination de la version, qui devra \xeatre configur\xe9e pour inclure la cl\xe9 et le s\xe9parateur."),e.k0s(),e.j41(163,"p"),e.EFF(164,"Pour activer le "),e.j41(165,"strong"),e.EFF(166,"versionnage du type de m\xe9dia"),e.k0s(),e.EFF(167," pour votre application, proc\xe9dez comme suit :"),e.k0s(),e.j41(168,"app-copy-button",24)(169,"span",25),e.EFF(170),e.nI1(171,"extension"),e.nrm(172,"app-tabs",null,3),e.k0s(),e.j41(174,"pre")(175,"code",26),e.EFF(176,"\nconst app = await NestFactory.create(AppModule);\napp.enableVersioning({\n  type: VersioningType.MEDIA_TYPE,\n  key: 'v=',\n});\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(177,"p"),e.EFF(178,"La propri\xe9t\xe9 "),e.j41(179,"code"),e.EFF(180,"key"),e.k0s(),e.EFF(181," doit \xeatre la cl\xe9 et le s\xe9parateur de la paire cl\xe9-valeur qui contient la version. Pour l'exemple "),e.j41(182,"code"),e.EFF(183,"Accept : application/json;v=2"),e.k0s(),e.EFF(184,", la propri\xe9t\xe9 "),e.j41(185,"code"),e.EFF(186,"key"),e.k0s(),e.EFF(187," serait fix\xe9e \xe0 "),e.j41(188,"code"),e.EFF(189,"v="),e.k0s(),e.EFF(190,"."),e.k0s(),e.j41(191,"blockquote",16)(192,"strong"),e.EFF(193,"Astuce"),e.k0s(),e.EFF(194," L'enum "),e.j41(195,"code"),e.EFF(196,"VersioningType"),e.k0s(),e.EFF(197," est disponible pour la propri\xe9t\xe9 "),e.j41(198,"code"),e.EFF(199,"type"),e.k0s(),e.EFF(200," et est import\xe9 du package "),e.j41(201,"code"),e.EFF(202,"@nestjs/common"),e.k0s(),e.EFF(203,".\n"),e.k0s(),e.j41(204,"h4",29)(205,"span"),e.EFF(206,"Versionnage personnalis\xe9"),e.k0s()(),e.j41(207,"p"),e.EFF(208,"Le versionnage personnalis\xe9 utilise n'importe quel aspect de la requ\xeate pour sp\xe9cifier la (ou les) version(s). La requ\xeate entrante est analys\xe9e \xe0 l'aide d'une fonction "),e.j41(209,"code"),e.EFF(210,"extractor"),e.k0s(),e.EFF(211," qui renvoie une cha\xeene de caract\xe8res ou un tableau de caract\xe8res."),e.k0s(),e.j41(212,"p"),e.EFF(213,"Si plusieurs versions sont fournies par la requ\xeate, la fonction d'extraction peut renvoyer un tableau de caract\xe8res, tri\xe9s dans l'ordre de la version la plus grande/la plus \xe9lev\xe9e \xe0 la version la plus petite/la plus basse. Les versions sont associ\xe9es aux itin\xe9raires dans l'ordre de la plus grande \xe0 la plus petite."),e.k0s(),e.j41(214,"p"),e.EFF(215,"Si une cha\xeene de caract\xe8res ou un tableau vide est renvoy\xe9 par l'extracteur, aucune route n'est prise en compte et un message 404 est renvoy\xe9."),e.k0s(),e.j41(216,"p"),e.EFF(217,"Par exemple, si une requ\xeate entrante sp\xe9cifie qu'elle supporte les versions "),e.j41(218,"code"),e.EFF(219,"1"),e.k0s(),e.EFF(220,", "),e.j41(221,"code"),e.EFF(222,"2"),e.k0s(),e.EFF(223,", et "),e.j41(224,"code"),e.EFF(225,"3"),e.k0s(),e.EFF(226,", l'extracteur ** DOIT** renvoyer "),e.j41(227,"code"),e.EFF(228,"[3, 2, 1]"),e.k0s(),e.EFF(229,". Cela permet de s'assurer que la version de route la plus \xe9lev\xe9e possible est s\xe9lectionn\xe9e en premier."),e.k0s(),e.j41(230,"p"),e.EFF(231,"Si les versions "),e.j41(232,"code"),e.EFF(233,"[3, 2, 1]"),e.k0s(),e.EFF(234," sont extraites, mais que les routes n'existent que pour les versions "),e.j41(235,"code"),e.EFF(236,"2"),e.k0s(),e.EFF(237," et "),e.j41(238,"code"),e.EFF(239,"1"),e.k0s(),e.EFF(240,", la route qui correspond \xe0 la version "),e.j41(241,"code"),e.EFF(242,"2"),e.k0s(),e.EFF(243," est s\xe9lectionn\xe9e (la version "),e.j41(244,"code"),e.EFF(245,"3"),e.k0s(),e.EFF(246," est automatiquement ignor\xe9e)."),e.k0s(),e.j41(247,"blockquote",22)(248,"strong"),e.EFF(249,"Remarque"),e.k0s(),e.EFF(250," La s\xe9lection de la version la plus \xe9lev\xe9e bas\xe9e sur le tableau retourn\xe9 par "),e.j41(251,"code"),e.EFF(252,"extractor"),e.k0s(),e.j41(253,"strong"),e.EFF(254,"ne fonctionne pas de mani\xe8re fiable"),e.k0s(),e.EFF(255," avec l'adaptateur Express en raison de limitations de conception. Une version unique (soit une cha\xeene de caract\xe8res, soit un tableau de 1 \xe9l\xe9ment) fonctionne parfaitement dans Express. Fastify supporte correctement la s\xe9lection de la version la plus \xe9lev\xe9e et la s\xe9lection d'une seule version.\n"),e.k0s(),e.j41(256,"p"),e.EFF(257,"Pour activer le "),e.j41(258,"strong"),e.EFF(259,"versionnage personnalis\xe9"),e.k0s(),e.EFF(260," pour votre application, cr\xe9ez une fonction "),e.j41(261,"code"),e.EFF(262,"extractor"),e.k0s(),e.EFF(263," et passez-la dans votre application\ncomme suit :"),e.k0s(),e.j41(264,"app-copy-button",24)(265,"span",25),e.EFF(266),e.nI1(267,"extension"),e.nrm(268,"app-tabs",null,4),e.k0s(),e.j41(270,"pre")(271,"code",26),e.EFF(272,"\n// Exemple d'extracteur qui extrait une liste de versions d'un en-t\xeate personnalis\xe9 et la transforme en un tableau tri\xe9.\n// Cet exemple utilise Fastify, mais les requ\xeates Express peuvent \xeatre trait\xe9es de mani\xe8re similaire.\nconst extractor = (request: FastifyRequest): string | string[] =>\n  [request.headers['custom-versioning-field'] ?? '']\n     .flatMap(v => v.split(','))\n     .filter(v => !!v)\n     .sort()\n     .reverse()\n\nconst app = await NestFactory.create(AppModule);\napp.enableVersioning({\n  type: VersioningType.CUSTOM,\n  extractor,\n});\nawait app.listen(process.env.PORT ?? 3000);\n"),e.k0s()()(),e.j41(273,"h4",30)(274,"span"),e.EFF(275,"Usage"),e.k0s()(),e.j41(276,"p"),e.EFF(277,"Le versionnage vous permet de versionner les contr\xf4leurs, les routes individuelles et fournit \xe9galement un moyen pour certaines ressources de ne pas utiliser le versionnage. L'utilisation du versionnage est la m\xeame quel que soit le type de versionnage utilis\xe9 par votre application."),e.k0s(),e.j41(278,"blockquote",22)(279,"strong"),e.EFF(280,"Remarque"),e.k0s(),e.EFF(281," Si le versioning est activ\xe9 pour l'application mais que le contr\xf4leur ou la route ne sp\xe9cifie pas la version, toutes les requ\xeates vers ce contr\xf4leur/route seront retourn\xe9es avec le statut de r\xe9ponse "),e.j41(282,"code"),e.EFF(283,"404"),e.k0s(),e.EFF(284,". De m\xeame, si une requ\xeate est re\xe7ue contenant une version qui n'a pas de contr\xf4leur ou d'itin\xe9raire correspondant, elle sera \xe9galement renvoy\xe9e avec un statut de r\xe9ponse "),e.j41(285,"code"),e.EFF(286,"404"),e.k0s(),e.EFF(287,".\n"),e.k0s(),e.j41(288,"h4",31)(289,"span"),e.EFF(290,"Versions de contr\xf4leurs"),e.k0s()(),e.j41(291,"p"),e.EFF(292,"Une version peut \xeatre appliqu\xe9e \xe0 un contr\xf4leur, d\xe9finissant la version pour tous les itin\xe9raires au sein du contr\xf4leur."),e.k0s(),e.j41(293,"p"),e.EFF(294,"Pour ajouter une version \xe0 un contr\xf4leur, proc\xe9dez comme suit :"),e.k0s(),e.j41(295,"app-copy-button",24)(296,"span",25),e.EFF(297),e.nI1(298,"extension"),e.nrm(299,"app-tabs",null,5),e.k0s(),e.j41(301,"pre")(302,"code",26),e.EFF(303,"\n@Controller({\n  version: '1',\n})\nexport class CatsControllerV1 {\n  @Get('cats')\n  findAll(): string {\n    return 'This action returns all cats for version 1';\n  }\n}\n"),e.k0s()(),e.j41(304,"pre")(305,"code",26),e.EFF(306,"\n@Controller({\n  version: '1',\n})\nexport class CatsControllerV1 {\n  @Get('cats')\n  findAll() {\n    return 'This action returns all cats for version 1';\n  }\n}\n"),e.k0s()()(),e.j41(307,"h4",32)(308,"span"),e.EFF(309,"Versions de routes"),e.k0s()(),e.j41(310,"p"),e.EFF(311,"Une version peut \xeatre appliqu\xe9e \xe0 une route individuelle. Cette version remplacera toute autre version qui affecterait la route, telle que la version du contr\xf4leur."),e.k0s(),e.j41(312,"p"),e.EFF(313,"Pour ajouter une version \xe0 une route individuelle, proc\xe9dez comme suit :"),e.k0s(),e.j41(314,"app-copy-button",24)(315,"span",25),e.EFF(316),e.nI1(317,"extension"),e.nrm(318,"app-tabs",null,6),e.k0s(),e.j41(320,"pre")(321,"code",26),e.EFF(322,"\nimport { Controller, Get, Version } from '@nestjs/common';\n\n@Controller()\nexport class CatsController {\n  @Version('1')\n  @Get('cats')\n  findAllV1(): string {\n    return 'This action returns all cats for version 1';\n  }\n\n  @Version('2')\n  @Get('cats')\n  findAllV2(): string {\n    return 'This action returns all cats for version 2';\n  }\n}\n"),e.k0s()(),e.j41(323,"pre")(324,"code",26),e.EFF(325,"\nimport { Controller, Get, Version } from '@nestjs/common';\n\n@Controller()\nexport class CatsController {\n  @Version('1')\n  @Get('cats')\n  findAllV1() {\n    return 'This action returns all cats for version 1';\n  }\n\n  @Version('2')\n  @Get('cats')\n  findAllV2() {\n    return 'This action returns all cats for version 2';\n  }\n}\n"),e.k0s()()(),e.j41(326,"h4",33)(327,"span"),e.EFF(328,"Versions multiples"),e.k0s()(),e.j41(329,"p"),e.EFF(330,"Plusieurs versions peuvent \xeatre appliqu\xe9es \xe0 un contr\xf4leur ou \xe0 une route. Pour utiliser plusieurs versions, vous devez d\xe9finir la version comme un tableau."),e.k0s(),e.j41(331,"p"),e.EFF(332,"Pour ajouter plusieurs versions, proc\xe9dez comme suit :"),e.k0s(),e.j41(333,"app-copy-button",24)(334,"span",25),e.EFF(335),e.nI1(336,"extension"),e.nrm(337,"app-tabs",null,7),e.k0s(),e.j41(339,"pre")(340,"code",26),e.EFF(341,"\n@Controller({\n  version: ['1', '2'],\n})\nexport class CatsController {\n  @Get('cats')\n  findAll(): string {\n    return 'This action returns all cats for version 1 or 2';\n  }\n}\n"),e.k0s()(),e.j41(342,"pre")(343,"code",26),e.EFF(344,"\n@Controller({\n  version: ['1', '2'],\n})\nexport class CatsController {\n  @Get('cats')\n  findAll() {\n    return 'This action returns all cats for version 1 or 2';\n  }\n}\n"),e.k0s()()(),e.j41(345,"h4",34)(346,"span"),e.EFF(347,'Version "neutre"'),e.k0s()(),e.j41(348,"p"),e.EFF(349,"Certains contr\xf4leurs ou routes peuvent ne pas se soucier de la version et avoir la m\xeame fonctionnalit\xe9 quelle que soit la version. Pour tenir compte de cela, la version peut \xeatre d\xe9finie avec le symbole "),e.j41(350,"code"),e.EFF(351,"VERSION_NEUTRAL"),e.k0s(),e.EFF(352,"."),e.k0s(),e.j41(353,"p"),e.EFF(354,"Une requ\xeate entrante sera affect\xe9e \xe0 un contr\xf4leur ou \xe0 une route "),e.j41(355,"code"),e.EFF(356,"VERSION_NEUTRAL"),e.k0s(),e.EFF(357," quelle que soit la version envoy\xe9e dans la requ\xeate et m\xeame si la requ\xeate ne contient pas de version du tout."),e.k0s(),e.j41(358,"blockquote",22)(359,"strong"),e.EFF(360,"Remarque"),e.k0s(),e.EFF(361," Pour le versionnage des URI, une ressource "),e.j41(362,"code"),e.EFF(363,"VERSION_NEUTRAL"),e.k0s(),e.EFF(364," n'aurait pas la version pr\xe9sente dans l'URI.\n"),e.k0s(),e.j41(365,"p"),e.EFF(366,"Pour le versionnage des URI, une ressource "),e.j41(367,"code"),e.EFF(368,"VERSION_NEUTRAL"),e.k0s(),e.EFF(369," n'aurait pas la version pr\xe9sente dans l'URI."),e.k0s(),e.j41(370,"app-copy-button",24)(371,"span",25),e.EFF(372),e.nI1(373,"extension"),e.nrm(374,"app-tabs",null,8),e.k0s(),e.j41(376,"pre")(377,"code",26),e.EFF(378,"\nimport { Controller, Get, VERSION_NEUTRAL } from '@nestjs/common';\n\n@Controller({\n  version: VERSION_NEUTRAL,\n})\nexport class CatsController {\n  @Get('cats')\n  findAll(): string {\n    return 'This action returns all cats regardless of version';\n  }\n}\n"),e.k0s()(),e.j41(379,"pre")(380,"code",26),e.EFF(381,"\nimport { Controller, Get, VERSION_NEUTRAL } from '@nestjs/common';\n\n@Controller({\n  version: VERSION_NEUTRAL,\n})\nexport class CatsController {\n  @Get('cats')\n  findAll() {\n    return 'This action returns all cats regardless of version';\n  }\n}\n"),e.k0s()()(),e.j41(382,"h4",35)(383,"span"),e.EFF(384,"Version globale par d\xe9faut"),e.k0s()(),e.j41(385,"p"),e.EFF(386,"Si vous ne voulez pas fournir une version pour chaque contr\xf4leur et/ou route individuelle, ou si vous voulez qu'une version sp\xe9cifique soit d\xe9finie comme version par d\xe9faut pour chaque contr\xf4leur/route qui n'a pas la version sp\xe9cifi\xe9e, vous pouvez d\xe9finir "),e.j41(387,"code"),e.EFF(388,"defaultVersion"),e.k0s(),e.EFF(389," de la fa\xe7on suivante :"),e.k0s(),e.j41(390,"app-copy-button",24)(391,"span",25),e.EFF(392),e.nI1(393,"extension"),e.nrm(394,"app-tabs",null,9),e.k0s(),e.j41(396,"pre")(397,"code",26),e.EFF(398,"\napp.enableVersioning({\n  // ...\n  defaultVersion: '1'\n  // ou\n  defaultVersion: ['1', '2']\n  // ou\n  defaultVersion: VERSION_NEUTRAL\n});\n"),e.k0s()()(),e.j41(399,"h4",36)(400,"span"),e.EFF(401,"Versionnage des middlewares"),e.k0s()(),e.j41(402,"p"),e.EFF(403,"Les "),e.j41(404,"a",37),e.EFF(405,"Middlewares"),e.k0s(),e.EFF(406," peuvent \xe9galement utiliser les m\xe9tadonn\xe9es de version pour configurer le middleware en fonction de la version d'une route sp\xe9cifique. Pour ce faire, il faut fournir le num\xe9ro de version comme l'un des param\xe8tres de la m\xe9thode "),e.j41(407,"code"),e.EFF(408,"MiddlewareConsumer.forRoutes()"),e.k0s(),e.EFF(409," :"),e.k0s(),e.j41(410,"app-copy-button",24)(411,"span",25),e.EFF(412),e.nI1(413,"extension"),e.nrm(414,"app-tabs",null,10),e.k0s(),e.j41(416,"pre")(417,"code",26),e.EFF(418,"\nimport { Module, NestModule, MiddlewareConsumer } from '@nestjs/common';\nimport { LoggerMiddleware } from './common/middleware/logger.middleware';\nimport { CatsModule } from './cats/cats.module';\nimport { CatsController } from './cats/cats.controller';\n\n@Module({\n  imports: [CatsModule],\n})\nexport class AppModule implements NestModule {\n  configure(consumer: MiddlewareConsumer) {\n    consumer\n      .apply(LoggerMiddleware)\n      .forRoutes({ path: 'cats', method: RequestMethod.GET, version: '2' });\n  }\n}\n"),e.k0s()()(),e.j41(419,"p"),e.EFF(420,"Avec le code ci-dessus, le "),e.j41(421,"code"),e.EFF(422,"LoggerMiddleware"),e.k0s(),e.EFF(423," ne sera appliqu\xe9 qu'\xe0 la version '2' de l'endpoint "),e.j41(424,"code"),e.EFF(425,"/cats"),e.k0s(),e.EFF(426,"."),e.k0s(),e.j41(427,"blockquote",16)(428,"strong"),e.EFF(429,"Remarque"),e.k0s(),e.EFF(430," Les middlewares fonctionnent avec tous les types de version d\xe9crits dans cette section : "),e.j41(431,"code"),e.EFF(432,"URI"),e.k0s(),e.EFF(433,", "),e.j41(434,"code"),e.EFF(435,"en-t\xeate"),e.k0s(),e.EFF(436,", "),e.j41(437,"code"),e.EFF(438,"type de m\xe9dia"),e.k0s(),e.EFF(439," ou "),e.j41(440,"code"),e.EFF(441,"personnalis\xe9"),e.k0s(),e.EFF(442,".\n"),e.k0s()()),2&o){const u=e.sdS(75),r=e.sdS(122),p=e.sdS(173),l=e.sdS(269),d=e.sdS(300),m=e.sdS(319),f=e.sdS(338),v=e.sdS(375),b=e.sdS(395),h=e.sdS(415);e.R7$(72),e.SpI(" ",e.i5U(73,26,"main",u.isJsActive),"\n"),e.R7$(47),e.SpI(" ",e.i5U(120,29,"main",r.isJsActive),"\n"),e.R7$(51),e.SpI(" ",e.i5U(171,32,"main",p.isJsActive),"\n"),e.R7$(96),e.SpI(" ",e.i5U(267,35,"main",l.isJsActive),"\n"),e.R7$(31),e.SpI(" ",e.i5U(298,38,"cats.controller",d.isJsActive),"\n"),e.R7$(4),e.AVh("hide",d.isJsActive),e.R7$(3),e.AVh("hide",!d.isJsActive),e.R7$(12),e.SpI(" ",e.i5U(317,41,"cats.controller",m.isJsActive),"\n"),e.R7$(4),e.AVh("hide",m.isJsActive),e.R7$(3),e.AVh("hide",!m.isJsActive),e.R7$(12),e.SpI(" ",e.i5U(336,44,"cats.controller",f.isJsActive),"\n"),e.R7$(4),e.AVh("hide",f.isJsActive),e.R7$(3),e.AVh("hide",!f.isJsActive),e.R7$(30),e.SpI(" ",e.i5U(373,47,"cats.controller",v.isJsActive),"\n"),e.R7$(4),e.AVh("hide",v.isJsActive),e.R7$(3),e.AVh("hide",!v.isJsActive),e.R7$(13),e.SpI(" ",e.i5U(393,50,"main",b.isJsActive),"\n"),e.R7$(20),e.SpI(" ",e.i5U(413,53,"app.module",h.isJsActive),"\n")}},dependencies:[E.O,i.a,c.z,j.Wk,k.M],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Gestion des versions"}},{path:"events",component:U,data:{title:"\xc9v\xe9nements"}},{path:"session",component:(()=>{class s extends a.y{static \u0275fac=(()=>{let n;return function(t){return(n||(n=e.xGo(s)))(t||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-sessions"]],features:[e.Vt3],decls:200,vars:0,consts:[["contentReference",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/techniques/sessions.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","session"],["routerLink","/techniques/mvc"],["appAnchor","","id","utilisation-avec-express-par-d\xe9faut"],["rel","nofollow","target","_blank","href","https://github.com/expressjs/session"],[1,"language-shell"],[1,"language-typescript"],[1,"warning"],["rel","nofollow","target","_blank","href","https://github.com/expressjs/session#saveuninitialized"],["rel","nofollow","target","_blank","href","https://github.com/expressjs/session#options"],[1,"info"],["appAnchor","","id","utilisation-avec-fastify"],["rel","nofollow","target","_blank","href","https://github.com/fastify/fastify-secure-session"],["rel","nofollow","target","_blank","href","https://github.com/fastify/fastify-secure-session#using-keys-with-key-rotation"]],template:function(o,t){1&o&&(e.j41(0,"div",1,0)(2,"div",2)(3,"a",3),e.nrm(4,"i",4),e.k0s()(),e.j41(5,"h3",5),e.EFF(6,"Session"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Les "),e.j41(9,"strong"),e.EFF(10,"sessions HTTP"),e.k0s(),e.EFF(11," permettent de stocker des informations sur l'utilisateur \xe0 travers plusieurs requ\xeates, ce qui est particuli\xe8rement utile pour les applications "),e.j41(12,"a",6),e.EFF(13,"MVC"),e.k0s(),e.EFF(14,"."),e.k0s(),e.j41(15,"h4",7)(16,"span"),e.EFF(17,"Utilisation avec Express (par d\xe9faut)"),e.k0s()(),e.j41(18,"p"),e.EFF(19,"Commencez par installer le "),e.j41(20,"a",8),e.EFF(21,"package requis"),e.k0s(),e.EFF(22," (et ses types pour les utilisateurs de TypeScript) :"),e.k0s(),e.j41(23,"pre")(24,"code",9),e.EFF(25,"\n$ npm i express-session\n$ npm i -D @types/express-session\n"),e.k0s()(),e.j41(26,"p"),e.EFF(27,"Une fois l'installation termin\xe9e, appliquez le middleware "),e.j41(28,"code"),e.EFF(29,"express-session"),e.k0s(),e.EFF(30," comme middleware global (par exemple, dans votre fichier "),e.j41(31,"code"),e.EFF(32,"main.ts"),e.k0s(),e.EFF(33,")."),e.k0s(),e.j41(34,"app-copy-button")(35,"pre")(36,"code",10),e.EFF(37,"\nimport * as session from 'express-session';\n// quelque part dans votre fichier d'initialisation\napp.use(\n  session({\n    secret: 'my-secret',\n    resave: false,\n    saveUninitialized: false,\n  }),\n);\n"),e.k0s()()(),e.j41(38,"blockquote",11)(39,"strong"),e.EFF(40,"Remarque"),e.k0s(),e.EFF(41," Le stockage de session c\xf4t\xe9 serveur par d\xe9faut n'est volontairement pas con\xe7u pour un environnement de production. Il provoque des fuites de m\xe9moire dans la plupart des cas, n'est pas extensible au-del\xe0 d'un seul processus et est destin\xe9 au d\xe9bogage et au d\xe9veloppement. Pour en savoir plus, consultez le "),e.j41(42,"a",8),e.EFF(43,"d\xe9p\xf4t officiel"),e.k0s(),e.EFF(44,".\n"),e.k0s(),e.j41(45,"p"),e.EFF(46,"Le "),e.j41(47,"code"),e.EFF(48,"secret"),e.k0s(),e.EFF(49," est utilis\xe9 pour signer le cookie d'identification de session. Il peut s'agir d'une cha\xeene de caract\xe8res pour un seul secret, ou d'un tableau de plusieurs secrets. Si un tableau de secrets est fourni, seul le premier \xe9l\xe9ment sera utilis\xe9 pour signer le cookie d'identification de session, tandis que tous les \xe9l\xe9ments seront pris en compte lors de la v\xe9rification de la signature dans les requ\xeates. Le secret lui-m\xeame ne doit pas \xeatre facilement analys\xe9 par un \xeatre humain et doit de pr\xe9f\xe9rence \xeatre un ensemble al\xe9atoire de caract\xe8res."),e.k0s(),e.j41(50,"p"),e.EFF(51,"Activer l'option "),e.j41(52,"code"),e.EFF(53,"resave"),e.k0s(),e.EFF(54," force la session \xe0 \xeatre sauvegard\xe9e dans le magasin de session, m\xeame si la session n'a jamais \xe9t\xe9 modifi\xe9e durant la requ\xeate. La valeur par d\xe9faut est "),e.j41(55,"code"),e.EFF(56,"true"),e.k0s(),e.EFF(57,", mais l'utilisation de la valeur par d\xe9faut a \xe9t\xe9 d\xe9pr\xe9ci\xe9e, car la valeur par d\xe9faut changera dans le futur."),e.k0s(),e.j41(58,"p"),e.EFF(59,"De m\xeame, l'activation de l'option "),e.j41(60,"code"),e.EFF(61,"saveUninitialized"),e.k0s(),e.EFF(62,' force une session "non initialis\xe9e" \xe0 \xeatre sauvegard\xe9e dans le stockage. Une session est non initialis\xe9e lorsqu\'elle est nouvelle mais non modifi\xe9e. Choisir '),e.j41(63,"code"),e.EFF(64,"false"),e.k0s(),e.EFF(65," est utile pour mettre en place des sessions de connexion, r\xe9duire l'utilisation du stockage du serveur, ou se conformer aux lois qui requi\xe8rent une permission avant de mettre en place un cookie. Choisir "),e.j41(66,"code"),e.EFF(67,"false"),e.k0s(),e.EFF(68," aidera aussi \xe0 r\xe9soudre les conditions de concurrence lorsqu'un client fait plusieurs requ\xeates parall\xe8les sans session ("),e.j41(69,"a",12),e.EFF(70,"source"),e.k0s(),e.EFF(71,")."),e.k0s(),e.j41(72,"p"),e.EFF(73,"Vous pouvez passer plusieurs autres options au middleware "),e.j41(74,"code"),e.EFF(75,"session"),e.k0s(),e.EFF(76,", pour en savoir plus, consultez la "),e.j41(77,"a",13),e.EFF(78,"documentation API"),e.k0s(),e.EFF(79,"."),e.k0s(),e.j41(80,"blockquote",14)(81,"strong"),e.EFF(82,"Astuce"),e.k0s(),e.EFF(83," Veuillez noter que "),e.j41(84,"code"),e.EFF(85,"secure : true"),e.k0s(),e.EFF(86," est une option recommand\xe9e. Cependant, elle n\xe9cessite un site web compatible avec le protocole HTTPS, c'est-\xe0-dire que le protocole HTTPS est n\xe9cessaire pour s\xe9curiser les cookies. Si l'option secure est activ\xe9e, et que vous acc\xe9dez \xe0 votre site par HTTP, le cookie ne sera pas activ\xe9. Si vous avez votre node.js derri\xe8re un proxy et que vous utilisez "),e.j41(87,"code"),e.EFF(88,"secure : true"),e.k0s(),e.EFF(89,", vous devez d\xe9finir "),e.j41(90,"code"),e.EFF(91,'"trust proxy"'),e.k0s(),e.EFF(92," dans express.\n"),e.k0s(),e.j41(93,"p"),e.EFF(94,"Ainsi, vous pouvez d\xe9sormais d\xe9finir et lire les valeurs de session \xe0 partir des gestionnaires d'itin\xe9raires, comme suit :"),e.k0s(),e.j41(95,"app-copy-button")(96,"pre")(97,"code",10),e.EFF(98,"\n@Get()\nfindAll(@Req() request: Request) {\n  request.session.visits = request.session.visits ? request.session.visits + 1 : 1;\n}\n"),e.k0s()()(),e.j41(99,"blockquote",14)(100,"strong"),e.EFF(101,"Astuce"),e.k0s(),e.EFF(102," Le d\xe9corateur "),e.j41(103,"code"),e.EFF(104,"@Req()"),e.k0s(),e.EFF(105," est import\xe9 du package "),e.j41(106,"code"),e.EFF(107,"@nestjs/common"),e.k0s(),e.EFF(108,", tandis que "),e.j41(109,"code"),e.EFF(110,"Request"),e.k0s(),e.EFF(111," est import\xe9 du package "),e.j41(112,"code"),e.EFF(113,"express"),e.k0s(),e.EFF(114,".\n"),e.k0s(),e.j41(115,"p"),e.EFF(116,"Vous pouvez \xe9galement utiliser le d\xe9corateur "),e.j41(117,"code"),e.EFF(118,"@Session()"),e.k0s(),e.EFF(119," pour extraire un objet de session de la requ\xeate, comme suit :"),e.k0s(),e.j41(120,"app-copy-button")(121,"pre")(122,"code",10),e.EFF(123,"\n@Get()\nfindAll(@Session() session: Record<string, any>) {\n  session.visits = session.visits ? session.visits + 1 : 1;\n}\n"),e.k0s()()(),e.j41(124,"blockquote",14)(125,"strong"),e.EFF(126,"Astuce"),e.k0s(),e.EFF(127," Le d\xe9corateur "),e.j41(128,"code"),e.EFF(129,"@Session()"),e.k0s(),e.EFF(130," est import\xe9 du package "),e.j41(131,"code"),e.EFF(132,"@nestjs/common"),e.k0s(),e.EFF(133,".\n"),e.k0s(),e.j41(134,"h4",15)(135,"span"),e.EFF(136,"Utilisation avec Fastify"),e.k0s()(),e.j41(137,"p"),e.EFF(138,"Installez d'abord le package requis :"),e.k0s(),e.j41(139,"pre")(140,"code",9),e.EFF(141,"\n$ npm i @fastify/secure-session\n"),e.k0s()(),e.j41(142,"p"),e.EFF(143,"Une fois l'installation termin\xe9e, enregistrez le plugin "),e.j41(144,"code"),e.EFF(145,"fastify-secure-session"),e.k0s(),e.EFF(146," :"),e.k0s(),e.j41(147,"app-copy-button")(148,"pre")(149,"code",10),e.EFF(150,"\nimport secureSession from '@fastify/secure-session';\n\n// quelque part dans votre fichier d'initialisation\nconst app = await NestFactory.create<NestFastifyApplication>(\n  AppModule,\n  new FastifyAdapter(),\n);\nawait app.register(secureSession, {\n  secret: 'unetreslonguephraseplusgrandequetrentedeuxcaracteres',\n  salt: 'mq9hDxBVDbspDR6n',\n});\n"),e.k0s()()(),e.j41(151,"blockquote",14)(152,"strong"),e.EFF(153,"Astuce"),e.k0s(),e.EFF(154," Vous pouvez \xe9galement pr\xe9g\xe9n\xe9rer une cl\xe9 ("),e.j41(155,"a",16),e.EFF(156,"voir instructions"),e.k0s(),e.EFF(157,") ou utiliser la "),e.j41(158,"a",17),e.EFF(159,"rotation des cl\xe9s"),e.k0s(),e.EFF(160,".\n"),e.k0s(),e.j41(161,"p"),e.EFF(162,"Pour en savoir plus sur les options disponibles, consultez le "),e.j41(163,"a",16),e.EFF(164,"d\xe9p\xf4t officiel"),e.k0s(),e.EFF(165,"."),e.k0s(),e.j41(166,"p"),e.EFF(167,"Ainsi, vous pouvez d\xe9sormais d\xe9finir et lire les valeurs de session \xe0 partir des gestionnaires de routes, comme suit :"),e.k0s(),e.j41(168,"app-copy-button")(169,"pre")(170,"code",10),e.EFF(171,"\n@Get()\nfindAll(@Req() request: FastifyRequest) {\n  const visits = request.session.get('visits');\n  request.session.set('visits', visits ? visits + 1 : 1);\n}\n"),e.k0s()()(),e.j41(172,"p"),e.EFF(173,"Vous pouvez \xe9galement utiliser le d\xe9corateur "),e.j41(174,"code"),e.EFF(175,"@Session()"),e.k0s(),e.EFF(176," pour extraire un objet de session de la requ\xeate, comme suit :"),e.k0s(),e.j41(177,"app-copy-button")(178,"pre")(179,"code",10),e.EFF(180,"\n@Get()\nfindAll(@Session() session: secureSession.Session) {\n  const visits = session.get('visits');\n  session.set('visits', visits ? visits + 1 : 1);\n}\n"),e.k0s()()(),e.j41(181,"blockquote",14)(182,"strong"),e.EFF(183,"Astuce"),e.k0s(),e.EFF(184," Le d\xe9corateur "),e.j41(185,"code"),e.EFF(186,"@Session()"),e.k0s(),e.EFF(187," est import\xe9 depuis "),e.j41(188,"code"),e.EFF(189,"@nestjs/common"),e.k0s(),e.EFF(190,", tandis que "),e.j41(191,"code"),e.EFF(192,"secureSession.Session"),e.k0s(),e.EFF(193," est import\xe9 depuis le package "),e.j41(194,"code"),e.EFF(195,"@fastify/secure-session"),e.k0s(),e.EFF(196," (d\xe9claration d'importation : "),e.j41(197,"code"),e.EFF(198,"import * as secureSession from '@fastify/secure-session'"),e.k0s(),e.EFF(199,").\n"),e.k0s()())},dependencies:[i.a,c.z,j.Wk],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Session"}}];let $=(()=>{class s{static \u0275fac=function(o){return new(o||s)};static \u0275mod=e.$C({type:s});static \u0275inj=e.G2t({imports:[P.MD,R.G,j.iI.forChild(J)]})}return s})()}}]);