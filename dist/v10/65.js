"use strict";(self.webpackChunkdocs_nestjs_com=self.webpackChunkdocs_nestjs_com||[]).push([[65],{3065:(q,v,r)=>{r.r(v),r.d(v,{WebsocketsModule:()=>x});var j=r(177),l=r(685),h=r(445),i=r(8050),e=r(4438),c=r(5119),p=r(4819),u=r(2469),f=r(5663);let g=(()=>{class s extends i.y{static \u0275fac=(()=>{let n;return function(a){return(n||(n=e.xGo(s)))(a||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-adapter"]],features:[e.Vt3],decls:194,vars:10,consts:[["contentReference",""],["appd7ac54c53af8f5d4b9a5468d7976ae915856afcb",""],["app4846c567697b960dc68f6f07cefd260f1b13f4a4",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/websockets/adapter.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","adaptateurs"],["appAnchor","","id","\xe9tendre-socketio"],["rel","nofollow","target","_blank","href","https://github.com/socketio/socket.io"],[1,"warning"],["rel","nofollow","target","_blank","href","https://socket.io/docs/v4/using-multiple-nodes/#enabling-sticky-session"],[1,"language-bash"],[1,"language-typescript"],["appAnchor","","id","biblioth\xe8que-ws"],["rel","nofollow","target","_blank","href","https://github.com/websockets/ws"],[1,"info"],["appAnchor","","id","avanc\xe9-adaptateur-personnalis\xe9"],[1,"with-heading"],[1,"filename"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/16-gateways-ws"]],template:function(t,a){if(1&t&&(e.j41(0,"div",3,0)(2,"div",4)(3,"a",5),e.nrm(4,"i",6),e.k0s()(),e.j41(5,"h3",7),e.EFF(6,"Adaptateurs"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Le module WebSockets est agnostique, vous pouvez donc apporter votre propre biblioth\xe8que (ou m\xeame une impl\xe9mentation native) en utilisant l'interface "),e.j41(9,"code"),e.EFF(10,"WebSocketAdapter"),e.k0s(),e.EFF(11,". Cette interface oblige \xe0 impl\xe9menter quelques m\xe9thodes d\xe9crites dans le tableau suivant :"),e.k0s(),e.j41(12,"table")(13,"tr")(14,"td")(15,"code"),e.EFF(16,"create"),e.k0s()(),e.j41(17,"td"),e.EFF(18,"Cr\xe9e une instance de socket sur la base des arguments fournis"),e.k0s()(),e.j41(19,"tr")(20,"td")(21,"code"),e.EFF(22,"bindClientConnect"),e.k0s()(),e.j41(23,"td"),e.EFF(24,"Lie l'\xe9v\xe9nement de connexion du client"),e.k0s()(),e.j41(25,"tr")(26,"td")(27,"code"),e.EFF(28,"bindClientDisconnect"),e.k0s()(),e.j41(29,"td"),e.EFF(30,"Lie l'\xe9v\xe9nement de d\xe9connexion du client (optionnel*)"),e.k0s()(),e.j41(31,"tr")(32,"td")(33,"code"),e.EFF(34,"bindMessageHandlers"),e.k0s()(),e.j41(35,"td"),e.EFF(36,"Relie le message entrant au gestionnaire de message correspondant"),e.k0s()(),e.j41(37,"tr")(38,"td")(39,"code"),e.EFF(40,"close"),e.k0s()(),e.j41(41,"td"),e.EFF(42,"Met fin \xe0 une instance de serveur"),e.k0s()()(),e.j41(43,"h4",8)(44,"span"),e.EFF(45,"\xc9tendre socket.io"),e.k0s()(),e.j41(46,"p"),e.EFF(47,"Le package "),e.j41(48,"a",9),e.EFF(49,"socket.io"),e.k0s(),e.EFF(50," est envelopp\xe9 dans une classe "),e.j41(51,"code"),e.EFF(52,"IoAdapter"),e.k0s(),e.EFF(53,". Que se passe-t-il si vous souhaitez am\xe9liorer la fonctionnalit\xe9 de base de l'adaptateur ? Par exemple, vos exigences techniques requi\xe8rent une capacit\xe9 \xe0 diffuser des \xe9v\xe9nements \xe0 travers de multiples instances de votre service web. Pour cela, vous pouvez \xe9tendre "),e.j41(54,"code"),e.EFF(55,"IoAdapter"),e.k0s(),e.EFF(56," et surcharger une m\xe9thode unique dont la responsabilit\xe9 est d'instancier de nouveaux serveurs socket.io. Mais tout d'abord, installons le package n\xe9cessaire."),e.k0s(),e.j41(57,"blockquote",10)(58,"strong"),e.EFF(59,"Attention"),e.k0s(),e.EFF(60," Pour utiliser socket.io avec plusieurs instances \xe0 load-balanc\xe9es, vous devez soit d\xe9sactiver le polling en r\xe9glant "),e.j41(61,"code"),e.EFF(62,"transports : ['websocket']"),e.k0s(),e.EFF(63," dans la configuration de socket.io de vos clients ou vous devez activer le routage bas\xe9 sur les cookies dans votre \xe9quilibreur de charge. Redis seul n'est pas suffisant. Voir "),e.j41(64,"a",11),e.EFF(65,"ici"),e.k0s(),e.EFF(66," pour plus d'informations.\n"),e.k0s(),e.j41(67,"pre")(68,"code",12),e.EFF(69,"\n$ npm i --save redis socket.io @socket.io/redis-adapter\n"),e.k0s()(),e.j41(70,"p"),e.EFF(71,"Une fois le package install\xe9, nous pouvons cr\xe9er une classe "),e.j41(72,"code"),e.EFF(73,"RedisIoAdapter"),e.k0s(),e.EFF(74,"."),e.k0s(),e.j41(75,"app-copy-button")(76,"pre")(77,"code",13),e.EFF(78,"\nimport { IoAdapter } from '@nestjs/platform-socket.io';\nimport { ServerOptions } from 'socket.io';\nimport { createAdapter } from '@socket.io/redis-adapter';\nimport { createClient } from 'redis';\n\nexport class RedisIoAdapter extends IoAdapter {\n  private adapterConstructor: ReturnType<typeof createAdapter>;\n\n  async connectToRedis(): Promise<void> {\n    const pubClient = createClient({ url: `redis://localhost:6379` });\n    const subClient = pubClient.duplicate();\n\n    await Promise.all([pubClient.connect(), subClient.connect()]);\n\n    this.adapterConstructor = createAdapter(pubClient, subClient);\n  }\n\n  createIOServer(port: number, options?: ServerOptions): any {\n    const server = super.createIOServer(port, options);\n    server.adapter(this.adapterConstructor);\n    return server;\n  }\n}\n"),e.k0s()()(),e.j41(79,"p"),e.EFF(80,"Ensuite, il suffit de basculer vers l'adaptateur Redis nouvellement cr\xe9\xe9."),e.k0s(),e.j41(81,"app-copy-button")(82,"pre")(83,"code",13),e.EFF(84,"\nconst app = await NestFactory.create(AppModule);\nconst redisIoAdapter = new RedisIoAdapter(app);\nawait redisIoAdapter.connectToRedis();\n\napp.useWebSocketAdapter(redisIoAdapter);\n"),e.k0s()()(),e.j41(85,"h4",14)(86,"span"),e.EFF(87,"Biblioth\xe8que Ws"),e.k0s()(),e.j41(88,"p"),e.EFF(89,"Un autre adaptateur disponible est le "),e.j41(90,"code"),e.EFF(91,"WsAdapter"),e.k0s(),e.EFF(92," qui agit comme un proxy entre le framework et la biblioth\xe8que "),e.j41(93,"a",15),e.EFF(94,"ws"),e.k0s(),e.EFF(95,", rapide et soigneusement test\xe9e. Cet adaptateur est enti\xe8rement compatible avec les WebSockets natifs des navigateurs et est bien plus rapide que le package socket.io. Malheureusement, il a beaucoup moins de fonctionnalit\xe9s disponibles par d\xe9faut. Dans certains cas, vous n'en avez pas n\xe9cessairement besoin."),e.k0s(),e.j41(96,"blockquote",16)(97,"strong"),e.EFF(98,"Astuce"),e.k0s(),e.EFF(99," La biblioth\xe8que "),e.j41(100,"code"),e.EFF(101,"ws"),e.k0s(),e.EFF(102," ne supporte pas les espaces de noms (canaux de communication popularis\xe9s par "),e.j41(103,"code"),e.EFF(104,"socket.io"),e.k0s(),e.EFF(105,"). Cependant, pour imiter cette fonctionnalit\xe9, vous pouvez monter plusieurs serveurs "),e.j41(106,"code"),e.EFF(107,"ws"),e.k0s(),e.EFF(108," sur des chemins diff\xe9rents (exemple : "),e.j41(109,"code"),e.EFF(110),e.k0s(),e.EFF(111,").\n"),e.k0s(),e.j41(112,"p"),e.EFF(113,"Afin d'utiliser "),e.j41(114,"code"),e.EFF(115,"ws"),e.k0s(),e.EFF(116,", nous devons tout d'abord installer le package requis :"),e.k0s(),e.j41(117,"pre")(118,"code",12),e.EFF(119,"\n$ npm i --save @nestjs/platform-ws\n"),e.k0s()(),e.j41(120,"p"),e.EFF(121,"Une fois le package install\xe9, nous pouvons changer d'adaptateur :"),e.k0s(),e.j41(122,"app-copy-button")(123,"pre")(124,"code",13),e.EFF(125,"\nconst app = await NestFactory.create(AppModule);\napp.useWebSocketAdapter(new WsAdapter(app));\n"),e.k0s()()(),e.j41(126,"blockquote",16)(127,"strong"),e.EFF(128,"Astuce"),e.k0s(),e.EFF(129," Le "),e.j41(130,"code"),e.EFF(131,"WsAdapter"),e.k0s(),e.EFF(132," est import\xe9 de "),e.j41(133,"code"),e.EFF(134,"@nestjs/platform-ws"),e.k0s(),e.EFF(135,".\n"),e.k0s(),e.j41(136,"h4",17)(137,"span"),e.EFF(138,"Avanc\xe9 (adaptateur personnalis\xe9)"),e.k0s()(),e.j41(139,"p"),e.EFF(140,"Pour la d\xe9monstration, nous allons int\xe9grer manuellement la biblioth\xe8que "),e.j41(141,"a",15),e.EFF(142,"ws"),e.k0s(),e.EFF(143,". Comme mentionn\xe9, l'adaptateur pour cette biblioth\xe8que est d\xe9j\xe0 cr\xe9\xe9 et est expos\xe9 depuis le package "),e.j41(144,"code"),e.EFF(145,"@nestjs/platform-ws"),e.k0s(),e.EFF(146," en tant que classe "),e.j41(147,"code"),e.EFF(148,"WsAdapter"),e.k0s(),e.EFF(149,". Voici \xe0 quoi pourrait ressembler l'impl\xe9mentation simplifi\xe9e :"),e.k0s(),e.j41(150,"app-copy-button",18)(151,"span",19),e.EFF(152),e.nI1(153,"extension"),e.nrm(154,"app-tabs",null,1),e.k0s(),e.j41(156,"pre")(157,"code",13),e.EFF(158,"\nimport * as WebSocket from 'ws';\nimport { WebSocketAdapter, INestApplicationContext } from '@nestjs/common';\nimport { MessageMappingProperties } from '@nestjs/websockets';\nimport { Observable, fromEvent, EMPTY } from 'rxjs';\nimport { mergeMap, filter } from 'rxjs/operators';\n\nexport class WsAdapter implements WebSocketAdapter {\n  constructor(private app: INestApplicationContext) {}\n\n  create(port: number, options: any = {}): any {\n    return new WebSocket.Server({ port, ...options });\n  }\n\n  bindClientConnect(server, callback: Function) {\n    server.on('connection', callback);\n  }\n\n  bindMessageHandlers(\n    client: WebSocket,\n    handlers: MessageMappingProperties[],\n    process: (data: any) => Observable<any>,\n  ) {\n    fromEvent(client, 'message')\n      .pipe(\n        mergeMap(data => this.bindMessageHandler(data, handlers, process)),\n        filter(result => result),\n      )\n      .subscribe(response => client.send(JSON.stringify(response)));\n  }\n\n  bindMessageHandler(\n    buffer,\n    handlers: MessageMappingProperties[],\n    process: (data: any) => Observable<any>,\n  ): Observable<any> {\n    const message = JSON.parse(buffer.data);\n    const messageHandler = handlers.find(\n      handler => handler.message === message.event,\n    );\n    if (!messageHandler) {\n      return EMPTY;\n    }\n    return process(messageHandler.callback(message.data));\n  }\n\n  close(server) {\n    server.close();\n  }\n}\n"),e.k0s()()(),e.j41(159,"blockquote",16)(160,"strong"),e.EFF(161,"Astuce"),e.k0s(),e.EFF(162," Si vous voulez profiter de la biblioth\xe8que "),e.j41(163,"a",15),e.EFF(164,"ws"),e.k0s(),e.EFF(165,", utilisez l'adaptateur int\xe9gr\xe9 "),e.j41(166,"code"),e.EFF(167,"WsAdapter"),e.k0s(),e.EFF(168," au lieu de cr\xe9er votre propre adaptateur.\n"),e.k0s(),e.j41(169,"p"),e.EFF(170,"Ensuite, nous pouvons mettre en place un adaptateur personnalis\xe9 en utilisant la m\xe9thode "),e.j41(171,"code"),e.EFF(172,"useWebSocketAdapter()"),e.k0s(),e.EFF(173," :"),e.k0s(),e.j41(174,"app-copy-button",18)(175,"span",19),e.EFF(176),e.nI1(177,"extension"),e.nrm(178,"app-tabs",null,2),e.k0s(),e.j41(180,"pre")(181,"code",13),e.EFF(182,"\nconst app = await NestFactory.create(AppModule);\napp.useWebSocketAdapter(new WsAdapter(app));\n"),e.k0s()()(),e.j41(183,"h4",20)(184,"span"),e.EFF(185,"Exemple"),e.k0s()(),e.j41(186,"p"),e.EFF(187,"Un exemple de travail utilisant "),e.j41(188,"code"),e.EFF(189,"WsAdapter"),e.k0s(),e.EFF(190," est disponible "),e.j41(191,"a",21),e.EFF(192,"ici"),e.k0s(),e.EFF(193,"."),e.k0s()()),2&t){const o=e.sdS(155),d=e.sdS(179);e.R7$(110),e.Lme("@WebSocketGateway(","{"," path : '/users' ","}",")"),e.R7$(42),e.SpI(" ",e.i5U(153,4,"ws-adapter",o.isJsActive),"\n"),e.R7$(24),e.SpI(" ",e.i5U(177,7,"main",d.isJsActive),"\n")}},dependencies:[c.O,p.a,u.z,f.M],encapsulation:2,changeDetection:0})}return s})(),y=(()=>{class s extends i.y{static \u0275fac=(()=>{let n;return function(a){return(n||(n=e.xGo(s)))(a||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-exception-filters"]],features:[e.Vt3],decls:84,vars:4,consts:[["contentReference",""],["app6530e9ccfe844955aa86887ec9e3e5fc3b2fa098",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/websockets/exception-filters.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","filtres-dexception"],["href","/exception-filters"],[1,"language-typescript"],[1,"info"],["appAnchor","","id","filtres"],["appAnchor","","id","h\xe9ritage"],[1,"with-heading"],[1,"filename"]],template:function(t,a){if(1&t&&(e.j41(0,"div",2,0)(2,"div",3)(3,"a",4),e.nrm(4,"i",5),e.k0s()(),e.j41(5,"h3",6),e.EFF(6,"Filtres d'exception"),e.k0s(),e.j41(7,"p"),e.EFF(8,"La seule diff\xe9rence entre la couche HTTP de "),e.j41(9,"a",7),e.EFF(10,"filtre d'exception"),e.k0s(),e.EFF(11," et la couche web sockets correspondante est qu'au lieu de lancer "),e.j41(12,"code"),e.EFF(13,"HttpException"),e.k0s(),e.EFF(14,", vous devez utiliser "),e.j41(15,"code"),e.EFF(16,"WsException"),e.k0s(),e.EFF(17,"."),e.k0s(),e.j41(18,"app-copy-button")(19,"pre")(20,"code",8),e.EFF(21,"\nthrow new WsException('Invalid credentials.');\n"),e.k0s()()(),e.j41(22,"blockquote",9)(23,"strong"),e.EFF(24,"Astuce"),e.k0s(),e.EFF(25," La classe "),e.j41(26,"code"),e.EFF(27,"WsException"),e.k0s(),e.EFF(28," est import\xe9e du package "),e.j41(29,"code"),e.EFF(30,"@nestjs/websockets"),e.k0s(),e.EFF(31,".\n"),e.k0s(),e.j41(32,"p"),e.EFF(33,"Avec l'exemple ci-dessus, Nest va g\xe9rer l'exception lanc\xe9e et \xe9mettre le message "),e.j41(34,"code"),e.EFF(35,"exception"),e.k0s(),e.EFF(36," avec la structure suivante :"),e.k0s(),e.j41(37,"app-copy-button")(38,"pre")(39,"code",8),e.EFF(40,"\n{\n  status: 'error',\n  message: 'Invalid credentials.'\n}\n"),e.k0s()()(),e.j41(41,"h4",10)(42,"span"),e.EFF(43,"Filtres"),e.k0s()(),e.j41(44,"p"),e.EFF(45,"Les filtres d'exception des sockets web se comportent de mani\xe8re \xe9quivalente aux filtres d'exception HTTP. L'exemple suivant utilise un filtre \xe0 port\xe9e de m\xe9thode instanci\xe9 manuellement. Tout comme pour les applications bas\xe9es sur HTTP, vous pouvez \xe9galement utiliser des filtres \xe0 l'\xe9chelle de la gateway (c'est-\xe0-dire pr\xe9fixer la classe de la gateway avec un d\xe9corateur "),e.j41(46,"code"),e.EFF(47,"@UseFilters()"),e.k0s(),e.EFF(48,")."),e.k0s(),e.j41(49,"app-copy-button")(50,"pre")(51,"code",8),e.EFF(52,"\n@UseFilters(new WsExceptionFilter())\n@SubscribeMessage('events')\nonEvent(client, data: any): WsResponse<any> {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()()(),e.j41(53,"h4",11)(54,"span"),e.EFF(55,"H\xe9ritage"),e.k0s()(),e.j41(56,"p"),e.EFF(57,"G\xe9n\xe9ralement, vous cr\xe9ez des filtres d'exception enti\xe8rement personnalis\xe9s, con\xe7us pour r\xe9pondre aux exigences de votre application. Cependant, il peut y avoir des cas d'utilisation o\xf9 vous souhaiteriez simplement \xe9tendre le "),e.j41(58,"strong"),e.EFF(59,"filtre d'exception de base"),e.k0s(),e.EFF(60,", et modifier son comportement en fonction de certains facteurs."),e.k0s(),e.j41(61,"p"),e.EFF(62,"Pour d\xe9l\xe9guer le traitement des exceptions au filtre de base, vous devez \xe9tendre "),e.j41(63,"code"),e.EFF(64,"BaseWsExceptionFilter"),e.k0s(),e.EFF(65," et appeler la m\xe9thode "),e.j41(66,"code"),e.EFF(67,"catch()"),e.k0s(),e.EFF(68," h\xe9rit\xe9e."),e.k0s(),e.j41(69,"app-copy-button",12)(70,"span",13),e.nrm(71,"app-tabs",null,1),e.k0s(),e.j41(73,"pre")(74,"code",8),e.EFF(75,"\nimport { Catch, ArgumentsHost } from '@nestjs/common';\nimport { BaseWsExceptionFilter } from '@nestjs/websockets';\n\n@Catch()\nexport class AllExceptionsFilter extends BaseWsExceptionFilter {\n  catch(exception: unknown, host: ArgumentsHost) {\n    super.catch(exception, host);\n  }\n}\n"),e.k0s()(),e.j41(76,"pre")(77,"code",8),e.EFF(78,"\nimport { Catch } from '@nestjs/common';\nimport { BaseWsExceptionFilter } from '@nestjs/websockets';\n\n@Catch()\nexport class AllExceptionsFilter extends BaseWsExceptionFilter {\n  catch(exception, host) {\n    super.catch(exception, host);\n  }\n}\n"),e.k0s()()(),e.j41(79,"p"),e.EFF(80,"L'impl\xe9mentation ci-dessus n'est qu'une coquille d\xe9montrant l'approche. Votre impl\xe9mentation du filtre d'exception \xe9tendu inclurait votre "),e.j41(81,"strong"),e.EFF(82,"logique m\xe9tier"),e.k0s(),e.EFF(83," personnalis\xe9e (par exemple, le traitement de diverses conditions)."),e.k0s()()),2&t){const o=e.sdS(72);e.R7$(73),e.AVh("hide",o.isJsActive),e.R7$(3),e.AVh("hide",!o.isJsActive)}},dependencies:[c.O,p.a,u.z],encapsulation:2,changeDetection:0})}return s})();var A=r(8149);const w=[{path:"gateways",component:(()=>{class s extends i.y{static \u0275fac=(()=>{let n;return function(a){return(n||(n=e.xGo(s)))(a||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-gateways"]],features:[e.Vt3],decls:395,vars:56,consts:[["contentReference",""],["appa4213c4ad459fa847ed86d2af02bb1f38f682410",""],["appd0ace979e7529a95313ea3a9da5e72517ce0b7d7",""],["app84de12e3abe14eee977b81161ae7c6527963f414",""],["app630fcb681e0dd23956f3fc57fd9f19012386580e",""],["appdc3535a3f14c601a3ab0cff4c1a3c197ef3a5a65",""],["app887bf07af025d22d02a9a665d5179f27974af267",""],["appa38fe69b848838d2b8848fbd9ef6997b6b3a66cc",""],["appcb83cf6260fab4f67654965274dd2baaa9f6321b",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/websockets/gateways.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","gateways"],["rel","nofollow","target","_blank","href","https://github.com/socketio/socket.io"],["rel","nofollow","target","_blank","href","https://github.com/websockets/ws"],["routerLink","/websockets/adapter"],["src","/assets/Gateways_1.png",1,"illustrative-image"],[1,"info"],["routerLink","/providers"],["appAnchor","","id","installation"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"],["appAnchor","","id","vue-densemble"],["rel","nofollow","target","_blank","href","https://socket.io/docs/v4/namespaces/"],[1,"warning"],["rel","nofollow","target","_blank","href","https://socket.io/docs/v4/server-options/"],["rel","nofollow","target","_blank","href","https://socket.io/docs/v4/server-api/#socket"],["appAnchor","","id","r\xe9ponses-multiples"],["appAnchor","","id","r\xe9ponses-asynchrones"],["appAnchor","","id","hooks-du-cycle-de-vie"],["appAnchor","","id","serveur-et-namespace"],["appAnchor","","id","exemple"],["rel","nofollow","target","_blank","href","https://github.com/nestjs/nest/tree/master/sample/02-gateways"]],template:function(t,a){if(1&t&&(e.j41(0,"div",9,0)(2,"div",10)(3,"a",11),e.nrm(4,"i",12),e.k0s()(),e.j41(5,"h3",13),e.EFF(6,"Gateways"),e.k0s(),e.j41(7,"p"),e.EFF(8,"La plupart des concepts abord\xe9s ailleurs dans cette documentation, tels que l'injection de d\xe9pendance, les d\xe9corateurs, les filtres d'exception, les pipes, les gardes et les intercepteurs, s'appliquent \xe9galement aux gateways. Dans la mesure du possible, Nest fait abstraction des d\xe9tails de mise en \u0153uvre afin que les m\xeames composants puissent fonctionner sur des plates-formes HTTP, WebSockets et Microservices. Cette section couvre les aspects de Nest qui sont sp\xe9cifiques aux WebSockets."),e.k0s(),e.j41(9,"p"),e.EFF(10,"Dans Nest, une gateway est simplement une classe annot\xe9e avec le d\xe9corateur "),e.j41(11,"code"),e.EFF(12,"@WebSocketGateway()"),e.k0s(),e.EFF(13,". Techniquement, les gateways sont agnostiques en termes de plateforme, ce qui les rend compatibles avec n'importe quelle biblioth\xe8que WebSockets une fois qu'un adaptateur est cr\xe9\xe9. Deux plates-formes WS sont prises en charge d\xe8s le d\xe9part : "),e.j41(14,"a",14),e.EFF(15,"socket.io"),e.k0s(),e.EFF(16," et "),e.j41(17,"a",15),e.EFF(18,"ws"),e.k0s(),e.EFF(19,". Vous pouvez choisir celle qui correspond le mieux \xe0 vos besoins. Vous pouvez \xe9galement cr\xe9er votre propre adaptateur en suivant ce "),e.j41(20,"a",16),e.EFF(21,"guide"),e.k0s(),e.EFF(22,"."),e.k0s(),e.j41(23,"figure"),e.nrm(24,"img",17),e.k0s(),e.j41(25,"blockquote",18)(26,"strong"),e.EFF(27,"Astuce"),e.k0s(),e.EFF(28," Les gateways peuvent \xeatre trait\xe9es comme des "),e.j41(29,"a",19),e.EFF(30,"providers"),e.k0s(),e.EFF(31," ; cela signifie qu'elles peuvent injecter des d\xe9pendances via le constructeur de la classe. Les passerelles peuvent \xe9galement \xeatre inject\xe9es par d'autres classes (fournisseurs et contr\xf4leurs).\n"),e.k0s(),e.j41(32,"h4",20)(33,"span"),e.EFF(34,"Installation"),e.k0s()(),e.j41(35,"p"),e.EFF(36,"Pour commencer \xe0 cr\xe9er des applications bas\xe9es sur les WebSockets, il faut d'abord installer le package requis :"),e.k0s(),e.j41(37,"app-copy-button",21)(38,"span",22),e.nrm(39,"app-tabs",null,1),e.k0s(),e.j41(41,"pre")(42,"code",23),e.EFF(43,"\n$ npm i --save @nestjs/websockets @nestjs/platform-socket.io\n"),e.k0s()(),e.j41(44,"pre")(45,"code",23),e.EFF(46,"\n$ npm i --save @nestjs/websockets @nestjs/platform-socket.io\n"),e.k0s()()(),e.j41(47,"h4",24)(48,"span"),e.EFF(49,"Vue d'ensemble"),e.k0s()(),e.j41(50,"p"),e.EFF(51,"En g\xe9n\xe9ral, chaque gateway \xe9coute sur le m\xeame port que le "),e.j41(52,"strong"),e.EFF(53,"serveur HTTP"),e.k0s(),e.EFF(54,", \xe0 moins que votre application ne soit pas une application web, ou que vous ayez chang\xe9 le port manuellement. Ce comportement par d\xe9faut peut \xeatre modifi\xe9 en passant un argument au d\xe9corateur "),e.j41(55,"code"),e.EFF(56,"@WebSocketGateway(80)"),e.k0s(),e.EFF(57," o\xf9 "),e.j41(58,"code"),e.EFF(59,"80"),e.k0s(),e.EFF(60," est un num\xe9ro de port choisi. Vous pouvez \xe9galement d\xe9finir un "),e.j41(61,"a",25),e.EFF(62,"namespace"),e.k0s(),e.EFF(63," utilis\xe9 par la gateway en utilisant la construction suivante :"),e.k0s(),e.j41(64,"app-copy-button")(65,"pre")(66,"code",23),e.EFF(67,"\n@WebSocketGateway(80, { namespace: 'events' })\n"),e.k0s()()(),e.j41(68,"blockquote",26)(69,"strong"),e.EFF(70,"Attention"),e.k0s(),e.EFF(71," Les gateways ne sont pas instanci\xe9es tant qu'elles ne sont pas r\xe9f\xe9renc\xe9es dans le tableau des fournisseurs d'un module existant.\n"),e.k0s(),e.j41(72,"p"),e.EFF(73,"Vous pouvez passer n'importe quelle "),e.j41(74,"a",27),e.EFF(75,"option"),e.k0s(),e.EFF(76," support\xe9e au constructeur de la socket avec le second argument du d\xe9corateur "),e.j41(77,"code"),e.EFF(78,"@WebSocketGateway()"),e.k0s(),e.EFF(79,", comme montr\xe9 ci-dessous :"),e.k0s(),e.j41(80,"app-copy-button")(81,"pre")(82,"code",23),e.EFF(83,"\n@WebSocketGateway(81, { transports: ['websocket'] })\n"),e.k0s()()(),e.j41(84,"p"),e.EFF(85,"La gateway est maintenant \xe0 l'\xe9coute, mais nous n'avons pas encore souscrit aux messages entrants. Cr\xe9ons un handler qui s'abonnera aux messages "),e.j41(86,"code"),e.EFF(87,"events"),e.k0s(),e.EFF(88," et r\xe9pondra \xe0 l'utilisateur avec exactement les m\xeames donn\xe9es."),e.k0s(),e.j41(89,"app-copy-button",21)(90,"span",22),e.EFF(91),e.nI1(92,"extension"),e.nrm(93,"app-tabs",null,2),e.k0s(),e.j41(95,"pre")(96,"code",23),e.EFF(97,"\n@SubscribeMessage('events')\nhandleEvent(@MessageBody() data: string): string {\n  return data;\n}\n"),e.k0s()(),e.j41(98,"pre")(99,"code",23),e.EFF(100,"\n@Bind(MessageBody())\n@SubscribeMessage('events')\nhandleEvent(data) {\n  return data;\n}\n"),e.k0s()()(),e.j41(101,"blockquote",18)(102,"strong"),e.EFF(103,"Astuce"),e.k0s(),e.EFF(104," Les d\xe9corateurs "),e.j41(105,"code"),e.EFF(106,"@SubscribeMessage()"),e.k0s(),e.EFF(107," et "),e.j41(108,"code"),e.EFF(109,"@MessageBody()"),e.k0s(),e.EFF(110," sont import\xe9s du package "),e.j41(111,"code"),e.EFF(112,"@nestjs/websockets"),e.k0s(),e.EFF(113,".\n"),e.k0s(),e.j41(114,"p"),e.EFF(115,"Une fois la gateway cr\xe9\xe9e, nous pouvons l'enregistrer dans notre module."),e.k0s(),e.j41(116,"app-copy-button",21)(117,"span",22),e.EFF(118),e.nI1(119,"extension"),e.nrm(120,"app-tabs",null,3),e.k0s(),e.j41(122,"pre")(123,"code",23),e.EFF(124,"\n@Module({\n  providers: [EventsGateway]\n})\nexport class EventsModule {}\n"),e.k0s()()(),e.j41(125,"p"),e.EFF(126,"Vous pouvez \xe9galement transmettre une cl\xe9 de propri\xe9t\xe9 au d\xe9corateur pour qu'il l'extraie du corps du message entrant :"),e.k0s(),e.j41(127,"app-copy-button",21)(128,"span",22),e.EFF(129),e.nI1(130,"extension"),e.nrm(131,"app-tabs",null,4),e.k0s(),e.j41(133,"pre")(134,"code",23),e.EFF(135,"\n@SubscribeMessage('events')\nhandleEvent(@MessageBody('id') id: number): number {\n  // id === messageBody.id\n  return id;\n}\n"),e.k0s()(),e.j41(136,"pre")(137,"code",23),e.EFF(138,"\n@Bind(MessageBody('id'))\n@SubscribeMessage('events')\nhandleEvent(id) {\n  // id === messageBody.id\n  return id;\n}\n"),e.k0s()()(),e.j41(139,"p"),e.EFF(140,"Si vous pr\xe9f\xe9rez ne pas utiliser de d\xe9corateurs, le code suivant est fonctionnellement \xe9quivalent :"),e.k0s(),e.j41(141,"app-copy-button",21)(142,"span",22),e.EFF(143),e.nI1(144,"extension"),e.nrm(145,"app-tabs",null,5),e.k0s(),e.j41(147,"pre")(148,"code",23),e.EFF(149,"\n@SubscribeMessage('events')\nhandleEvent(client: Socket, data: string): string {\n  return data;\n}\n"),e.k0s()(),e.j41(150,"pre")(151,"code",23),e.EFF(152,"\n@SubscribeMessage('events')\nhandleEvent(client, data) {\n  return data;\n}\n"),e.k0s()()(),e.j41(153,"p"),e.EFF(154,"Dans l'exemple ci-dessus, la fonction "),e.j41(155,"code"),e.EFF(156,"handleEvent()"),e.k0s(),e.EFF(157," prend deux arguments. Le premier est une "),e.j41(158,"a",28),e.EFF(159,"instance de socket"),e.k0s(),e.EFF(160," sp\xe9cifique \xe0 la plate-forme, tandis que le second est la donn\xe9e re\xe7ue du client. Cette approche n'est cependant pas recommand\xe9e, car elle n\xe9cessite de simuler l'instance "),e.j41(161,"code"),e.EFF(162,"socket"),e.k0s(),e.EFF(163," dans chaque test unitaire."),e.k0s(),e.j41(164,"p"),e.EFF(165,"Une fois le message "),e.j41(166,"code"),e.EFF(167,"events"),e.k0s(),e.EFF(168," re\xe7u, le gestionnaire envoie un accus\xe9 de r\xe9ception avec les m\xeames donn\xe9es que celles envoy\xe9es sur le r\xe9seau. De plus, il est possible d'\xe9mettre des messages en utilisant une approche sp\xe9cifique \xe0 la biblioth\xe8que, par exemple en utilisant la m\xe9thode "),e.j41(169,"code"),e.EFF(170,"client.emit()"),e.k0s(),e.EFF(171,". Pour acc\xe9der \xe0 une instance de socket connect\xe9e, utilisez le d\xe9corateur "),e.j41(172,"code"),e.EFF(173,"@ConnectedSocket()"),e.k0s(),e.EFF(174,"."),e.k0s(),e.j41(175,"app-copy-button",21)(176,"span",22),e.EFF(177),e.nI1(178,"extension"),e.nrm(179,"app-tabs",null,6),e.k0s(),e.j41(181,"pre")(182,"code",23),e.EFF(183,"\n@SubscribeMessage('events')\nhandleEvent(\n  @MessageBody() data: string,\n  @ConnectedSocket() client: Socket,\n): string {\n  return data;\n}\n"),e.k0s()(),e.j41(184,"pre")(185,"code",23),e.EFF(186,"\n@Bind(MessageBody(), ConnectedSocket())\n@SubscribeMessage('events')\nhandleEvent(data, client) {\n  return data;\n}\n"),e.k0s()()(),e.j41(187,"blockquote",18)(188,"strong"),e.EFF(189,"Astuce"),e.k0s(),e.EFF(190," Le d\xe9corateur "),e.j41(191,"code"),e.EFF(192,"@ConnectedSocket()"),e.k0s(),e.EFF(193," est import\xe9 du package "),e.j41(194,"code"),e.EFF(195,"@nestjs/websockets"),e.k0s(),e.EFF(196,".\n"),e.k0s(),e.j41(197,"p"),e.EFF(198,"Cependant, dans ce cas, vous ne pourrez pas utiliser les intercepteurs. Si vous ne voulez pas r\xe9pondre \xe0 l'utilisateur, vous pouvez simplement sauter l'instruction "),e.j41(199,"code"),e.EFF(200,"return"),e.k0s(),e.EFF(201,' (ou retourner explicitement une valeur "falsy", par exemple '),e.j41(202,"code"),e.EFF(203,"undefined"),e.k0s(),e.EFF(204,")."),e.k0s(),e.j41(205,"p"),e.EFF(206,"Maintenant, lorsqu'un client \xe9met le message suivant :"),e.k0s(),e.j41(207,"app-copy-button")(208,"pre")(209,"code",23),e.EFF(210,"\nsocket.emit('events', { name: 'Nest' });\n"),e.k0s()()(),e.j41(211,"p"),e.EFF(212,"La m\xe9thode "),e.j41(213,"code"),e.EFF(214,"handleEvent()"),e.k0s(),e.EFF(215," sera ex\xe9cut\xe9e. Afin d'\xe9couter les messages \xe9mis par le gestionnaire ci-dessus, le client doit attacher un r\xe9cepteur d'accus\xe9 de r\xe9ception correspondant :"),e.k0s(),e.j41(216,"app-copy-button")(217,"pre")(218,"code",23),e.EFF(219,"\nsocket.emit('events', { name: 'Nest' }, (data) => console.log(data));\n"),e.k0s()()(),e.j41(220,"h4",29)(221,"span"),e.EFF(222,"R\xe9ponses multiples"),e.k0s()(),e.j41(223,"p"),e.EFF(224,"L'accus\xe9 de r\xe9ception n'est envoy\xe9 qu'une seule fois. En outre, il n'est pas pris en charge par les impl\xe9mentations natives des WebSockets. Pour r\xe9soudre cette limitation, vous pouvez retourner un objet qui consiste en deux propri\xe9t\xe9s : "),e.j41(225,"code"),e.EFF(226,"event"),e.k0s(),e.EFF(227," qui est le nom de l'\xe9v\xe9nement \xe9mis et "),e.j41(228,"code"),e.EFF(229,"data"),e.k0s(),e.EFF(230," qui doit \xeatre transmis au client."),e.k0s(),e.j41(231,"app-copy-button",21)(232,"span",22),e.EFF(233),e.nI1(234,"extension"),e.nrm(235,"app-tabs",null,7),e.k0s(),e.j41(237,"pre")(238,"code",23),e.EFF(239,"\n@SubscribeMessage('events')\nhandleEvent(@MessageBody() data: unknown): WsResponse<unknown> {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()(),e.j41(240,"pre")(241,"code",23),e.EFF(242,"\n@Bind(MessageBody())\n@SubscribeMessage('events')\nhandleEvent(data) {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()()(),e.j41(243,"blockquote",18)(244,"strong"),e.EFF(245,"Astuce"),e.k0s(),e.EFF(246," L'interface "),e.j41(247,"code"),e.EFF(248,"WsResponse"),e.k0s(),e.EFF(249," est import\xe9e du package "),e.j41(250,"code"),e.EFF(251,"@nestjs/websockets"),e.k0s(),e.EFF(252,".\n"),e.k0s(),e.j41(253,"blockquote",26)(254,"strong"),e.EFF(255,"Attention"),e.k0s(),e.EFF(256," Vous devez retourner une instance de classe qui impl\xe9mente "),e.j41(257,"code"),e.EFF(258,"WsResponse"),e.k0s(),e.EFF(259," si votre champ "),e.j41(260,"code"),e.EFF(261,"data"),e.k0s(),e.EFF(262," repose sur "),e.j41(263,"code"),e.EFF(264,"ClassSerializerInterceptor"),e.k0s(),e.EFF(265,", car il ignore les r\xe9ponses d'objets JavaScript simples.\n"),e.k0s(),e.j41(266,"p"),e.EFF(267,"Afin d'\xe9couter la ou les r\xe9ponses entrantes, le client doit appliquer un autre \xe9couteur d'\xe9v\xe9nements."),e.k0s(),e.j41(268,"app-copy-button")(269,"pre")(270,"code",23),e.EFF(271,"\nsocket.on('events', (data) => console.log(data));\n"),e.k0s()()(),e.j41(272,"h4",30)(273,"span"),e.EFF(274,"R\xe9ponses asynchrones"),e.k0s()(),e.j41(275,"p"),e.EFF(276,"Les gestionnaires de messages peuvent r\xe9pondre de mani\xe8re synchrone ou "),e.j41(277,"strong"),e.EFF(278,"asynchrone"),e.k0s(),e.EFF(279,". Les m\xe9thodes "),e.j41(280,"code"),e.EFF(281,"asynchrones"),e.k0s(),e.EFF(282," sont donc support\xe9es. Un gestionnaire de message peut \xe9galement retourner un "),e.j41(283,"code"),e.EFF(284,"Observable"),e.k0s(),e.EFF(285,", auquel cas les valeurs de r\xe9sultat seront \xe9mises jusqu'\xe0 ce que le flux soit termin\xe9."),e.k0s(),e.j41(286,"app-copy-button",21)(287,"span",22),e.EFF(288),e.nI1(289,"extension"),e.nrm(290,"app-tabs",null,8),e.k0s(),e.j41(292,"pre")(293,"code",23),e.EFF(294,"\n@SubscribeMessage('events')\nonEvent(@MessageBody() data: unknown): Observable<WsResponse<number>> {\n  const event = 'events';\n  const response = [1, 2, 3];\n\n  return from(response).pipe(\n    map(data => ({ event, data })),\n  );\n}\n"),e.k0s()(),e.j41(295,"pre")(296,"code",23),e.EFF(297,"\n@Bind(MessageBody())\n@SubscribeMessage('events')\nonEvent(data) {\n  const event = 'events';\n  const response = [1, 2, 3];\n\n  return from(response).pipe(\n    map(data => ({ event, data })),\n  );\n}\n"),e.k0s()()(),e.j41(298,"p"),e.EFF(299,"Dans l'exemple ci-dessus, le gestionnaire de message r\xe9pondra "),e.j41(300,"strong"),e.EFF(301,"3 fois"),e.k0s(),e.EFF(302," (avec chaque \xe9l\xe9ment du tableau)."),e.k0s(),e.j41(303,"h4",31)(304,"span"),e.EFF(305,"Hooks du cycle de vie"),e.k0s()(),e.j41(306,"p"),e.EFF(307,"Il existe trois hooks utiles pour le cycle de vie. Ils ont tous des interfaces correspondantes et sont d\xe9crits dans le tableau suivant :"),e.k0s(),e.j41(308,"table")(309,"tr")(310,"td")(311,"code"),e.EFF(312,"OnGatewayInit"),e.k0s()(),e.j41(313,"td"),e.EFF(314," Oblige \xe0 mettre en \u0153uvre la m\xe9thode "),e.j41(315,"code"),e.EFF(316,"afterInit()"),e.k0s(),e.EFF(317,". Prend en argument l'instance de serveur sp\xe9cifique \xe0 la biblioth\xe8que (et \xe9tend le reste si n\xe9cessaire). "),e.k0s()(),e.j41(318,"tr")(319,"td")(320,"code"),e.EFF(321,"OnGatewayConnection"),e.k0s()(),e.j41(322,"td"),e.EFF(323," Oblige \xe0 mettre en \u0153uvre la m\xe9thode "),e.j41(324,"code"),e.EFF(325,"handleConnection()"),e.k0s(),e.EFF(326,". Prend l'instance de socket client sp\xe9cifique \xe0 la biblioth\xe8que comme argument. "),e.k0s()(),e.j41(327,"tr")(328,"td")(329,"code"),e.EFF(330,"OnGatewayDisconnect"),e.k0s()(),e.j41(331,"td"),e.EFF(332," Oblige \xe0 mettre en \u0153uvre la m\xe9thode "),e.j41(333,"code"),e.EFF(334,"handleDisconnect()"),e.k0s(),e.EFF(335,". Prend l'instance de socket client sp\xe9cifique \xe0 la biblioth\xe8que comme argument. "),e.k0s()()(),e.j41(336,"blockquote",18)(337,"strong"),e.EFF(338,"Astuce"),e.k0s(),e.EFF(339," Chaque interface de cycle de vie est expos\xe9e dans le package "),e.j41(340,"code"),e.EFF(341,"@nestjs/websockets"),e.k0s(),e.EFF(342,".\n"),e.k0s(),e.j41(343,"h4",32)(344,"span"),e.EFF(345,"Serveur et Namespace"),e.k0s()(),e.j41(346,"p"),e.EFF(347,"Occasionnellement, vous pouvez vouloir avoir un acc\xe8s direct \xe0 l'instance du serveur natif, "),e.j41(348,"strong"),e.EFF(349,"sp\xe9cifique \xe0 la plateforme"),e.k0s(),e.EFF(350,". La r\xe9f\xe9rence \xe0 cet objet est pass\xe9e comme argument \xe0 la m\xe9thode "),e.j41(351,"code"),e.EFF(352,"afterInit()"),e.k0s(),e.EFF(353," (interface "),e.j41(354,"code"),e.EFF(355,"OnGatewayInit"),e.k0s(),e.EFF(356,"). Une autre option consiste \xe0 utiliser le d\xe9corateur "),e.j41(357,"code"),e.EFF(358,"@WebSocketServer()"),e.k0s(),e.EFF(359,"."),e.k0s(),e.j41(360,"app-copy-button")(361,"pre")(362,"code",23),e.EFF(363,"\n@WebSocketServer()\nserver: Server;\n"),e.k0s()()(),e.j41(364,"p"),e.EFF(365,"Vous pouvez \xe9galement r\xe9cup\xe9rer le namespace correspondant en utilisant l'attribut "),e.j41(366,"code"),e.EFF(367,"namespace"),e.k0s(),e.EFF(368,", comme suit :"),e.k0s(),e.j41(369,"app-copy-button")(370,"pre")(371,"code",23),e.EFF(372,"\n@WebSocketServer({ namespace : 'my-namespace' })\nnamespace : Namespace ;\n"),e.k0s()()(),e.j41(373,"blockquote",26)(374,"strong"),e.EFF(375,"Remarque"),e.k0s(),e.EFF(376," Le d\xe9corateur "),e.j41(377,"code"),e.EFF(378,"@WebSocketServer()"),e.k0s(),e.EFF(379," est import\xe9 du package "),e.j41(380,"code"),e.EFF(381,"@nestjs/websockets"),e.k0s(),e.EFF(382,".\n"),e.k0s(),e.j41(383,"p"),e.EFF(384,"Nest attribuera automatiquement l'instance de serveur \xe0 cette propri\xe9t\xe9 lorsqu'elle sera pr\xeate \xe0 \xeatre utilis\xe9e."),e.k0s(),e.j41(385,"p"),e.nrm(386,"app-banner-enterprise"),e.k0s(),e.j41(387,"h4",33)(388,"span"),e.EFF(389,"Exemple"),e.k0s()(),e.j41(390,"p"),e.EFF(391,"Un exemple concret est disponible "),e.j41(392,"a",34),e.EFF(393,"ici"),e.k0s(),e.EFF(394,"."),e.k0s()()),2&t){const o=e.sdS(40),d=e.sdS(94),S=e.sdS(121),F=e.sdS(132),E=e.sdS(146),m=e.sdS(180),k=e.sdS(236),b=e.sdS(291);e.R7$(41),e.AVh("hide",o.isJsActive),e.R7$(3),e.AVh("hide",!o.isJsActive),e.R7$(47),e.SpI(" ",e.i5U(92,35,"events.gateway",d.isJsActive),"\n"),e.R7$(4),e.AVh("hide",d.isJsActive),e.R7$(3),e.AVh("hide",!d.isJsActive),e.R7$(20),e.SpI(" ",e.i5U(119,38,"events.module",S.isJsActive),"\n"),e.R7$(11),e.SpI(" ",e.i5U(130,41,"events.gateway",F.isJsActive),"\n"),e.R7$(4),e.AVh("hide",F.isJsActive),e.R7$(3),e.AVh("hide",!F.isJsActive),e.R7$(7),e.SpI(" ",e.i5U(144,44,"events.gateway",E.isJsActive),"\n"),e.R7$(4),e.AVh("hide",E.isJsActive),e.R7$(3),e.AVh("hide",!E.isJsActive),e.R7$(27),e.SpI(" ",e.i5U(178,47,"events.gateway",m.isJsActive),"\n"),e.R7$(4),e.AVh("hide",m.isJsActive),e.R7$(3),e.AVh("hide",!m.isJsActive),e.R7$(49),e.SpI(" ",e.i5U(234,50,"events.gateway",k.isJsActive),"\n"),e.R7$(4),e.AVh("hide",k.isJsActive),e.R7$(3),e.AVh("hide",!k.isJsActive),e.R7$(48),e.SpI(" ",e.i5U(289,53,"events.gateway",b.isJsActive),"\n"),e.R7$(4),e.AVh("hide",b.isJsActive),e.R7$(3),e.AVh("hide",!b.isJsActive)}},dependencies:[c.O,p.a,A.d,u.z,l.Wk,f.M],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Gateways"}},{path:"pipes",component:(()=>{class s extends i.y{static \u0275fac=(()=>{let n;return function(a){return(n||(n=e.xGo(s)))(a||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-pipes"]],features:[e.Vt3],decls:52,vars:4,consts:[["contentReference",""],["appa154697596f94f6d8c29d0b7b9816b7752b121f9",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/websockets/pipes.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","pipes"],["routerLink","/pipes"],[1,"info"],["appAnchor","","id","lier-les-pipes"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"]],template:function(t,a){if(1&t&&(e.j41(0,"div",2,0)(2,"div",3)(3,"a",4),e.nrm(4,"i",5),e.k0s()(),e.j41(5,"h3",6),e.EFF(6,"Pipes"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Il n'y a pas de diff\xe9rence fondamentale entre les "),e.j41(9,"a",7),e.EFF(10,"pipes ordinaires"),e.k0s(),e.EFF(11," et les pipes des sockets web. La seule diff\xe9rence est qu'au lieu de lancer "),e.j41(12,"code"),e.EFF(13,"HttpException"),e.k0s(),e.EFF(14,", vous devriez utiliser "),e.j41(15,"code"),e.EFF(16,"WsException"),e.k0s(),e.EFF(17,". De plus, tous les pipes ne seront appliqu\xe9s qu'au param\xe8tre "),e.j41(18,"code"),e.EFF(19,"data"),e.k0s(),e.EFF(20," (parce que valider ou transformer l'instance "),e.j41(21,"code"),e.EFF(22,"client"),e.k0s(),e.EFF(23," est inutile)."),e.k0s(),e.j41(24,"blockquote",8)(25,"strong"),e.EFF(26,"Astuce"),e.k0s(),e.EFF(27," La classe "),e.j41(28,"code"),e.EFF(29,"WsException"),e.k0s(),e.EFF(30," est expos\xe9e dans le package "),e.j41(31,"code"),e.EFF(32,"@nestjs/websockets"),e.k0s(),e.EFF(33,".\n"),e.k0s(),e.j41(34,"h4",9)(35,"span"),e.EFF(36,"Lier les pipes"),e.k0s()(),e.j41(37,"p"),e.EFF(38,"L'exemple suivant utilise une pipe \xe0 port\xe9e de m\xe9thode instanci\xe9e manuellement. Tout comme pour les applications bas\xe9es sur HTTP, vous pouvez \xe9galement utiliser des pipes \xe0 l'\xe9chelle de la gateway (en pr\xe9fixant la classe de la gateway avec un d\xe9corateur "),e.j41(39,"code"),e.EFF(40,"@UsePipes()"),e.k0s(),e.EFF(41,")."),e.k0s(),e.j41(42,"app-copy-button",10)(43,"span",11),e.nrm(44,"app-tabs",null,1),e.k0s(),e.j41(46,"pre")(47,"code",12),e.EFF(48,"\n@UsePipes(new ValidationPipe({ exceptionFactory: (errors) => new WsException(errors) }))\n@SubscribeMessage('events')\nhandleEvent(client: Client, data: unknown): WsResponse<unknown> {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()(),e.j41(49,"pre")(50,"code",12),e.EFF(51,"\n@UsePipes(new ValidationPipe({ exceptionFactory: (errors) => new WsException(errors) }))\n@SubscribeMessage('events')\nhandleEvent(client, data) {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()()()()),2&t){const o=e.sdS(45);e.R7$(46),e.AVh("hide",o.isJsActive),e.R7$(3),e.AVh("hide",!o.isJsActive)}},dependencies:[c.O,p.a,u.z,l.Wk],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Pipes - Gateways"}},{path:"exception-filters",component:y,data:{title:"Filtres d'exception - Gateways"}},{path:"guards",component:(()=>{class s extends i.y{static \u0275fac=(()=>{let n;return function(a){return(n||(n=e.xGo(s)))(a||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-guards"]],features:[e.Vt3],decls:46,vars:4,consts:[["contentReference",""],["appb1b1685a00bcb9386bbe68b1677e23da5fc0b0d1",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/websockets/guards.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","gardes"],["href","/guards"],[1,"info"],["appAnchor","","id","lier-les-gardes"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"]],template:function(t,a){if(1&t&&(e.j41(0,"div",2,0)(2,"div",3)(3,"a",4),e.nrm(4,"i",5),e.k0s()(),e.j41(5,"h3",6),e.EFF(6,"Gardes"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Il n'y a pas de diff\xe9rence fondamentale entre les gardes de sockets web et les "),e.j41(9,"a",7),e.EFF(10,"gardes d'applications HTTP ordinaires"),e.k0s(),e.EFF(11,". La seule diff\xe9rence est qu'au lieu de lancer "),e.j41(12,"code"),e.EFF(13,"HttpException"),e.k0s(),e.EFF(14,", vous devriez utiliser "),e.j41(15,"code"),e.EFF(16,"WsException"),e.k0s(),e.EFF(17,"."),e.k0s(),e.j41(18,"blockquote",8)(19,"strong"),e.EFF(20,"Astuce"),e.k0s(),e.EFF(21," La classe "),e.j41(22,"code"),e.EFF(23,"WsException"),e.k0s(),e.EFF(24," est expos\xe9e dans le package "),e.j41(25,"code"),e.EFF(26,"@nestjs/websockets"),e.k0s(),e.EFF(27,".\n"),e.k0s(),e.j41(28,"h4",9)(29,"span"),e.EFF(30,"Lier les gardes"),e.k0s()(),e.j41(31,"p"),e.EFF(32,"L'exemple suivant utilise un garde \xe0 l'\xe9chelle de la m\xe9thode. Comme pour les applications bas\xe9es sur HTTP, vous pouvez \xe9galement utiliser des protections au niveau de la gateway (en pr\xe9fixant la classe de la gateway avec un d\xe9corateur "),e.j41(33,"code"),e.EFF(34,"@UseGuards()"),e.k0s(),e.EFF(35,")."),e.k0s(),e.j41(36,"app-copy-button",10)(37,"span",11),e.nrm(38,"app-tabs",null,1),e.k0s(),e.j41(40,"pre")(41,"code",12),e.EFF(42,"\n@UseGuards(AuthGuard)\n@SubscribeMessage('events')\nhandleEvent(client: Client, data: unknown): WsResponse<unknown> {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()(),e.j41(43,"pre")(44,"code",12),e.EFF(45,"\n@UseGuards(AuthGuard)\n@SubscribeMessage('events')\nhandleEvent(client, data) {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()()()()),2&t){const o=e.sdS(39);e.R7$(40),e.AVh("hide",o.isJsActive),e.R7$(3),e.AVh("hide",!o.isJsActive)}},dependencies:[c.O,p.a,u.z],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Gardes - Gateways"}},{path:"interceptors",component:(()=>{class s extends i.y{static \u0275fac=(()=>{let n;return function(a){return(n||(n=e.xGo(s)))(a||s)}})();static \u0275cmp=e.VBU({type:s,selectors:[["app-interceptors"]],features:[e.Vt3],decls:25,vars:4,consts:[["contentReference",""],["appf3448425be3702cccdba875f80ea9e1e738ec687",""],[1,"content"],[1,"github-links"],["href","https://github.com/Lou8is/docs.nestjs.fr/edit/main/content/websockets/interceptors.md","aria-label","Proposer des modifications","title","Proposer des modifications"],[1,"fas","fa-edit"],["id","intercepteurs"],["routerLink","/intercepteurs"],[1,"with-heading"],[1,"filename"],[1,"language-typescript"]],template:function(t,a){if(1&t&&(e.j41(0,"div",2,0)(2,"div",3)(3,"a",4),e.nrm(4,"i",5),e.k0s()(),e.j41(5,"h3",6),e.EFF(6,"Intercepteurs"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Il n'y a pas de diff\xe9rence entre les "),e.j41(9,"a",7),e.EFF(10,"intercepteurs ordinaires"),e.k0s(),e.EFF(11," et les intercepteurs de sockets web. L'exemple suivant utilise un intercepteur \xe0 port\xe9e de m\xe9thode instanci\xe9 manuellement. Tout comme pour les applications bas\xe9es sur HTTP, vous pouvez \xe9galement utiliser des intercepteurs \xe0 l'\xe9chelle de la gateway (c'est-\xe0-dire pr\xe9fixer la classe de la gateway avec un d\xe9corateur "),e.j41(12,"code"),e.EFF(13,"@UseInterceptors()"),e.k0s(),e.EFF(14,"))."),e.k0s(),e.j41(15,"app-copy-button",8)(16,"span",9),e.nrm(17,"app-tabs",null,1),e.k0s(),e.j41(19,"pre")(20,"code",10),e.EFF(21,"\n@UseInterceptors(new TransformInterceptor())\n@SubscribeMessage('events')\nhandleEvent(client: Client, data: unknown): WsResponse<unknown> {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()(),e.j41(22,"pre")(23,"code",10),e.EFF(24,"\n@UseInterceptors(new TransformInterceptor())\n@SubscribeMessage('events')\nhandleEvent(client, data) {\n  const event = 'events';\n  return { event, data };\n}\n"),e.k0s()()()()),2&t){const o=e.sdS(18);e.R7$(19),e.AVh("hide",o.isJsActive),e.R7$(3),e.AVh("hide",!o.isJsActive)}},dependencies:[c.O,u.z,l.Wk],encapsulation:2,changeDetection:0})}return s})(),data:{title:"Intercepteurs - Gateways"}},{path:"adapter",component:g,data:{title:"Adaptateurs - Gateways"}}];let x=(()=>{class s{static \u0275fac=function(t){return new(t||s)};static \u0275mod=e.$C({type:s});static \u0275inj=e.G2t({imports:[j.MD,h.G,l.iI.forChild(w)]})}return s})()}}]);